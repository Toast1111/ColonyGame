:root{--bg:#0b0f14;--fg:#e6f0ff;--accent:#6ee7ff;--muted:#9fb3c8;--good:#7CFC00;--bad:#ff6b6b;--warn:#ffd166}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0f14 0%, #0e121a 60%, #0b0f14 100%);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif;-webkit-text-size-adjust:100%;overscroll-behavior:none}
#wrap,body,header,#game{user-select:none;-webkit-user-select:none;-ms-user-select:none}
#mobileControls, header, #headerDropdown, button { user-select: none; -webkit-user-select: none; }
#game{touch-action:none}
#wrap{position:fixed;inset:0;display:grid;grid-template-rows:auto 1fr}
header{display:flex;gap:.75rem;align-items:center;padding:.5rem .75rem;border-bottom:1px solid #18202c;background:#0d131b88;backdrop-filter:blur(6px)}
header h1{font-size:clamp(14px,2.0vw,20px);font-weight:600;margin:0;letter-spacing:.4px;color:var(--muted)}
header h1 #ver{font-size:.82em;opacity:.9}
header .spacer{flex:1}
header button{appearance:none;border:1px solid #1b2736;background:#0f1621;color:var(--fg);padding:.5rem .8rem;border-radius:.75rem;cursor:pointer;font-size:clamp(13px,1.8vw,18px);line-height:1;min-height:44px;min-width:44px;outline:none}
header button:hover{border-color:#2b3d59}
header button:focus{outline:none;border-color:#2b3d59}
#btnToggleUI{background:#1a2332;border-color:#2b3d59;color:var(--accent);font-size:20px;transition:all 0.2s ease}
#btnToggleUI:hover{background:#243041;border-color:#3b4d69;transform:scale(1.05)}
#game{display:block;width:100%;height:100%}
#headerDropdown{position:fixed;top:56px;right:12px;background:#0f1621;border:1px solid #1e293b;border-radius:.75rem;box-shadow:0 12px 28px #0008;padding:8px;z-index:20}
#headerDropdown[hidden]{display:none}
#headerDropdown button{display:block;width:100%;text-align:left;margin:4px 0;outline:none}
#headerDropdown button:focus{outline:none}
button{outline:none;touch-action:manipulation}
button:focus{outline:none}
#toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#0f172288;border:1px solid #1f2a3a;color:#dfe9ff;padding:.6rem .9rem;border-radius:.75rem;box-shadow:0 10px 30px #00000066;opacity:0;pointer-events:none;transition:opacity .25s ease;font-size:clamp(13px,1.8vw,18px)}
#help{position:fixed;inset:auto 12px 12px auto;max-width:min(560px,42vw);background:#0f172aee;border:1px solid #1e293b;color:#dbeafe;padding:14px 16px;border-radius:14px;box-shadow:0 16px 32px #0008;font-size:clamp(14px,1.9vw,18px);line-height:1.4}
#legend{position:fixed;left:12px;bottom:12px;background:#0f172aee;border:1px solid #1e293b;color:#dbeafe;border-radius:14px;padding:10px 12px;font-size:clamp(12px,1.7vw,17px);line-height:1.35}

/* Research Panel */
#research-panel{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:95vw;height:92vh;background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:2px solid #334155;border-radius:14px;box-shadow:0 20px 60px #0008;flex-direction:column;z-index:1000;overflow:hidden;color:#dbeafe}
#research-panel:not([hidden]){display:flex}
#research-panel h2{margin:0;color:#f1f5f9;font-size:clamp(18px,2.2vw,24px);font-weight:700}
.research-header{padding:16px 20px;background:rgba(15,23,42,0.8);border-bottom:2px solid #334155;display:flex;justify-content:space-between;align-items:center;flex-shrink:0}
.research-close-btn{background:#dc2626;border:none;color:white;width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:18px;font-weight:bold;transition:all 0.2s;outline:none}
.research-close-btn:hover{background:#b91c1c}
.research-close-btn:focus{outline:none}
.research-category-bar{display:flex;gap:8px;padding:12px 16px;background:rgba(15,23,42,0.4);border-bottom:1px solid #334155;overflow-x:auto;flex-shrink:0}
.research-category-btn{padding:8px 16px;border:1px solid;border-radius:6px;cursor:pointer;font-size:clamp(12px,1.6vw,14px);font-weight:600;transition:all 0.2s;white-space:nowrap;outline:none;background:rgba(30,41,59,0.5)}
.research-category-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.3)}
.research-category-btn:focus{outline:none}
.research-category-btn.active{background:rgba(59,130,246,0.2);box-shadow:0 0 12px rgba(59,130,246,0.4)}
.research-tree-container{flex:1;position:relative;overflow:auto;min-height:0;background:radial-gradient(circle at 50% 50%,#1e293b,#0f172a)}
.research-tree-wrapper{position:relative;min-width:100%;min-height:100%}
.research-tree-svg{position:absolute;top:0;left:0;pointer-events:none;z-index:1}
.research-node{position:absolute;width:180px;padding:12px;background:#374151;border:2px solid #6b7280;border-radius:8px;cursor:default;transition:all 0.2s;z-index:2;box-shadow:0 4px 8px rgba(0,0,0,0.3)}
.research-node.available{background:#1e3a5f;border-color:#3b82f6;cursor:pointer;box-shadow:0 6px 16px rgba(59,130,246,0.4)}
.research-node.available:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 8px 20px rgba(59,130,246,0.6);z-index:10}
.research-node.completed{background:#064e3b;border-color:#10b981;box-shadow:0 4px 8px rgba(16,185,129,0.3)}
.research-node.in-progress{background:#7c2d12;border-color:#ea580c;box-shadow:0 4px 8px rgba(234,88,12,0.4);animation:pulse-research 2s ease-in-out infinite}
@keyframes pulse-research{0%,100%{box-shadow:0 4px 8px rgba(234,88,12,0.4)}50%{box-shadow:0 6px 16px rgba(234,88,12,0.7)}}
.research-node-header{display:flex;align-items:center;gap:6px;margin-bottom:6px}
.research-node-status{font-size:16px;flex-shrink:0}
.research-node-title{color:#f1f5f9;font-weight:700;font-size:13px;line-height:1.2}
.research-node-cost{color:#94a3b8;font-size:11px;font-weight:600;margin-bottom:6px}
.research-node-desc{color:#cbd5e1;font-size:11px;line-height:1.3;margin-bottom:6px}
.research-node-unlocks{color:#a3e635;font-size:10px;font-weight:600}
.research-progress-container{padding:12px 20px;background:rgba(15,23,42,0.6);border-top:2px solid #334155;flex-shrink:0}
.research-progress-info{color:#94a3b8;font-size:clamp(12px,1.5vw,14px);text-align:left}
.research-cancel-btn{background:#dc2626;border:1px solid #b91c1c;color:white;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:clamp(11px,1.4vw,13px);font-weight:600;transition:all 0.2s;outline:none}
.research-cancel-btn:hover{background:#b91c1c;transform:translateY(-1px);box-shadow:0 2px 8px rgba(220,38,38,0.4)}
.research-cancel-btn:focus{outline:none}
.research-progress-bar-outer{background:#1e293b;border-radius:6px;height:20px;overflow:hidden}
.research-progress-bar-inner{height:100%;width:0;background:linear-gradient(90deg,#3b82f6,#2563eb);transition:width 0.3s;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:white}
.tag{display:inline-block;padding:.05rem .35rem;border-radius:.35rem;margin-right:.3rem;font-weight:600}
.t-colonist{background:#c7f9cc22;border:1px solid #c7f9cc55;color:#c7f9cc}
.t-enemy{background:#ffd6d622;border:1px solid #ffd6d655;color:#ffd6d6}
.t-tree{background:#c4f1be22;border:1px solid #c4f1be55;color:#c4f1be}
.t-rock{background:#cbd5e122;border:1px solid #cbd5e155;color:#cbd5e1}
.t-bld{background:#93c5fd22;border:1px solid #93c5fd55;color:#93c5fd}

/* Mobile controls overlay */
#mobileControls{position:fixed;right:12px;bottom:102px;display:flex;flex-direction:column;gap:8px;z-index:10}
#mobileControls button{appearance:none;border:1px solid #1b2736;background:#0f1621;color:var(--fg);padding:.6rem;border-radius:.75rem;cursor:pointer;font-size:18px;min-height:44px;min-width:44px;box-shadow:0 4px 12px #0006;outline:none;transition:all 0.2s ease}
#mobileControls button:hover{border-color:#2b3d59;background:#1a2332}
#mobileControls button:active{transform:scale(0.95)}
#mobileControls button:focus{outline:none}
#mobileControls button.active{background:#1a2332;border-color:#2b3d59;color:var(--accent)}
#mobileControls #mc-skip-tutorial{background:#ff5252;border-color:#ff7777;color:#ffffff;animation:skipButtonPulse 2s infinite}
#mobileControls #mc-skip-tutorial:hover{background:#ff3333;border-color:#ff5555}
#mobileControls .zoom{display:flex;gap:8px;justify-content:flex-end}
#mobileControls .zoom button{min-width:44px}

@keyframes skipButtonPulse{0%,100%{box-shadow:0 4px 12px #0006}50%{box-shadow:0 4px 16px #ff525255,0 0 8px #ff525233}}

body:not(.touch-ui) #mobileControls{display:none!important}
body.touch-ui #mobileControls{display:flex;right:max(10px,calc(env(safe-area-inset-right,0px) + 10px));bottom:max(88px,calc(env(safe-area-inset-bottom,0px) + 68px))}
body.touch-ui #mobileControls button{min-height:52px;min-width:52px;font-size:clamp(18px,4.2vw,22px);padding:.8rem}
body.touch-ui header button{min-height:52px;min-width:52px;font-size:clamp(16px,3.8vw,20px);padding:.75rem 1rem}
body.touch-ui #headerDropdown{right:max(12px,calc(env(safe-area-inset-right,0px) + 12px));padding:12px;border-radius:1rem}
body.touch-ui #headerDropdown button{padding:.85rem 1rem;font-size:clamp(15px,3.6vw,18px)}
body.touch-ui #toast{bottom:max(16px,calc(env(safe-area-inset-bottom,0px) + 20px))}

/* Touch-friendly and tablet adjustments (iPad 10th gen is 820px wide in portrait) */
@media (max-width: 1024px), (hover: none) and (pointer: coarse) {
	header { padding: .5rem .65rem; gap: .5rem; }
	header h1 { font-size: clamp(14px, 2.1vw, 18px); }
	header h1 #ver { font-size: .78em; opacity: .85; }
	header button { padding: .55rem .8rem; min-height: 44px; font-size: clamp(14px, 2.0vw, 17px); }
	#btnMenu{display:inline-block}
	#btnToggleUI{display:inline-block} /* Keep toggle button visible on all devices */
	#btnNew,#btnPause,#btnHelp{display:none}

	#legend { left: 10px; bottom: 10px; border-radius: 16px; padding: 14px 16px; font-size: clamp(15px, 2.6vw, 19px); }
	#help { inset: auto 12px 12px 12px; max-width: none; width: calc(100vw - 24px); border-radius: 18px; font-size: clamp(16px, 2.6vw, 20px); }
	#research-panel { width: calc(100vw - 24px); height: min(88vh, 700px); border-radius: 16px; }
	.research-category-bar { padding: 10px 12px; gap: 6px; }
	.research-category-btn { padding: 10px 14px; font-size: clamp(14px, 2.2vw, 16px); }
	.research-node { width: 160px; padding: 10px; font-size: 11px; }
	.research-node-title { font-size: 12px; }
	#toast { bottom: 14px; border-radius: 14px; font-size: clamp(15px, 2.5vw, 19px); }
	.tag { padding: .12rem .5rem; border-radius: .5rem; }
	#mobileControls { bottom: 100px; right: 10px; gap: 10px; }
	#mobileControls button { font-size: 20px; padding: .7rem; min-height: 48px; }
	#mobileControls button:hover { background: #0f1621; }
	#mobileControls button:active { transform: scale(0.95); }
}

/* Research Tooltip */
.research-tooltip{
	position:fixed;
	background:#1e293b;
	border:2px solid #475569;
	border-radius:8px;
	padding:12px 14px;
	box-shadow:0 8px 24px rgba(0,0,0,0.6);
	z-index:10001;
	color:#cbd5e1;
	font-size:13px;
	max-width:280px;
	pointer-events:none;
}

/* Changelog Modal */
.changelog-modal {
	position: fixed;
	inset: 0;
	z-index: 1000;
	display: flex;
	align-items: center;
	justify-content: center;
	animation: fadeIn 0.2s ease;
}

.changelog-modal .modal-backdrop {
	position: absolute;
	inset: 0;
	background: rgba(0, 0, 0, 0.7);
	backdrop-filter: blur(4px);
}

.changelog-modal .modal-container {
	position: relative;
	background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
	border: 2px solid #334155;
	border-radius: 16px;
	box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
	width: min(90vw, 800px);
	height: min(85vh, 700px);
	display: flex;
	flex-direction: column;
	overflow: hidden;
}

.changelog-modal .modal-header {
	padding: 20px 24px;
	background: rgba(15, 23, 42, 0.8);
	border-bottom: 2px solid #334155;
	display: flex;
	justify-content: space-between;
	align-items: center;
	flex-shrink: 0;
}

.changelog-modal .modal-header h2 {
	margin: 0;
	color: #f1f5f9;
	font-size: clamp(20px, 2.5vw, 26px);
	font-weight: 700;
}

.changelog-modal .modal-close {
	background: #dc2626;
	border: none;
	color: white;
	width: 36px;
	height: 36px;
	border-radius: 8px;
	cursor: pointer;
	font-size: 24px;
	font-weight: bold;
	line-height: 1;
	transition: all 0.2s;
	outline: none;
}

.changelog-modal .modal-close:hover {
	background: #b91c1c;
	transform: scale(1.1);
}

.changelog-modal .modal-body {
	flex: 1;
	overflow: auto;
	padding: 0;
}

.changelog-content {
	padding: 24px;
}

.changelog-loading {
	text-align: center;
	padding: 60px 20px;
	color: #94a3b8;
}

.changelog-loading .spinner {
	width: 40px;
	height: 40px;
	border: 4px solid #334155;
	border-top: 4px solid #3b82f6;
	border-radius: 50%;
	animation: spin 1s linear infinite;
	margin: 0 auto 20px;
}

@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.changelog-entry {
	margin-bottom: 32px;
	padding-bottom: 24px;
	border-bottom: 1px solid #334155;
}

.changelog-entry:last-child {
	border-bottom: none;
	margin-bottom: 0;
}

.changelog-entry.prerelease {
	opacity: 0.8;
}

.changelog-header {
	display: flex;
	justify-content: space-between;
	align-items: flex-start;
	margin-bottom: 16px;
	gap: 16px;
}

.changelog-header h3 {
	margin: 0;
	color: #f1f5f9;
	font-size: clamp(18px, 2.2vw, 22px);
	font-weight: 700;
	display: flex;
	align-items: center;
	gap: 12px;
}

.prerelease-badge {
	background: #f59e0b;
	color: #1c1917;
	font-size: 12px;
	font-weight: 600;
	padding: 4px 8px;
	border-radius: 6px;
	text-transform: uppercase;
	letter-spacing: 0.5px;
}

.changelog-date {
	color: #94a3b8;
	font-size: 14px;
	font-weight: 500;
	flex-shrink: 0;
}

.changelog-body {
	color: #cbd5e1;
	line-height: 1.6;
}

.changelog-body h1, .changelog-body h2, .changelog-body h3 {
	color: #f1f5f9;
	margin: 20px 0 12px 0;
}

.changelog-body h1 { font-size: 24px; }
.changelog-body h2 { font-size: 20px; }
.changelog-body h3 { font-size: 18px; }

.changelog-body ul {
	padding-left: 20px;
	margin: 12px 0;
}

.changelog-body li {
	margin: 6px 0;
}

.changelog-body p {
	margin: 12px 0;
}

.changelog-body code {
	background: #374151;
	color: #fbbf24;
	padding: 2px 6px;
	border-radius: 4px;
	font-size: 0.9em;
}

.changelog-body strong {
	color: #f1f5f9;
	font-weight: 600;
}

.changelog-body a {
	color: #60a5fa;
	text-decoration: none;
}

.changelog-body a:hover {
	text-decoration: underline;
}

.changelog-error {
	text-align: center;
	padding: 60px 20px;
	color: #94a3b8;
}

.changelog-error h3 {
	color: #f87171;
	margin: 0 0 16px 0;
}

.changelog-error p {
	margin: 12px 0;
}

/* Commit information styling */
.changelog-commits {
	margin-top: 20px;
	padding: 16px;
	background: rgba(15, 23, 42, 0.6);
	border-radius: 8px;
	border-left: 4px solid #3b82f6;
}

.changelog-commits h4 {
	margin: 0 0 12px 0;
	color: #f1f5f9;
	font-size: 16px;
	font-weight: 600;
}

.changelog-commit {
	display: flex;
	align-items: center;
	gap: 12px;
	padding: 8px 0;
	border-bottom: 1px solid rgba(51, 65, 85, 0.5);
	flex-wrap: wrap;
}

.changelog-commit:last-child {
	border-bottom: none;
}

.commit-sha {
	font-family: 'Courier New', Consolas, monospace;
	background: #374151;
	color: #fbbf24;
	padding: 3px 8px;
	border-radius: 4px;
	font-size: 12px;
	font-weight: 600;
	flex-shrink: 0;
}

.commit-message {
	flex: 1;
	color: #cbd5e1;
	font-size: 14px;
	line-height: 1.4;
	min-width: 0; /* Allow text to wrap */
}

.commit-date {
	color: #94a3b8;
	font-size: 12px;
	flex-shrink: 0;
}

@keyframes fadeIn {
	from { opacity: 0; transform: scale(0.95); }
	to { opacity: 1; transform: scale(1); }
}

/* Mobile adjustments for changelog */
@media (max-width: 1024px), (hover: none) and (pointer: coarse) {
	.changelog-modal .modal-container {
		width: calc(100vw - 24px);
		height: min(90vh, 600px);
		border-radius: 20px;
	}
	
	.changelog-modal .modal-header {
		padding: 16px 20px;
	}
	
	.changelog-content {
		padding: 20px;
	}
	
	.changelog-entry {
		margin-bottom: 24px;
		padding-bottom: 20px;
	}
	
	.changelog-header {
		flex-direction: column;
		align-items: flex-start;
		gap: 8px;
	}
	
	.changelog-commit {
		flex-direction: column;
		align-items: flex-start;
		gap: 6px;
		padding: 12px 0;
	}
	
	.commit-message {
		font-size: 13px;
	}
}
