var Ti=Object.defineProperty;var Pi=(t,e,i)=>e in t?Ti(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var x=(t,e,i)=>Pi(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}})();const ee=(t,e)=>Math.random()*(e-t)+t,Bi=(t,e)=>Math.floor(ee(t,e)),ie=(t,e,i)=>Math.max(e,Math.min(i,t)),re=(t,e)=>{const i=t.x-e.x,n=t.y-e.y;return i*i+n*n},Ii=t=>Math.hypot(t.x,t.y),Ei=t=>{const e=Ii(t)||1;return{x:t.x/e,y:t.y/e}},Di=(t,e)=>({x:t.x-e.x,y:t.y-e.y}),A=32,Q={w:240*A,h:240*A},oe={x:Q.w/2,y:Q.h/2},_={sky:"#0a0e14",ground:"#0e161f",colonist:"#c7f9cc",enemy:"#ff9aa2",tree:"#6fbf73",rock:"#9aa5b1",ghost:"#6ee7ff",wall:"#9aa5b1",bld:"#93c5fd",turret:"#93c5fd",farm:"#8bd3dd",house:"#e2b714",stock:"#c084fc",tent:"#f59e0b",bed:"#f8fafc"};var dt=(t=>(t.GRASS="grass",t.DIRT="dirt",t.STONE="stone",t.SAND="sand",t.MUD="mud",t.SOFT_DIRT="soft_dirt",t.SHALLOW_WATER="shallow_water",t.DEEP_WATER="deep_water",t.ROCK="rock",t.SNOW="snow",t.ICE="ice",t.MARSH="marsh",t.GRAVEL="gravel",t))(dt||{}),$=(t=>(t.NONE="none",t.BASIC_PATH="basic_path",t.STONE_ROAD="stone_road",t.WOODEN_FLOOR="wooden_floor",t.CONCRETE="concrete",t.METAL_FLOOR="metal_floor",t.CARPET="carpet",t))($||{});const ai={grass:1,dirt:1,stone:1.1,sand:1.2,mud:2.5,soft_dirt:1.4,shallow_water:1.8,deep_water:999,rock:999,snow:1.3,ice:.9,marsh:2,gravel:1.05},Fi={none:1,basic_path:.6,stone_road:.5,wooden_floor:.7,concrete:.55,metal_floor:.65,carpet:.85},li={none:{color:"transparent",renderLayer:1},basic_path:{color:"#9ca3af",pattern:"solid",renderLayer:1},stone_road:{color:"#6b7280",secondaryColor:"#5b6270",pattern:"noise",renderLayer:1},wooden_floor:{color:"#92400e",secondaryColor:"#a2500e",pattern:"stripes",renderLayer:1},concrete:{color:"#9ca3af",pattern:"solid",renderLayer:1},metal_floor:{color:"#71717a",secondaryColor:"#81818a",pattern:"stripes",renderLayer:1},carpet:{color:"#991b1b",pattern:"solid",renderLayer:1}};function Li(t,e){const i=t*e;return{cols:t,rows:e,terrain:new Uint8Array(i).fill(Ni("grass")),floors:new Uint8Array(i).fill(Wi("none"))}}function Ni(t){return Object.values(dt).indexOf(t)}function ci(t){return Object.values(dt)[t]}function Wi(t){return Object.values($).indexOf(t)}function Ne(t){return Object.values($)[t]}function Gi(t,e,i){const n=i*t.cols+e,o=ci(t.terrain[n]),a=Ne(t.floors[n]),s=ai[o]||1,r=Fi[a]||1;return s*r}function Oi(t,e,i){const n=i*t.cols+e,o=ci(t.terrain[n]);return ai[o]<100}function Ue(t,e,i,n){return Math.abs(t-i)+Math.abs(e-n)}function zi(){const t=Math.ceil(7680/A),e=Math.ceil(7680/A),i=t*e,n=32,o=Math.ceil(t/n),a=Math.ceil(e/n),s=o*a;return{cols:t,rows:e,solid:new Uint8Array(i),cost:new Float32Array(i).fill(1),minCost:1,sectionSize:n,sectionCols:o,sectionRows:a,dirtyFlags:new Uint8Array(s)}}function Hi(t){t.solid.fill(0),t.cost.fill(1),t.minCost=1,t.dirtyFlags.fill(1)}function Yi(t,e,i,n,o){const a=Math.min(t.cols,e+n),s=Math.min(t.rows,i+o);for(let f=i;f<s;f++)for(let d=e;d<a;d++){const u=f*t.cols+d;t.solid[u]=0,t.cost[u]=1}const r=Math.floor(e/t.sectionSize),l=Math.floor(i/t.sectionSize),c=Math.min(t.sectionCols-1,Math.floor((a-1)/t.sectionSize)),h=Math.min(t.sectionRows-1,Math.floor((s-1)/t.sectionSize));for(let f=l;f<=h;f++)for(let d=r;d<=c;d++){const u=f*t.sectionCols+d;t.dirtyFlags[u]=1}}function ht(t){if(!t.terrainGrid)return;const{cols:e,rows:i,terrainGrid:n}=t;let o=1/0;for(let a=0;a<i;a++)for(let s=0;s<e;s++){const r=a*e+s,l=Gi(n,s,a);t.cost[r]=l,l<o&&l>0&&(o=l),Oi(n,s,a)||(t.solid[r]=1)}t.minCost=o,t.dirtyFlags.fill(1)}function ft(t,e,i,n,o){const a=Math.floor(Math.floor(e/A)/t.sectionSize),s=Math.floor(Math.floor(i/A)/t.sectionSize),r=Math.floor(Math.floor((e+n-1)/A)/t.sectionSize),l=Math.floor(Math.floor((i+o-1)/A)/t.sectionSize);for(let c=Math.max(0,s);c<=Math.min(t.sectionRows-1,l);c++)for(let h=Math.max(0,a);h<=Math.min(t.sectionCols-1,r);h++){const f=c*t.sectionCols+h;t.dirtyFlags[f]=1}}function di(t,e,i,n,o){const a=Math.floor(e/A),s=Math.floor(i/A),r=Math.floor((e+n-1)/A),l=Math.floor((i+o-1)/A);for(let c=s;c<=l;c++)for(let h=a;h<=r;h++)if(h>=0&&c>=0&&h<t.cols&&c<t.rows){const f=c*t.cols+h;t.solid[f]=1}ft(t,e,i,n,o)}function Qe(t,e,i,n){const o=Math.floor((e-n)/A),a=Math.floor((i-n)/A),s=Math.floor((e+n)/A),r=Math.floor((i+n)/A);for(let l=a;l<=r;l++)for(let c=o;c<=s;c++)if(c>=0&&l>=0&&c<t.cols&&l<t.rows){const h=c*A+A/2,f=l*A+A/2,d=h-e,u=f-i;if(d*d+u*u<=n*n){const m=l*t.cols+c;t.solid[m]=1}}ft(t,e-n,i-n,n*2,n*2)}function ji(t,e,i,n,o,a){const s=Math.floor(e/A),r=Math.floor(i/A),l=Math.floor((e+n-1)/A),c=Math.floor((i+o-1)/A);for(let h=r;h<=c;h++)for(let f=s;f<=l;f++)if(f>=0&&h>=0&&f<t.cols&&h<t.rows){const d=h*t.cols+f;t.cost[d]=a,a<t.minCost&&(t.minCost=a)}ft(t,e,i,n,o)}const hi=.7,Ui={BASIC_PATH:.6,FAST_ROAD:.5,SLOW_PATH:.7,GRASS:1,ROUGH_TERRAIN:1.5};function Le(t,e){return t.cost[e]<=hi}function Mt(t,e,i){const n=Math.floor(e/A),o=Math.floor(i/A);return n<0||o<0||n>=t.cols||o>=t.rows?!1:Le(t,o*t.cols+n)}function Pe(t,e,i,n,o,a="BASIC_PATH"){const s=Ui[a],r=Math.max(.5,Math.min(.7,s));ji(t,e,i,n,o,r)}function Ze(t,e){return{gx:Math.floor(t/A),gy:Math.floor(e/A)}}function Qi(t,e){for(let i=0;i<e.length;i++){const n=Math.floor(e[i].x/A),o=Math.floor(e[i].y/A);if(n>=0&&o>=0&&n<t.cols&&o<t.rows){const a=o*t.cols+n;Le(t,a)&&(e[i].x=n*A+A/2,e[i].y=o*A+A/2)}}}function qi(t,e,i,n){const o=Ze(e.x,e.y),a=Ze(i.x,i.y),s=Ze(n.x,n.y),r=Math.sign(a.gx-o.gx),l=Math.sign(a.gy-o.gy),c=Math.sign(s.gx-a.gx),h=Math.sign(s.gy-a.gy),f=r!==0&&h!==0||l!==0&&c!==0,d=a.gy*t.cols+a.gx;return f&&d>=0&&d<t.cost.length&&Le(t,d)}function fi(t,e,i,n,o){const a=t.cols,s=t.rows,r={x:Math.floor(e/A),y:Math.floor(i/A)},l={x:Math.floor(n/A),y:Math.floor(o/A)},c=(S,P)=>P*a+S;if(r.x===l.x&&r.y===l.y)return[{x:n,y:o}];const h=c(r.x,r.y),f=c(l.x,l.y),d=(S,P)=>S>=0&&P>=0&&S<a&&P<s,u=(S,P)=>{if(!d(S,P))return!1;const I=c(S,P);return I===h||I===f?!0:t.solid[I]===0},m=new Int32Array(a*s).fill(-1),g=new Float32Array(a*s).fill(1/0),p=new Float32Array(a*s).fill(1/0),b=new Uint8Array(a*s),v=[],M=S=>{v.push(S)},w=()=>{let S=-1,P=1/0;for(let B=0;B<v.length;B++){const N=v[B];if(b[N])continue;const O=p[N];O<P&&(P=O,S=B)}return S===-1?-1:v.splice(S,1)[0]},C=Math.max(1e-4,t.minCost);g[h]=0,p[h]=Ue(r.x,r.y,l.x,l.y)*C,M(h);const k=[[1,0],[-1,0],[0,1],[0,-1]];for(;v.length;){const S=w();if(S===-1)break;if(b[S])continue;b[S]=1;const P=S%a,I=S/a|0;if(S===f){let B=[],N=S;for(;N!==-1;){const q=N%a,U=N/a|0;B.push({x:q*A+A/2,y:U*A+A/2}),N=m[N]}B.reverse(),B[B.length-1]={x:n,y:o};const O=[];for(let q=0;q<B.length-1;q++){const U=B[q],K=B[q+1];O.push(U);const y=Math.floor(U.x/A),R=Math.floor(U.y/A),W=Math.floor(K.x/A),T=Math.floor(K.y/A),E=R*a+y,D=T*a+W,z=Le(t,E)&&Le(t,D);if(!(z&&(R===T||y===W)))if(z){const F=K.x-U.x,G=K.y-U.y,Y=Math.hypot(F,G),se=Math.floor(Y/18);for(let ne=1;ne<=se;ne++){const Z=ne/(se+1);O.push({x:U.x+F*Z,y:U.y+G*Z})}}else{const F=K.x-U.x,G=K.y-U.y,Y=Math.hypot(F,G),se=Math.floor(Y/24);for(let ne=1;ne<=se;ne++){const Z=ne/(se+1);O.push({x:U.x+F*Z,y:U.y+G*Z})}}}O.push(B[B.length-1]),B=O;const X=(q,U,K,y)=>{const R=K-q,W=y-U,T=Math.hypot(R,W)||1,E=Math.max(6,A*.33),D=Math.ceil(T/E);let z=0,L=0;for(let G=1;G<D;G++){const Y=G/D,se=q+R*Y,ne=U+W*Y,Z=Math.floor(se/A),we=Math.floor(ne/A);if(Z<0||we<0||Z>=t.cols||we>=t.rows)return!1;const Oe=we*t.cols+Z;if(t.solid[Oe])return!1;t.cost[Oe]<=hi&&z++,L++}const J=Mt(t,q,U),F=Mt(t,K,y);return J&&F&&L>0?z/L>=.6:!0},j=[];let H=0;for(;H<B.length;){j.push(B[H]);let q=H+2,U=H+1;for(;q<B.length&&!qi(t,B[H],B[H+1],B[q]);)if(X(B[H].x,B[H].y,B[q].x,B[q].y))U=q,q++;else break;H=U}return B=j.length>=2?j:B,Qi(t,B),B}for(const[B,N]of k){const O=P+B,X=I+N;if(!u(O,X))continue;const j=X*a+O,H=t.cost[j]||1,q=g[S]+H;if(q<g[j]){m[j]=S,g[j]=q;const U=Ue(O,X,l.x,l.y)*Math.max(1e-4,t.minCost)*.9999;p[j]=q+U,M(j)}}}return null}function Xi(t,e,i,n,o,a){const{cols:s,rows:r}=t,l={x:Math.floor(e/A),y:Math.floor(i/A)},c={x:Math.floor(n/A),y:Math.floor(o/A)};if(l.x<0||l.y<0||l.x>=s||l.y>=r||c.x<0||c.y<0||c.x>=s||c.y>=r)return null;const h=l.y*s+l.x,f=c.y*s+c.x;if(h===f||t.solid[h]||t.solid[f]||a&&a.isEnabled&&a.isEnabled()&&!a.isReachable(e,i,n,o))return null;const d=new Float32Array(s*r).fill(1/0),u=new Float32Array(s*r).fill(1/0),m=new Int32Array(s*r).fill(-1),g=new Uint8Array(s*r),p=[];d[h]=0,u[h]=Ue(l.x,l.y,c.x,c.y),p.push(h);const b=C=>{p.push(C);let k=p.length-1;for(;k>0;){const S=k-1>>1;if(u[p[S]]<=u[p[k]])break;const P=p[S];p[S]=p[k],p[k]=P,k=S}},v=()=>{if(!p.length)return-1;const C=p[0],k=p.pop();if(p.length>0){p[0]=k;let S=0;for(;;){const P=(S<<1)+1,I=(S<<1)+2;let B=S;if(P<p.length&&u[p[P]]<u[p[B]]&&(B=P),I<p.length&&u[p[I]]<u[p[B]]&&(B=I),B===S)break;const N=p[S];p[S]=p[B],p[B]=N,S=B}}return C},M=(C,k)=>C<0||k<0||C>=s||k>=r?!1:!t.solid[k*s+C],w=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];for(;p.length;){const C=v();if(C===-1)break;if(g[C])continue;g[C]=1;const k=C%s,S=C/s|0;if(C===f){const P=[];let I=C;for(;I!==-1;){const B=I%s,N=I/s|0;P.push({x:B*A+A/2,y:N*A+A/2}),I=m[I]}return P.reverse(),P.length>1&&Math.hypot(P[0].x-e,P[0].y-i)<A*.3&&P.shift(),P.length>0?P:null}for(const[P,I]of w){const B=k+P,N=S+I;if(!M(B,N)||P!==0&&I!==0&&!M(k+P,S)&&!M(k,S+I))continue;const O=N*s+B,H=(P!==0&&I!==0?1.414:1)*(t.cost[O]||1),q=d[C]+H;if(q<d[O]){m[O]=C,d[O]=q;const U=Ue(B,N,c.x,c.y)*Math.max(1e-4,t.minCost)*.9999;u[O]=q+U,b(O)}}}return null}function kt(t){let e=0;return t.edge===0||t.edge===2?e=t.x*1e5+t.span*10+(t.edge===0?0:2):e=t.y*1e5+t.span*10+(t.edge===1?1:3),e}function le(t,e,i){return e*i+t}function he(t,e,i,n){return t>=0&&e>=0&&t<i&&e<n}function Ke(t,e,i,n){return t===0||e===0||t===i-1||e===n-1}function ze(t,e){return[{x:t,y:e-1,edge:0},{x:t+1,y:e,edge:1},{x:t,y:e+1,edge:2},{x:t-1,y:e,edge:3}]}function _e(t){return{id:t,cells:new Set,neighbors:new Set,links:[],roomId:null,touchesMapEdge:!1,objects:{buildings:new Set,trees:new Set,rocks:new Set},valid:!0,isExternal:!1}}function Ji(t){return{id:t,regions:new Set,isPrison:!1,isOutdoors:!0,touchesMapEdge:!1}}class Vi{constructor(e,i){x(this,"regionIds");x(this,"cols");x(this,"rows");this.cols=e,this.rows=i,this.regionIds=new Int32Array(e*i).fill(-1)}get(e,i){return he(e,i,this.cols,this.rows)?this.regionIds[le(e,i,this.cols)]:-1}set(e,i,n){he(e,i,this.cols,this.rows)&&(this.regionIds[le(e,i,this.cols)]=n)}clear(){this.regionIds.fill(-1)}}class Zi{constructor(e){x(this,"navGrid");x(this,"regionGrid");x(this,"regions");x(this,"rooms");x(this,"nextRegionId");x(this,"nextRoomId");x(this,"linkHashIndex");x(this,"doorPositions");this.navGrid=e,this.regionGrid=new Vi(e.cols,e.rows),this.regions=new Map,this.rooms=new Map,this.nextRegionId=0,this.nextRoomId=0,this.linkHashIndex=new Map,this.doorPositions=new Set}buildAll(e){console.log("[RegionBuilder] Building all regions...");const i=performance.now();if(this.clear(),e)for(const o of e){const a=Math.floor(o.x/A),s=Math.floor(o.y/A),r=le(a,s,this.navGrid.cols);this.doorPositions.add(r)}for(const o of this.doorPositions){const a=o%this.navGrid.cols,s=Math.floor(o/this.navGrid.cols);if(this.navGrid.solid[o]===1)continue;const r=this.nextRegionId++,l=_e(r);l.cells.add(o),this.regionGrid.set(a,s,r),Ke(a,s,this.navGrid.cols,this.navGrid.rows)&&(l.touchesMapEdge=!0),this.regions.set(r,l)}for(let o=0;o<this.navGrid.rows;o++)for(let a=0;a<this.navGrid.cols;a++){const s=le(a,o,this.navGrid.cols);this.regionGrid.regionIds[s]===-1&&this.navGrid.solid[s]!==1&&(this.doorPositions.has(s)||this.floodFillRegion(a,o))}this.detectAllLinks(),this.buildRooms();const n=performance.now()-i;console.log(`[RegionBuilder] Built ${this.regions.size} regions and ${this.rooms.size} rooms in ${n.toFixed(2)}ms`)}rebuildArea(e,i,n,o,a){if(console.log(`[RegionBuilder] Rebuilding area (${e},${i}) to (${n},${o})`),this.doorPositions.clear(),a)for(const r of a){const l=Math.floor(r.x/A),c=Math.floor(r.y/A),h=le(l,c,this.navGrid.cols);this.doorPositions.add(h)}const s=new Set;for(let r=i;r<=o;r++)for(let l=e;l<=n;l++){if(!he(l,r,this.navGrid.cols,this.navGrid.rows))continue;const c=this.regionGrid.get(l,r);c>=0&&s.add(c)}for(const r of s)this.deleteRegion(r);for(let r=i;r<=o;r++)for(let l=e;l<=n;l++){if(!he(l,r,this.navGrid.cols,this.navGrid.rows))continue;const c=le(l,r,this.navGrid.cols);if(!this.doorPositions.has(c)||this.regionGrid.regionIds[c]!==-1||this.navGrid.solid[c]===1)continue;const h=this.nextRegionId++,f=_e(h);f.cells.add(c),this.regionGrid.set(l,r,h),Ke(l,r,this.navGrid.cols,this.navGrid.rows)&&(f.touchesMapEdge=!0),this.regions.set(h,f)}for(let r=i;r<=o;r++)for(let l=e;l<=n;l++){if(!he(l,r,this.navGrid.cols,this.navGrid.rows))continue;const c=le(l,r,this.navGrid.cols);this.regionGrid.regionIds[c]===-1&&this.navGrid.solid[c]!==1&&(this.doorPositions.has(c)||this.floodFillRegion(l,r))}this.detectLinksInArea(e-1,i-1,n+1,o+1),this.buildRooms()}floodFillRegion(e,i){const n=this.nextRegionId++,o=_e(n),a=[{x:e,y:i}],s=new Set;for(;a.length>0;){const{x:r,y:l}=a.shift(),c=le(r,l,this.navGrid.cols);if(!s.has(c)&&(s.add(c),!!he(r,l,this.navGrid.cols,this.navGrid.rows)&&this.navGrid.solid[c]!==1&&!(this.regionGrid.regionIds[c]>=0)&&!this.doorPositions.has(c))){o.cells.add(c),this.regionGrid.set(r,l,n),Ke(r,l,this.navGrid.cols,this.navGrid.rows)&&(o.touchesMapEdge=!0);for(const{x:h,y:f}of ze(r,l)){const d=le(h,f,this.navGrid.cols);s.has(d)||a.push({x:h,y:f})}}}o.cells.size>0&&this.regions.set(n,o)}detectAllLinks(){this.linkHashIndex.clear();for(const e of this.regions.values())this.detectLinksForRegion(e)}detectLinksForRegion(e){e.links=[],e.neighbors.clear();const i=this.findEdgeCells(e),n=this.extractLinks(i,e.id);for(const o of n){e.links.push(o);const a=kt(o),s=this.linkHashIndex.get(a);if(s&&s.regionId!==e.id){e.neighbors.add(s.regionId);const r=this.regions.get(s.regionId);r&&r.neighbors.add(e.id)}this.linkHashIndex.set(a,{...o,regionId:e.id})}}findEdgeCells(e){const i=new Set;for(const n of e.cells){const o=n%this.navGrid.cols,a=Math.floor(n/this.navGrid.cols);for(const{x:s,y:r}of ze(o,a)){if(!he(s,r,this.navGrid.cols,this.navGrid.rows)){i.add(n);break}const l=le(s,r,this.navGrid.cols);if(this.regionGrid.regionIds[l]!==e.id){i.add(n);break}}}return i}extractLinks(e,i){const n=[],o=new Set;for(const a of e){if(o.has(a))continue;const s=a%this.navGrid.cols,r=Math.floor(a/this.navGrid.cols);for(const{x:l,y:c,edge:h}of ze(s,r)){if(!he(l,c,this.navGrid.cols,this.navGrid.rows))continue;const f=le(l,c,this.navGrid.cols);if(this.regionGrid.regionIds[f]===i||this.navGrid.solid[f]===1)continue;const u=this.traceLink(s,r,h,e,o);u&&n.push(u)}}return n}traceLink(e,i,n,o,a){const s={span:0,edge:n,x:e,y:i};let r=0,l=0;n===0||n===2?r=1:l=1;let c=e,h=i;for(;;){const f=le(c,h,this.navGrid.cols);if(!o.has(f))break;const u=ze(c,h).find(g=>g.edge===n);if(!u)break;const m=le(u.x,u.y,this.navGrid.cols);if(!he(u.x,u.y,this.navGrid.cols,this.navGrid.rows)||this.navGrid.solid[m]===1||(s.span++,a.add(f),c+=r,h+=l,!he(c,h,this.navGrid.cols,this.navGrid.rows)))break}return s.span>0?s:null}detectLinksInArea(e,i,n,o){const a=new Set;for(let s=Math.max(0,i);s<=Math.min(this.navGrid.rows-1,o);s++)for(let r=Math.max(0,e);r<=Math.min(this.navGrid.cols-1,n);r++){const l=this.regionGrid.get(r,s);l>=0&&a.add(l)}for(const s of a){const r=this.regions.get(s);r&&this.detectLinksForRegion(r)}}buildRooms(){this.rooms.clear(),this.nextRoomId=0;for(const i of this.regions.values())i.roomId=null;const e=new Set;for(const i of this.regions.values()){if(e.has(i.id))continue;const n=this.nextRoomId++,o=Ji(n),a=[i.id];for(;a.length>0;){const s=a.shift();if(e.has(s))continue;e.add(s);const r=this.regions.get(s);if(r){r.roomId=n,o.regions.add(s),r.touchesMapEdge&&(o.touchesMapEdge=!0);for(const l of r.neighbors)e.has(l)||a.push(l)}}this.rooms.set(n,o)}}deleteRegion(e){const i=this.regions.get(e);if(i){for(const n of i.cells)this.regionGrid.regionIds[n]=-1;for(const n of i.neighbors){const o=this.regions.get(n);o&&o.neighbors.delete(e)}for(const n of i.links){const o=kt(n);this.linkHashIndex.delete(o)}i.valid=!1,this.regions.delete(e)}}clear(){this.regions.clear(),this.rooms.clear(),this.regionGrid.clear(),this.linkHashIndex.clear(),this.doorPositions.clear(),this.nextRegionId=0,this.nextRoomId=0}getRegions(){return this.regions}getRooms(){return this.rooms}getRegionGrid(){return this.regionGrid}getRegionAt(e,i){const n=this.regionGrid.get(e,i);return n>=0&&this.regions.get(n)||null}}class Ki{constructor(e,i){x(this,"regions");x(this,"rooms");this.regions=e,this.rooms=i}findNearestBuilding(e,i,n,o,a=10){const s=new Set,r=[{regionId:e,depth:0}];let l=null,c=1/0;for(;r.length>0;){const{regionId:h,depth:f}=r.shift();if(s.has(h)||f>a)continue;s.add(h);const d=this.regions.get(h);if(!(!d||!d.valid)){for(const u of d.objects.buildings){if(!o(u))continue;const m=u.x+u.w/2,g=u.y+u.h/2,p=Math.hypot(i-m,n-g);p<c&&(c=p,l={object:u,distance:p,region:d})}if(l&&f>0&&c<this.estimateMinDistToNextRegion(d))break;for(const u of d.neighbors)s.has(u)||r.push({regionId:u,depth:f+1})}}return l}findBuildingsInRange(e,i,n,o,a,s=10){const r=[],l=new Set,c=[{regionId:e,depth:0}];for(;c.length>0;){const{regionId:h,depth:f}=c.shift();if(l.has(h)||f>s)continue;l.add(h);const d=this.regions.get(h);if(!(!d||!d.valid)){for(const u of d.objects.buildings){if(!a(u))continue;const m=u.x+u.w/2,g=u.y+u.h/2,p=Math.hypot(i-m,n-g);p<=o&&r.push({object:u,distance:p,region:d})}for(const u of d.neighbors)l.has(u)||c.push({regionId:u,depth:f+1})}}return r.sort((h,f)=>h.distance-f.distance)}findNearestTree(e,i,n,o,a=10){const s=new Set,r=[{regionId:e,depth:0}];let l=null,c=1/0;for(;r.length>0;){const{regionId:h,depth:f}=r.shift();if(s.has(h)||f>a)continue;s.add(h);const d=this.regions.get(h);if(!(!d||!d.valid)){for(const u of d.objects.trees){const m=o[u];if(!m||m.hp<=0)continue;const g=Math.hypot(i-m.x,n-m.y);g<c&&(c=g,l={object:m,distance:g,region:d})}if(l&&f>0&&c<this.estimateMinDistToNextRegion(d))break;for(const u of d.neighbors)s.has(u)||r.push({regionId:u,depth:f+1})}}return l}findNearestRock(e,i,n,o,a=10){const s=new Set,r=[{regionId:e,depth:0}];let l=null,c=1/0;for(;r.length>0;){const{regionId:h,depth:f}=r.shift();if(s.has(h)||f>a)continue;s.add(h);const d=this.regions.get(h);if(!(!d||!d.valid)){for(const u of d.objects.rocks){const m=o[u];if(!m||m.hp<=0)continue;const g=Math.hypot(i-m.x,n-m.y);g<c&&(c=g,l={object:m,distance:g,region:d})}if(l&&f>0&&c<this.estimateMinDistToNextRegion(d))break;for(const u of d.neighbors)s.has(u)||r.push({regionId:u,depth:f+1})}}return l}inSameRoom(e,i){const n=this.regions.get(e),o=this.regions.get(i);return!n||!o||n.roomId===null||o.roomId===null?!1:n.roomId===o.roomId}isReachable(e,i,n=50){if(e===i)return!0;const o=new Set,a=[{regionId:e,depth:0}];for(;a.length>0;){const{regionId:s,depth:r}=a.shift();if(s===i)return!0;if(o.has(s)||r>n)continue;o.add(s);const l=this.regions.get(s);if(!(!l||!l.valid))for(const c of l.neighbors)o.has(c)||a.push({regionId:c,depth:r+1})}return!1}estimateMinDistToNextRegion(e){return Math.sqrt(e.cells.size)*A*.5}getRoomForRegion(e){const i=this.regions.get(e);return!i||i.roomId===null?null:this.rooms.get(i.roomId)||null}}class _i{constructor(e){x(this,"builder");x(this,"objectFinder");x(this,"navGrid");x(this,"enabled");this.navGrid=e,this.builder=new Zi(e),this.objectFinder=new Ki(this.builder.getRegions(),this.builder.getRooms()),this.enabled=!1}initialize(e){console.log("[RegionManager] Initializing region system...");const i=e?e.filter(n=>n.kind==="door"&&n.done):[];this.builder.buildAll(i),this.enabled=!0}onBuildingsChanged(e){if(!this.enabled)return;console.log("[RegionManager] Buildings changed, rebuilding regions...");const i=e.filter(n=>n.kind==="door"&&n.done);this.builder.buildAll(i),this.updateObjectCaches(e,[],[])}updateArea(e,i,n,o,a){if(!this.enabled)return;const s=Math.floor(e/A),r=Math.floor(i/A),l=Math.floor((e+n)/A),c=Math.floor((i+o)/A),h=a?a.filter(f=>f.kind==="door"&&f.done):[];this.builder.rebuildArea(s,r,l,c,h)}rebuildArea(e,i,n,o,a){if(!this.enabled)return;const s=a?a.filter(r=>r.kind==="door"&&r.done):[];this.builder.rebuildArea(e,i,n,o,s)}updateObjectCaches(e,i,n){if(!this.enabled)return;const o=this.builder.getRegions(),a=this.builder.getRegionGrid();for(const s of o.values())s.objects.buildings.clear(),s.objects.trees.clear(),s.objects.rocks.clear();for(const s of e){const r=new Set,l=Math.floor(s.x/A),c=Math.floor(s.y/A),h=Math.floor((s.x+s.w)/A),f=Math.floor((s.y+s.h)/A);for(let d=c;d<=f;d++)for(let u=l;u<=h;u++){const m=a.get(u,d);m>=0&&r.add(m)}for(const d of r){const u=o.get(d);u&&u.objects.buildings.add(s)}}for(let s=0;s<i.length;s++){const r=i[s];if(r.hp<=0)continue;const l=Math.floor(r.x/A),c=Math.floor(r.y/A),h=a.get(l,c);if(h>=0){const f=o.get(h);f&&f.objects.trees.add(s)}}for(let s=0;s<n.length;s++){const r=n[s];if(r.hp<=0)continue;const l=Math.floor(r.x/A),c=Math.floor(r.y/A),h=a.get(l,c);if(h>=0){const f=o.get(h);f&&f.objects.rocks.add(s)}}}getRegionIdAt(e,i){const n=Math.floor(e/A),o=Math.floor(i/A);return this.builder.getRegionGrid().get(n,o)}getRegionAt(e,i){const n=Math.floor(e/A),o=Math.floor(i/A);return this.builder.getRegionAt(n,o)}findNearestBuilding(e,i,n){const o=this.getRegionIdAt(e,i);if(o<0)return null;const a=this.objectFinder.findNearestBuilding(o,e,i,n);return a?a.object:null}findNearestTree(e,i,n){const o=this.getRegionIdAt(e,i);if(o<0)return null;const a=this.objectFinder.findNearestTree(o,e,i,n);return a?a.object:null}findNearestRock(e,i,n){const o=this.getRegionIdAt(e,i);if(o<0)return null;const a=this.objectFinder.findNearestRock(o,e,i,n);return a?a.object:null}isReachable(e,i,n,o){const a=this.getRegionIdAt(e,i),s=this.getRegionIdAt(n,o);return a<0||s<0?!1:this.objectFinder.isReachable(a,s)}inSameRoom(e,i,n,o){const a=this.getRegionIdAt(e,i),s=this.getRegionIdAt(n,o);return a<0||s<0?!1:this.objectFinder.inSameRoom(a,s)}getRegions(){return this.builder.getRegions()}getRooms(){return this.builder.getRooms()}getStats(){const e=this.builder.getRegions(),i=this.builder.getRooms();let n=0;for(const a of e.values())n+=a.cells.size;let o=0;for(const a of i.values())o+=a.regions.size;return{regionCount:e.size,roomCount:i.size,avgRegionSize:e.size>0?n/e.size:0,avgRoomSize:i.size>0?o/i.size:0}}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e,e&&this.builder.getRegions().size===0&&this.initialize()}}function ui(t,e){t.inventory||(t.inventory={items:[],capacity:e})}function Ai(t){switch(t){case"pantry":return 10;case"farm":return 5;case"warehouse":return 20;case"stock":return 15;case"hq":return 30;case"stove":return 3;default:return 0}}function $i(t){return["pantry","farm","warehouse","stock","hq","stove"].includes(t)}function xt(t,e,i){if(!t.inventory){const a=Ai(t.kind);if(a===0)return 0;ui(t,a)}const n=t.inventory;let o=n.items.find(a=>a.type===e);if(o){const a=o.maxStack||St(e),s=Math.min(i,a-o.quantity);return o.quantity+=s,s}else{if(n.items.length>=n.capacity)return 0;const a=St(e),s=Math.min(i,a);return n.items.push({type:e,quantity:s,maxStack:a}),s}}function en(t,e,i){if(!t.inventory)return 0;const n=t.inventory,o=n.items.findIndex(r=>r.type===e);if(o===-1)return 0;const a=n.items[o],s=Math.min(i,a.quantity);return a.quantity-=s,a.quantity<=0&&n.items.splice(o,1),s}function gi(t,e){if(!t.inventory)return 0;const i=t.inventory.items.find(n=>n.type===e);return i?i.quantity:0}function tn(t){return t.inventory?t.inventory.items.reduce((e,i)=>e+i.quantity,0):0}function St(t){switch(t){case"wood":return 75;case"stone":return 75;case"food":return 50;case"wheat":return 100;case"bread":return 50;case"medicine":return 20;case"herbal":return 30;default:return 50}}function nn(t){return{wood:"Wood",stone:"Stone",food:"Food",wheat:"Wheat",bread:"Bread",medicine:"Medicine",herbal:"Herbal Medicine"}[t]||t}function on(t){return{wood:"🪵",stone:"🪨",food:"🍎",wheat:"🌾",bread:"🍞",medicine:"💊",herbal:"🌿"}[t]||"📦"}const V={house:{category:"Housing",name:"House",description:"Provides shelter for 2 colonists. Colonists can rest inside to recover fatigue.",key:"1",cost:{wood:20,stone:5},hp:220,size:{w:2,h:2},build:100,color:_.house,popCap:2},farm:{category:"Production",name:"Farm",description:"Grows crops that colonists can harvest for food. Takes 2 days to grow.",key:"2",cost:{wood:15},hp:120,size:{w:2,h:2},build:80,color:_.farm,growTime:1},turret:{category:"Defense",name:"Turret",description:"Automated defense structure. Shoots at enemies within range.",key:"3",cost:{wood:10,stone:20},hp:160,size:{w:1,h:1},build:120,color:_.turret,range:190,fireRate:.6,dps:30},wall:{category:"Defense",name:"Wall",description:"Blocks enemy movement. Essential for creating defensive perimeters.",key:"4",cost:{wood:1,stone:0},hp:150,size:{w:1,h:1},build:40,color:_.wall},stock:{category:"Utility",name:"Stockpile",description:"Increases resource storage capacity by 100. Colonists will store materials here.",key:"5",cost:{wood:10},hp:140,size:{w:2,h:2},build:60,color:_.stock,storageBonus:100},tent:{category:"Utility",name:"Recruit Tent",description:"Attracts new colonists every 60 seconds. Requires 15 food per recruit.",key:"6",cost:{wood:30,food:10},hp:140,size:{w:2,h:2},build:80,color:_.tent},warehouse:{category:"Utility",name:"Warehouse",description:"Large storage facility. Increases resource capacity by 300.",key:"7",cost:{wood:40,stone:20},hp:260,size:{w:3,h:2},build:160,color:_.stock,storageBonus:300},well:{category:"Production",name:"Well",description:"Provides clean water. Colonists can collect water here for food production.",key:"8",cost:{stone:25},hp:160,size:{w:1,h:1},build:80,color:_.farm},infirmary:{category:"Utility",name:"Infirmary",description:"Heals injured colonists within range. Essential for colony survival.",key:"9",cost:{wood:30,stone:20,food:10},hp:200,size:{w:2,h:2},build:140,color:_.bld,healRate:3,healRange:140,popCap:2},floor_path:{category:"Flooring",name:"Dirt Path",description:"Basic path that speeds up movement. Costs nothing but provides modest speed boost.",key:"0",cost:{wood:0},hp:1,size:{w:1,h:1},build:3,color:"#9ca3af",isFloor:!0,floorType:"BASIC_PATH"},floor_stone_road:{category:"Flooring",name:"Stone Road",description:"Premium paved road. Fast movement speed, very durable. Great for high-traffic areas.",key:"9",cost:{stone:2},hp:1,size:{w:1,h:1},build:8,color:"#6b7280",isFloor:!0,floorType:"STONE_ROAD"},floor_wooden:{category:"Flooring",name:"Wooden Floor",description:"Interior flooring. Comfortable and attractive, provides minor speed bonus.",key:"8",cost:{wood:3},hp:1,size:{w:1,h:1},build:5,color:"#92400e",isFloor:!0,floorType:"WOODEN_FLOOR"},bed:{category:"Furniture",name:"Bed",description:"Gives a colonist a comfortable spot to sleep. Restores fatigue faster than the ground.",key:"B",cost:{wood:12},hp:80,size:{w:1,h:2},build:40,color:_.bed,popCap:1},door:{category:"Defense",name:"Door",description:"Allows colonists to pass while blocking enemies. Must be opened before passing through.",key:"D",cost:{wood:10},hp:100,size:{w:1,h:1},build:30,color:"#8b4513"},stove:{category:"Furniture",name:"Stove",description:"Used for cooking wheat into bread. Colonists bring wheat here and cook it over time.",key:"S",cost:{wood:20,stone:10},hp:150,size:{w:2,h:1},build:60,color:"#cd5c5c"},pantry:{category:"Furniture",name:"Pantry",description:"Stores prepared food (bread). Colonists can retrieve meals when hungry.",key:"P",cost:{wood:25,stone:5},hp:120,size:{w:2,h:2},build:50,color:"#daa520"}};function xe(t,e){if(!e)return!0;for(const i of Object.keys(e))if((t[i]||0)<(e[i]||0))return!1;return!0}function qe(t,e){if(e)for(const i of Object.keys(e))t[i]-=e[i]||0}function Ie(t,e,i){const n=V[t],o=Math.floor(e/A)*A,a=Math.floor(i/A)*A,s={kind:t,...n,x:o,y:a,w:n.size.w*A,h:n.size.h*A,hp:n.hp,buildLeft:n.build,done:!1,growth:0,ready:!1,cooldown:0,...t==="bed"?{isMedicalBed:!1}:{}};if($i(t)){const r=Ai(t);ui(s,r)}return s}function sn(t){const e={};for(const i of Object.keys(t)){const n=t[i],o=n.category||"Other";(e[o]||(e[o]=[])).push([i,n])}for(const i of Object.keys(e))e[i].sort((n,o)=>n[1].name.localeCompare(o[1].name));return e}const rn=(()=>{const t=[];for(let e=1;e<=20;e++){const i=100+Math.pow(e,1.6)*40;t[e]=Math.round(i)}return t})();function an(){const t=["Medicine","Construction","Shooting","Melee","Plants","Mining","Crafting","Social","Cooking","Research"],e={};for(const i of t)e[i]={name:i,level:0,xp:0,passion:"none"};return{byName:e,xpMultiplier:1}}function ln(t){for(const e of Object.values(t.byName)){const i=Math.random();i>.95?e.level=8+Math.floor(Math.random()*4):i>.75?e.level=4+Math.floor(Math.random()*3):e.level=Math.floor(Math.random()*3);const n=Math.random();n>.9?e.passion="burning":n>.65?e.passion="interested":e.passion="none"}}function cn(t,e){return t.skills?t.skills.byName[e]:null}function ce(t,e,i,n){if(!t.skills)return;const o=t.skills.byName[e];if(!o)return;let a=i;if(o.passion==="interested"?a*=1.5:o.passion==="burning"&&(a*=2),t.skills.xpMultiplier&&(a*=t.skills.xpMultiplier),o.xp+=a,o.lastUsed=n,o.xpDeltas||(o.xpDeltas=[]),n!=null){o.xpDeltas.push({t:n,amount:a});const s=n-5;s>0&&(o.xpDeltas=o.xpDeltas.filter(r=>r.t>=s)),o.xpDeltas.length>64&&o.xpDeltas.splice(0,o.xpDeltas.length-64)}for(;o.level<20;){const s=rn[o.level+1];if(o.xp>=s)o.xp-=s,o.level++;else break}}function ge(t,e){var i;return((i=cn(t,e))==null?void 0:i.level)??0}function He(t){return .6+Math.pow(t,.9)*.06}const dn=[{type:"head",label:"Head",maxHp:40,currentHp:40,coverage:.08,vital:!0,efficiency:1},{type:"torso",label:"Torso",maxHp:80,currentHp:80,coverage:.4,vital:!0,efficiency:1},{type:"left_arm",label:"Left Arm",maxHp:30,currentHp:30,coverage:.12,vital:!1,efficiency:1},{type:"right_arm",label:"Right Arm",maxHp:30,currentHp:30,coverage:.12,vital:!1,efficiency:1},{type:"left_leg",label:"Left Leg",maxHp:35,currentHp:35,coverage:.14,vital:!1,efficiency:1},{type:"right_leg",label:"Right Leg",maxHp:35,currentHp:35,coverage:.14,vital:!1,efficiency:1}];function Be(t){t.health||(t.health={bodyParts:dn.map(e=>({...e})),injuries:[],totalPain:0,bloodLevel:1,consciousness:1,mobility:1,manipulation:1,immunity:1,lastBleedCalcTime:0,lastInfectionTick:0})}function ut(t){if(t.bodyParts.length===0)return 0;const e=t.bodyParts.reduce((n,o)=>n+o.maxHp,0),i=t.bodyParts.reduce((n,o)=>n+o.currentHp,0);return Math.max(0,Math.min(100,i/e*100))}function Ve(t){t.totalPain=Math.min(1,t.injuries.reduce((c,h)=>c+h.pain,0)),t.injuries.reduce((c,h)=>c+(h.bandaged?h.bleeding*.15:h.bleeding),0);const e=t.bodyParts.find(c=>c.type==="head"),i=e?e.efficiency:1;t.consciousness=Math.max(.1,i*(1-t.totalPain*.5)*Math.sqrt(t.bloodLevel));const n=t.bodyParts.find(c=>c.type==="left_leg"),o=t.bodyParts.find(c=>c.type==="right_leg"),a=(((n==null?void 0:n.efficiency)||0)+((o==null?void 0:o.efficiency)||0))/2;t.mobility=Math.max(.1,a*(1-t.totalPain*.3)*t.consciousness);const s=t.bodyParts.find(c=>c.type==="left_arm"),r=t.bodyParts.find(c=>c.type==="right_arm"),l=(((s==null?void 0:s.efficiency)||0)+((r==null?void 0:r.efficiency)||0))/2;t.manipulation=Math.max(.1,l*(1-t.totalPain*.2)*t.consciousness);for(const c of t.bodyParts){const h=c.currentHp/c.maxHp;c.efficiency=Math.max(0,Math.min(1,h))}}function hn(t){const e=t.bodyParts.reduce((n,o)=>n+o.coverage,0);let i=Math.random()*e;for(const n of t.bodyParts)if(i-=n.coverage,i<=0)return n;return t.bodyParts.find(n=>n.type==="torso")||t.bodyParts[0]}function fn(t,e,i,n){const o=`${t}_${e}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;let a=0,s=0,r=1,l=0,c="";switch(t){case"cut":a=.2,s=.1,r=2,l=.1,c=`Cut on ${e.replace("_"," ")}`;break;case"bruise":a=.1,s=0,r=3,l=0,c=`Bruise on ${e.replace("_"," ")}`;break;case"burn":a=.4,s=.05,r=.5,l=.2,c=`Burn on ${e.replace("_"," ")}`;break;case"gunshot":a=.6,s=.3,r=1,l=.15,c=`Gunshot wound on ${e.replace("_"," ")}`;break;case"fracture":a=.5,s=0,r=.2,l=0,c=`Fractured ${e.replace("_"," ")}`;break;default:c=`${t} on ${e.replace("_"," ")}`}return{id:o,type:t,bodyPart:e,severity:Math.max(0,Math.min(1,i)),pain:a*i,bleeding:s*i,healRate:r,permanent:i>.8&&(t==="burn"||t==="fracture"),timeCreated:n,description:c,infected:!1,infectionChance:l*i,bandaged:!1,infectionProgress:0}}function un(t,e,i,n="cut",o){const a=t.bodyParts.find(r=>r.type===e);if(!a)return!1;a.currentHp=Math.max(0,a.currentHp-i);const s=Math.min(1,i/a.maxHp);if(s>.1){const r=fn(n,e,s,o);t.injuries.push(r)}return Ve(t),!!(a.vital&&a.currentHp<=0)}function Ct(t,e,i,n="cut",o={}){if(!e.alive)return{died:!1,bodyPart:"torso",fatal:!1};if(e.godmode)return{died:!1,bodyPart:"torso",fatal:!1};Be(e);const a=e.health,s=o.bodyPart?a.bodyParts.find(c=>c.type===o.bodyPart):hn(a),r=Math.max(0,i*(o.damageMultiplier??1));return un(a,s.type,r,n,performance.now())?(Rt(t,e,`Destroyed vital ${s.label}`),{died:!0,bodyPart:s.type,fatal:!0,cause:"vital_part"}):(e.hp=ut(a),a.bloodLevel<=.01?(Rt(t,e,"Blood loss"),{died:!0,bodyPart:s.type,fatal:!0,cause:"blood_loss"}):(a.consciousness<=.05,{died:!1,bodyPart:s.type,fatal:!1}))}function Rt(t,e,i){var n;e.alive=!1,e.task=null,e.state="idle",t&&typeof t.msg=="function"&&t.msg(`${((n=e.profile)==null?void 0:n.name)||"Colonist"} died (${i})`,"bad")}function An(t,e){const i=t.injuries.reduce((o,a)=>o+(a.bandaged?a.bleeding*.15:a.bleeding),0);if(i<=0)return;const n=i*(e/300);t.bloodLevel=Math.max(0,t.bloodLevel-n)}function gn(t,e){for(const i of t.injuries)if(i.infected){const n=t.immunity;i.infectionProgress=Math.min(1,(i.infectionProgress||0)+e/600*(1-n*.8)),(i.infectionProgress||0)>.7&&(t.bloodLevel=Math.max(0,t.bloodLevel-5e-4*e),i.pain=Math.min(1,i.pain+.05*(e/60)))}else if(i.infectionChance>0&&i.severity>.2&&!i.bandaged){const n=i.infectionChance*(e/400);Math.random()<n&&(i.infected=!0,i.infectionProgress=.05)}}function pn(t,e){t.lastBleedCalcTime=(t.lastBleedCalcTime||0)+e,t.lastInfectionTick=(t.lastInfectionTick||0)+e,t.lastBleedCalcTime>=1&&(An(t,t.lastBleedCalcTime),t.lastBleedCalcTime=0),t.lastInfectionTick>=4&&(gn(t,t.lastInfectionTick),t.lastInfectionTick=0)}function yn(t,e){for(let i=t.injuries.length-1;i>=0;i--){const n=t.injuries[i],o=n.healRate*e/86400;n.severity=Math.max(0,n.severity-o),n.pain=n.pain*(n.severity/(n.severity+.1)),n.bleeding=n.bleeding*n.severity,n.severity<=.05&&t.injuries.splice(i,1)}for(const i of t.bodyParts)if(i.currentHp<i.maxHp&&i.currentHp>0){const n=.1*e/86400;i.currentHp=Math.min(i.maxHp,i.currentHp+n)}t.bloodLevel<1&&(t.bloodLevel=Math.min(1,t.bloodLevel+.01*e/86400)),Ve(t)}function mn(t){if(!t.injuries.length)return"No injuries";const e=t.injuries.filter(o=>o.bleeding>0&&!o.bandaged).length,i=t.injuries.filter(o=>o.infected).length,n=t.injuries.filter(o=>o.severity>.6).length;return[`${t.injuries.length} wound${t.injuries.length!==1?"s":""}`,e?`${e} bleeding`:null,n?`${n} severe`:null,i?`${i} infected`:null].filter(Boolean).join(", ")}function bn(t){let e=0,i=0;for(const n of t.injuries)if(n.bleeding>0&&!n.bandaged&&(n.bandaged=!0,n.bleeding*=.35,n.infectionChance*=.7,e++),n.pain>.4){const o=n.pain;n.pain*=.85,i+=o-n.pain}return Ve(t),{bandaged:e,painReduced:Number(i.toFixed(2))}}const Ye=[{id:"bandage_wound",name:"Bandage Wound",description:"Apply bandages to stop bleeding and reduce infection risk.",requiredMedicine:["Bandages"],skillRequired:0,baseSuccessRate:.85,duration:30,painReduction:.2,healingBonus:1.2,canTreatInjuryTypes:["cut","gunshot"],canTreatBodyParts:["head","torso","left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!1,riskOfInfection:.05,priority:1},{id:"treat_burn",name:"Treat Burn",description:"Apply medicine to burns to prevent infection and reduce scarring.",requiredMedicine:["MedicineKit"],skillRequired:2,baseSuccessRate:.75,duration:45,painReduction:.4,healingBonus:1.5,canTreatInjuryTypes:["burn"],canTreatBodyParts:["head","torso","left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!1,riskOfInfection:.1,priority:2},{id:"set_fracture",name:"Set Fracture",description:"Set and splint broken bones. Requires medical skill.",requiredMedicine:["MedicineKit"],skillRequired:5,baseSuccessRate:.7,duration:120,painReduction:.3,healingBonus:2,canTreatInjuryTypes:["fracture"],canTreatBodyParts:["left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!1,riskOfInfection:.05,priority:2},{id:"remove_bullet",name:"Remove Bullet",description:"Surgical removal of bullets and foreign objects.",requiredMedicine:["MedicineKit"],skillRequired:8,baseSuccessRate:.6,duration:180,painReduction:.5,healingBonus:2.5,canTreatInjuryTypes:["gunshot"],canTreatBodyParts:["head","torso","left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!0,riskOfInfection:.15,priority:1},{id:"treat_infection",name:"Treat Infection",description:"Use medicine to fight infection and prevent sepsis.",requiredMedicine:["MedicineKit"],skillRequired:4,baseSuccessRate:.8,duration:60,painReduction:.1,healingBonus:1.3,canTreatInjuryTypes:["infection"],canTreatBodyParts:["head","torso","left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!1,riskOfInfection:0,priority:1},{id:"pain_management",name:"Pain Management",description:"Administer pain relief without treating the underlying injury.",requiredMedicine:["MedicineKit"],skillRequired:1,baseSuccessRate:.95,duration:15,painReduction:.6,healingBonus:1,canTreatInjuryTypes:["cut","bruise","burn","gunshot","fracture"],canTreatBodyParts:["head","torso","left_arm","right_arm","left_leg","right_leg"],surgeryRequired:!1,riskOfInfection:0,priority:3}];class wn{performTreatment(e,i,n,o){if(!n||!o)return!1;const a=this.getDoctorSkill(e),s=Math.max(0,(a-n.skillRequired)*.05),r=Math.min(.95,n.baseSuccessRate+s);if(Math.random()<r){if(this.applySuccessfulTreatment(i,o,n),e.skills){const c=20+n.skillRequired*4;ce(e,"Medicine",c,e.t||0)}return!0}else{if(this.applyFailedTreatment(i,o,n),e.skills){const c=8+Math.max(0,n.skillRequired-a)*2;ce(e,"Medicine",c,e.t||0)}return!1}}applySuccessfulTreatment(e,i,n){e.health&&(i.pain=Math.max(0,i.pain-n.painReduction),i.healRate*=n.healingBonus,n.id==="bandage_wound"&&(i.bleeding=Math.max(0,i.bleeding*.2),i.bandaged=!0,i.infectionChance=Math.max(0,i.infectionChance*.5)),n.id==="treat_burn"&&(i.bandaged=!0,i.infectionChance=Math.max(0,i.infectionChance*.6)),n.id==="set_fracture"&&(i.bandaged=!0),n.id==="treat_infection"&&(i.infected=!1,i.infectionChance=0),i.treatedBy=n.id,console.log(`Successfully treated ${i.description} with ${n.name}`))}applyFailedTreatment(e,i,n){e.health&&(Math.random()<n.riskOfInfection&&!i.infected&&(i.infected=!0,i.infectionChance=.1,console.log(`Treatment failed and caused infection: ${i.description}`)),i.pain=Math.min(1,i.pain+.1),!i.infected&&i.infectionChance>0&&(i.infectionChance=Math.min(1,i.infectionChance+.05)),console.log(`Failed to treat ${i.description} with ${n.name}`))}hasRequiredItems(e,i){if(!e.inventory||i.length===0)return!0;for(const n of i)if(!e.inventory.items.some(a=>a.defName===n&&a.quantity>0))return!1;return!0}consumeItems(e,i){if(e.inventory)for(const n of i){const o=e.inventory.items.find(a=>a.defName===n&&a.quantity>0);if(o&&(o.quantity-=1,o.quantity<=0)){const a=e.inventory.items.indexOf(o);e.inventory.items.splice(a,1)}}}getDoctorSkill(e){return e.skills?ge(e,"Medicine"):0}}const vn=new wn;class Mn{constructor(){x(this,"jobs",new Map);x(this,"jobCounter",0);x(this,"lastScanTime",0);x(this,"scanInterval",.5)}scanForMedicalWork(e,i,n){if(n-this.lastScanTime<this.scanInterval)return this.getReservedJob(e);this.lastScanTime=n,this.cleanupJobs(i,n);const o=this.findPlayerForcedJob(e);if(o)return o;const a=this.scanEmergencyMedical(e,i);if(a)return a;const s=this.scanNormalMedical(e,i);return s||null}scanEmergencyMedical(e,i){this.getColonistId(e);const n=this.getDoctorSkill(e),o=i.filter(a=>{if(!a.alive||a===e||!a.health||!a.health.injuries.length)return!1;const s=a.state==="downed",r=a.health.injuries.some(h=>h.bleeding>.3&&!h.bandaged),l=a.health.injuries.some(h=>h.severity>.85),c=a.health.bloodLevel<.4;return s||r||l||c});if(!o.length)return null;o.sort((a,s)=>{const r=this.calculatePatientUrgency(a);return this.calculatePatientUrgency(s)-r});for(const a of o){const s=this.createMedicalJobForPatient(e,a,n,!0);if(s&&!s.reservedBy)return s}return null}scanNormalMedical(e,i){this.getColonistId(e);const n=this.getDoctorSkill(e),o=i.filter(a=>{if(!a.alive||a===e||!a.health||!a.health.injuries.length)return!1;const s=this.getColonistId(a);return this.isPatientReserved(s)?!1:a.health.injuries.some(r=>!r.bandaged||r.infected||r.pain>.3)});if(!o.length)return null;o.sort((a,s)=>{const r=this.calculatePatientPriority(a),l=this.calculatePatientPriority(s);return r-l});for(const a of o){const s=this.createMedicalJobForPatient(e,a,n,!1);if(s&&!s.reservedBy)return s}return null}createMedicalJobForPatient(e,i,n,o){if(!i.health)return null;const a=this.getColonistId(i),s=Array.from(this.jobs.values()).find(h=>h.patientId===a&&!h.reservedBy);if(s)return s;const r=this.findBestTreatment(i,n);if(!r)return null;const l=this.findTargetInjury(i,r);if(!l)return null;const c={id:`medical_${this.jobCounter++}`,type:"doctor",patientId:a,patient:i,treatment:r,targetInjury:l,priority:o?1:this.calculateTreatmentPriority(l,r),playerForced:!1,createdAt:Date.now(),expiresAt:Date.now()+3e4};return this.jobs.set(c.id,c),c}findBestTreatment(e,i){if(!e.health)return null;const n=e.health.injuries.find(s=>s.bleeding>.2&&!s.bandaged);if(n){const s=Ye.find(r=>r.id==="bandage_wound"&&r.canTreatInjuryTypes.includes(n.type)&&r.skillRequired<=i);if(s)return s}if(e.health.injuries.find(s=>s.infected)){const s=Ye.find(r=>r.id==="treat_infection"&&r.skillRequired<=i);if(s)return s}const a=[...e.health.injuries].sort((s,r)=>r.severity-s.severity);for(const s of a){const r=Ye.filter(l=>l.canTreatInjuryTypes.includes(s.type)&&l.canTreatBodyParts.includes(s.bodyPart)&&l.skillRequired<=i);if(r.length)return r.sort((c,h)=>h.healingBonus-c.healingBonus)[0]}return null}findTargetInjury(e,i){return e.health&&e.health.injuries.find(n=>i.canTreatInjuryTypes.includes(n.type)&&i.canTreatBodyParts.includes(n.bodyPart))||null}calculatePatientUrgency(e){if(!e.health)return 0;let i=0;e.state==="downed"&&(i+=100),i+=(1-e.health.bloodLevel)*80;const n=Math.max(...e.health.injuries.map(a=>a.bleeding),0);i+=n*60;const o=Math.max(...e.health.injuries.map(a=>a.severity),0);return i+=o*40,i+=(1-e.health.consciousness)*50,i}calculatePatientPriority(e){if(!e.health)return 10;let i=5;e.health.injuries.some(o=>o.infected)&&(i-=2),i+=e.health.totalPain*3;const n=Math.max(...e.health.injuries.map(o=>o.severity),0);return i-=n*2,Math.max(1,Math.min(10,Math.round(i)))}calculateTreatmentPriority(e,i){let n=i.priority*2;const o=e.bandaged?e.bleeding*.15:e.bleeding;return n-=e.severity*3,n-=o*5,e.infected?n-=3:e.infectionChance>.2&&!e.bandaged&&(n-=2),n-=e.pain*1,e.bodyPart==="head"&&(n-=1),Math.max(1,Math.min(10,Math.round(n)))}getReservedJob(e){const i=this.getColonistId(e);return Array.from(this.jobs.values()).find(n=>n.reservedBy===i)||null}findPlayerForcedJob(e){return Array.from(this.jobs.values()).find(i=>i.playerForced&&!i.reservedBy)||null}reserveJob(e,i){if(e.reservedBy)return!1;const n=this.getColonistId(i);return e.reservedBy=n,e.patient.isBeingTreated=!0,e.patient.doctorId=n,!0}releaseJob(e,i){const n=this.getColonistId(i);e.reservedBy===n&&(e.reservedBy=void 0,e.patient.isBeingTreated=!1,e.patient.doctorId=void 0)}completeJob(e){const i=this.jobs.get(e);i&&(i.patient.isBeingTreated=!1,i.patient.doctorId=void 0,this.jobs.delete(e))}isPatientReserved(e){return Array.from(this.jobs.values()).some(i=>i.patientId===e&&i.reservedBy)}cleanupJobs(e,i){const n=[];for(const[o,a]of this.jobs.entries()){if(a.expiresAt&&i>a.expiresAt){n.push(o);continue}const s=e.find(r=>this.getColonistId(r)===a.patientId);if(!s||!s.alive||!s.health||!s.health.injuries.length){n.push(o);continue}if(a.reservedBy){const r=e.find(l=>this.getColonistId(l)===a.reservedBy);if(!r||!r.alive){n.push(o);continue}}}for(const o of n)this.completeJob(o)}createForcedJob(e,i,n){if(!i.health)return null;const o=this.getColonistId(e),a=this.getColonistId(i),s=this.getDoctorSkill(e);let r=null,l=null;if(n?(r=Ye.find(h=>h.id===n)||null,r&&(l=this.findTargetInjury(i,r))):(r=this.findBestTreatment(i,s),r&&(l=this.findTargetInjury(i,r))),!r||!l)return null;const c={id:`forced_${this.jobCounter++}`,type:"doctor",patientId:a,patient:i,treatment:r,targetInjury:l,priority:0,playerForced:!0,reservedBy:o,createdAt:Date.now()};return this.jobs.set(c.id,c),i.isBeingTreated=!0,i.doctorId=o,c}getDoctorSkill(e){return e.skills?ge(e,"Medicine"):0}getColonistId(e){return e.id||(e.id=`colonist_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),e.id}getActiveJobs(){return Array.from(this.jobs.values())}}const pe=new Mn,Tt=2,ot=1,kn=2;function pi(t){t.kind==="door"&&(t.doorState="closed",t.doorProgress=0,t.doorOpenTime=0,t.doorCloseDelay=0,t.doorQueue=[])}function xn(t){return t.kind!=="door"||!t.done?!1:t.doorState==="open"&&(t.doorProgress??0)>=1}function At(t){return t.kind!=="door"||!t.done?!1:t.doorState==="closed"||t.doorState==="closing"}function Sn(t,e){if(e.kind!=="door")return!1;const i=e.x+e.w/2,n=e.y+e.h/2;return Math.hypot(t.x-i,t.y-n)<96}function Pt(t,e){t.kind!=="door"||!t.doorQueue||(t.doorQueue=t.doorQueue.filter(i=>i.id!==e),t.doorQueue.length===0&&t.doorState==="open"&&(t.doorCloseDelay=ot))}function Cn(t,e,i){if(!(t.kind!=="door"||!t.done))switch(t.doorState===void 0&&pi(t),t.doorState){case"closed":t.doorProgress=0;break;case"opening":t.doorOpenTime+=e,t.doorProgress=Math.min(1,t.doorOpenTime/Tt),t.doorProgress>=1&&(t.doorState="open",t.doorCloseDelay=ot);break;case"open":t.doorProgress=1,t.doorQueue&&t.doorQueue.length===0?(t.doorCloseDelay=Math.max(0,(t.doorCloseDelay||0)-e),t.doorCloseDelay<=0&&(t.doorState="closing",t.doorOpenTime=0)):t.doorCloseDelay=ot;break;case"closing":t.doorOpenTime+=e,t.doorProgress=Math.max(0,1-t.doorOpenTime/kn),t.doorQueue&&t.doorQueue.length>0?(t.doorState="opening",t.doorOpenTime=(1-t.doorProgress)*Tt):t.doorProgress<=0&&(t.doorState="closed");break}}function Rn(t){return t.kind!=="door"?0:t.doorProgress||0}function Tn(t,e,i){if(t.kind!=="door"||!t.done)return!1;if(t.hp-=e,t.hp<=0){const n=i.buildings.indexOf(t);return n!==-1&&(i.buildings.splice(n,1),i.msg("A door has been destroyed!","bad"),i.rebuildNavGrid&&i.rebuildNavGrid()),!0}return!1}function Xe(t,e,i,n){for(const o of t.buildings){if(o.kind==="hq"||o.kind==="path"||o.kind==="house"||o.kind==="farm"||o.kind==="bed"||!o.done||o.kind==="door"&&!At(o))continue;const a=Math.max(o.x,Math.min(e,o.x+o.w)),s=Math.max(o.y,Math.min(i,o.y+o.h)),r=e-a,l=i-s;if(r*r+l*l<=n*n)return!0}return!1}function Pn(t,e){e.stuckTimer===void 0&&(e.stuckTimer=0),e.lastPos||(e.lastPos={x:e.x,y:e.y}),e.lastMoveCheck||(e.lastMoveCheck=0);const i=Xe(t,e.x,e.y,e.r);e.lastMoveCheck+=1/60;let n=!1;if(e.lastMoveCheck>1&&(Math.hypot(e.x-e.lastPos.x,e.y-e.lastPos.y)<5&&(e.state==="chop"||e.state==="mine"||e.state==="build"||e.state==="harvest")&&(n=!0),e.lastPos={x:e.x,y:e.y},e.lastMoveCheck=0),i||n){if(e.stuckTimer+=1/60,e.stuckTimer>3){const a=[0,Math.PI/2,Math.PI,3*Math.PI/2,Math.PI/4,3*Math.PI/4,5*Math.PI/4,7*Math.PI/4];let s=!1;for(const r of[20,40,60,80]){for(const l of a){const c=e.x+Math.cos(l)*r,h=e.y+Math.sin(l)*r,f=Math.max(e.r,Math.min(c,Q.w-e.r)),d=Math.max(e.r,Math.min(h,Q.h-e.r));if(!Xe(t,f,d,e.r)){e.x=f,e.y=d,e.stuckTimer=0,s=!0,console.log(`Rescued stuck colonist at (${e.x.toFixed(1)}, ${e.y.toFixed(1)}) using distance ${r}`);break}}if(s)break}if(!s){const r=t.buildings.find(l=>l.kind==="hq");r&&(e.x=r.x+r.w/2+(Math.random()-.5)*40,e.y=r.y-40+(Math.random()-.5)*20,e.stuckTimer=0,console.log("Emergency rescue: teleported stuck colonist to HQ area"))}return!0}}else e.stuckTimer=0;return!1}function Bn(t,e,i){var v,M,w,C,k,S,P,I,B,N,O,X,j,H,q,U,K;if(e.health||Be(e),e.health){pn(e.health,i),yn(e.health,i),Ve(e.health);const y=ut(e.health);if(e.hp=y,e.hp=y,e.alive&&e.health.injuries.some(T=>T.bleeding>.25&&!T.bandaged||T.severity>.7||T.infected)?["doctoring","beingTreated","resting","sleep"].includes(e.state||"")||(e.needsMedical=!0):e.needsMedical=!1,e.alive){const T=e.health.consciousness<.25||e.health.bloodLevel<.25||e.health.injuries.some(E=>E.severity>.85);T&&e.state!=="downed"?(e.prevState=e.state,e.state="downed",e.task=null,e.target=null,t.msg&&t.msg(`${((v=e.profile)==null?void 0:v.name)||"Colonist"} is downed`,"warn")):!T&&e.state==="downed"&&(t.msg&&t.msg(`${((M=e.profile)==null?void 0:M.name)||"Colonist"} has recovered from downed state`,"good"),e.state="seekTask")}const R=e.health.totalPain;1-e.health.consciousness;const W=(e.fatigue||0)>66?.8:(e.fatigue||0)>33?.9:1;e.fatigueSlow=W*e.health.mobility*(1-R*.3),e.manipulationMultiplier=e.health.manipulation*(1-R*.2),e.consciousnessMultiplier=e.health.consciousness}else e.fatigueSlow=(e.fatigue||0)>66?.8:(e.fatigue||0)>33?.9:1,e.manipulationMultiplier=1,e.consciousnessMultiplier=1;if(!e.alive||(e.t+=i,e.state==="downed"))return;if(e.state||d("seekTask","initial state"),e.stateSince=(e.stateSince||0)+i,Pn(t,e)){e.task=null,e.target=null,t.clearPath&&t.clearPath(e),d("seekTask","rescued from stuck");return}const n=e.state==="build"||e.state==="chop"||e.state==="mine"||e.state==="harvest"||e.state==="flee"||e.state==="move",o=((w=e.profile)==null?void 0:w.stats.hungerRate)||1,a=((C=e.profile)==null?void 0:C.stats.fatigueRate)||1;if(e.godmode)e.hunger=0,e.fatigue=0;else{const y=(n?.25:e.inside?.1:.15)*o;e.hunger=Math.max(0,Math.min(100,(e.hunger||0)+i*y));const R=(n?.8:.3)*a;e.inside||e.state==="resting"?e.fatigue=Math.max(0,(e.fatigue||0)-i*8):e.fatigue=Math.min(100,(e.fatigue||0)+i*R)}if((e.hunger||0)>=95){const y=2*i;e.hp=Math.max(0,e.hp-y),Math.random()<.05&&console.log(`Colonist starving: hunger=${(e.hunger||0).toFixed(1)}, hp=${e.hp.toFixed(1)}, damage=${y.toFixed(2)}/frame`)}(e.hunger||0)<30&&!n&&!e.inside&&(e.hp=Math.min(100,e.hp+.8*i));const s=t.buildings.find(y=>y.kind==="infirmary"&&y.done);if(s){const y=s.healRange||140,R=s.healRate||3;(e.x-(s.x+s.w/2))**2+(e.y-(s.y+s.h/2))**2<=y*y&&(e.hp=Math.min(100,e.hp+R*i))}const r=140*140,l=180*180,c=t.enemies.find(y=>re(y,e)<r),h=e.state==="flee"&&e.lastDanger&&re(e.lastDanger,e)<l,f=c||(h?e.lastDanger:null);c?e.lastDanger=c:h||(e.lastDanger=null),e.lastHp=e.lastHp??e.hp,e.hp<e.lastHp&&(e.hurt=1.5),e.lastHp=e.hp,e.hurt=Math.max(0,(e.hurt||0)-i);function d(y,R){if(!(!(T=>T==="flee"||T==="heal"||T==="sleep"&&t.isNight())(y)&&e.softLockUntil!=null&&e.t<(e.softLockUntil||0))&&e.state!==y){if((e.state==="sleep"||e.state==="goToSleep")&&y!=="sleep"&&y!=="goToSleep"&&(t.releaseSleepReservation&&t.releaseSleepReservation(e),e.sleepTarget=void 0,e.sleepTargetLockUntil=0),y==="sleep"||y==="flee"||y==="heal"||y==="goToSleep"||y==="eat"||y==="resting"||y==="beingTreated"||y==="doctoring"){const D=e.task;D&&(D==="chop"||D==="mine"||D==="build"||D==="harvestFarm"||D==="harvestWell")&&(e.task==="build"&&e.target&&t.releaseBuildReservation&&t.releaseBuildReservation(e),e.target&&t.assignedTargets&&t.assignedTargets.has(e.target)&&t.assignedTargets.delete(e.target),e.task=null,e.target=null,t.clearPath&&t.clearPath(e),R&&Math.random()<.2&&console.log(`Cleared work task (${D}) when changing to ${y}: ${R}`))}const E=e.state;e.prevState=E,e.state=y,e.stateSince=0,e.lastStateChangeReason=R||"",y==="eat"?e.softLockUntil=e.t+1.5:y==="goToSleep"||y==="sleep"?e.softLockUntil=e.t+2:y==="resting"?e.softLockUntil=e.t+1:e.softLockUntil=void 0,R&&Math.random()<.1&&console.log(`Colonist state change: ${E} → ${y} (${R})`)}}const u=1;e.state==="chop"||e.state==="mine"||e.state==="build"||e.state;const m=e.stateSince>u||e.state==="idle"||e.state==="seekTask"||f,g=80,p=20;function b(){let y=null;const R=(W,T,E)=>{(!y||T>y.prio)&&(y={state:W,prio:T,reason:E})};if(!e.inside&&f&&R("flee",100,"danger detected"),!e.inside&&!f&&e.health&&e.health.totalPain<.6){const W=pe.scanForMedicalWork(e,t.colonists,e.t);W&&!W.reservedBy&&pe.reserveJob(W,e)&&(e.medicalJob=W,R("doctoring",95,"medical work available"))}if(!e.inside&&e.health&&e.needsMedical){const W=e.health.bloodLevel<.4?98:e.health.injuries.some(T=>T.bleeding>.4)?95:90;R("beingTreated",W,"needs medical treatment")}return!e.inside&&!f&&(e.hp||0)<35&&R("heal",85-Math.max(0,e.hp)*.1,"low health"),!e.inside&&!f&&t.isNight()&&R("sleep",80,"night time"),!e.inside&&!f&&!t.isNight()&&(e.fatigue||0)>=g&&R("goToSleep",70+Math.min(20,(e.fatigue||0)-g),"high fatigue"),!e.inside&&(e.hunger||0)>75&&(t.RES.food||0)>0&&R("eat",60+Math.min(25,(e.hunger||0)-75),"hunger"),R("seekTask",10,"default"),y}if(e.inside&&e.state!=="resting")d("resting","entered building");else{const y=W=>{switch(W){case"flee":return 100;case"waitingAtDoor":return 98;case"beingTreated":return 96;case"doctoring":return 95;case"heal":return 90;case"sleep":return 80;case"goToSleep":return 75;case"eat":return 65;case"storingBread":return 45;case"cooking":return 42;case"build":case"chop":case"mine":case"harvest":return 40;case"resting":return 35;case"move":return 25;case"idle":return 15;case"seekTask":return 10;default:return 0}};e.state!=="waitingAtDoor"&&e.waitingForDoor&&d("waitingAtDoor","encountered closed door");const R=b();if(R&&R.state!==e.state){const W=R.state==="flee"||R.state==="heal"||R.state==="beingTreated"||R.state==="doctoring"||R.state==="sleep"&&t.isNight(),T=y(e.state);(W||R.prio>T&&m)&&d(R.state,R.reason)}}switch(e.state){case"resting":{if(e.hideTimer=Math.max(0,(e.hideTimer||0)-i),e.inside&&e.inside.kind==="bed"){const T=e.inside,E=T.x+T.w/2,D=T.y+T.h/2;e.x=E,e.y=D,e.sleepFacing!=null&&(e.direction=e.sleepFacing)}e.hp=Math.min(100,e.hp+1.2*i);const R=(e.fatigue||0)<=p&&e.stateSince>=1;!t.isNight()&&!f&&(e.hurt||0)<=0&&(e.hideTimer||0)<=0&&R&&(t.leaveBuilding(e),e.safeTarget=null,e.safeTimer=0,d("seekTask","finished resting"));break}case"heal":{const y=t.buildings.filter(L=>L.kind==="infirmary"&&L.done);if(!y.length){d("seekTask","no infirmary");break}let R=y[0],W=re(e,t.centerOf(R));for(let L=1;L<y.length;L++){const J=re(e,t.centerOf(y[L]));J<W&&(W=J,R=y[L])}const T=t.centerOf(R),E=R.healRange||140,D=e.x>=R.x-8&&e.x<=R.x+R.w+8&&e.y>=R.y-8&&e.y<=R.y+R.h+8,z=Math.hypot(e.x-T.x,e.y-T.y);if(D&&t.tryEnterBuilding(e,R)){d("resting","entered infirmary");break}z<=E*.9?e.hp>=80&&d("seekTask","healed enough"):t.moveAlongPath(e,i,T,E*.9);break}case"doctoring":{const y=e.medicalJob;if(!y){d("seekTask","no medical job assigned");break}const R=y.patient;if(!R||!R.alive||!R.health||!R.health.injuries.length){pe.releaseJob(y,e),e.medicalJob=null,d("seekTask","patient no longer needs treatment");break}const W=Math.hypot(e.x-R.x,e.y-R.y),T=40;if(W>T)t.moveAlongPath(e,i,{x:R.x,y:R.y},T);else{const E=(((k=y.treatment)==null?void 0:k.duration)||30)/1e3;if(e.stateSince>=E){if(!y.treatment||!y.targetInjury){t.msg&&t.msg(`${((S=e.profile)==null?void 0:S.name)||"Doctor"} could not perform treatment - invalid job`,"bad"),pe.completeJob(y.id),e.medicalJob=null,d("seekTask","invalid medical job");return}const D=vn.performTreatment(e,R,y.treatment,y.targetInjury),z=y.treatment.name;D?t.msg&&t.msg(`${((P=e.profile)==null?void 0:P.name)||"Doctor"} successfully applied ${z} to ${((I=R.profile)==null?void 0:I.name)||"patient"}`,"good"):t.msg&&t.msg(`${((B=e.profile)==null?void 0:B.name)||"Doctor"} failed to apply ${z} to ${((N=R.profile)==null?void 0:N.name)||"patient"}`,"warn"),pe.completeJob(y.id),e.medicalJob=null,d("seekTask","treatment completed")}}break}case"beingTreated":{const y=e.isBeingTreated,R=e.doctorId;if(y&&R){const E=t.colonists.find(D=>D.id===R);if(E){const D=E.x-e.x,z=E.y-e.y;(Math.abs(D)>1||Math.abs(z)>1)&&(e.direction=Math.atan2(z,D))}break}const W=e.health&&(e.health.injuries.some(E=>E.severity>.6)||e.health.bloodLevel<.5),T=t.buildings.filter(E=>(E.kind==="bed"||E.kind==="house")&&E.done&&(!W||E.kind==="bed"&&E.isMedicalBed)&&t.buildingHasSpace&&t.buildingHasSpace(E,e));if(T.length>0){let E=T[0],D=re(e,t.centerOf(E));for(const J of T.slice(1)){const F=re(e,t.centerOf(J));F<D&&(D=F,E=J)}const z=t.centerOf(E);Math.hypot(e.x-z.x,e.y-z.y)<=20?t.tryEnterBuilding&&t.tryEnterBuilding(e,E)&&d("resting","entered medical bed"):t.moveAlongPath&&t.moveAlongPath(e,i,z,20)}else e.health&&(e.hp=Math.min(100,e.hp+.3*i)),e.health&&!e.needsMedical&&d("seekTask","minor injuries, resuming work");e.stateSince>30&&d("seekTask","medical bed search timeout");break}case"eat":{const y=(t.RES.bread||0)>0,R=(t.RES.food||0)>0,W=y||R;if(Math.random()<.01&&console.log(`Colonist eating: bread=${t.RES.bread}, food=${t.RES.food}, hunger=${e.hunger}, stateSince=${e.stateSince.toFixed(1)}`),!W){e.stateSince>1&&(e.hp=Math.max(0,e.hp-2.5*i)),console.log("NO FOOD AVAILABLE! Colonist will continue tasks or sleep."),d(t.isNight()?"sleep":"seekTask","no food available");break}if((e.hunger||0)>40&&(t.tryConsumeInventoryFood?t.tryConsumeInventoryFood(e):!1)){d("seekTask","ate from inventory");break}const T=t.buildings.filter(L=>L.kind==="pantry"&&L.done&&(L.breadStored||0)>0),E=T.length>0?T:t.buildings.filter(L=>(L.kind==="hq"||L.kind==="warehouse"||L.kind==="stock")&&L.done);if(Math.random()<.01&&console.log(`Food buildings found: ${E.length}, pantries: ${T.length}, buildings: ${E.map(L=>L.kind).join(", ")}`),E.length===0&&W){console.log(`No food buildings found! Available buildings: ${t.buildings.filter(L=>L.done).map(L=>L.kind).join(", ")}`),e.stateSince>1&&(y?(t.RES.bread=(t.RES.bread||0)-1,e.hunger=Math.max(0,(e.hunger||0)-80),e.hp=Math.min(100,e.hp+5),d("seekTask","ate bread without building"),console.log(`Colonist ate bread without building! Bread remaining: ${t.RES.bread}`)):(t.RES.food-=1,e.hunger=Math.max(0,(e.hunger||0)-60),e.hp=Math.min(100,e.hp+2.5),d("seekTask","ate food without building"),console.log(`Colonist ate food without building! Food remaining: ${t.RES.food}`)));break}let D=null,z=1/0;for(const L of E){const J=t.centerOf(L),F=Math.hypot(e.x-J.x,e.y-J.y);F<z&&(z=F,D=L)}if(D){const L=t.centerOf(D),J=Math.max(D.w,D.h)/2+e.r+15;Math.random()<.01&&console.log(`Eating: distance=${z.toFixed(1)}, reachDist=${J.toFixed(1)}, stateSince=${e.stateSince.toFixed(1)}`),z<=J?e.stateSince>.6&&(D.kind==="pantry"&&(t.RES.bread||0)>0?(console.log("Colonist successfully ate bread from pantry"),t.RES.bread=(t.RES.bread||0)-1,D.breadStored=Math.max(0,(D.breadStored||0)-1),e.hunger=Math.max(0,(e.hunger||0)-80),e.hp=Math.min(100,e.hp+5)):(console.log("Colonist successfully ate food from storage"),t.RES.food=Math.max(0,t.RES.food-1),e.hunger=Math.max(0,(e.hunger||0)-60),e.hp=Math.min(100,e.hp+2.5)),d("seekTask","finished eating")):t.moveAlongPath(e,i,L,J)}break}case"flee":{let y=null,R=null;const W=f?t.findSafeTurret(e,f):null;if(W){const T=W.range||120,E=t.centerOf(W),D=t.buildings.find(z=>z.kind==="house"&&z.done&&t.buildingHasSpace(z,e)&&re(t.centerOf(z),E)<T*T);D&&(R=D,y=t.centerOf(D))}if(!y){const T=t.buildings.find(E=>E.kind==="hq"&&t.buildingHasSpace(E,e));T&&(R=T,y=t.centerOf(T))}if(!y&&W&&(y=t.centerOf(W)),y){const T=y.x-e.x,E=y.y-e.y,D=Math.hypot(T,E),z=R?e.x>=R.x-8&&e.x<=R.x+R.w+8&&e.y>=R.y-8&&e.y<=R.y+R.h+8:!1;if(D<=20||z)if(R&&t.tryEnterBuilding(e,R))e.hideTimer=3,d("resting","hid from danger");else{const L=t.buildings.filter(J=>J.done&&t.buildingHasSpace(J,e)&&(J.kind==="house"||J.kind==="hq"));if(L.length){const J=L.sort((G,Y)=>re(e,t.centerOf(G))-re(e,t.centerOf(Y)))[0],F=t.centerOf(J);R=J,y=F}}else t.moveAlongPath(e,i,y,20)}else if(f){const T=Ei(Di(e,f));e.direction=Math.atan2(T.y,T.x),e.x+=T.x*(e.speed+90)*i,e.y+=T.y*(e.speed+90)*i}f||d("seekTask","no more danger");break}case"sleep":{const y=t.colonistNeedsMedicalBed(e),R=F=>{if(!F.length)return null;const G=e.t||0;if(e.reservedSleepFor&&F.includes(e.reservedSleepFor))return e.sleepTarget=e.reservedSleepFor,e.sleepTargetLockUntil=G+5,e.reservedSleepFor;let Y=e.sleepTarget;const se=e.sleepTargetLockUntil||0;if(Y&&!F.includes(Y)&&(e.reservedSleepFor===Y&&t.releaseSleepReservation(e),Y=void 0,e.sleepTarget=void 0,e.sleepTargetLockUntil=0),Y&&G<se){if(t.reserveSleepSpot(e,Y))return Y;e.reservedSleepFor===Y&&t.releaseSleepReservation(e),Y=void 0,e.sleepTarget=void 0,e.sleepTargetLockUntil=0}const ne=F.map(Z=>{const we=Math.sqrt(re(e,t.centerOf(Z))),Oe=t.buildingCapacity(Z),Ci=t.insideCounts.get(Z)||0,Ri=Math.max(0,Oe-Ci)*100-we;return{house:Z,score:Ri}}).sort((Z,we)=>we.score-Z.score);for(const{house:Z}of ne)if(t.reserveSleepSpot(e,Z))return e.sleepTarget=Z,e.sleepTargetLockUntil=G+5,Z;return null},W=t.buildings.filter(F=>(F.kind==="house"||F.kind==="bed"||F.kind==="tent")&&F.done&&!(F.kind==="bed"&&F.isMedicalBed&&!y)&&t.isProtectedByTurret(F)&&t.buildingHasSpace(F,e));if(W.length===0){const F=t.buildings.filter(G=>(G.kind==="house"||G.kind==="bed"||G.kind==="tent"||G.kind==="hq")&&G.done&&!(G.kind==="bed"&&G.isMedicalBed&&!y)&&t.buildingHasSpace(G,e));if(F.length>0){const G=R(F);if(!G){d("seekTask","no bed available");break}const Y=t.centerOf(G);Math.hypot(Y.x-e.x,Y.y-e.y)<=20?t.tryEnterBuilding(e,G)?(e.hideTimer=0,e.sleepTarget=void 0,e.sleepTargetLockUntil=0,d("resting","sleeping in unprotected shelter")):(e.sleepTarget=void 0,e.sleepTargetLockUntil=0,t.releaseSleepReservation(e),d("resting","sleeping outside shelter")):t.moveAlongPath(e,i,Y,20)}else{const G=t.buildings.find(Y=>Y.kind==="hq");if(G){const Y=t.centerOf(G);Math.hypot(Y.x-e.x,Y.y-e.y)>50?t.moveAlongPath(e,i,Y,40):d("resting","sleeping near HQ")}else d("resting","sleeping in place")}e.stateSince>15&&d("resting","sleep timeout - resting in place");break}if(!t.isNight()){d("seekTask","daybreak");break}let T=R(W);if(!T){d("seekTask","no bed available");break}let E=t.centerOf(T);const D=E.x-e.x,z=E.y-e.y,L=Math.hypot(D,z),J=e.x>=T.x-8&&e.x<=T.x+T.w+8&&e.y>=T.y-8&&e.y<=T.y+T.h+8;if(L<=20||J)if(t.tryEnterBuilding(e,T))e.hideTimer=0,e.sleepTarget=void 0,e.sleepTargetLockUntil=0,d("resting","fell asleep");else{e.sleepTarget=void 0,e.sleepTargetLockUntil=0,t.releaseSleepReservation(e);const F=t.buildings.filter(Y=>Y.done&&t.buildingHasSpace(Y,e)&&(Y.kind==="house"||Y.kind==="bed"||Y.kind==="tent"||Y.kind==="hq")&&!(Y.kind==="bed"&&Y.isMedicalBed&&!y)),G=R(F);G?(T=G,E=t.centerOf(G)):d("seekTask","no bed available")}else t.moveAlongPath(e,i,E,20),e.stateSince>15&&d("seekTask","sleep timeout");break}case"goToSleep":{const y=t.colonistNeedsMedicalBed(e),R=t.buildings.filter(F=>(F.kind==="house"||F.kind==="bed"||F.kind==="infirmary"||F.kind==="tent"||F.kind==="hq")&&F.done&&!(F.kind==="bed"&&F.isMedicalBed&&!y)&&t.buildingHasSpace(F,e)),T=(e.fatigue||0)<=p&&e.stateSince>=2;if(R.length===0){t.releaseSleepReservation(e),e.stateSince>3&&(T?d("seekTask","no rest buildings, fatigue recovered"):e.fatigue=Math.max(0,(e.fatigue||0)-i*2));break}const E=()=>{if(e.reservedSleepFor&&R.includes(e.reservedSleepFor))return e.sleepTarget=e.reservedSleepFor,e.sleepTargetLockUntil=(e.t||0)+5,e.reservedSleepFor;const F=R.map(G=>({b:G,d:re(e,t.centerOf(G)),priority:y&&G.kind==="bed"&&G.isMedicalBed?0:G.kind==="bed"?1:2})).sort((G,Y)=>G.priority-Y.priority||G.d-Y.d);for(const{b:G}of F)if(t.reserveSleepSpot(e,G))return e.sleepTarget=G,e.sleepTargetLockUntil=(e.t||0)+5,G;return null},D=E();if(!D){T&&d("seekTask","no available rest buildings, fatigue recovered");break}const z=t.centerOf(D),L=Math.hypot(z.x-e.x,z.y-e.y),J=e.x>=D.x-8&&e.x<=D.x+D.w+8&&e.y>=D.y-8&&e.y<=D.y+D.h+8;if(L<=20||J)if(t.tryEnterBuilding(e,D))e.hideTimer=0,d("resting","entered rest building");else{t.releaseSleepReservation(e);const F=E();F?F!==D&&t.clearPath(e):T&&d("seekTask","no available rest buildings, fatigue recovered")}else t.moveAlongPath(e,i,z,20),T&&d("seekTask","fatigue recovered while searching for rest");break}case"seekTask":{if(t.isNight()){d("sleep","night time");break}if(!e.task||e.task==="idle"&&Math.random()<.05){const y=e.task;t.pickTask(e),y!==e.task&&Math.random()<.1&&console.log(`Colonist assigned task: ${e.task}, target:`,e.target)}switch(e.task){case"build":d("build","assigned build task");break;case"harvestFarm":d("harvest","assigned farm task");break;case"harvestWell":d("harvest","assigned well task");break;case"chop":d("chop","assigned chop task");break;case"mine":d("mine","assigned mine task");break;case"cookWheat":d("cooking","assigned cooking task");break;case"storeBread":d("storingBread","assigned bread storage task");break;case"idle":default:e.target||(e.target={x:e.x+(Math.random()-.5)*160,y:e.y+(Math.random()-.5)*160}),d("idle","no tasks available");break}break}case"idle":{if(t.isNight()){Math.random()<.1&&console.log("Colonist was idle during night time, forcing sleep transition"),d("sleep","night time while idle");break}const y=e.target;if(!y){d("seekTask","no target");break}t.moveAlongPath(e,i,y,8)&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","reached target"));break}case"build":{const y=e.target;if(!y||y.done){e.stateSince>=.5&&(t.releaseBuildReservation(e),e.task=null,e.target=null,t.clearPath(e),d("seekTask","building complete"));break}const R={x:y.x+y.w/2,y:y.y+y.h/2};if(e.stateSince>15){console.log(`Build task timeout after ${e.stateSince.toFixed(1)}s, abandoning building`),t.releaseBuildReservation(e),e.task=null,e.target=null,t.clearPath(e),d("seekTask","build timeout");break}const W=Math.hypot(e.x-R.x,e.y-R.y);if(e.lastDistToNode||(e.lastDistToNode=W),e.lastDistToNode=W,t.moveAlongPath(e,i,R,12)){const T=t.getWorkSpeedMultiplier?t.getWorkSpeedMultiplier(e,"Construction"):1,E=e.skills?ge(e,"Construction"):0,D=He(E),z=T*D;if(y.buildLeft-=25*i*z,e.skills&&ce(e,"Construction",6*i,e.t||0),y.buildLeft<=0){if(y.done=!0,y.kind==="farm"&&(y.growth=0,y.ready=!1),y.kind==="door"&&pi(y),y.isFloorConstruction&&y.floorType){const L=y.floorType,F={BASIC_PATH:1,STONE_ROAD:2,WOODEN_FLOOR:3,CONCRETE:4,METAL_FLOOR:5,CARPET:6}[L]||1,G=Math.floor(y.x/32),Y=Math.floor(y.y/32);if(t.terrainGrid&&G>=0&&Y>=0&&G<t.grid.cols&&Y<t.grid.rows){const se=Y*t.grid.cols+G;t.terrainGrid.floors[se]=F,(O=t.syncTerrainToGrid)==null||O.call(t);const ne=t.buildings.indexOf(y);ne!==-1&&t.buildings.splice(ne,1),t.msg("Floor construction complete","good")}}if(Xe(t,e.x,e.y,e.r)){const L=[0,Math.PI/2,Math.PI,3*Math.PI/2,Math.PI/4,3*Math.PI/4,5*Math.PI/4,7*Math.PI/4];let J=!1;for(const F of L){const G=Math.max(y.w,y.h)/2+e.r+10,Y=y.x+y.w/2+Math.cos(F)*G,se=y.y+y.h/2+Math.sin(F)*G,ne=Math.max(e.r,Math.min(Y,Q.w-e.r)),Z=Math.max(e.r,Math.min(se,Q.h-e.r));if(!Xe(t,ne,Z,e.r)){e.x=ne,e.y=Z,J=!0,Math.random()<.1&&console.log(`Moved colonist to safety after building completion: (${e.x.toFixed(1)}, ${e.y.toFixed(1)})`);break}}if(!J){const F=t.buildings.find(G=>G.kind==="hq");F&&(e.x=F.x+F.w/2,e.y=F.y-30,console.log("Emergency teleport to HQ area after building completion"))}}t.msg(y.name?y.name+" complete":"Building complete"),t.rebuildNavGrid(),t.clearPath(e),t.releaseBuildReservation(e),e.task=null,e.target=null,d("seekTask","building complete")}}break}case"harvest":{const y=e.target;if(!y){e.stateSince>=.5&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","no harvest target"));break}if(y.kind==="farm"&&!y.ready){e.stateSince>=.5&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","farm not ready"));break}const R={x:y.x+y.w/2,y:y.y+y.h/2};if(t.moveAlongPath(e,i,R,12)){const W=e.skills?ge(e,"Plants"):0,T=1+Math.min(.5,W*.02);if(y.kind==="farm"){y.ready=!1,y.growth=0;const E=Math.round(10*T);if(y.inventory){const D=xt(y,"wheat",E);if(D>0&&t.msg(`Farm harvested (+${D} wheat stored in farm)`,"good"),D<E){const z=E-D,L=t.addResource("wheat",z);L>0&&t.msg(`Farm full! +${L} wheat to storage`,"info")}}else{const D=t.addResource("wheat",E);D>0&&t.msg(`Farm harvested (+${D} wheat)`,"good")}e.skills&&ce(e,"Plants",20,e.t||0)}else if(y.kind==="well"){const E=t.addResource("food",Math.round(5*T*.6));E>0&&t.msg(`Well collected (+${E} food)`,"good")}e.stateSince>=.5&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","harvest complete"))}break}case"chop":{const y=e.target;if(!y||y.hp<=0){e.stateSince>=.5&&(y&&t.assignedTargets.has(y)&&t.assignedTargets.delete(y),e.task=null,e.target=null,t.clearPath(e),d("seekTask","tree gone"));break}const R=y.x-e.x,W=y.y-e.y,T=Math.hypot(R,W),E=(y.r||12)+e.r+4,D=2.5;if(T<=E+D+.1){const z=t.getWorkSpeedMultiplier?t.getWorkSpeedMultiplier(e,"Woodcutting"):1,L=e.skills?ge(e,"Plants"):0,J=He(L),F=z*J;if(y.hp-=18*i*F,e.skills&&ce(e,"Plants",4*i,e.t||0),y.hp<=0){const G=1+Math.min(.5,L*.02),Y=t.addResource("wood",Math.round(6*G));t.trees.splice(t.trees.indexOf(y),1),t.assignedTargets.has(y)&&t.assignedTargets.delete(y),Y>0&&t.msg(`+${Y} wood`,"good"),t.navigationManager.rebuildNavGridPartial(y.x,y.y,y.r+32),e.stateSince>=.5&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","chopped tree"))}break}else t.moveAlongPath(e,i,y,E+D),e.lastDistToNode||(e.lastDistToNode=T),e.lastDistToNode=T;e.stateSince&&e.stateSince>20&&(console.log(`Chop task timeout after ${e.stateSince.toFixed(1)}s, abandoning tree`),t.assignedTargets.has(y)&&t.assignedTargets.delete(y),e.task=null,e.target=null,t.clearPath(e),d("seekTask","chop timeout"));break}case"mine":{const y=e.target;if(!y||y.hp<=0){e.stateSince>=.5&&(y&&t.assignedTargets.has(y)&&t.assignedTargets.delete(y),e.task=null,e.target=null,t.clearPath(e),d("seekTask","rock gone"));break}const R=y.x-e.x,W=y.y-e.y,T=Math.hypot(R,W),E=(y.r||12)+e.r+4,D=2.5;if(Math.random()<.01&&console.log(`Mining: distance=${T.toFixed(1)}, interact=${E}, colonist at (${e.x.toFixed(1)}, ${e.y.toFixed(1)}), rock at (${y.x.toFixed(1)}, ${y.y.toFixed(1)})`),T<=E+D+.1){const z=t.getWorkSpeedMultiplier?t.getWorkSpeedMultiplier(e,"Mining"):1,L=e.skills?ge(e,"Mining"):0,J=He(L),F=z*J;if(y.hp-=16*i*F,e.skills&&ce(e,"Mining",4*i,e.t||0),y.hp<=0){const G=1+Math.min(.5,L*.02),Y=t.addResource("stone",Math.round(5*G));t.rocks.splice(t.rocks.indexOf(y),1),t.assignedTargets.has(y)&&t.assignedTargets.delete(y),Y>0&&t.msg(`+${Y} stone`,"good"),t.navigationManager.rebuildNavGridPartial(y.x,y.y,y.r+32),e.stateSince>=.5&&(e.task=null,e.target=null,t.clearPath(e),d("seekTask","mined rock"))}break}else t.moveAlongPath(e,i,y,E+D),Math.random()<.01&&console.log(`Moving toward rock: target=(${y.x.toFixed(1)}, ${y.y.toFixed(1)}), distance=${T.toFixed(1)}`);e.stateSince&&e.stateSince>15&&(console.log(`Colonist stuck mining for ${e.stateSince.toFixed(1)}s, abandoning`),t.assignedTargets.has(y)&&t.assignedTargets.delete(y),e.task=null,e.target=null,t.clearPath(e),d("seekTask","mine timeout"));break}case"waitingAtDoor":{const y=e.waitingForDoor;if(!y||y.kind!=="door"||!y.done){e.waitingForDoor=null,e.doorWaitStart=void 0,d("seekTask","door no longer exists");break}if(xn(y))e.id&&Pt(y,e.id),e.waitingForDoor=null,e.doorWaitStart=void 0,e.task==="build"?d("build","door opened, resuming build"):e.task==="chop"?d("chop","door opened, resuming chop"):e.task==="mine"?d("mine","door opened, resuming mine"):e.task==="harvestFarm"||e.task==="harvestWell"?d("harvest","door opened, resuming harvest"):d("move","door opened, resuming movement");else{const R=e.doorWaitStart?e.t-e.doorWaitStart:0;R>10&&(console.log(`Colonist gave up waiting at door after ${R.toFixed(1)}s`),e.id&&Pt(y,e.id),e.waitingForDoor=null,e.doorWaitStart=void 0,e.task=null,e.target=null,t.clearPath&&t.clearPath(e),d("seekTask","door wait timeout"))}break}case"cooking":{const y=e.target;if(!y||y.kind!=="stove"||!y.done){e.task=null,e.target=null,t.clearPath(e),d("seekTask","stove no longer available");break}const R={x:y.x+y.w/2,y:y.y+y.h/2};if(Math.hypot(e.x-R.x,e.y-R.y)>20){t.moveAlongPath(e,i,R,20);break}if(!e.carryingWheat||e.carryingWheat===0){let T=0;const E=t.buildings.filter(D=>D.kind==="farm"&&D.done&&D.inventory);for(const D of E)if(gi(D,"wheat")>=5){const L=en(D,"wheat",5);T=L,t.msg(`${((X=e.profile)==null?void 0:X.name)||"Colonist"} took ${L} wheat from farm`,"info");break}if(T===0&&(t.RES.wheat||0)>=5&&(t.RES.wheat=(t.RES.wheat||0)-5,T=5,t.msg(`${((j=e.profile)==null?void 0:j.name)||"Colonist"} picked up 5 wheat`,"info")),T>0)e.carryingWheat=T,y.cookingColonist=e.id;else{e.task=null,e.target=null,d("seekTask","no wheat available");break}}if(e.carryingWheat>0&&(!y.wheatStored||y.wheatStored===0)&&(y.wheatStored=e.carryingWheat,e.carryingWheat=0,y.cookingProgress=0,t.msg(`${((H=e.profile)==null?void 0:H.name)||"Colonist"} started cooking`,"info")),y.wheatStored&&y.wheatStored>0&&y.cookingProgress!==void 0){const T=e.skills?ge(e,"Cooking"):0,D=.1*He(T);if(y.cookingProgress+=D*i,e.skills&&ce(e,"Cooking",3*i,e.t||0),y.cookingProgress>=1){const z=Math.floor(y.wheatStored/5)*3;e.carryingBread=(e.carryingBread||0)+z,y.wheatStored=0,y.cookingProgress=0,y.cookingColonist=void 0,t.msg(`${((q=e.profile)==null?void 0:q.name)||"Colonist"} cooked ${z} bread!`,"good"),e.skills&&ce(e,"Cooking",30,e.t||0),e.task=null,e.target=null,d("seekTask","finished cooking")}}e.stateSince>30&&(console.log(`Cooking task timeout after ${e.stateSince.toFixed(1)}s, abandoning`),y.cookingColonist=void 0,e.task=null,e.target=null,d("seekTask","cooking timeout"));break}case"storingBread":{const y=e.target;if(!y||y.kind!=="pantry"||!y.done){e.carryingBread&&e.carryingBread>0&&(t.addResource("bread",e.carryingBread),e.carryingBread=0),e.task=null,e.target=null,d("seekTask","pantry no longer available");break}const R={x:y.x+y.w/2,y:y.y+y.h/2};if(Math.hypot(e.x-R.x,e.y-R.y)>20){t.moveAlongPath(e,i,R,20);break}if(e.carryingBread&&e.carryingBread>0){if(y.inventory){const T=xt(y,"bread",e.carryingBread);if(T>0&&(t.msg(`${((U=e.profile)==null?void 0:U.name)||"Colonist"} stored ${T} bread in pantry`,"good"),y.breadStored=(y.breadStored||0)+T),t.addResource("bread",T),T<e.carryingBread){const E=e.carryingBread-T;t.addResource("bread",E),t.msg(`Pantry full! +${E} bread to general storage`,"info")}}else y.breadStored=(y.breadStored||0)+e.carryingBread,t.addResource("bread",e.carryingBread),t.msg(`${((K=e.profile)==null?void 0:K.name)||"Colonist"} stored ${e.carryingBread} bread`,"good");e.carryingBread=0,e.task=null,e.target=null,d("seekTask","bread stored")}else e.task=null,e.target=null,d("seekTask","no bread to store");break}}e.overlapTimers||(e.overlapTimers=new Map);for(const y of t.colonists){if(y===e||!y.alive)continue;if((e.state==="mine"||e.state==="chop")&&e.target){const J=(e.target.r||12)+e.r+4;if(Math.hypot(e.x-e.target.x,e.y-e.target.y)<=J+2.5)continue}if(e.inside||y.inside)continue;const R=e.x-y.x,W=e.y-y.y,T=R*R+W*W,E=e.r+y.r+8,D=E*E,z=y.id||y,L=e.overlapTimers;if(T>0&&T<D){if(L.has(z)||L.set(z,0),L.set(z,L.get(z)+i),L.get(z)>=1){const F=Math.sqrt(T)||1,Y=(E-F)/E*.3;e.x+=R/F*Y*i*3,e.y+=W/F*Y*i*3}}else L.delete(z)}}function $e(t,e,i,n){for(const o of t.buildings){if(o.kind==="hq"||o.kind==="path"||o.kind==="house"||o.kind==="farm"||o.kind==="bed"||!o.done||o.kind==="door"&&!At(o))continue;const a=Math.max(o.x,Math.min(e,o.x+o.w)),s=Math.max(o.y,Math.min(i,o.y+o.h)),r=e-a,l=i-s;if(r*r+l*l<=n*n)return!0}return!1}const In=48,En=4,Dn=25,Fn=.75;function Ln(t,e,i,n){const o=e;if(Math.hypot(i.x-e.x,i.y-e.y)<=e.r+4)return o.path=void 0,o.pathIndex=void 0,!1;o.repath=Math.max(0,(o.repath??0)-n);const s=o.pathGoal,r=!s||Math.hypot(s.x-i.x,s.y-i.y)>In,l=!o.path||o.pathIndex==null||o.pathIndex>=o.path.length;if(r||l||(o.repath??0)<=0){if(!t.grid)return!1;const c=Xi(t.grid,e.x,e.y,i.x,i.y,t.regionManager);if(c&&c.length){for(;c.length&&Math.hypot(c[0].x-e.x,c[0].y-e.y)<A*.25;)c.shift();return c.length?(o.path=c,o.pathIndex=0,o.pathGoal={x:i.x,y:i.y},o.repath=1.5+Math.random()*1,!0):(o.path=void 0,o.pathIndex=void 0,!1)}return o.path=void 0,o.pathIndex=void 0,o.repath=.5+Math.random()*.5,!1}return!0}function Nn(t,e,i){const n=e,o=n.path,a=n.pathIndex??0;if(!o||a>=o.length)return n.path=void 0,n.pathIndex=void 0,0;const s=o[a];if(!s)return n.path=void 0,n.pathIndex=void 0,0;const r=e.x,l=e.y,c=s.x-e.x,h=s.y-e.y,f=Math.hypot(c,h);let d=e.speed;if(t.grid){const g=Math.floor(e.x/A),p=Math.floor(e.y/A);if(g>=0&&p>=0&&g<t.grid.cols&&p<t.grid.rows){const b=p*t.grid.cols+g;t.grid.cost[b]<=.7&&(d+=Dn)}}const u=d*i;if(f<=En)e.x=s.x,e.y=s.y,n.pathIndex=a+1,n.pathIndex>=o.length&&(n.path=void 0,n.pathIndex=void 0);else if(f>0){const g=1/f,p=c*g*u,b=h*g*u;Math.hypot(p,b)>=f?(e.x=s.x,e.y=s.y,n.pathIndex=a+1,n.pathIndex>=o.length&&(n.path=void 0,n.pathIndex=void 0)):(e.x+=p,e.y+=b)}return Math.hypot(e.x-r,e.y-l)}function Wn(t,e,i,n){const o=i.x-e.x,a=i.y-e.y,s=Math.hypot(o,a);if(s<.001)return!1;const r=e.speed*n,l=o/s,c=a/s,h=e.x+l*r,f=e.y+c*r;if(!$e(t,h,f,e.r))return e.x=h,e.y=f,!0;const d=-c,u=l,m=e.x+d*r*.5,g=e.y+u*r*.5;if(!$e(t,m,g,e.r))return e.x=m,e.y=g,!0;const p=e.x-d*r*.5,b=e.y-u*r*.5;return $e(t,p,b,e.r)?!1:(e.x=p,e.y=b,!0)}function Gn(t,e,i){var m;const n=e._lastPos||{x:e.x,y:e.y},o=Math.hypot(e.x-n.x,e.y-n.y);e._lastPos={x:e.x,y:e.y};const a=o>.5;e.meleeCd=Math.max(0,(e.meleeCd||0)-i);const s=t.buildings.find(g=>g.kind==="hq");let r=s,l=re(e,t.centerOf(s));for(const g of t.colonists){const p=re(e,g);p<l&&(l=p,r=g)}const c=r.w?t.centerOf(r):{x:r.x,y:r.y};e.target=r;let h=Math.hypot(c.x-e.x,c.y-e.y),f=!1,d=0;h>e.r+4?(f=Ln(t,e,c,i),f&&(d=Nn(t,e,i),h=Math.hypot(c.x-e.x,c.y-e.y))):(e.path=void 0,e.pathIndex=void 0);let u=!1;if(h>e.r+4&&(d<.5||!f)){const g=t.buildings.find(p=>p.kind==="door"&&p.done&&At(p)&&Sn(e,p));if(g){if(e.waitingForDoor=g,e.doorWaitStart||(e.doorWaitStart=t.time||0),!a&&e.meleeCd<=0){const p=Tn(g,e.dmg,t);e.meleeCd=1,p&&(e.waitingForDoor=null,e.doorWaitStart=void 0)}}else e.waitingForDoor=null,e.doorWaitStart=void 0,u=Wn(t,e,c,i);!u&&f&&e.path?(e.stuckTimer=(e.stuckTimer||0)+i,e.stuckTimer>Fn&&(e.path=void 0,e.pathIndex=void 0,e.repath=0,e.stuckTimer=0)):f&&(e.stuckTimer=0)}else f&&(e.stuckTimer=0);if(f||(e.stuckTimer=0),r.w){const g=r;t.pointInRect(e,g)&&(!a&&e.meleeCd<=0&&(g.hp-=e.dmg,e.meleeCd=1),g.hp<=0&&(g.kind==="hq"?t.lose():(t.evictColonistsFrom(g),t.buildings.splice(t.buildings.indexOf(g),1),t.msg((g.name||g.kind)+" destroyed","warn"))))}else{const g=r;if(Math.hypot(e.x-g.x,e.y-g.y)<e.r+8&&!a&&e.meleeCd<=0){let b="bruise";const v=((m=e.color)==null?void 0:m.toLowerCase())||"";v.includes("red")||v.includes("orange")?b="burn":v.includes("green")||v.includes("brown")?b="bite":e.dmg>15&&(b="cut"),typeof t.applyDamageToColonist=="function"?t.applyDamageToColonist(g,e.dmg,b):g.hp-=e.dmg,e.meleeCd=1,g.hp<=0&&(g.alive=!1,t.colonists.splice(t.colonists.indexOf(g),1),t.msg("A colonist has fallen","warn"))}}}function On(t){const e=t.ctx,i=t.canvas.width,n=t.canvas.height,o=t.isTouch,a=Math.min(t.scale(o?980:860),i-t.scale(o?28:40)),s=Math.min(t.scale(o?720:620),n-t.scale(o?60:80)),r=(i-a)/2,l=(n-s)/2;e.save(),e.fillStyle="#0b1628dd",e.fillRect(r,l,a,s),e.strokeStyle="#1e293b",e.strokeRect(r+.5,l+.5,a-1,s-1),e.fillStyle="#dbeafe",e.font=t.getScaledFont(o?22:18,"600"),e.fillText("Build Menu (B to close)",r+t.scale(14),l+t.scale(24));const c=sn(V),h=Object.keys(c),f=t.scale(o?36:28),d=Math.floor((a-f)/Math.max(1,h.length));t.menuRects=[];let u=null;for(let p=0;p<h.length;p++){const b=r+t.scale(12)+p*d;let v=l+t.scale(50);const M=h[p];e.fillStyle="#93c5fd",e.font=t.getScaledFont(o?18:15,"600"),e.fillText(M,b,v),v+=t.scale(o?12:8);const w=c[M];for(const[C,k]of w){v+=t.scale(o?12:8);const S=t.scale(o?78:58),P=d-t.scale(18),I=b,B=v,N=t.mouse.x*t.DPR,O=t.mouse.y*t.DPR,X=N>=I&&N<=I+P&&O>=B&&O<=B+S;e.fillStyle=t.selectedBuild===C?"#102034":X?"#1a1f2e":"#0f172a",e.fillRect(I,B,P,S),e.strokeStyle=t.selectedBuild===C?"#4b9fff":X?"#3b82f6":"#1e293b",e.strokeRect(I+.5,B+.5,P-1,S-1),e.fillStyle="#dbeafe",e.font=t.getScaledFont(o?18:15,"600"),e.fillText(k.name,I+t.scale(10),B+t.scale(o?22:18));const j=t.costText(k.cost||{});e.fillStyle="#9fb3c8",e.font=t.getScaledFont(o?14:12);const H=Math.min(t.scale(o?120:100),e.measureText(j).width+t.scale(4));if(e.fillText(j,I+P-H,B+t.scale(o?22:18)),k.description){e.fillStyle="#94a3b8",e.font=t.getScaledFont(o?14:12);const q=P-t.scale(18);let U=k.description;for(;e.measureText(U).width>q&&U.length>10;)U=U.substring(0,U.length-4)+"...";e.fillText(U,I+t.scale(10),B+t.scale(o?46:36))}if(X&&k.description&&(u={key:C,desc:k.description}),t.menuRects.push({key:C,x:I,y:B,w:P,h:S}),v+=S,v>l+s-t.scale(o?90:70))break}}if(u){const p=t.scale(o?16:14),b=t.scale(o?420:360);e.font=t.getScaledFont(o?16:14);const v=zn(t,u.desc,b-p*2),M=t.scale(o?20:18),w=v.length*M+p*2,C=t.mouse.x*t.DPR,k=t.mouse.y*t.DPR;let S=C+t.scale(20),P=k-w-t.scale(10);S+b>i&&(S=C-b-t.scale(20)),P<0&&(P=k+t.scale(20)),e.fillStyle="#0f1419f0",e.fillRect(S,P,b,w),e.strokeStyle="#374151",e.strokeRect(S+.5,P+.5,b-1,w-1),e.fillStyle="#e5e7eb";for(let I=0;I<v.length;I++)e.fillText(v[I],S+p,P+p+(I+1)*M-t.scale(4))}e.fillStyle="#9fb3c8",e.font=t.getScaledFont(o?16:14);const m="Click an item to select • Hover for details • Press B to close",g=e.measureText(m).width;e.fillText(m,(i-g)/2,l+s+t.scale(o?30:24)),e.restore()}function Bt(t){const e=t.mouse.x*t.DPR,i=t.mouse.y*t.DPR;for(const n of t.menuRects)if(e>=n.x&&e<=n.x+n.w&&i>=n.y&&i<=n.y+n.h){t.selectedBuild=n.key,t.showBuildMenu=!1,t.toast("Selected: "+V[n.key].name);return}t.showBuildMenu=!1}function zn(t,e,i){const n=t.ctx,o=e.split(" "),a=[];let s="";for(const r of o){const l=s+(s?" ":"")+r;n.measureText(l).width<=i?s=l:(s&&a.push(s),s=r)}return s&&a.push(s),a}function yi(t,e){if(!e.items||e.items.length===0){Re(t);return}const i={...e,visible:!0,x:e.screenX,y:e.screenY,openSubmenu:e.openSubmenuId};t.contextMenu=i,t.contextMenuRects=[]}function Re(t){t.contextMenu=null,t.contextMenuRects=[]}function Hn(t){const e=t.contextMenu;if(!e||!e.visible)return;const i=t.ctx;i.save();const n=t.scale(32),o=t.scale(220),a=t.scale(8),s=t.scale(24),r=e.items??[],l=r.length*n+a*2;let c=e.x,h=e.y;c+o>t.canvas.width&&(c=t.canvas.width-o-t.scale(10)),h+l>t.canvas.height&&(h=t.canvas.height-l-t.scale(10)),i.fillStyle="rgba(0, 0, 0, 0.4)",i.fillRect(c+3,h+3,o,l),i.fillStyle="#1e293b",i.fillRect(c,h,o,l),i.strokeStyle="#374151",i.lineWidth=1,i.strokeRect(c+.5,h+.5,o-1,l-1),t.contextMenuRects=[];let f=h+a;for(let d=0;d<r.length;d++){const u=r[d],m=f+d*n,g={item:u,x:c,y:m,w:o,h:n},p=u.enabled!==!1,b=mi(t.mouse.x*t.DPR,t.mouse.y*t.DPR,g);t.contextMenuRects.push(g),b&&p&&(i.fillStyle="#374151",i.fillRect(c+1,m,o-2,n));const v=u.submenu&&e.openSubmenu===u.id;v&&(i.fillStyle="#475569",i.fillRect(c+1,m,o-2,n));const M=u.icon??"";if(i.fillStyle=p?"#f1f5f9":"#6b7280",i.font=t.getScaledFont(16,"400"),i.textAlign="left",i.textBaseline="middle",M&&i.fillText(M,c+a,m+n/2),i.fillStyle=p?"#f1f5f9":"#6b7280",i.font=t.getScaledFont(14,"400"),i.fillText(u.label,c+a+(M?s:0),m+n/2),u.submenu&&u.submenu.length>0){i.fillStyle=p?"#9ca3af":"#4b5563";const w=v?"▼":"▶";i.fillText(w,c+o-a-t.scale(16),m+n/2),v&&Yn(t,u,c+o+t.scale(5),m)}}i.restore()}function Yn(t,e,i,n){const o=e.submenu??[];if(o.length===0)return;const a=t.ctx,s=t.scale(30),r=t.scale(200),l=t.scale(8),c=t.scale(22),h=o.length*s+l*2;let f=i,d=n;f+r>t.canvas.width&&(f=i-r-t.scale(225)),d+h>t.canvas.height&&(d=t.canvas.height-h-t.scale(10)),a.fillStyle="rgba(0, 0, 0, 0.4)",a.fillRect(f+3,d+3,r,h),a.fillStyle="#1e293b",a.fillRect(f,d,r,h),a.strokeStyle="#374151",a.strokeRect(f+.5,d+.5,r-1,h-1);for(let u=0;u<o.length;u++){const m=o[u],g=d+l+u*s,p=m.enabled!==!1,b={item:m,x:f,y:g,w:r,h:s,isSubmenu:!0,parentId:e.id},v=mi(t.mouse.x*t.DPR,t.mouse.y*t.DPR,b);t.contextMenuRects.push(b),v&&p&&(a.fillStyle="#374151",a.fillRect(f+1,g,r-2,s));const M=m.icon??"";a.fillStyle=p?"#f1f5f9":"#6b7280",a.font=t.getScaledFont(14,"400"),a.textAlign="left",a.textBaseline="middle",M&&a.fillText(M,f+l,g+s/2),a.fillStyle=p?"#f1f5f9":"#6b7280",a.font=t.getScaledFont(13,"400"),a.fillText(m.label,f+l+(M?c:0),g+s/2)}}function mi(t,e,i){return t>=i.x&&t<=i.x+i.w&&e>=i.y&&e<=i.y+i.h}function It(t,e,i,n){const o=jn(t,e,i,n);yi(t,o)}function jn(t,e,i,n){var b,v;const o=!e.task||e.task==="idle",a=e.hp<50,s=(e.hunger||0)>60,r=(e.fatigue||0)>60,l=((b=e.health)==null?void 0:b.injuries)??[],c=l.length>0,h=l.some(M=>M.bleeding>0),f=l.some(M=>M.infected),d=(((v=e.health)==null?void 0:v.totalPain)||0)>.3,u=l.some(M=>M.type==="gunshot"||M.type==="fracture"&&M.severity>.6),m=e.state==="downed",g=[];m&&g.push({id:"medical_rescue",label:"Rescue (Carry to Bed)",icon:"🚑",enabled:!0}),h&&(g.push({id:"medical_bandage",label:"Bandage Wounds",icon:"🩹",enabled:!0}),g.push({id:"medical_bandage_all_bleeding",label:"Bandage All Bleeding",icon:"🩸",enabled:!0})),f&&g.push({id:"medical_treat_infection",label:"Treat Infection",icon:"💊",enabled:!0}),u&&g.push({id:"medical_surgery",label:"Surgery",icon:"⚕️",enabled:!0}),d&&g.push({id:"medical_pain_relief",label:"Pain Relief",icon:"💉",enabled:!0}),c&&(g.push({id:"medical_treat_all",label:"Treat All Injuries",icon:"🏥",enabled:!0}),g.push({id:"medical_rest",label:"Bed Rest",icon:"🛌",enabled:!0}),g.push({id:"medical_injury_summary",label:"Injury Summary",icon:"📋",enabled:!0})),g.length===0&&a&&g.push({id:"medical_treat",label:"Basic Treatment",icon:"🩹",enabled:!0});const p=[{id:"prioritize",label:"Prioritize",icon:"⚡",enabled:!0,submenu:[{id:"prioritize_medical",label:"Medical Work",icon:"🏥",enabled:!0},{id:"prioritize_work",label:"Work Tasks",icon:"🔨",enabled:!0},{id:"prioritize_build",label:"Construction",icon:"🏗️",enabled:!0},{id:"prioritize_haul",label:"Hauling",icon:"📦",enabled:!0},{id:"prioritize_research",label:"Research",icon:"🔬",enabled:!0},...t.selColonist&&t.selColonist!==e&&(c||a)?(()=>{var C,k;const M=t.selColonist,w=M.assignedMedicalPatientId&&M.assignedMedicalPatientId===e.id;return[{id:w?"clear_prioritize_treat":"prioritize_treat_patient",label:w?`Clear Treat ${((C=e.profile)==null?void 0:C.name)||"Patient"}`:`Treat ${((k=e.profile)==null?void 0:k.name)||"Patient"} First`,icon:"🩺",enabled:!0}]})():[]]},{id:"force",label:"Force",icon:"❗",enabled:!0,submenu:[{id:"force_rest",label:"Rest Now",icon:"😴",enabled:r},{id:"force_eat",label:"Eat Now",icon:"🍽️",enabled:s},{id:"force_work",label:"Work",icon:"⚒️",enabled:o},{id:"force_guard",label:"Guard Area",icon:"🛡️",enabled:!0}]},{id:"goto",label:"Go To",icon:"🎯",enabled:!0,submenu:[{id:"goto_hq",label:"HQ",icon:"🏠",enabled:!0},{id:"goto_safety",label:"Safe Room",icon:"🛡️",enabled:!0},{id:"goto_bed",label:"Nearest Bed",icon:"🛏️",enabled:!0},{id:"goto_food",label:"Food Storage",icon:"🥘",enabled:!0}]},{id:"medical",label:"Medical",icon:"🏥",enabled:c||a,submenu:g},{id:"cancel",label:"Cancel Current Task",icon:"❌",enabled:!!e.target},{id:"follow",label:t.follow&&t.selColonist===e?"Stop Following":"Follow",icon:"👁️",enabled:!0}];return{target:e,screenX:i,screenY:n,items:p,onSelect:({item:M})=>{t.handleContextMenuAction(M.id,e)}}}class Un{constructor(){x(this,"providers",new Map)}register(e,i){const n=e,o=this.providers.get(n)??[];o.push(i),this.providers.set(n,o)}collectItems(e,i){const n=[],o=this.providers.get(i.kind)??[],a=this.providers.get("*")??[];for(const s of[...a,...o]){const r=s({game:e,building:i});Array.isArray(r)&&r.length&&n.push(...r)}return n}}const gt=new Un;function et(t,e,i,n){const o=gt.collectItems(t,e);return o.length?(yi(t,{target:e,screenX:i,screenY:n,items:o}),!0):!1}gt.register("bed",({game:t,building:e})=>{if(e.kind!=="bed")return null;const i=!!e.isMedicalBed;return[{id:"bed_medical_info",label:i?"Medical bed (patients only)":"Standard bed (rest only)",icon:"ℹ️",enabled:!1},{id:i?"bed_unset_medical":"bed_set_medical",label:i?"Unset Medical Bed":"Set as Medical Bed",icon:i?"🛌":"⚕️",enabled:!0,action:({game:a,target:s})=>{s.isMedicalBed=!s.isMedicalBed;const r=!!s.isMedicalBed;a.msg(r?"Bed designated as a medical bed":"Bed returned to standard use",r?"good":"info")}}]});let ke=null,We=!1;function Qn(t){t.inventory&&(ke=t,We=!0)}function Et(){ke=null,We=!1}function Dt(){return We}function qn(t,e,i){if(!We||!ke||!ke.inventory)return;t.save(),t.setTransform(1,0,0,1,0,0);const n=ke.inventory,o=ke,a=Math.min(500,e*.85),s=Math.min(600,i*.75),r=(e-a)/2,l=(i-s)/2,c=16;t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,e,i),t.fillStyle="#1a2332",t.fillRect(r,l,a,s),t.strokeStyle="#3b4a5a",t.lineWidth=2,t.strokeRect(r,l,a,s);const h=60;t.fillStyle="#2d3e50",t.fillRect(r,l,a,h),t.fillStyle="#ffffff",t.font="bold 24px Arial, sans-serif",t.textAlign="left";const f=o.name||"Building";t.fillText(`${f} Inventory`,r+c,l+38);const d=40,u=r+a-d-c,m=l+(h-d)/2;t.fillStyle="#d32f2f",t.beginPath(),t.roundRect(u,m,d,d,6),t.fill(),t.strokeStyle="#fff",t.lineWidth=3,t.beginPath(),t.moveTo(u+12,m+12),t.lineTo(u+d-12,m+d-12),t.moveTo(u+d-12,m+12),t.lineTo(u+12,m+d-12),t.stroke();const g=l+h+c;t.fillStyle="#ffffff",t.font="16px Arial, sans-serif",t.textAlign="left";const p=n.items.length,b=n.capacity,v=tn(o);t.fillText(`Slots: ${p}/${b}`,r+c,g),t.fillText(`Total Items: ${v}`,r+a-150,g);const M=g+30,w=60;if(n.items.length===0)t.fillStyle="#888888",t.font="italic 18px Arial, sans-serif",t.textAlign="center",t.fillText("No items stored",r+a/2,M+100);else{let k=M;for(const S of n.items){if(k+w>l+s-80)break;t.fillStyle="#2a3a4a",t.fillRect(r+c,k,a-c*2,w-8),t.strokeStyle="#3b4a5a",t.lineWidth=1,t.strokeRect(r+c,k,a-c*2,w-8);const P=on(S.type);t.font="32px Arial, sans-serif",t.textAlign="left",t.fillText(P,r+c*2,k+40);const I=nn(S.type);t.fillStyle="#ffffff",t.font="bold 18px Arial, sans-serif",t.fillText(I,r+c*4+32,k+25),t.fillStyle="#90caf9",t.font="16px Arial, sans-serif";const B=S.maxStack||100;t.fillText(`Quantity: ${S.quantity}/${B}`,r+c*4+32,k+45);const N=r+a-120,O=k+20,X=80,j=20;t.fillStyle="#1a1a1a",t.fillRect(N,O,X,j);const H=S.quantity/B,q=X*H;let U="#4caf50";H>.9&&(U="#ff9800"),H>=1&&(U="#f44336"),t.fillStyle=U,t.fillRect(N,O,q,j),t.strokeStyle="#666",t.lineWidth=1,t.strokeRect(N,O,X,j),k+=w}}const C=l+s-50;t.fillStyle="#2d3e50",t.fillRect(r,C,a,50),t.fillStyle="#aaaaaa",t.font="14px Arial, sans-serif",t.textAlign="center",t.fillText("Click outside or press X to close",r+a/2,C+30),t.restore()}function Ft(t,e,i,n){if(!We||!ke)return!1;const o=Math.min(500,i*.85),a=Math.min(600,n*.75),s=(i-o)/2,r=(n-a)/2,l=16,c=60,h=40,f=s+o-h-l,d=r+(c-h)/2;return(t>=f&&t<=f+h&&e>=d&&e<=d+h||!(t>=s&&t<=s+o&&e>=r&&e<=r+a))&&Et(),!0}gt.register("*",({game:t,building:e})=>{if(!e.inventory||!e.done)return null;const i=[],n=e.inventory.items.reduce((s,r)=>s+r.quantity,0),o=e.inventory.items.length,a=e.inventory.capacity;return i.push({id:"view_inventory",label:`View Inventory (${n} items, ${o}/${a} slots)`,icon:"📦",enabled:!0,action:({target:s})=>{Qn(s)}}),i});function Ge(t,e,i,n){const o=e.w??e.size.w*A,a=e.h??e.size.h*A,s={x:i,y:n,w:o,h:a};if(s.x<0||s.y<0||s.x+s.w>Q.w||s.y+s.h>Q.h)return!1;for(const l of t.buildings)if(!(s.x+s.w<=l.x||s.x>=l.x+l.w||s.y+s.h<=l.y||s.y>=l.y+l.h))return!1;const r=(l,c)=>{const h=Math.max(c.x,Math.min(l.x,c.x+c.w)),f=Math.max(c.y,Math.min(l.y,c.y+c.h)),d=l.x-h,u=l.y-f;return d*d+u*u<=l.r*l.r};for(const l of t.trees)if(r(l,s))return!1;for(const l of t.rocks)if(r(l,s))return!1;return!0}function pt(t,e,i,n,o){const a=V[e];if(!a)return;if(a.isFloor&&a.floorType){const r=Math.floor(i/A),l=Math.floor(n/A);if(r<0||l<0||r>=t.grid.cols||l>=t.grid.rows){t.toast("Can't place here");return}const c=l*t.grid.cols+r;if(Ne(t.terrainGrid.floors[c])!==$.NONE){t.toast("Floor already exists here");return}const f=r*A,d=l*A;if(t.buildings.some(g=>!(f+A<=g.x||f>=g.x+g.w||d+A<=g.y||d>=g.y+g.h))){t.toast("Can't place floor under building");return}if(!xe(t.RES,a.cost)){t.toast("Not enough resources");return}qe(t.RES,a.cost);const m=Ie(e,f+1,d+1);m.isFloorConstruction=!0,m.floorType=a.floorType,t.buildings.push(m),t.rebuildNavGrid(),t.toast(`Placed ${a.name} blueprint`);return}const s=Ie(e,i,n);if(o&&(s.rot=o,o===90||o===270)){const r=s.w;s.w=s.h,s.h=r}if(!Ge(t,s,s.x,s.y)){t.toast("Can't place here");return}if(!xe(t.RES,a.cost)){t.toast("Not enough resources");return}if(qe(t.RES,a.cost),s.kind!=="path")for(let r=t.buildings.length-1;r>=0;r--){const l=t.buildings[r];l.kind==="path"&&!(s.x+s.w<=l.x||s.x>=l.x+l.w||s.y+s.h<=l.y||s.y>=l.y+l.h)&&t.buildings.splice(r,1)}t.buildings.push(s),t.rebuildNavGrid()}function Xn(t){if(t.paused)return;const e=t.selectedBuild;if(!(!e||!V[e])){if(!t.debug.forceDesktopMode&&t.isActuallyTouchDevice&&t.lastInputWasTouch){const n=Math.floor(t.mouse.wx/A)*A,o=Math.floor(t.mouse.wy/A)*A;t.pendingPlacement={key:e,x:n,y:o,rot:0};return}pt(t,e,t.mouse.wx,t.mouse.wy)}}function Jn(t,e,i){if(!t.pendingPlacement)return;const n=V[t.pendingPlacement.key],o=t.pendingPlacement.x+e*A,a=t.pendingPlacement.y+i*A,s=t.pendingPlacement.rot||0,r=s===90||s===270,l=(r?n.size.h:n.size.w)*A,c=(r?n.size.w:n.size.h)*A;t.pendingPlacement.x=ie(o,0,Q.w-l),t.pendingPlacement.y=ie(a,0,Q.h-c)}function Vn(t,e){if(!t.pendingPlacement)return;const i=V[t.pendingPlacement.key],n=((t.pendingPlacement.rot||0)+e+360)%360;t.pendingPlacement.rot=n;const o=n===90||n===270,a=(o?i.size.h:i.size.w)*A,s=(o?i.size.w:i.size.h)*A;t.pendingPlacement.x=ie(t.pendingPlacement.x,0,Q.w-a),t.pendingPlacement.y=ie(t.pendingPlacement.y,0,Q.h-s)}function Zn(t){if(!t.pendingPlacement)return;const{key:e,x:i,y:n,rot:o}=t.pendingPlacement,a=V[e],s=Ie(e,i+1,n+1);if(o&&(s.rot=o,o===90||o===270)){const l=s.w;s.w=s.h,s.h=l}if(!(Ge(t,s,s.x,s.y)&&xe(t.RES,a.cost))){t.toast("Can't place here");return}t.pendingPlacement=null,pt(t,e,i+1,n+1,o)}function Kn(t){t.pendingPlacement=null}function _n(t,e=!1){const i=Math.floor(t.mouse.wx/A),n=Math.floor(t.mouse.wy/A);if(!e&&t.lastPaintCell&&t.lastPaintCell.gx===i&&t.lastPaintCell.gy===n)return;const o=t.selectedBuild?V[t.selectedBuild]:null;$.BASIC_PATH;let a=t.selectedBuild||"floor_path";o!=null&&o.isFloor&&o.floorType&&({BASIC_PATH:$.BASIC_PATH,STONE_ROAD:$.STONE_ROAD,WOODEN_FLOOR:$.WOODEN_FLOOR,CONCRETE:$.CONCRETE,METAL_FLOOR:$.METAL_FLOOR,CARPET:$.CARPET}[o.floorType]||$.BASIC_PATH);const s=(p,b)=>{if(p<0||b<0||p>=t.grid.cols||b>=t.grid.rows)return;const v=b*t.grid.cols+p;if(Ne(t.terrainGrid.floors[v])!==$.NONE)return;const w=p*A,C=b*A;if(t.buildings.some(I=>!(w+A<=I.x||w>=I.x+I.w||C+A<=I.y||C>=I.y+I.h)))return;const S=(o==null?void 0:o.cost)||{wood:0};if(!xe(t.RES,S))return;qe(t.RES,S);const P=Ie(a,w+1,C+1);P.isFloorConstruction=!0,P.floorType=(o==null?void 0:o.floorType)||"BASIC_PATH",t.buildings.push(P)};if(t.lastPaintCell==null){s(i,n),t.lastPaintCell={gx:i,gy:n},t.rebuildNavGrid();return}let r=t.lastPaintCell.gx,l=t.lastPaintCell.gy,c=i,h=n;const f=Math.abs(c-r),d=Math.abs(h-l),u=r<c?1:-1,m=l<h?1:-1;let g=f-d;for(;s(r,l),!(r===c&&l===h);){const p=2*g;p>-d&&(g-=d,r+=u),p<f&&(g+=f,l+=m)}t.lastPaintCell={gx:i,gy:n},t.rebuildNavGrid()}function $n(t,e=!1){const i=Math.floor(t.mouse.wx/A),n=Math.floor(t.mouse.wy/A);if(!e&&t.lastPaintCell&&t.lastPaintCell.gx===i&&t.lastPaintCell.gy===n)return;const o=(m,g)=>{const p=m*A+1,b=g*A+1,v=Ie("wall",p,b);t.buildings.some(w=>w.kind==="wall"&&w.x===v.x&&w.y===v.y)||xe(t.RES,V.wall.cost)&&Ge(t,v,v.x,v.y)&&(qe(t.RES,V.wall.cost),t.buildings.push(v))};if(t.lastPaintCell==null){o(i,n),t.lastPaintCell={gx:i,gy:n},t.rebuildNavGrid();return}let a=t.lastPaintCell.gx,s=t.lastPaintCell.gy,r=i,l=n;const c=Math.abs(r-a),h=Math.abs(l-s),f=a<r?1:-1,d=s<l?1:-1;let u=c-h;for(;o(a,s),!(a===r&&s===l);){const m=2*u;m>-h&&(u-=h,a+=f),m<c&&(u+=c,s+=d)}t.lastPaintCell={gx:i,gy:n},t.rebuildNavGrid()}function eo(t,e){const i=t.buildings.length;for(let o=t.buildings.length-1;o>=0;o--){const a=t.buildings[o];if(a.kind==="hq")continue;!(e.x+e.w<=a.x||e.x>=a.x+a.w||e.y+e.h<=a.y||e.y>=a.y+a.h)&&(yt(t,a),t.buildings.splice(o,1),t.buildReservations.delete(a),t.insideCounts.delete(a))}const n=i-t.buildings.length;n>0&&(t.msg(`Removed ${n} structure(s)`),t.rebuildNavGrid())}function to(t){const e={x:t.mouse.wx,y:t.mouse.wy};for(let i=t.buildings.length-1;i>=0;i--){const n=t.buildings[i];if(n.kind!=="hq"&&e.x>=n.x&&e.x<=n.x+n.w&&e.y>=n.y&&e.y<=n.y+n.h){yt(t,n),t.buildings.splice(i,1),t.msg("Building removed"),t.rebuildNavGrid();return}}t.selectedBuild=null,t.toast("Build canceled")}function yt(t,e){const i=e.x+e.w/2,n=e.y+e.h/2;for(const o of t.colonists){if(o.inside===e){t.leaveBuilding(o),o.safeTarget=null,o.safeTimer=0;const a=Math.random()*Math.PI*2,s=(e.w/2+10)*Math.cos(a),r=(e.h/2+10)*Math.sin(a);o.x=ie(i+s,0,Q.w),o.y=ie(n+r,0,Q.h)}o.reservedSleepFor===e&&(t.releaseSleepReservation(o),o.sleepTarget=void 0,o.sleepTargetLockUntil=0)}}const io="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAYAAAB5fY51AAALLUlEQVR4nOzdMY8cZ/0HcF/0lxW5+BOBohhFwkcFPTQRRU7Q5EXE4ERpkXgDIZf4DSDRRsklfhNpkNYFSgOCMlS5K1ASRUYRhRW5sCmC9x7O+9zN7M7OPN+Zz6danfd2n7vb/er39TM789w1gBACC4ghsIAYAguIIbCAGAILiCGwgBgCC4ghsIAYAguIIbCAGAILiCGwgBgCC4ghsIAYAguIIbCAGAILiCGwgBgCC4ghsIAYAguIIbCAGAILiPF/Uy+APD/5/v+vb//jX/9+0vN7D4rvHXhlzJ0JC4ghsIAYB1MvgBgbq9/7r73S60He+uTT2j95LXIlExYQQ2ABMYzh/I9bN66vb589fDRIDayp1cOXnjt/XX71eJCnYiZMWEAMgQXEUAkXpEvdK7390x+ub5+efrG+fe/b8/vsskv4y+LrLz9/bePj16iNy2TCAmIILCCGzxLORJe6d/bw0fp2Wfdac/v5q+9z79vNB7KW1Mb5MWEBMQQWEEMlDDCnujcUtXGZTFhADIEFxFAJJ6bu7Y/aOD8mLCCGwAJiqIQjqVU/dW9au9RGVXF8JiwghsACYqiEA7DT145/Vk5N83KH6ldTq412GMdnwgJiCCwghkp4hanq3p8/Oz/D5y9UyK2UNXDMqlhSG4dlwgJiCCwgxqIrYcu7e2UNLOth7T5cbpfqtwu1cVgmLCCGwAJizLYStlz3+upSD/nOVNVvF2pjdyYsIIbAAmJEVsI51T3oQm38jgkLiCGwgBjNVUJ173IOFqVmCbXRhAXEEFhAjFYqoYsysCjl6W7GPNh1x9p4MPR6+jJhATEEFhCjlUq4pgYyV7WznramrI33GluzCQuIIbCAGM1VQliCxNPgtMCEBcQQWEAMlRAmMNWBo+lMWEAMgQXEmFUldHl3Wqb67c6EBcQQWEAMgQXEEFhADIEFxIjfJbQzeDm/H+bEhAXEEFhAjPhKqOZcrvz9LLke1s726WDOLCYsIIbAAmLEV0K6W1oN7MJpXrKYsIAYAguIoRJeodxZK6lXuVS/XCYsIIbAAmJMVglv3bi+vn328NFUy7hS7cBLVbF9KZeGT/FSMd589XiaNZiwgBgCC4gxWSU8e/joydPbb4fUKHUvl53B7dwufm/3vr32pPingynWY8ICYggsIIYDR5ktNXB+TFhADIEFxFAJYebmdAodExYQQ2ABMQQWEENgATEEFhDDLiHMXLkz2OWUOy3vJJqwgBgCC4ihEsJCtVz9akxYQAyBBcSIqYQu+gDbmdPFOExYQAyBBcSIqYS16wNCX7WKlLhrVprrz1UyYQExBBYQo7lK2Hc3sLy/HUNq5nTWzZq5/lwlExYQQ2ABMZqrhLXdwFr1s2O4naVV6SXUpSUwYQExBBYQo7lKWOpSVZZQZ4aiPpPOhAXEEFhAjKYrIbtzWh7mxIQFxBBYQAyVcOaGqn73is/ivf/aK1s/Tvm9b33y6fr27e2XxoKYsIAYAguIsehKuOQdtLuNHUR6r+eFEm77bOAimbCAGAILiLHoSliaUw3sUvfe7vDzlo9T2xksd/p+/ermx/n4/rWNj1PbMey7tpo51cYlnDG1CxMWEENgATEWVwnTT7EyVN3rq6xsLTzOkmvjkuuhCQuIIbCAGIurhC1f33DMutfluY6Ojq68z2q16vW8XR7zbofH7PJ7mFNtLKtfWQmXcHn6kgkLiCGwgBijVsJbN66vb589fDTmU19pHzWw7+f1Wqt7U0msjaV9V8ha3avVw314qRh1vno83vOasIAYAguIcTDy8z15emMfBzeOaaoDOFs7LUy6qf5GLew87uLC6YBGyxETFhBDYAExFnfgaBct173aKVz6Ojr62dbfu1r9dTZruHt/+L/1nA5YbY0JC4ghsIAYi9slbO3zeqWh6t7h4Q963X+1erC+fXR09feenj7Yal0X9V1nX0Otszxjahdjvn6mqo12CQGuILCAGLOqhK3VvaEqXmmXGlVWv1JZA/ddD/ddA/saqjaWulTI9NqoEgJcQWABMWIqYWt1786dO4M8V+nk5GR9+/e/2Vyd3vvowV7X0Jc1776GmpZro0oIcAWBBcRo4rOES6h7fR0eHlb+ZfhdraFYc3ddXmN3B6qNc/psowkLiCGwgBiT7RKWdql7fT+vN1Tdq1eJ7Z2enq5v13aRyvXvYw19WfPua9hFl93G0p7ea3YJAS4SWECMWR04Wl7PbpcxvrXaUmphbTXWPKxdamP5vauBruFYuvB+VAkBLhJYQIyYA0dv3bi+HjsvXOZ+485jzVCj/vHxca+v97XvSjLUOqeS/nvusv4ua9uiNq7fR7duXF9/8e5nX1z5PmrhWqImLCCGwAJiNHHg6CV1r9dj1nYJdxn7a6P7r/7wl41f/9Pvft7rccZUrqF2WpUU5elfhvrddtkxrN2ndgDnmK+Tcm2X7BL2es+XtfHs4aNabbRLCHCRwAJijL1LuHF03KIG7lU5ltdG+pr3/nY+Nd+/f3459eOiAoxZD8vn+uCd7S8N35oP3jmvaW8WP+Muv9ta9Stvl/eZ0+uk5sJ7c+z/QnqGCQuIIbCAGE0cOJru1VfPq1Y53rfmzXfbXVtr9nFAacrrpGUmLCCGwAJiqIQz1+WzbOUl9cvLrO/jUvtd1NZQfr2FHTTGZ8ICYggsIIZKuCU7PpcrP3LXwMk7J+N1MiwTFhBDYAExVEKuHR2d15aPB6otZQ2snRSzS1Xcx9rIZcICYggsIIZK2IMdn+0sbZfQ62R/TFhADIEFxIivhC+88ML6LIir1WrjBSlKLVyCfBe1s1/2vU8Xh4cTXaji/oNpnjdQlwtPlO+Rb775ZszlDc6EBcQQWECM+Eq47xG35R2fLtfRa9lzP/7t+vbjz/846Vp21fLrJL0GlkxYQAyBBcSIr4RDKc9g+eGHH57/w9/PL0H++ve2f/zXi8d84403Nj5vF112BtmflNfJXJmwgBgCC4ihEm5wdnY29RJ6a21ncLU6P/jz6GjzAahljf3RKKsaVuLrJJ0JC4ghsIAYKuF/lbsw+96RmdOOT1n9SrUaWHr8+fnO2rWpPrfYk9fJtExYQAyBBcRQCTe4c+fO1Eto2i41sDTZ6WsG4nUyPhMWEENgATFUwg1aOwizNX2r31x5nYzPhAXEEFhADIEFxBBYQAyBBcSwSziSxAtGvPeR6wPSFhMWEENgATFUwj3qe1n5UgtVsXa5/30rL7M+pr5/iy5/X4ZlwgJiCCwgxqwq4Ysvvnjw9PZqtXry9PaYpwHZpSZMVSvefHfzpdVbqDm1te1D+fOWf8eUaz6WVbp8L3z99ddTLWlwJiwghsACYhxMvYB9uTDeP9l0n6Wd5L96mfVAY17GvbXdwNrPe3h4uH4/p9TYvkxYQAyBBcSY1S5h6cJIvB6Vy5H++Ph4Y1VcwsUF5nSZ9THrz5jPdXJysvHrteo31xpYMmEBMQQWEGO2lbCmVhVv3ry5/uLJycnGqkibatUp3c2bN9evzy+//HL99SVUvxoTFhBDYAExZnvgKM/qcjBtiiUcJMmzTFhADIEFADA0ExYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhBDYAExBBYQQ2ABMQQWEENgATEEFhDjPwEAAP//jw+GDh5CCrwAAAAASUVORK5CYII=",no="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAwCAYAAABwrHhvAAAAAXNSR0IArs4c6QAAAX5JREFUWIXtlT1ug0AQhcdpkj51hBuLLnfwFbjD0CIfgIoDuKOI78AVcpUg105ad6TJQ+Nhf1hix1I0n4QE7O57s38zRIZhGIZhGIYRoWrz4Zb6D/pH0WSjYdXmw/F0niUkx/0aiElRbbDdrSff6IO2xUEVTQYxDhm4xsm2OWMmW0BE1NV9KT6ZiPh9/7FSQqyGMRHR6+bROQbvKbB4sJz8E8CFOdqqNh/ku+qvAw6bV20+4AaoLZkIoR2m+IdvMX5CaFm4aLK3l+cnOp7O2JaDrzMMxPYd5C3q6t7p5TwDEOjqvhTX0GuujMcJCPOSErdgRN+GCHKLOLRtf8VdzW9DKDuClPoROoTRIL4+V5NAUurHLBOIilmxTrmyf0r9iAaAZOKqC+TIhkvqRwjWonIVfP3JkcK3u/XgCjqKFhSrIdsvgtDm5KkfcxnFMPtAfk+qH1H0IYQYhD0Zkn3nZhG6tOKJiAerXwr6EErD4MyuMnsZxLXEFgdxT3Pj//MNvPQlpMCKHrIAAAAASUVORK5CYII=",oo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAwCAYAAABwrHhvAAAAAXNSR0IArs4c6QAAA/VJREFUWIXtVjFrG0kU/jYEZLa5tQWb5JCRmxCSQpw6FUfATcpA5OJKFWY3xk3wD5AL6wcIN0FZ4cJlCqlImUZNCnc24rjD5OAkEL6cCnmdQhDwsVdE3+TN7KwiX1Ideo3Q7Lz3vve9N98MsLSlLW1p/ydrdSrJTX1ufU8A43h6Y5+FALQ6lWSR6nzPxcFR6UYsLARgZ+vEAWANLoGN4yl8z7XGyCpg4RZkBR/HU7Q6laTaKCb7230r0FankmS1JwUgC2lWcN9zMY6n6NaHTrVRTEyg3E//rwKYB8LGAttDn/3tviOrJcAsSwEw+11tFBUY33PV93KtkDCxyULv149aTFv1BHzLXLDRSBCv330Ak58ejxz21mRBGn3M5GRFAeAwAcDZxRXIQrc+VBX/8vNdtYdBzOq69aGzuvYZx+behgJERk0/BYALP/34A4DPrZAsPHu8BgB49WaE0+ORYyY3e0/Wes2BU64VEsYy2dVmgB+fPLqHaqOYkL4///hHG6ZWp5KQJWlcu5x8IYXtoq+coxQAViErYQAA4HBx4ACdZlqvOdDacnBUUgyYM5E6BWcXV/A9V7VCDhv/s9LNvY2k1xw4L14+0EAQVDy5xunxyLEdRZ6i1Cno1ocOW1G6nwOAYMZOGE+uv3rjMTkZovmeq5LyVwMgJZUV5nM5AMDb3/4CADx/WlCVsHr6SxbICltH89Zuq/bwmwJAmtbzKwqQ77l48fJBBAAHR6WITIiYAQAc7p5bZRZAwPa9ejOCWb0GgJP58M4qmGiepPaaAwWk1akkD++sYj2/AmrAjJXIJt+SGW0IZZJqoxhZJDUEgG59qCU3wQMIDnfPw3wuB99z8frdB5wejzTmUlIsWXjy6J5aO9w9D4FMSY0IeGfrJBzHU82XlceTa1l9KP0y3wNSUqWwcBYYRKhh23bcxvFUVd9rDkIxS/oQ0iySGtG5XCtEs6raGVdzOHuWRVwzFdMEaWUgQ1KjeZI6034JrA1o89K2sDb/SbaopLY6lYRvARl8BrZNMED6baAB+BZJNd8TwJe7g99tL6NMBrIkdX+775iSurN14vAErOdXYB5fmu0GTQGYJ6mswCapkp3S/Zz2lCvXCknWDaoBmCepAIKziyvrhUIWfM9VMQRzgazevEOsLbBJKqCfClk9Wfv970tUG8Wk//6TWivXCpG3dlsWolkKgMFCQCWkHpiSKkAm9JX3hLTNvY3I/GZjILBVC6Ql1QJaAeq//8TTE/aag9CIp/bZALRZtbTLiaNJKvcKECFbtbm3YWPLykzmMZSbbYBkclh6ayYz/rexgAUicGD8z9w/O37m3kz/rGP3X00mWKjKpS3tX9TH+YSAxDb2AAAAAElFTkSuQmCC",so="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAwCAYAAABwrHhvAAAAAXNSR0IArs4c6QAAA+pJREFUWIXtVrFqG0sUPasujbE3gd3OpFAcgjAYF8GBly6FCz+cIriUEbugL1iBPsCg/QLBChOXIUUMLlykS2GRIizoiYDiwiiVBI4wacxrvK+wzvjO7Kwiv5fqodsIzc6999xz75wZYGELW9jC/k+WdqvZfX1KvxPAaDy5t89cANJuNZunOt9zcXq8cy8W5gKwsXXkALAGl8BG4wl8z7XGKCpg7hYUBR+NJ0i71azdqmTbuydWoGm3mhW1JwegCGlRcN9zMRpPUG/0nXarkplAuZ/+vwQwC4SNBbaHPtu7J46slgCLLAfA7He7VVFgfM9V35u1csbEJgt/nQ21mLbqCbhkLthoJIiPH1Iw+cHhucPemixIo4+ZnKwoABwmABgOLkAW6o2+qvjV6w21h0HM6uqNvrP08AYAEEfrChAZNf0UAC6srj0GcNsKycIffz4FALxPznBweO6Yyc3ek7Uo7jnNWjljLJNdbQb48fnLTbRblYz0fR/8rQ1T2q1mZEka137+uAvLdtFXzlEOAKuQlTAAAHC4OHCATjMtintaW06PdxQD5kzkTsFwcAHfc1Ur5LDxPyuNo/UsinvOu7cVDQRBXV1e4+Dw3LEdRZ6i3CmoN/oOW7H67AYAgik74dXl9S9vPCYnQzTfc1VS/moApKSywqXlWxY+f/oCAHgTvlCVsHr6SxbICltHW370QLWH3xQA0rTi3QHyPRfv3lYSADg93knIhIgZAMDeft8qswACtu99cgazeg0AJ/PJ2iaYaJakRnFPAUm71ezJ2iZWPIAaMGUlscm3ZEYbQpmk3aokFkkNAaDe6GvJTfAAgr39fri0/Bi+5+LjhxQHh+caczkpliw8f6kCYW//NlmBpCYEvLF1FI7GE82XlV9dXsvqQ+lX+B6QkiqFhbPAIEINO7bjNhpPVPVR3AvFLOlDSLNIakLnZq2cTKvqFFzN4fRZlnDNVEwTpJWBAklNZknqVPslsA6gzUvHwtrsJ9m8kpp2qxnfAjL4FGyHYID820AD8F8k1XxPAHd3B7/bXkaFDBRJ6vbuiWNK6sbWkcMTsOLpiaXZbtAcgFmSygpskirZWX12oz3lmrVyVnSDagBmSSqAYDi4sF4oZMH3XBVDMBfI6s07xNoCm6QC+qmQ1ZO1b4MvaLcq2fBrSa01a+Vk+dEDWYhmOQAGCwGVkHpgSqoAmdFX3hPS4mg9Mb/ZGAhs1QJ5SbWAVoCGX0s8PWEU90IjntpnA9Bh1dJ+/ihpksq9AkTIVsXRuo0tKzOFx1ButgGSyWHprZnM+N/BHBaIwIHxv3D/9PiZewv9i47dvzWZYK4qF7awfwAJR/sa22/msgAAAABJRU5ErkJggg==",ro=""+new URL("Male_Average_Normal_east-Dp-W028J.png",import.meta.url).href,ao=""+new URL("Male_Average_Normal_north-jjTiChVU.png",import.meta.url).href,lo=""+new URL("Male_Average_Normal_south-ChBeJhbM.png",import.meta.url).href,co="data:image/png;base64,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",ho=""+new URL("Naked_Male_north-B44-odFG.png",import.meta.url).href,fo=""+new URL("Naked_Male_south-BtPFzGMg.png",import.meta.url).href,uo="data:image/png;base64,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",Ao="data:image/png;base64,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",go="data:image/png;base64,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",po="data:image/png;base64,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",yo="data:image/png;base64,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",mo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAEbAAABGwGN907lAAAGe0lEQVR4nO3cv08bSRQH8AemJJEblEPKgVGugkiYgosUFzg1SOdUKQP/AShSrjUtEgIKUqQxpCemPCrjCBp0CUbKD3QJwleBFCl24SJe/9jTm511ZjdrEwz2zua+H2m0MbbXk3lvZvY3AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgMZ6EJyGMBFFm7yXlwV+IhEimieiNBEViMi8oBTkZ+fldyGg4kSU+YGAX1TScl0QENcVeHdJB3lE+Fm2AZrN3zm5TBFRwuuLiUSCpqamKBqNUjzu3aF3d3cpl8tRNpul7e1tr48UiWiBiDau8H+AS4rLwJ626J0Fr/k9EomYKysrZqFQMC/r9PTUTCaTZjgc9vq9FILYeW0P5Rw0Dt514OSZnZ1FEnTZSrtzdSKRaKvHXySdTnuNBkiCDkh59ej5+Xkzk8k4gptKpRyf4deddHh46JUEntsc0J4Vd+CbDeU8R9vB4CUHpxs8kqAgN07hiuLu4LcKKg/1/LloNNqRIb8Vng4wFVy/0x8NPk8FfgXfZiegUnDU8Apm1cbkXbdW4vG42MXzK/imnIIwClyfQ7shh4eHzXq93rTh7Tm4W3N+K67dQ2wLtCmi9qTnz5+3TABudJ6DdeAxCszq2si9GtShGcdu1PT09MVfSOix5xWJRGh8fFz90x/+1Sa40nYPisViZqlUMmu1mmf/5mGfe51OlpeX3aOAltOAziNAY+v5fuw+maYpihc+kcO9TiczMzPu2jS72MRXOidAo8HGRseoXq83TQDdcD1v/3qbhoaG1Jppee2Argng6M43btwQCcAlCDgBuK53795VazuuY9UDkQCTv09SrV4TJQijgEjWWp3GxsbUP2MboF3cmFxqtWAkANeTi2vE0vKIYCASoFqrilKrWg2rMw56tVoV9bx3755aUyRAu0SPqtZEw3LReRTguoqElUmgu2CMANUqVaoVa1mxljrixBT1rFgJUCwWtaynKhgJIBuUG9cuddOaX/mCzdXV1a7WhwO7sLAgflsl6lb5Vsd3796pb+earM5XgUiAQqFgNaxdDKuXsbW1NRGMBw8eUD7f2Zt3OPAbGxs0MTEhkm5xcbHxHu+hcL3ECMUJW6mKv6lf72jl2qRrAjh6y/sP7x3B56VhGGJUsHshL0dGRujhw4ciSNc1/PJ6+FLwubk5sX5e2olmXy4uhn6jQkbFaCy5HH84Vlel5a1lfRrUwUtRFrHvfHx8TJOTk9QX6qNQKCRKb28vvX379rtAc7DsgNnX+ofDYXHtP8nDxvzajQPJ6+JydHQkgsx/49IK/9bo6KhISFFkEnCScr0V//rZoM3omgBs1z4j+Ob1G3r06JEV+FAvhXqtBPj8+XPLFfxIANvUSM5MJkNPnjyhcrn8LQkMg758+UJnZ2eO6nSiIlel8zZA1v4HB9Ee9rmUjbJocL5TR5GTd+d0qqF5vby1OSF/R3j16pWoC9fJKBtWMQw6ODhwf3/3uzVqQPcRQCiVSqKheTjv6emxCvWI/W1FUQZoVR50icvj71H5+jIHYnJyfVn575xrDnfMIZ9OPtHAwEAjEbi8/vu1+pG8rhuBOieA3egicDt/7VAsFnMkAB8caiLf4j69ZmflLvMMAEdvPjk5oZs3b1oJIKeCvb099SOeNxTqQOcEYGvyngDa39+n8/NzGhwcbLzZ5gGhax+KeaOv/LVMX8tfRQJ8/OejqKsie9E6/KL7cQBHL36x+cLa5apUREPrckSQe7wdfD4XsLW1pb5d1HkE0D0BimoS7OzsiF00Owlc2wDd5NgG4F0/O/i8vcKjlULb4FNAjgQuqhtQ6+vrYikuEav7dlLIcXkXn/e3T/2+3HopkkCx6LkGTQQhAfJyW0A4+XQipgKfOUYA++wkz/uu4X9X94dL6b4RaEvKS6tFz9vc3KRbv9yiO7/dUT/TzWvuGiOAWoelpSV3718gzQXiZJA0p754tv5MjAY+GbZ/tr+/Xyy55x/ljtTabOh69C/IZl3X2vt1I2bjlrXHjx+bT/986vVoGtwO1iHJFs8D6hZTvWnFoy54fFyHeY0E3br/LnLBKKTtfYA/m4gcDZI+XHDZ7MlkCP7/RNT1+LlCUJ8JhIdFt099OGVO17N9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgGSL6D4RcNyCBIOeCAAAAAElFTkSuQmCC",bo=""+new URL("Bowlcut_east-BqNLAYRr.png",import.meta.url).href,wo=""+new URL("Bowlcut_north-CedmSNiQ.png",import.meta.url).href,vo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAAG0OVFdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFHGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTA5LTI4VDEzOjI5OjE4KzAxOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wOS0yOFQxMzozMTozOCswMTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOS0wOS0yOFQxMzozMTozOCswMTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDphNGY4M2QzMi1kMTA0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",Mo="data:image/png;base64,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",ko="data:image/png;base64,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",xo="data:image/png;base64,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",So=""+new URL("Bravo_east-CJd2Z9hg.png",import.meta.url).href,Co=""+new URL("Bravo_north-D1RfI44O.png",import.meta.url).href,Ro=""+new URL("Bravo_south-BjW4bVxW.png",import.meta.url).href,To="data:image/png;base64,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",Po="data:image/png;base64,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",Bo="data:image/png;base64,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",Io=""+new URL("Cleopatra_east-B3qqZTHk.png",import.meta.url).href,Eo=""+new URL("Cleopatra_north-DFb2lqEL.png",import.meta.url).href,Do=""+new URL("Cleopatra_south-DYRggimK.png",import.meta.url).href,Fo="data:image/png;base64,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",Lo="data:image/png;base64,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",No="data:image/png;base64,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",Wo=""+new URL("Cute_east-DYRGxF50.png",import.meta.url).href,Go=""+new URL("Cute_north-Dyfz5Iyy.png",import.meta.url).href,Oo=""+new URL("Cute_south-CSpoY84q.png",import.meta.url).href,zo=""+new URL("Decent_east-DDtNv2Dw.png",import.meta.url).href,Ho=""+new URL("Decent_north-DK7xoZDS.png",import.meta.url).href,Yo=""+new URL("Decent_south-DVJAzXst.png",import.meta.url).href,jo=""+new URL("Elder_east-CcqrTIrj.png",import.meta.url).href,Uo=""+new URL("Elder_north-IBsD-VXD.png",import.meta.url).href,Qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAAG0OVFdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFHGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDE5LTA5LTI4VDEzOjU4OjMxKzAxOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOS0wOS0zMFQyMDoyMDoxMyswMTowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOS0wOS0zMFQyMDoyMDoxMyswMTowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0YzM4NTlhZS03YjM0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",qo=""+new URL("Fancybun_east-_VNdpRKg.png",import.meta.url).href,Xo=""+new URL("Fancybun_north-jN5WcBOL.png",import.meta.url).href,Jo=""+new URL("Fancybun_south-DplcV99p.png",import.meta.url).href,Vo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAEbAAABGwGN907lAAAEWUlEQVR4nO3bv08bZxjA8cdxaRYj2MqELMHQIJA9sNWobJaY3H8gYWwVEJBK6WqUDmUiiAGJAcMW5EollRgJRsJKJZAwaga2ABNMZmBCwm/1vr077g6bGpSi8+vvJzm9vjtz3PE873M//FoAAAAAAAAAAAAAAAAAAAAAAAAAAABaVFpERp1d7xaRaRHZFpE/fMutE2uDbNXBHBeRlIgcisiqiFz41uvgFkQk6cwfO20ytJ1Zp72osw1ElO7VVRFRvunASQptPLSu2alaJ0EQMfWC7075ZoKfTCbvWl8g4NH22R+wzs5Of/Cq4eSYn58PBHh8fFxpdyTBdrv/gaMs7w/W2NiYWlpaatibV1ZWTLBzuZyZ162rUCiYZel0Wk1PT5MALcLr/f39/Wp3d1ft7e2p4eHhW8GfmJhQ19fXJty6CnR3d6tqteolgH6tE0K3+XyeBIi4bicwXqDe/PpGlctltb+/r4q/F28lwNHRkarVaibYBwcHXumvZ3R01LprgCcR2IcvaTt8z57JZMzNbiwWk2ffPpPJyUlv3cjIiCSTNxfz6XRapqammt2dk6gd/EPYlAB558rf09ffZ17q4JsnHjExAR4YGDDLdQK4yeHSSdBIpVLxr7HiOYAtCaBLv9d1e3p6TJtIJLw3xJx/+n+xWJSuri4ZGhoyS5t1cRGIeaXpH4wwWxIg53u4I69/ee0lgTjBdyuApoO/sbEhvb29Tf+CUqkUXnRc/52txZYE+N59oct+KpWS5y+e36yt08kHBwdNBWhWnfJPAkSIdyWX+S5j2mw2Kz3fOFXAvW4Xd1bde893dnb8s1aUf7HwLiBAnwrECbgJuu8m7r5JEDoF7DR+Z2uxLgEuLy9vL1RuowLJoJTyprusrq6GLwA3HuVgHoEtCeCV5HK5HFhhAiwqGOx7BF9bW1vzzx5zCogerySfnZ2Zyc8f7EZTI7Ozs+Hyv2DJ38ywJQECJfn8/Nx7XS/gNVW7tSxMl/yZmRnJ5/P+Nbr3v32sg3oMX1l0LBX3SeBh5dDcCrpMkGsq0NZqtcAUj8fNrZ6e9BW/fk4QOu9rPzz+Yf2/bEoAL1rhU4AJtqoF2tPTU9na2pKPf32UT39/kpOTOx/t623P2HTud9mUADvuB0H6QlDfDbiPgsM9fuHtgiwuLja73ZKtwdfiEdiHL0X30h/1tq6uruTp108llb45DegSH38Sl1c/v5L19fX/+pU62O9E5CcRmdNFJfqH/zC2jQoOfBy8vLzsfSLY0dEhc7/NyebmZvhnSk71KDlJZGVPbxdp/2CPvv4+9f7P92rrw5Z6OfEyPBhEjxpq/NkvWlZgPGA2mzVJkEgkwoNC235Yt80O/EmQSqfCvd/ab/rgX8k7vhPAYM42kWuQAPT+NpLzDRH/7HwbCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeSkT+AUPibJk5WdyzAAAAAElFTkSuQmCC",Zo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAEbAAABGwGN907lAAAE50lEQVR4nO3bPU8bSRjA8Qd8bZCTlsbXHSjSbYMo0rgkTeLLBwgOSm/zDeATEEoqA31EIkVKCW1eFLiCJkjYlwRxSARM7AtnjHdOM/aYycbGdg47rP3/SaNd74tnvc+zM+P1WgAAAAAAAAAAAAAAAAAAAAAAAAAAAACERCTkgYqJSEJE4iLyt4jke1hvUkR+E5GciPzbo3rhmBMRFSjJHpygZIN65whMb603CIIuxyIS7eKRRGt1NKo7cx1PVD9aaBIAW+Jd/MzxFnUvDG5YeiPmnvBoNKo2Nzd/WgLouvUxBOqPXacT1m8ywQBoPysBtAYJSFfQRfX+N5lMKitwFbYaCCZqTbUeRxzXynptWaLFvkm39bH0sQTGIegCr9HVr8Xj8Vb9cLQ2Um82gAsGcK7JYLI+/tB1Wg1aAY8EuHqJYPNrpdPpYADdflhftdk2Ah8s2UBr4rkJpOt0BfZt1ZLgB9S/93ue983JX19fb3YVNw28brYXFhZMCTThjRLhu9ZD1+nSx8R9ge6qJ4Db/DbphxsWvZ8dL+jAW3re9uuB7qRp8gQF9iMBuuDSBLgsCWKxmFpbWzPbJBIJs0xPreCyTCZj9mk3+A3GIaFJgF+uwTFcmUwmI9PT07K4uCj5fF6i0ajcv39fksmLrtzzPHn27JlZb9l5vU7T2+uyvLwsz58/r79XKpWSeLyb3zJ7r68SQNMBuixIbuBbrbOJ0M+G+/rTBegA66tanKvdndfrLkuQfjRQCeA2/bo5t+y8Xqe3GSShTIDq1+7Ozc/P1/dZWVlpOO9uMwhCmwDlcrmjRNja2jJTPZjTNjY26uvsvF1nt+3keH40KX+2UCfA2dmZVCqVtk6+7uez2Wz99e3bt6VUKpmi5y29jTs+aMX3/Y6T8ToJZQLok66Df1Y+M1MdgHYSwR3kPZp5JMViUYr/FGVmZsYscweJ7RyDTUI91a/RXd88inVwcKAOPx+qfD6vCoWC+vr1qyqVSqpcLqtKpaJ85X93s8be3JmcnFTZXFbl/spVSy5nltmbRs34vq/Oz89NPaenp6pYLKqTkxN1dHQUvGEUmu+OYboPkHNfHH4+lFs3b4kf8SUSiZgyPDxcn7plaGjI3BzK5apvoe8TLC0tyds3b83riYkJs+zVq1dmmydPnkg6na737broK9wW3drYqS7Hx9/9ApwLLriuhsJyoM7zeIYO4NTU1EXwI8MSGb6Ybm9vy5cvX0x58eKFrK6udlTZw4cP5d69ezIyMmKKHidU/Grg/Ypfna9Uk+Dly5fy+PFjd/ebPXxCeaBs2mZ2bGxM7ezsqN3dXdOMf/z0UT19+lTdvXu305992y537twxvyns7++rT3uf1IcPH1Q2m1Xj4+Pue2wOepC6Ke0GK/FHQr1+81q933mvUqnUjwR1rVY62m92dtYk3rt379SDBw+C69NhOqFh6gKsrPvAx40bN0wTvbe312q/jVqz/Gdt/uJGQFW8Vn6vdTeX/uozOjoqhULBdDEO3ff/+r8+HVry2ni0a+6KH8vymvwRJfgQCo+C9YjX5M8hm10OgtfkKaP1sAY/jF2Ay6s11dEmzXq32O4iX6uzs3vHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACDER+Q9xEDTIkulSxgAAAABJRU5ErkJggg==",Ko="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAEbAAABGwGN907lAAAFOElEQVR4nO3aT2sTaRzA8adbxYuSHHrx0saTnmzegDaCFqGX4NVL34CQgEfpZl9BoG8g116koXhy0SgIVnCJXZAuLvYPdu220k1TbbfVJr/lN2ZmnzzOWKlJ7Oj3Aw+dZJ6Z5+nzb57nyRgAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6LpxY0zVGCPGmGljTLqHRZ5upSmtPIxT3b1VaBW+HWrGmGQPcpFspeWmXzhKBfQ9Gw8pfD/0oid+6/Q76qeY5TdljCn6H5LJpEmlUu75XuTh40Eq5eXBUuxRHjombg2gaA/zxWLRbQBDPchDkIamrXmwJO0Gis7K2MNtLpcTVSgU7CG42oMy9yeeXtpK8+I8Cno5If1hlPwCTiaTUqvVvMKfnp52C7+bQ3DKTkvTVpoXzZN1rvSjV1Y31Nze7xe+0wByIWmnW0Nzxe7BIaHailOM6MU5+xq/EYaMArX4Fe/R1jb8V6tVsWWzWbvwF63/JNWq0KgKPyhUnBFl0Y+vado0T869Mj96pXVS0PN0qHWVSqWwUSBsr+CwoeD2fk3T5TwGwkaiI6cvJg1AK+BnPchkMqZSqXwS4cyZM2ZpaSnyBrpcy2az3sx9eHjYXb6Zzc1NMzc3592jXC57n6PoPRYXFz85e+nSJfPgwQP/4y9x2ByKyzIwcVCEUil63pXL5cyTJ0/M1atXzYkTJ7wGoA3JDvqdntM4GlevOUxa6I5i1LPX5i7HUqmU92y+d++ed50GPY7ixtNr9R5hy88wmUwmdlvDcRkB6v7B54Zm3ZQpFP4vdx3O8/m8efjwYfDd8+fPI6+3z+k1eq39WNF7Oxs/6JFgQnfx4kXZ39+P7IWqUqlIOp1u67kDAwMyOjoaOQr4vX9sbExOnz7ddq3eS+95kDiOAHERNIALFy7Izr878uHDB2k2m5+tEp2p20P48ePHveuvX78uk5OT8u7dOy/osX6n5zSO/QgJm+2HaTQbMjIyQgPokmAJlkgkpF6vy/b2tuzt7R04GvgNwV6i3blzR2ZnZ2VmZsYLeqzf2UvNYrH4RRWvjVDzsLu7G8tlYFy0bQS9efPG24V7+/at7OzsyPv376XRaHy2onRC51eQ9myN7wetQH+k0DjuRlMUvU4boeZha2srlhtBx45AHr5E28zv2bNn5vz586bZbJr+Y/0f//b3B6Gvr89b0+uavF6ve/F18qhrf/2rE7u7v979WE1aWyLBZE/j6ORP/6bTaZNIJLxloh77cTW9RqPRFjQNR/RsFYcS9K6pqSl5tfJKVldXZX19XTb+2fAeCyt/rcitW7dkaGioUzuAbfOBiYkJWVtb83q8jj6bm5uysbEha+trcvv2bfcadFiwD3/jxg15ufBSlpeXZWVlRVb/XpVyuSyDg4NuJdRa+/mH+T3Av67t9a/BoUFvvqAVr43v9eprrzHm8m17EJ9uE+KrBZWoy7X5P+blxZ8vZGFhQfL5vFt5pYhf877kp+KwOGn752gNN2/e9Cp+aXnJa4zXrl1zGw86LFgKnj17VuZ+n5PHs4/l8uXLbs/r5ssYGXskujJ6RZ7+9lTm5+fl3LlzLAG7rO1lzPuV+15DsL6b7uFbwcFopBX/6NEjdwTiNfEuSNuFfPLkSbvAv8X+bPD7xKlTp9wGwCthXRL2Pv637G1hr4jzNlAXuS95HIWhNmutGIq8CdR9462GEKv37wEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8F4wx/wE9mUF5CNZnBwAAAABJRU5ErkJggg==",_o="data:image/png;base64,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",$o=""+new URL("Flowy_north-CjN0OhUN.png",import.meta.url).href,es=""+new URL("Flowy_south-CP20N1Hd.png",import.meta.url).href,ts=""+new URL("Fringe_east-D4I7-ug9.png",import.meta.url).href,is=""+new URL("Fringe_north-BaR1__6m.png",import.meta.url).href,ns=""+new URL("Fringe_south-DYZWOYbC.png",import.meta.url).href,os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAH/0lEQVR4nO3dT2gTWRwH8O9M/nSJsS2mHqoNnb2kJ7Wai61CZ702pR4XESoqEaGHFg+Cl+YoYtkqeEkRuxdFe9guCHpQOvUiRWurUDABMXtR8NJZFdoqmj0k6b68vkxmJmmTl/4+MJiZzkxe/H3nzUxnMgUIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhNSYUusGbIE+ABqAkwBa8681G8tl8sMSADP/79/Vbx7ZCi0AxgCsAMhWeRhDLlSkDrUA+APVLzo/3NmuD7TdZN4FHAJgINfNW4pEIti9e3fJnyuKAkVR8OLFC9GPTeR2If+6amWd89a6AS6VLH57ezt0XYeu6wgGg+jq6rJckaqq8Pl8RUMqlcL169cxOzuLb9++jaBBiw/IGYBOCIofDAZx6tQpxGIx7Nu3z/bKVFWFx+MpGpqbm9HV1YXOzs6JZDL5Z3WbX19kDEACXPH7+vqQSCQsu3kRRVHg8XigqupGED59+oR79+4tra6ujkxOTs5Vsd11SbZjgE7kTtU2xGIxJBIJVyvzer3w+Xzw+/3w+Xz48eMHbty4Ya6trWnJZLJhu32WWusGODTCjrS3t+PSpUuuV1bY6gs9wJs3b7C2tja1U4oPyBeAk+xIPB533O0XsIUvBOHt27fIZrMzVWmpJGQKQCeY3+gFg0Houu56ZXzxVVWm/4rqkelTa+xINBp1vfUrirKp+1dVFXv27IGiKFq55RuJTAHoZkfKnd9bYYvO9gL79+8H7F03aBgyBaDo1C8ajbpekSgAqqriwIEDyGazeqUNlYlMAaiKQvfP7/9VVcXevXsRiUT0eDzeUut2bpcdFwB+q+cD0dPTA3Cnm41sRweAL76qqjh27Bii0ejIhQsXDtW6rdthxwWgcOVPVPzCqeDp06dbA4HA1E7YFcgUgKVKV1Dq4I8PQCAQwOjoaPeuXbuMc+fOdVbc8jomUwBMdmRhYcHxCsoVX1H+vzQSDocxOjra3dzcPNPIuwOZAlDUA6yvr5ulZiyF7f5FAy8cDuPKlSvdbW1tM+fPnx+soO11y1PrBjiwjtylYACA1+v9ZWBgwNEKClf/vF6vcBCFIBAI4OjRo61+v//3YDCoHzlyxDx8+PDa4uKi1QWjPgD/OGpcjch2P4ABQAeAdDptwsbtYAVsN1/qQLCUQCCAgYEB9PT06A8fPtSfP3+eAfArAMTj8b+y2Wzr5ORkoW16fjEpLrVL0UjGHQBnCiNPnz7NtLS0aHYW9Hg88Pv98Pv9aGpq2nhdGHw+n+1GjI+PI5VK6YqiaKFQaKq/v988fvw4G8YM8gGpdzIdAwC5HmDDs2fPNLsLslu8qBdwoqOjA8hdm0jEYjF8//6d74kyjlZYQ7IFIMOOpNNp2wuKii86+rcjfyEqEQqFtN7eXszPz/MHpJnNS9Un2QJQdI+e0wDwxbc6A7DS0dEBRVFaY7EYAODly5f8LBX/zmK7yBYAgNm67P4uoFTX7zYAbW1tCIVC6O3tBQA8efKEn4UCsIUy7MiHDx/KLuD0/N+OixcvAgAWFhZM0zTZYwATXE9Vz2QMgMGO2NkNFIpczQCEw2EAwIMHDyzbV+9kDEARuwGodg9QkEwm+UlS3VQqYwAMdsTJLoB9XY0APHr0KMN1/wAFYHt9/PjR1nyiolcagJGREf70bwqSfY9QxgAUHWDZOROwKrzbACwvLxvpdLqbmzzhamU1JGMAHCtV+Eq2/sHBQY2bZAB47XqFNSJrAIrOs1OpVMkZ+S29Glv/9PS08e7dO42bnHC1shqTNQBF+96vX79aziwqeAVbvxmPx/mu34BE5/4sWQNgm1Xx3YTg2rVroiP/M27bV2sNEQCrXQBQveIDyFy+fJkvfgKS3PwhImsAio4Byu0CCird99+8eRMo/uqYCQmP/FmyBsD2/YBWRXcYBHNsbIzf+icg2Xk/T9YAuOZ2608mkxBc9JF66wd2YADcunr1Kj9pBpJv/QAFwJb5+fnM+/fvRQd/0pM1ANp2vtnt27f54huQ+Mif1RABiEQithfMZrOO32x6epqfNOV4JXVK1gAUsfOoGFHh7YRhZmZGdPDXMA+PlDUAGjsSDAYdLeykFzAMg58k1fX+choiAFbPC2KLXeq1FUEANk2QmYwBKHp2v51nBVUSgtevN13hpR6gxjR2pFwACkXOZrPC11YEW/8SGuDcnyVjAE6Wn6UYv9WzQbCSyWT4SYbT9653MgbA9jeCAXEPwI5bhUAQAGm+8GGXjAEo8uXLl7LziLp/O7uB1dVVab/zZ5f0AbBzU6hV8a1CIPjKl5R3/ViRMQBFW2U6nbYdAlHxSwVgZWXFfPXqlaPdjYxkDMCm07Dx8XHA4h4Bvvh2dgPDw8MN3/0D8gYgw05Ip9MYGhoyP3/+LAyB0wDcunXLuHv3rsZNNqrT/PoiYwD+heAmzOXlZe3EiRO4f/9+BlxAREX/+fPnxsCEYOns2bNLw8PDuuB9p6r5IeqFbM8IYg0hd0eOaD9tRqPRpf7+/taDBw9C0zSzqakJPp8Pon8fP37cOjExYc7NzXWXWJ8B4Lct/CzEpU4As9javxr6Pv8+pI4NAVhE9Yu/iNwfqSSSOITc3xKupFdYyS8/tM1trwmZjwHKaUHuUW56flwvOWfOUn5oiJs9CSGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQsgO8h+8bug09B+LWAAAAABJRU5ErkJggg==",ss=""+new URL("ShirtBasic_Male_north-D0Q-ZKK7.png",import.meta.url).href,rs=""+new URL("ShirtBasic_Male_south-CIlSPWtc.png",import.meta.url).href,ve=class ve{constructor(){x(this,"images",new Map);x(this,"loaded",!1)}static getInstance(){return ve.instance||(ve.instance=new ve),ve.instance}async loadAssets(){const e=[{name:"house",path:io},{name:"wheat_stage_1",path:no},{name:"wheat_stage_2",path:oo},{name:"wheat_stage_3",path:so}],i=[{name:"head_male_average_normal_east",path:ro},{name:"head_male_average_normal_north",path:ao},{name:"head_male_average_normal_south",path:lo},{name:"body_naked_male_east",path:co},{name:"body_naked_male_north",path:ho},{name:"body_naked_male_south",path:fo},{name:"hair_afro_east",path:uo},{name:"hair_afro_north",path:Ao},{name:"hair_afro_south",path:go},{name:"hair_bob_east",path:po},{name:"hair_bob_north",path:yo},{name:"hair_bob_south",path:mo},{name:"hair_bowlcut_east",path:bo},{name:"hair_bowlcut_north",path:wo},{name:"hair_bowlcut_south",path:vo},{name:"hair_braidbun_east",path:Mo},{name:"hair_braidbun_north",path:ko},{name:"hair_braidbun_south",path:xo},{name:"hair_bravo_east",path:So},{name:"hair_bravo_north",path:Co},{name:"hair_bravo_south",path:Ro},{name:"hair_burgundy_east",path:To},{name:"hair_burgundy_north",path:Po},{name:"hair_burgundy_south",path:Bo},{name:"hair_cleopatra_east",path:Io},{name:"hair_cleopatra_north",path:Eo},{name:"hair_cleopatra_south",path:Do},{name:"hair_curly_east",path:Fo},{name:"hair_curly_north",path:Lo},{name:"hair_curly_south",path:No},{name:"hair_cute_east",path:Wo},{name:"hair_cute_north",path:Go},{name:"hair_cute_south",path:Oo},{name:"hair_decent_east",path:zo},{name:"hair_decent_north",path:Ho},{name:"hair_decent_south",path:Yo},{name:"hair_elder_east",path:jo},{name:"hair_elder_north",path:Uo},{name:"hair_elder_south",path:Qo},{name:"hair_fancybun_east",path:qo},{name:"hair_fancybun_north",path:Xo},{name:"hair_fancybun_south",path:Jo},{name:"hair_firestarter_east",path:Vo},{name:"hair_firestarter_north",path:Zo},{name:"hair_firestarter_south",path:Ko},{name:"hair_flowy_east",path:_o},{name:"hair_flowy_north",path:$o},{name:"hair_flowy_south",path:es},{name:"hair_fringe_east",path:ts},{name:"hair_fringe_north",path:is},{name:"hair_fringe_south",path:ns},{name:"apparel_shirt_basic_male_east",path:os},{name:"apparel_shirt_basic_male_north",path:ss},{name:"apparel_shirt_basic_male_south",path:rs}],o=[...e,...i].map(a=>this.loadImage(a.name,a.path));try{await Promise.all(o),this.loaded=!0}catch{console.warn("Some assets failed to load, continuing with fallbacks"),this.loaded=!0}}loadImage(e,i){return new Promise((n,o)=>{const a=new Image;a.onload=()=>{this.images.set(e,a),console.log(`Loaded image: ${e}`),n()},a.onerror=()=>{console.warn(`Failed to load image: ${e} from ${i}`),o(new Error(`Failed to load ${e}`))},a.src=i})}getImage(e){return this.images.get(e)||null}getColonistSprite(e,i,n){const o=`${e}_${i}_${n}`;return this.images.get(o)||null}getAvailableHairStyles(){return["afro","bob","bowlcut","braidbun","bravo","burgundy","cleopatra","curly","cute","decent","elder","fancybun","firestarter","flowy","fringe"]}getAvailableHeadTypes(){return["male_average_normal"]}getAvailableBodyTypes(){return["naked_male"]}getAvailableApparelTypes(){return["shirt_basic_male"]}isLoaded(){return this.loaded}};x(ve,"instance");let fe=ve;const Me=class Me{constructor(){x(this,"itemDefs",new Map);x(this,"loaded",!1)}static getInstance(){return Me.instance||(Me.instance=new Me),Me.instance}async loadItems(){if(!this.loaded)try{const e=[{defName:"Hoe",label:"hoe",description:"A simple farming tool for tilling soil and planting crops.",category:"Tool",equipSlot:"tool",maxDurability:100,stackable:!1,value:25,weight:2,workSpeedBonus:.2,workTypes:["Farming","Construction"]},{defName:"Axe",label:"axe",description:"A sturdy axe for chopping wood and basic construction work.",category:"Tool",equipSlot:"tool",maxDurability:120,stackable:!1,value:40,weight:3.5,workSpeedBonus:.3,workTypes:["Woodcutting","Construction"]},{defName:"Pickaxe",label:"pickaxe",description:"Heavy mining tool for extracting stone and ore.",category:"Tool",equipSlot:"tool",maxDurability:150,stackable:!1,value:60,weight:4,workSpeedBonus:.4,workTypes:["Mining","Construction"]},{defName:"Hammer",label:"hammer",description:"Essential construction tool for building and repairs.",category:"Tool",equipSlot:"tool",maxDurability:200,stackable:!1,value:35,weight:2.5,workSpeedBonus:.25,workTypes:["Construction","Crafting"]},{defName:"Pistol",label:"pistol",description:"A reliable sidearm for personal protection.",category:"Weapon",equipSlot:"weapon",maxDurability:80,stackable:!1,value:150,weight:1.2,damage:25,range:15,accuracy:.7,ammoType:"Bullets"},{defName:"Rifle",label:"assault rifle",description:"Military-grade automatic rifle with high damage output.",category:"Weapon",equipSlot:"weapon",maxDurability:100,stackable:!1,value:400,weight:3.8,damage:40,range:25,accuracy:.8,ammoType:"Bullets"},{defName:"Knife",label:"combat knife",description:"Sharp blade suitable for close combat and utility work.",category:"Weapon",equipSlot:"weapon",maxDurability:60,stackable:!1,value:30,weight:.5,damage:15,range:1,accuracy:.9},{defName:"FlakVest",label:"flak vest",description:"Basic body armor that provides protection against projectiles.",category:"Armor",equipSlot:"armor",maxDurability:150,stackable:!1,value:200,weight:5,armorRating:.3,movementPenalty:.05},{defName:"TacticalArmor",label:"tactical armor",description:"Advanced military armor offering superior protection.",category:"Armor",equipSlot:"armor",maxDurability:200,stackable:!1,value:500,weight:8,armorRating:.5,movementPenalty:.1},{defName:"WorkClothes",label:"work clothes",description:"Durable clothing designed for manual labor.",category:"Clothing",equipSlot:"armor",maxDurability:80,stackable:!1,value:50,weight:1.5,armorRating:.05,workSpeedBonus:.1},{defName:"SimpleHelmet",label:"simple helmet",description:"Basic head protection for dangerous work environments.",category:"Helmet",equipSlot:"helmet",maxDurability:100,stackable:!1,value:75,weight:1,armorRating:.2},{defName:"TacticalHelmet",label:"tactical helmet",description:"Military-grade helmet with enhanced protection.",category:"Helmet",equipSlot:"helmet",maxDurability:150,stackable:!1,value:180,weight:2,armorRating:.35},{defName:"MedicineKit",label:"medicine kit",description:"Basic medical supplies for treating injuries and illnesses.",category:"Medical",equipSlot:"none",maxDurability:50,stackable:!0,maxStack:10,value:40,weight:.5,healAmount:25},{defName:"Bandages",label:"bandages",description:"Clean cloth bandages for wound treatment.",category:"Medical",equipSlot:"none",stackable:!0,maxStack:25,value:5,weight:.1,healAmount:10},{defName:"Wood",label:"wood",description:"Raw lumber for construction and crafting.",category:"Resource",equipSlot:"none",stackable:!0,maxStack:75,value:2,weight:1},{defName:"Stone",label:"stone blocks",description:"Cut stone blocks for sturdy construction.",category:"Resource",equipSlot:"none",stackable:!0,maxStack:75,value:3,weight:2},{defName:"Steel",label:"steel",description:"Refined metal suitable for advanced construction and weapons.",category:"Resource",equipSlot:"none",stackable:!0,maxStack:75,value:5,weight:1.5},{defName:"Bread",label:"bread",description:"Fresh baked bread that provides sustenance.",category:"Food",equipSlot:"none",stackable:!0,maxStack:10,value:8,weight:.3,nutrition:12,spoilage:7},{defName:"MealRation",label:"meal ration",description:"Preserved military ration with long shelf life.",category:"Food",equipSlot:"none",stackable:!0,maxStack:20,value:15,weight:.4,nutrition:20,spoilage:60},{defName:"WheatSeeds",label:"wheat seeds",description:"Seeds for growing wheat crops.",category:"Seeds",equipSlot:"none",stackable:!0,maxStack:50,value:3,weight:.1,cropType:"Wheat",growthTime:15},{defName:"CornSeeds",label:"corn seeds",description:"Seeds for growing corn crops.",category:"Seeds",equipSlot:"none",stackable:!0,maxStack:50,value:4,weight:.1,cropType:"Corn",growthTime:20},{defName:"ComponentElectronic",label:"electronic component",description:"Advanced electronic component for complex devices.",category:"Component",equipSlot:"none",stackable:!0,maxStack:25,value:25,weight:.2},{defName:"ComponentMechanical",label:"mechanical component",description:"Precision mechanical parts for machinery.",category:"Component",equipSlot:"none",stackable:!0,maxStack:25,value:20,weight:.5},{defName:"Gold",label:"gold",description:"Precious metal valuable for trade.",category:"Valuable",equipSlot:"none",stackable:!0,maxStack:25,value:50,weight:.8},{defName:"Silver",label:"silver",description:"Valuable metal used in electronics and trade.",category:"Valuable",equipSlot:"none",stackable:!0,maxStack:25,value:20,weight:.6}];for(const i of e)this.itemDefs.set(i.defName,i);this.loaded=!0,console.log(`Loaded ${this.itemDefs.size} item definitions`)}catch(e){console.error("Failed to load item definitions:",e)}}getItemDef(e){return this.itemDefs.get(e)}getAllItemDefs(){return Array.from(this.itemDefs.values())}getItemDefsByCategory(e){return Array.from(this.itemDefs.values()).filter(i=>i.category===e)}createItem(e,i=1,n){const o=this.getItemDef(e);return o?{name:o.label,quantity:Math.min(i,o.maxStack||i),description:o.description,quality:n||"normal",durability:o.maxDurability,maxDurability:o.maxDurability,stackable:o.stackable,category:o.category,value:o.value,weight:o.weight,defName:e}:(console.warn(`Item definition not found: ${e}`),null)}getWorkSpeedBonus(e){const i=this.getItemDef(e.defName||"");return(i==null?void 0:i.workSpeedBonus)||0}getArmorRating(e){const i=this.getItemDef(e.defName||"");return(i==null?void 0:i.armorRating)||0}getDamage(e){const i=this.getItemDef(e.defName||"");return(i==null?void 0:i.damage)||0}getHealAmount(e){const i=this.getItemDef(e.defName||"");return(i==null?void 0:i.healAmount)||0}getNutrition(e){const i=this.getItemDef(e.defName||"");return(i==null?void 0:i.nutrition)||0}getRandomItemsByCategory(e,i=1){const n=this.getItemDefsByCategory(e),o=[];for(let a=0;a<i&&n.length>0;a++){const s=Math.floor(Math.random()*n.length);o.push(n[s].defName)}return o}getItemsForBackground(e){const i=[];switch(e.toLowerCase()){case"farmer":i.push("Hoe","WheatSeeds","WorkClothes");break;case"soldier":i.push("Rifle","TacticalArmor","TacticalHelmet","MedicineKit");break;case"doctor":i.push("MedicineKit","Bandages");break;case"engineer":i.push("Hammer","ComponentElectronic","ComponentMechanical");break;case"miner":i.push("Pickaxe","SimpleHelmet","WorkClothes");break;case"trader":i.push("Gold","Silver");break;default:i.push("Knife","Bread");break}return i}};x(Me,"instance");let st=Me;const te=st.getInstance(),Te=[{id:"farmer",name:"Farmer",description:"Spent years working the fields, knows the land well.",skillModifiers:{farming:3,construction:1,strength:2},startingItems:["seeds","hoe"],rarity:"common"},{id:"laborer",name:"Laborer",description:"Hard physical work has made them strong and resilient.",skillModifiers:{construction:3,strength:3,endurance:2},startingItems:["hammer","nails"],rarity:"common"},{id:"merchant",name:"Merchant",description:"Skilled in trade and negotiation, knows the value of goods.",skillModifiers:{social:3,intelligence:2,trade:3},startingItems:["coin_purse","ledger"],rarity:"common"},{id:"hunter",name:"Hunter",description:"Experienced in tracking and survival in the wilderness.",skillModifiers:{shooting:3,animals:2,survival:3},startingItems:["bow","arrows"],rarity:"common"},{id:"soldier",name:"Soldier",description:"Military training has prepared them for combat and discipline.",skillModifiers:{shooting:4,melee:3,discipline:3,strength:2},startingItems:["rifle","armor"],rarity:"uncommon"},{id:"scholar",name:"Scholar",description:"Years of study have made them knowledgeable but physically weak.",skillModifiers:{research:4,intelligence:4,medicine:2,strength:-2},startingItems:["books","research_notes"],rarity:"uncommon"},{id:"engineer",name:"Engineer",description:"Technical expertise in building and maintaining complex systems.",skillModifiers:{construction:4,crafting:3,intelligence:3,repair:4},startingItems:["toolbox","blueprints"],rarity:"uncommon"},{id:"medic",name:"Medic",description:"Trained in healing and medical procedures.",skillModifiers:{medicine:4,intelligence:2,social:2,dexterity:2},startingItems:["medical_kit","bandages"],rarity:"uncommon"},{id:"noble",name:"Noble",description:"Born into privilege, skilled in leadership but lacks practical experience.",skillModifiers:{social:4,leadership:4,intelligence:2,construction:-2,farming:-2},startingItems:["fine_clothes","signet_ring"],rarity:"rare"},{id:"assassin",name:"Assassin",description:"Trained in stealth and precision, deadly but antisocial.",skillModifiers:{melee:4,stealth:5,dexterity:3,social:-3},startingItems:["poison","throwing_knives"],rarity:"rare"},{id:"witch",name:"Witch",description:"Practitioner of ancient arts, mysterious and powerful.",skillModifiers:{medicine:3,research:3,intelligence:3,social:-2},startingItems:["herbs","ritual_components"],rarity:"rare"},{id:"hero",name:"Hero",description:"A legendary figure with exceptional abilities in all areas.",skillModifiers:{shooting:3,melee:3,leadership:4,strength:3,intelligence:2},startingItems:["legendary_weapon","hero_medal"],rarity:"legendary"},{id:"mastermind",name:"Mastermind",description:"Brilliant strategist and inventor, capable of incredible feats.",skillModifiers:{intelligence:5,research:5,leadership:3,crafting:4},startingItems:["advanced_tools","invention_plans"],rarity:"legendary"}],Lt=["Was a respected member of their community before the collapse.","Survived alone in the wilderness for months before joining the colony.","Lost their family in the great disaster and seeks a new beginning.","Was part of a failed expedition to establish another settlement.","Escaped from raiders who destroyed their previous home.","Voluntarily left their old life behind to join the colony.","Was rescued by the colony after being found injured and alone.","Brings tales of distant lands and strange discoveries.","Seeks redemption for past mistakes in their former life.","Dreams of rebuilding civilization better than it was before."];function as(t){let e=Te;{const i=Math.random();i<.6?e=Te.filter(n=>n.rarity==="common"):i<.85?e=Te.filter(n=>n.rarity==="uncommon"):i<.98?e=Te.filter(n=>n.rarity==="rare"):e=Te.filter(n=>n.rarity==="legendary")}return e[Math.floor(Math.random()*e.length)]}function ls(){return Lt[Math.floor(Math.random()*Lt.length)]}const mt=[{name:"Brown",hex:"#8B4513",rgb:[139,69,19],rarity:"common"},{name:"Black",hex:"#000000",rgb:[0,0,0],rarity:"common"},{name:"Blonde",hex:"#FFD700",rgb:[255,215,0],rarity:"common"},{name:"Dark Brown",hex:"#654321",rgb:[101,67,33],rarity:"common"},{name:"Auburn",hex:"#A0522D",rgb:[160,82,45],rarity:"uncommon"},{name:"Ginger",hex:"#FF6347",rgb:[255,99,71],rarity:"uncommon"},{name:"Strawberry Blonde",hex:"#FF8C69",rgb:[255,140,105],rarity:"uncommon"},{name:"Gray",hex:"#808080",rgb:[128,128,128],rarity:"uncommon"},{name:"White",hex:"#FFFFFF",rgb:[255,255,255],rarity:"rare"},{name:"Silver",hex:"#C0C0C0",rgb:[192,192,192],rarity:"rare"},{name:"Platinum Blonde",hex:"#F5F5DC",rgb:[245,245,220],rarity:"rare"}],bt=[{name:"Fair",hex:"#FDBCB4",rgb:[253,188,180],rarity:"common"},{name:"Light",hex:"#F1C27D",rgb:[241,194,125],rarity:"common"},{name:"Medium",hex:"#E0AC69",rgb:[224,172,105],rarity:"common"},{name:"Olive",hex:"#C68642",rgb:[198,134,66],rarity:"common"},{name:"Tan",hex:"#8D5524",rgb:[141,85,36],rarity:"common"},{name:"Dark",hex:"#5C4033",rgb:[92,64,51],rarity:"common"},{name:"Deep",hex:"#3C2415",rgb:[60,36,21],rarity:"common"}],wt=[{name:"Brown",hex:"#8B4513",rgb:[139,69,19],rarity:"common"},{name:"Blue",hex:"#4169E1",rgb:[65,105,225],rarity:"common"},{name:"Green",hex:"#228B22",rgb:[34,139,34],rarity:"common"},{name:"Hazel",hex:"#8FBC8F",rgb:[143,188,143],rarity:"common"},{name:"Gray",hex:"#808080",rgb:[128,128,128],rarity:"uncommon"},{name:"Amber",hex:"#FFBF00",rgb:[255,191,0],rarity:"uncommon"},{name:"Violet",hex:"#8A2BE2",rgb:[138,43,226],rarity:"rare"},{name:"Heterochromia",hex:"#FF1493",rgb:[255,20,147],rarity:"rare"}],Nt=["afro","bob","bowlcut","braidbun","bravo","burgundy","cleopatra","curly","cute","decent","elder","fancybun","firestarter","flowy","fringe"],Wt=["Male_Average_Normal"],cs=[{name:"White",hex:"#FFFFFF",rgb:[255,255,255],rarity:"common"},{name:"Black",hex:"#000000",rgb:[0,0,0],rarity:"common"},{name:"Gray",hex:"#808080",rgb:[128,128,128],rarity:"common"},{name:"Brown",hex:"#8B4513",rgb:[139,69,19],rarity:"common"},{name:"Blue",hex:"#4169E1",rgb:[65,105,225],rarity:"common"},{name:"Red",hex:"#DC143C",rgb:[220,20,60],rarity:"common"},{name:"Green",hex:"#228B22",rgb:[34,139,34],rarity:"common"},{name:"Purple",hex:"#800080",rgb:[128,0,128],rarity:"uncommon"},{name:"Orange",hex:"#FF8C00",rgb:[255,140,0],rarity:"uncommon"},{name:"Yellow",hex:"#FFD700",rgb:[255,215,0],rarity:"uncommon"},{name:"Gold",hex:"#FFD700",rgb:[255,215,0],rarity:"rare"},{name:"Silver",hex:"#C0C0C0",rgb:[192,192,192],rarity:"rare"}];function je(t,e=!0){if(!e)return t[Math.floor(Math.random()*t.length)];const i=Math.random();let n;return i<.7?n=t.filter(o=>o.rarity==="common"):i<.9?n=t.filter(o=>o.rarity==="uncommon"):n=t.filter(o=>o.rarity==="rare"),n.length===0&&(n=t),n[Math.floor(Math.random()*n.length)]}function ds(){return Nt[Math.floor(Math.random()*Nt.length)]}function hs(){return Wt[Math.floor(Math.random()*Wt.length)]}function fs(){return{hairColor:je(mt),hairStyle:ds(),skinTone:je(bt),eyeColor:je(wt),bodyType:hs(),height:["short","average","tall"][Math.floor(Math.random()*3)],build:["slim","average","stocky","muscular"][Math.floor(Math.random()*4)]}}const us=[{id:"fleet_footed",name:"Fleet-Footed",description:"Moves faster than average due to natural agility.",type:"positive",category:"physical",effects:[{stat:"movementSpeed",modifier:1.25,type:"multiplicative",description:"+25% movement speed"}],rarity:"uncommon",conflictsWith:["sluggish"]},{id:"sluggish",name:"Sluggish",description:"Naturally slow-moving, but often more careful and precise.",type:"negative",category:"physical",effects:[{stat:"movementSpeed",modifier:.8,type:"multiplicative",description:"-20% movement speed"},{stat:"accuracy",modifier:1,type:"additive",description:"+1 accuracy due to carefulness"}],rarity:"common",conflictsWith:["fleet_footed","nimble"]},{id:"strong_back",name:"Strong Back",description:"Can carry more items and work longer without fatigue.",type:"positive",category:"physical",effects:[{stat:"carryCapacity",modifier:1.5,type:"multiplicative",description:"+50% carry capacity"},{stat:"construction",modifier:2,type:"additive",description:"+2 construction skill"}],rarity:"uncommon",conflictsWith:["frail"]},{id:"frail",name:"Frail",description:"Physically weak but often compensates with intelligence.",type:"negative",category:"physical",effects:[{stat:"health",modifier:.75,type:"multiplicative",description:"-25% max health"},{stat:"intelligence",modifier:2,type:"additive",description:"+2 intelligence"}],rarity:"common",conflictsWith:["strong_back","tough"]},{id:"tough",name:"Tough",description:"Naturally resilient and hard to hurt.",type:"positive",category:"physical",effects:[{stat:"health",modifier:1.3,type:"multiplicative",description:"+30% max health"},{stat:"painTolerance",modifier:3,type:"additive",description:"+3 pain tolerance"}],rarity:"uncommon",conflictsWith:["frail"]},{id:"nimble",name:"Nimble",description:"Quick reflexes and excellent hand-eye coordination.",type:"positive",category:"physical",effects:[{stat:"dexterity",modifier:3,type:"additive",description:"+3 dexterity"},{stat:"accuracy",modifier:2,type:"additive",description:"+2 accuracy"}],rarity:"uncommon",conflictsWith:["clumsy"]},{id:"clumsy",name:"Clumsy",description:"Prone to accidents but oddly endearing to others.",type:"negative",category:"physical",effects:[{stat:"dexterity",modifier:-2,type:"additive",description:"-2 dexterity"},{stat:"social",modifier:1,type:"additive",description:"+1 social (endearing clumsiness)"}],rarity:"common",conflictsWith:["nimble"]}],As=[{id:"quick_learner",name:"Quick Learner",description:"Gains experience and skills faster than others.",type:"positive",category:"mental",effects:[{stat:"experienceGain",modifier:1.5,type:"multiplicative",description:"+50% experience gain"}],rarity:"rare"},{id:"slow_learner",name:"Slow Learner",description:"Takes longer to learn new skills but retains them better.",type:"negative",category:"mental",effects:[{stat:"experienceGain",modifier:.7,type:"multiplicative",description:"-30% experience gain"},{stat:"skillRetention",modifier:1.2,type:"multiplicative",description:"+20% skill retention"}],rarity:"common"},{id:"photographic_memory",name:"Photographic Memory",description:"Never forgets anything and excels at research.",type:"positive",category:"mental",effects:[{stat:"research",modifier:4,type:"additive",description:"+4 research skill"},{stat:"intelligence",modifier:3,type:"additive",description:"+3 intelligence"}],rarity:"legendary"},{id:"absent_minded",name:"Absent-Minded",description:"Often forgets things but has moments of brilliant insight.",type:"negative",category:"mental",effects:[{stat:"taskCompletion",modifier:.85,type:"multiplicative",description:"-15% task completion rate"},{stat:"creativity",modifier:3,type:"additive",description:"+3 creativity bonus"}],rarity:"common"},{id:"perfectionist",name:"Perfectionist",description:"Works slower but produces higher quality results.",type:"neutral",category:"mental",effects:[{stat:"workSpeed",modifier:.8,type:"multiplicative",description:"-20% work speed"},{stat:"quality",modifier:1.4,type:"multiplicative",description:"+40% work quality"}],rarity:"uncommon"},{id:"focused",name:"Focused",description:"Excellent concentration allows for efficient work.",type:"positive",category:"mental",effects:[{stat:"workSpeed",modifier:1.2,type:"multiplicative",description:"+20% work speed"},{stat:"accuracy",modifier:2,type:"additive",description:"+2 accuracy"}],rarity:"uncommon"}],gs=[{id:"charismatic",name:"Charismatic",description:"Natural leader who inspires others.",type:"positive",category:"social",effects:[{stat:"social",modifier:4,type:"additive",description:"+4 social skill"},{stat:"leadership",modifier:3,type:"additive",description:"+3 leadership"}],rarity:"rare"},{id:"antisocial",name:"Antisocial",description:"Prefers solitude but works well independently.",type:"negative",category:"social",effects:[{stat:"social",modifier:-3,type:"additive",description:"-3 social skill"},{stat:"independentWork",modifier:1.3,type:"multiplicative",description:"+30% efficiency when working alone"}],rarity:"common"},{id:"empathetic",name:"Empathetic",description:"Deeply understands others emotions and needs.",type:"positive",category:"social",effects:[{stat:"medicine",modifier:2,type:"additive",description:"+2 medicine (bedside manner)"},{stat:"social",modifier:2,type:"additive",description:"+2 social skill"},{stat:"moodImpact",modifier:1.2,type:"multiplicative",description:"+20% positive mood impact on others"}],rarity:"uncommon"},{id:"intimidating",name:"Intimidating",description:"Natural presence that can be useful in conflict.",type:"neutral",category:"social",effects:[{stat:"melee",modifier:2,type:"additive",description:"+2 melee (intimidation factor)"},{stat:"social",modifier:-1,type:"additive",description:"-1 social (can be off-putting)"},{stat:"conflictResolution",modifier:1.5,type:"multiplicative",description:"+50% conflict resolution through intimidation"}],rarity:"uncommon"}],ps=[{id:"green_thumb",name:"Green Thumb",description:"Plants seem to grow better under their care.",type:"positive",category:"special",effects:[{stat:"farming",modifier:4,type:"additive",description:"+4 farming skill"},{stat:"cropYield",modifier:1.25,type:"multiplicative",description:"+25% crop yield"},{stat:"plantGrowthSpeed",modifier:1.15,type:"multiplicative",description:"+15% plant growth speed"}],rarity:"rare"},{id:"animal_whisperer",name:"Animal Whisperer",description:"Has an uncanny ability to understand and work with animals.",type:"positive",category:"special",effects:[{stat:"animals",modifier:5,type:"additive",description:"+5 animal skill"},{stat:"animalProductivity",modifier:1.3,type:"multiplicative",description:"+30% animal productivity"},{stat:"tamingSpeed",modifier:2,type:"multiplicative",description:"100% faster animal taming"}],rarity:"rare"},{id:"night_owl",name:"Night Owl",description:"More productive during night hours.",type:"neutral",category:"special",effects:[{stat:"nightWorkBonus",modifier:1.5,type:"multiplicative",description:"+50% work efficiency at night"},{stat:"dayWorkPenalty",modifier:.9,type:"multiplicative",description:"-10% work efficiency during day"}],rarity:"uncommon"},{id:"early_bird",name:"Early Bird",description:"Most productive in the early morning hours.",type:"neutral",category:"special",effects:[{stat:"morningWorkBonus",modifier:1.4,type:"multiplicative",description:"+40% work efficiency in morning"},{stat:"eveningWorkPenalty",modifier:.9,type:"multiplicative",description:"-10% work efficiency in evening"}],rarity:"uncommon"},{id:"lucky",name:"Lucky",description:"Good things just seem to happen around them.",type:"positive",category:"special",effects:[{stat:"criticalSuccess",modifier:2,type:"multiplicative",description:"100% higher chance of critical success"},{stat:"resourceFind",modifier:1.2,type:"multiplicative",description:"+20% chance to find extra resources"}],rarity:"legendary"},{id:"jinxed",name:"Jinxed",description:"Prone to unfortunate accidents and bad luck.",type:"negative",category:"special",effects:[{stat:"criticalFailure",modifier:1.5,type:"multiplicative",description:"+50% chance of critical failure"},{stat:"equipmentBreakage",modifier:1.3,type:"multiplicative",description:"+30% equipment breakage rate"}],rarity:"uncommon"}],Je=[...us,...As,...gs,...ps];function ys(t,e){let i=Je;if(t&&(i=i.filter(n=>n.category===t)),e)i=i.filter(n=>n.rarity===e);else{const n=Math.random();n<.5?i=i.filter(o=>o.rarity==="common"):n<.8?i=i.filter(o=>o.rarity==="uncommon"):n<.95?i=i.filter(o=>o.rarity==="rare"):i=i.filter(o=>o.rarity==="legendary")}return i.length===0&&(i=Je),i[Math.floor(Math.random()*i.length)]}function ms(t=2){const e=[],i=new Set;for(let n=0;n<t;n++){let o=0,a;do a=ys(),o++;while((i.has(a.id)||a.conflictsWith&&a.conflictsWith.some(s=>i.has(s)))&&o<50);o<50&&(e.push(a),i.add(a.id))}return e}function bs(){return{background:as(),appearance:fs(),passiveTraits:ms(Math.floor(Math.random()*3)+1),originStory:ls()}}Je.map(t=>t.name);Je.map(t=>({name:t.name,description:t.description,effects:t.effects.reduce((e,i)=>(e[i.stat]=i.modifier,e),{}),rarity:t.rarity}));mt.map(t=>t.name);bt.map(t=>t.name);wt.map(t=>t.name);Te.map(t=>({name:t.name,description:t.description,effects:Object.entries(t.skillModifiers).reduce((e,[i,n])=>(e[i]=n,e),{}),startingSkills:t.startingItems||[]}));bt.map(t=>t.hex),mt.map(t=>t.hex),wt.map(t=>t.hex);const de={FIRST:["Alex","Jordan","Taylor","Casey","Morgan","Riley","Jamie","Avery","Quinn","Sage","River","Rowan","Phoenix","Dakota","Skyler","Emery","Emma","Liam","Olivia","Noah","Ava","Ethan","Sophia","Mason","Isabella","William","Mia","James","Charlotte","Benjamin","Amelia","Lucas"],LAST:["Smith","Johnson","Williams","Brown","Jones","Garcia","Miller","Davis","Rodriguez","Martinez","Hernandez","Lopez","Gonzalez","Wilson","Anderson","Thomas"]},ws=["Fresh Bread","Roasted Vegetables","Berry Pie","Hearty Stew","Honey Cakes","Grilled Fish","Wild Mushrooms","Apple Cider","Cheese & Crackers","Herbal Tea"];function Ee(t){return t[Math.floor(Math.random()*t.length)]}const vs=["Millhaven","Riverside","Oakwood","Stonecrest","Greenfield","Ashford","Fairview","Brookside","Clearwater","Redwood","Silverdale","Goldcrest","Ironport","Copper Hills","Crystal Lake","Shadowvale","Brightwater","Darkwood"],Ms=[{event:"Lost a parent at a young age",impact:"negative"},{event:"Won a local competition",impact:"positive"},{event:"Survived a natural disaster",impact:"neutral"},{event:"Fell in love and got heartbroken",impact:"negative"},{event:"Started their own small business",impact:"positive"},{event:"Served in the local militia",impact:"neutral"},{event:"Lost everything in a fire",impact:"negative"},{event:"Saved someone's life",impact:"positive"},{event:"Was betrayed by a close friend",impact:"negative"},{event:"Discovered a hidden talent",impact:"positive"},{event:"Moved frequently as a child",impact:"neutral"},{event:"Inherited property from a relative",impact:"positive"}],ks=["Cooking","Carpentry","Gardening","Mechanics","First Aid","Hunting","Fishing","Sewing","Music","Art","Writing","Leadership","Animal Care"],xs=["heights","darkness","water","crowds","spiders","failure","abandonment","confined spaces","loud noises","authority figures"],Ss=["once stole food to feed a starving family","has a photographic memory but hides it","is secretly afraid of butterflies","wrote anonymous love letters for years","saved someone's life and never told anyone","knows the location of hidden treasure","can't read but has never admitted it","has recurring dreams about flying"];class Cs{constructor(e){x(this,"seed");this.seed=e}next(){return this.seed=(this.seed*9301+49297)%233280,this.seed/233280}choice(e){return e[Math.floor(this.next()*e.length)]}choices(e,i){return[...e].sort(()=>this.next()-.5).slice(0,i)}range(e,i){return e+Math.floor(this.next()*(i-e+1))}}function Rs(t){let e=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return Math.abs(e)}function Ts(){const t=()=>.9+Math.random()*.2;return{workSpeed:Math.round(t()*100)/100,socialBonus:Math.round(t()*100)/100,hungerRate:Math.round(t()*100)/100,fatigueRate:Math.round(t()*100)/100}}function Ps(t,e,i){const n=t.choice(vs),o=t.next()>.1,a=[];o&&(t.next()>.2&&a.push(`${t.choice(de.FIRST)} ${i.split(" ")[1]} (Father)`),t.next()>.1&&a.push(`${t.choice(de.FIRST)} ${t.choice(de.LAST)} (Mother)`));const s=t.next()>.6?t.range(1,3):0,r=[];for(let M=0;M<s;M++){const w=t.choice(de.FIRST),C=t.choice(["Brother","Sister"]);r.push(`${w} ${i.split(" ")[1]} (${C})`)}const l=e>25&&t.next()>.6?`${t.choice(de.FIRST)} ${t.choice(de.LAST)}`:void 0,c=l&&t.next()>.7?t.range(1,2):0,h=[];for(let M=0;M<c;M++){const w=t.choice(de.FIRST),C=t.choice(["Son","Daughter"]);h.push(`${w} (${C})`)}const f=Math.min(t.range(2,5),Math.floor(e/8)),d=[];for(let M=0;M<f;M++){const w=t.choice(Ms),C=t.range(8,e-2);d.push({age:C,...w})}d.sort((M,w)=>M.age-w.age);const u=t.choices(ks,t.range(2,4)),m=t.choices(xs,t.range(1,2)),g=t.next()>.7?[t.choice(Ss)]:[],p=Math.min(t.range(1,3),Math.floor(e/12)),b=[],v=["Childhood Friend","Former Colleague","Neighbor","Mentor","Rival"];for(let M=0;M<p;M++){const w=`${t.choice(de.FIRST)} ${t.choice(de.LAST)}`,C=t.choice(v),k=t.choice(["good","bad","neutral"]);b.push({name:w,type:C,status:k})}return{birthplace:n,family:{parents:a,siblings:r,spouse:l,children:h},lifeEvents:d,skills:u,fears:m,secrets:g,relationships:b}}function Bs(t){const{name:e,age:i,detailedInfo:n,background:o}=t;if(!n)return"A mysterious person with an unknown past.";let a=`${e} is ${i} years old and was born in ${n.birthplace}. `;if(n.family.parents.length>0?a+=`Raised by ${n.family.parents.join(" and ")}, `:a+="Growing up without parents, ",n.family.siblings.length>0?a+=`they have ${n.family.siblings.length} sibling${n.family.siblings.length>1?"s":""}. `:a+="they were an only child. ",n.lifeEvents.length>0){const s=n.lifeEvents.filter(r=>r.impact!=="neutral").slice(0,2);s.length>0&&(a+="Key moments in their life include: ",a+=s.map(r=>`at age ${r.age}, ${r.event.toLowerCase()}`).join("; ")+". ")}return n.family.spouse&&(a+=`They are married to ${n.family.spouse}`,n.family.children.length>0&&(a+=` and have ${n.family.children.length} child${n.family.children.length>1?"ren":""}: ${n.family.children.join(", ")}`),a+=". "),n.skills.length>0&&(a+=`They are skilled in ${n.skills.slice(0,2).join(" and ")}. `),n.fears.length>0&&(a+=`Despite their strengths, they have a deep fear of ${n.fears[0]}. `),n.secrets.length>0&&(a+=`What few know is that they ${n.secrets[0]}.`),a}function Is(t,e,i){var h,f;const n={items:[],equipment:{},carryCapacity:50,currentWeight:0};te.loadItems();const o=te.getItemsForBackground(e);for(const d of o){const u=te.createItem(d,1,Gt(t));if(u)if(u.category==="Tool"||u.category==="Weapon"||u.category==="Armor"||u.category==="Helmet"){const m=Es(u.category);m&&!n.equipment[m]?n.equipment[m]=u:n.items.push(u)}else n.items.push(u)}if(i.includes("Cooking")){const d=te.createItem("Knife",1);d&&n.items.push(d)}if(i.includes("First Aid")){const d=te.createItem("MedicineKit",1);d&&n.items.push(d)}const a=["Bread","Bandages"];for(const d of a){const u=te.createItem(d,t.range(1,3));u&&n.items.push(u)}if(!n.equipment.armor){const d=te.createItem("WorkClothes",1);d&&(n.equipment.armor=d)}const s=e.toLowerCase();if(!(!!n.equipment.weapon&&(((h=n.equipment.weapon)==null?void 0:h.defName)==="Pistol"||((f=n.equipment.weapon)==null?void 0:f.defName)==="Rifle"))&&s!=="soldier"&&t.next()<.35){const d=te.createItem("Pistol",1,Gt(t));d&&(n.equipment.weapon=d)}let c=0;for(const d of n.items)c+=(d.weight||0)*d.quantity;for(const d of Object.values(n.equipment))d&&(c+=d.weight||0);return n.currentWeight=c,n}function Es(t){switch(t){case"Tool":return"tool";case"Weapon":return"weapon";case"Armor":return"armor";case"Helmet":return"helmet";default:return null}}function Gt(t){const e=t.range(0,1);return e<.05?"poor":e<.15?"awful":e<.6?"normal":e<.85?"good":e<.95?"excellent":e<.99?"masterwork":"legendary"}function Ot(){console.log("DEBUG: Generating new colonist profile...");const t=Ee(de.FIRST),e=Ee(de.LAST),i=`${t} ${e}`,n=Rs(i),o=new Cs(n),a=o.range(20,55),s=bs();console.log("DEBUG: Generated traits:",s);const r=Ps(o,a,i),l=Ee(ws),c={skinTone:s.appearance.skinTone.hex,hairColor:s.appearance.hairColor.hex,eyeColor:s.appearance.eyeColor.hex,clothing:je(cs).hex,sprites:{headType:Ee(fe.getInstance().getAvailableHeadTypes()),bodyType:s.appearance.bodyType,hairStyle:s.appearance.hairStyle,apparelType:Ee(fe.getInstance().getAvailableApparelTypes())}},h=Ts(),f={name:i,age:a,seed:n,background:s.background.name,personality:s.passiveTraits.map(u=>u.name),favoriteFood:l,backstory:"",detailedInfo:r,avatar:c,stats:h,startingInventory:Is(o,s.background.name,r.skills)};f.backstory=Bs(f);const d=an();return ln(d),f.initialSkills=d,f}function Ds(t){return`${t.name}, a ${t.personality.join(" and ").toLowerCase()} ${t.background.toLowerCase()}`}function zt(t){var s,r;const e=t.hp||0,i=t.hunger||0,n=t.fatigue||0,o=((s=t.health)==null?void 0:s.totalPain)||0,a=((r=t.health)==null?void 0:r.consciousness)||1;return o>.6?"Agonizing pain":o>.4?"In pain":a<.5?"Barely conscious":e<30?"Injured":i>80?"Starving":n>80?"Exhausted":t.inside?"Resting":t.state==="flee"?"Terrified":o<.1&&e>80&&i<30&&n<30?"Happy":o<.2&&e>60&&i<50&&n<50?"Content":o>.2?"Uncomfortable":"Okay"}function bi(t,e,i){const n=[],o=12+Math.floor(Math.random()*6);for(let a=0;a<o;a++){const r=i+(Math.random()-.5)*1.2,l=100+Math.random()*80,c=["#ffeb3b","#ffc107","#ff9800","#ff5722","#fff59d"],h=c[Math.floor(Math.random()*c.length)];n.push({x:t+(Math.random()-.5)*6,y:e+(Math.random()-.5)*6,vx:Math.cos(r)*l,vy:Math.sin(r)*l,life:.12+Math.random()*.08,maxLife:.12+Math.random()*.08,size:1.8+Math.random()*2,color:h,alpha:.95})}return n}function wi(t){const e=[],i=t.tx-t.x,n=t.ty-t.y,o=Math.sqrt(i*i+n*n),a=Math.atan2(n,i),s=Math.floor(o/8)+2;for(let r=0;r<s;r++){const l=r/(s-1),c=t.x+i*l,h=t.y+n*l,f=["#c0c0c0","#a8a8a8","#909090","#787878","#606060"],d=f[Math.floor(Math.random()*f.length)],u=a+Math.PI/2,m=(Math.random()-.5)*1.5;e.push({x:c+Math.cos(u)*m,y:h+Math.sin(u)*m,vx:Math.cos(a)*5+(Math.random()-.5)*8,vy:Math.sin(a)*5+(Math.random()-.5)*8,life:.15+Math.random()*.1,maxLife:.15+Math.random()*.1,size:.8+Math.random()*.4,color:d,alpha:.7})}return e}function tt(t,e){const i=[],n=8+Math.floor(Math.random()*8);for(let o=0;o<n;o++){const a=Math.PI*2*o/n+(Math.random()-.5)*.8,s=50+Math.random()*60,r=["#ff5722","#ff7043","#ffab40","#ffa726","#ff8a65"],l=r[Math.floor(Math.random()*r.length)];i.push({x:t+(Math.random()-.5)*8,y:e+(Math.random()-.5)*8,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:.25+Math.random()*.2,maxLife:.25+Math.random()*.2,size:1.2+Math.random()*1.2,color:l,alpha:.9})}return i}function Ht(t,e){return t.filter(i=>(i.x+=i.vx*e,i.y+=i.vy*e,i.vy+=30*e,i.vx*=.98,i.vy*=.98,i.life-=e,i.alpha=Math.max(0,i.life/i.maxLife*.8),i.size*=.995,i.life>0))}function vi(t,e){t.save();for(const i of e)t.globalAlpha=i.alpha,t.fillStyle=i.color,t.beginPath(),t.arc(i.x,i.y,i.size,0,Math.PI*2),t.fill(),i.alpha>.2&&(t.globalAlpha=i.alpha*.25,t.beginPath(),t.arc(i.x,i.y,i.size*2.5,0,Math.PI*2),t.fill()),i.life/i.maxLife>.7&&(t.globalAlpha=i.alpha*.8,t.fillStyle="#ffffff",t.beginPath(),t.arc(i.x,i.y,i.size*.4,0,Math.PI*2),t.fill());t.restore()}function Mi(t,e,i,n,o){const a=o.x,s=o.x+o.w,r=o.y,l=o.y+o.h,c=Math.min(t,i),h=Math.max(t,i),f=Math.min(e,n),d=Math.max(e,n);if(h<a||c>s||d<r||f>l)return!1;const u=(m,g,p,b,v,M,w,C)=>{const k=(m-p)*(M-C)-(g-b)*(v-w);if(k===0)return!1;const S=((m-v)*(M-C)-(g-M)*(v-w))/k,P=((m-v)*(g-b)-(g-M)*(m-p))/k;return S>=0&&S<=1&&P>=0&&P<=1};return!!(u(t,e,i,n,a,r,s,r)||u(t,e,i,n,s,r,s,l)||u(t,e,i,n,s,l,a,l)||u(t,e,i,n,a,l,a,r))}function ki(t,e,i){for(const n of t.buildings)if(!(n.kind==="hq"||n.kind==="path"||n.kind==="house"||n.kind==="farm"||n.kind==="bed"||!n.done||e.x>=n.x&&e.x<=n.x+n.w&&e.y>=n.y&&e.y<=n.y+n.h)&&Mi(e.x,e.y,i.x,i.y,n))return!1;return!0}function Fs(t,e,i){let n=null,o=1/0;for(const a of t.enemies){const s=Math.hypot(a.x-e.x,a.y-e.y);s<=i&&s<o&&ki(t,e,a)&&(n=a,o=s)}return n}function Ls(t,e,i){if(!("range"in e)||!e.range)return;e.cooldown=Math.max(0,(e.cooldown||0)-i),"flashTimer"in e&&(e.flashTimer=Math.max(0,(e.flashTimer||0)-i));const n=t.centerOf(e),o=e.range||160,a=e.fireRate||.6,s=e.dps||12;let r=e.target||null;if((!r||r.hp<=0||Math.hypot(r.x-n.x,r.y-n.y)>o||!ki(t,n,r))&&(r=Fs(t,n,o),e.target=r||null),!!r&&(e.cooldown||0)<=0){const l=Math.hypot(r.x-n.x,r.y-n.y),c=Math.max(.35,Math.min(.95,.85-l/o*.3)),h=Math.atan2(r.y-n.y,r.x-n.x),d=(1-c)*18*Math.PI/180,u=(Math.random()-.5)*d,m=h+u,g=l,p=n.x+Math.cos(m)*g,b=n.y+Math.sin(m)*g,v={x:n.x,y:n.y,tx:p,ty:b,t:.12,speed:700,dmg:s,life:0,maxLife:Math.max(.12,l/700+.1),owner:"turret"},M=p-n.x,w=b-n.y,C=Math.hypot(M,w)||1;v.vx=M/C*v.speed,v.vy=w/C*v.speed,v.particles=wi(v),t.bullets.push(v);const k=bi(n.x,n.y,h);t.particles.push(...k),e.flashTimer=.08,e.cooldown=a}}function Ns(t,e){for(let i=t.bullets.length-1;i>=0;i--){const n=t.bullets[i];if(n.vx!=null&&n.vy!=null){const o=n.x,a=n.y;n.x+=n.vx*e,n.y+=n.vy*e,n.life=(n.life||0)+e;let s=!1;for(const l of t.buildings)if(!(l.kind==="hq"||l.kind==="path"||l.kind==="house"||l.kind==="farm"||!l.done||o>=l.x&&o<=l.x+l.w&&a>=l.y&&a<=l.y+l.h)&&Mi(o,a,n.x,n.y,l)){s=!0;break}let r=null;if(!s)for(const l of t.enemies){const c=n.x-o,h=n.y-a,f=o-l.x,d=a-l.y,u=c*c+h*h,m=2*(f*c+d*h),g=f*f+d*d-l.r*l.r;let p=m*m-4*u*g;if(p>=0){p=Math.sqrt(p);const b=(-m-p)/(2*u),v=(-m+p)/(2*u);if(b>=0&&b<=1||v>=0&&v<=1){r=l;break}}}if(r){const l=Math.max(1,Math.round(n.dmg||10));if(t.colonists.includes(r)?t.applyDamageToColonist(r,l,"gunshot"):r.hp-=l,n.owner==="colonist"&&n.shooterId){const f=t.colonists.find(d=>d.id===n.shooterId);f&&f.skills&&(ce(f,"Shooting",8,f.t||0),r.hp<=0&&ce(f,"Shooting",20,f.t||0))}const h=tt(r.x,r.y);t.particles.push(...h),t.bullets.splice(i,1);continue}if(s||n.maxLife!=null&&n.life>=n.maxLife){const l=tt(n.x,n.y);t.particles.push(...l),t.bullets.splice(i,1);continue}}else if(n.t-=e,n.t<=0){const o=tt(n.tx,n.ty);t.particles.push(...o),t.bullets.splice(i,1);continue}n.particles&&(n.particles=Ht(n.particles,e),n.particles&&n.particles.length===0&&delete n.particles)}t.particles=Ht(t.particles,e)}function Ws(t,e,i,n,o){const a=o.x,s=o.x+o.w,r=o.y,l=o.y+o.h,c=Math.min(t,i),h=Math.max(t,i),f=Math.min(e,n),d=Math.max(e,n);if(h<a||c>s||d<r||f>l)return!1;const u=(m,g,p,b,v,M,w,C)=>{const k=(m-p)*(M-C)-(g-b)*(v-w);if(k===0)return!1;const S=((m-v)*(M-C)-(g-M)*(v-w))/k,P=((m-v)*(g-b)-(g-M)*(m-p))/k;return S>=0&&S<=1&&P>=0&&P<=1};return!!(u(t,e,i,n,a,r,s,r)||u(t,e,i,n,s,r,s,l)||u(t,e,i,n,s,l,a,l)||u(t,e,i,n,a,l,a,r))}function Gs(t,e,i){for(const n of t.buildings)if(!(n.kind==="hq"||n.kind==="path"||n.kind==="house"||n.kind==="farm"||n.kind==="bed"||!n.done||e.x>=n.x&&e.x<=n.x+n.w&&e.y>=n.y&&e.y<=n.y+n.h)&&Ws(e.x,e.y,i.x,i.y,n))return!1;return!0}function Os(t,e,i,n,o,a,s){const r=i-t,l=n-e,c=t-o,h=e-a,f=r*r+l*l,d=2*(c*r+h*l),u=c*c+h*h-s*s;let m=d*d-4*f*u;if(m<0)return!1;m=Math.sqrt(m);const g=(-d-m)/(2*f),p=(-d+m)/(2*f);return g>=0&&g<=1||p>=0&&p<=1}function zs(t,e,i,n){for(const o of t.colonists){if(o===n||!o.alive||o.inside)continue;const a=(o.r||8)+6;if(Os(e.x,e.y,i.x,i.y,o.x,o.y,a))return!0}return!1}function Hs(t,e,i){let n=0;for(const o of t.buildings){if(!o.done||o.kind!=="wall")continue;const a=o.x+o.w/2,s=o.y+o.h/2,r=i.x-e.x,l=i.y-e.y,c=a-e.x,h=s-e.y,f=r*r+l*l||1,d=Math.max(0,Math.min(1,(c*r+h*l)/f)),u=e.x+d*r,m=e.y+d*l,g=Math.hypot(u-a,m-s);d>.75&&g<Math.max(12,Math.min(o.w,o.h)*.6)&&(n+=.25)}return Math.min(.6,n)}function Ys(t){var g;const i=(((g=t.inventory)==null?void 0:g.equipment)||{}).weapon;if(!i||!i.defName)return null;const n=te.getItemDef(i.defName);if(!n)return null;const o=32,a=(n.range||10)*o,s=n.damage||12,r=n.accuracy??.7,l=n.defName==="Rifle"?3:1,c=n.defName==="Rifle"?.6:.4,h=.1,f=n.defName==="Rifle"?.7:.5,d=680,u=1.25*o,m=(n.range||0)<=2;return{rangePx:a,damage:s,accuracy:r,burst:l,warmup:c,betweenShots:h,cooldown:f,speed:d,minRangePx:u,isMelee:m}}function js(t,e,i){let n=null,o=1/0;for(const a of t.enemies){const s=Math.hypot(a.x-e.x,a.y-e.y);s<=i&&s<o&&Gs(t,e,a)&&(n=a,o=s)}return n}function Us(t,e,i){if(!e.alive||e.inside)return;const n=Ys(e),a=(()=>{const S=e._lastPos||{x:e.x,y:e.y},P=Math.hypot(e.x-S.x,e.y-S.y);return e._lastPos={x:e.x,y:e.y},P})()>.5;if(!n||n.isMelee){const P=41.6+e.r;let I=null,B=1/0;for(const N of t.enemies){const O=Math.hypot(N.x-e.x,N.y-e.y);O<B&&(B=O,I=N)}if(I&&B<=P){if(a)return;if(e.meleeCd=Math.max(0,(e.meleeCd||0)-i),(e.meleeCd||0)<=0){const N=e.skills?ge(e,"Melee"):0,O=Math.round(((n==null?void 0:n.damage)||10)*(1+N*.03));if(t.colonists.includes(I)){const j=n!=null&&n.isMelee?"cut":"bruise";t.applyDamageToColonist(I,O,j)}else I.hp-=O;e.skills&&ce(e,"Melee",18,e.t||0),e.meleeCd=.8}}return}e.fireCooldown=Math.max(0,(e.fireCooldown||0)-i),e.betweenShots=Math.max(0,(e.betweenShots||0)-i),e.warmup=Math.max(0,(e.warmup||0)-i);let s=e.combatTarget||null;if((!s||s.hp<=0)&&(s=js(t,e,n.rangePx),e.combatTarget=s,s&&(e.warmup=n.warmup)),!s)return;const r=Math.hypot(s.x-e.x,s.y-e.y);if(r>n.rangePx*1.1){e.combatTarget=null;return}if(r<=n.minRangePx){if(e.meleeCd=Math.max(0,(e.meleeCd||0)-i),(e.meleeCd||0)<=0){const S=Math.max(8,Math.round(n.damage*.6));t.colonists.includes(s)?t.applyDamageToColonist(s,S,"bruise"):s.hp-=S,e.meleeCd=.9,e.fireCooldown=Math.max(e.fireCooldown||0,.3)}return}if(a){e.burstLeft=0,e.warmup=Math.max(e.warmup||0,n.warmup*.6);return}if((e.warmup||0)>0)return;if(e.burstLeft==null||e.burstLeft<=0){if((e.fireCooldown||0)>0)return;e.burstLeft=n.burst}if((e.betweenShots||0)>0)return;const l=e.skills?ge(e,"Shooting"):0,c=Math.min(.98,n.accuracy*(1+l*.02)),h=Math.max(.5,1-r/n.rangePx*.5),f=Hs(t,e,s),d=Math.max(.1,c*h*(1-f)),u=Math.atan2(s.y-e.y,s.x-e.x),m=(1-d)*20*(Math.PI/180),g=u+(Math.random()-.5)*m,p=e.x+Math.cos(g)*r,b=e.y+Math.sin(g)*r;if(zs(t,e,{x:p,y:b},e)){e.betweenShots=Math.max(e.betweenShots||0,.15);return}const v={x:e.x,y:e.y,tx:p,ty:b,t:.12,speed:n.speed,dmg:Math.round(n.damage*(1+l*.02)),life:0,maxLife:Math.max(.12,r/n.speed+.12),owner:"colonist",shooterId:e.id||(e.id=`colonist_${Date.now()}_${Math.random().toString(36).substr(2,9)}`)},M=p-e.x,w=b-e.y,C=Math.hypot(M,w)||1;v.vx=M/C*n.speed,v.vy=w/C*n.speed,v.particles=wi(v),t.bullets.push(v);const k=bi(e.x,e.y,u);t.particles.push(...k),e.burstLeft-=1,e.betweenShots=n.betweenShots,e.burstLeft<=0&&(e.fireCooldown=n.cooldown,e.combatTarget=null),e.skills&&ce(e,"Shooting",2.5,e.t||0)}const Qs={Firefighting:1,PatientEmergency:1,Doctor:3,PatientBedRest:2,Flicker:2,Warden:3,Handling:3,Cooking:3,Hunting:3,Construction:2,Growing:2,Mining:2,PlantCutting:2,Smithing:3,Tailoring:3,Art:4,Crafting:3,Hauling:3,Cleaning:4,Research:3},rt={Firefighting:{name:"Firefighting",label:"Firefight",description:"Put out fires (emergency)",emergencyWork:!0,requiresCapability:"movement"},PatientEmergency:{name:"PatientEmergency",label:"Patient",description:"Being treated for injuries",emergencyWork:!0},Doctor:{name:"Doctor",label:"Doctor",description:"Treat injuries and illnesses",relatedSkill:"Medicine",requiresCapability:"manipulation"},PatientBedRest:{name:"PatientBedRest",label:"Bed rest",description:"Rest in bed when injured"},Flicker:{name:"Flicker",label:"Flick",description:"Operate switches and power controls",requiresCapability:"manipulation"},Warden:{name:"Warden",label:"Warden",description:"Manage prisoners",relatedSkill:"Social",requiresCapability:"movement"},Handling:{name:"Handling",label:"Handle",description:"Tame and train animals",relatedSkill:"Social",requiresCapability:"manipulation"},Cooking:{name:"Cooking",label:"Cook",description:"Prepare meals",relatedSkill:"Cooking",requiresCapability:"manipulation"},Hunting:{name:"Hunting",label:"Hunt",description:"Hunt animals for food",relatedSkill:"Shooting",requiresCapability:"movement"},Construction:{name:"Construction",label:"Construct",description:"Build structures",relatedSkill:"Construction",requiresCapability:"manipulation"},Growing:{name:"Growing",label:"Grow",description:"Sow and harvest crops",relatedSkill:"Plants",requiresCapability:"manipulation"},Mining:{name:"Mining",label:"Mine",description:"Extract stone and minerals",relatedSkill:"Mining",requiresCapability:"manipulation"},PlantCutting:{name:"PlantCutting",label:"Plant cut",description:"Chop trees for wood",relatedSkill:"Plants",requiresCapability:"manipulation"},Smithing:{name:"Smithing",label:"Smith",description:"Craft weapons and armor",relatedSkill:"Crafting",requiresCapability:"manipulation"},Tailoring:{name:"Tailoring",label:"Tailor",description:"Craft clothing",relatedSkill:"Crafting",requiresCapability:"manipulation"},Art:{name:"Art",label:"Art",description:"Create artistic works",relatedSkill:"Crafting",requiresCapability:"manipulation"},Crafting:{name:"Crafting",label:"Craft",description:"General crafting",relatedSkill:"Crafting",requiresCapability:"manipulation"},Hauling:{name:"Hauling",label:"Haul",description:"Move items and resources",requiresCapability:"movement"},Cleaning:{name:"Cleaning",label:"Clean",description:"Clean up filth",requiresCapability:"movement"},Research:{name:"Research",label:"Research",description:"Conduct research",relatedSkill:"Research",requiresCapability:"manipulation"}},Se=["Firefighting","PatientEmergency","Doctor","PatientBedRest","Flicker","Warden","Handling","Cooking","Hunting","Construction","Growing","Mining","PlantCutting","Smithing","Tailoring","Art","Crafting","Hauling","Cleaning","Research"];function at(t){if(t.workPriorities)return;const e={...Qs};if(t.skills){const i=t.skills;for(const[n,o]of Object.entries(i.byName))if(o.level>=8||o.passion==="burning"){for(const[a,s]of Object.entries(rt))if(s.relatedSkill===n){const r=e[a];r>1&&(e[a]=Math.max(1,r-1))}}}t.workPriorities=e}function qs(t,e){t.workPriorities||at(t);const i=t.workPriorities[e];let n;i===1?n=2:i===2?n=3:i===3?n=4:i===4?n=0:n=1,t.workPriorities[e]=n}let ye=!1,ae=0,Fe=null,lt=0,ct=0;function vt(t,e,i){const n=t*.9,o=e*.85,a=(t-n)/2,s=(e-o)/2,r=n*.02,l=o*.08,c=o*.06,h=n*.15,f=n-h-r*2,d=Se.length,u=f/d,m=o-l-c-r*2,g=i+1,p=Math.max(m/g,o*.04),b=Math.max(10,n*.012),v=Math.max(12,n*.015);return{panelX:a,panelY:s,panelWidth:n,panelHeight:o,cellWidth:u,cellHeight:p,headerHeight:l,nameColumnWidth:h,padding:r,fontSize:b,headerFontSize:v,footerHeight:c}}function it(){ye=!ye,ae=0;const t=document.getElementById("mobileControls");t&&(t.style.display=ye?"none":"")}function Ce(){return ye}function Yt(){ye=!1;const t=document.getElementById("mobileControls");t&&(t.style.display="")}function Xs(t){switch(t){case 1:return"#4CAF50";case 2:return"#8BC34A";case 3:return"#FFC107";case 4:return"#FF9800";case 0:return"#424242";default:return"#666666"}}function Js(t){return t===0?"—":t.toString()}function Vs(t,e,i,n){var j;if(!ye)return;t.save(),t.setTransform(1,0,0,1,0,0);const o=e.filter(H=>H.alive),a=vt(i,n,o.length),{panelX:s,panelY:r,panelWidth:l,panelHeight:c,cellWidth:h,cellHeight:f,headerHeight:d,nameColumnWidth:u,padding:m,fontSize:g,headerFontSize:p,footerHeight:b}=a;t.fillStyle="rgba(0, 0, 0, 0.75)",t.fillRect(0,0,i,n);const v=t.createLinearGradient(s,r,s,r+c);v.addColorStop(0,"#2a2a2a"),v.addColorStop(1,"#1a1a1a"),t.fillStyle=v,t.fillRect(s,r,l,c),t.shadowColor="rgba(100, 150, 200, 0.5)",t.shadowBlur=10,t.strokeStyle="#4a6fa5",t.lineWidth=2,t.strokeRect(s,r,l,c),t.shadowBlur=0,t.fillStyle="#1e3a5f",t.fillRect(s,r,l,d),t.fillStyle="#FFFFFF",t.font=`bold ${Math.round(p*1.3)}px Arial, sans-serif`,t.textAlign="center",t.fillText("Work Priorities",s+l/2,r+d*.6);const M=d*.6,w=s+l-M-m,C=r+(d-M)/2;t.fillStyle="#d32f2f",t.beginPath(),t.roundRect(w,C,M,M,M*.15),t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.strokeStyle="#fff",t.lineWidth=Math.max(2,M*.08),t.beginPath(),t.moveTo(w+M*.25,C+M*.25),t.lineTo(w+M*.75,C+M*.75),t.moveTo(w+M*.75,C+M*.25),t.lineTo(w+M*.25,C+M*.75),t.stroke();const k=s+m,S=r+d+m,P=l-m*2,I=c-d-m*2-b;let B=k+u;t.fillStyle="#2a4a6a",t.fillRect(k,S-ae,P,f),t.fillStyle="#fff",t.font=`bold ${Math.round(p)}px Arial, sans-serif`,t.textAlign="left",t.fillText("Colonist",k+m*.5,S-ae+f*.65),t.font=`bold ${Math.round(g)}px Arial, sans-serif`,t.textAlign="center";for(const H of Se){const q=rt[H];t.fillStyle="#2a4a6a",t.fillRect(B,S-ae,h,f),t.strokeStyle="#1a2a3a",t.lineWidth=1,t.strokeRect(B,S-ae,h,f),t.fillStyle="#e0e0e0",t.font=`bold ${Math.round(g*.95)}px Arial, sans-serif`,t.textAlign="center";const U=q.label.substring(0,Math.min(4,Math.max(3,Math.floor(h/(g*.6)))));t.fillText(U,B+h/2,S-ae+f*.65),B+=h}t.save(),t.beginPath(),t.rect(k,S+f-ae,P,I-f),t.clip();let N=S+f-ae;for(const H of o){const q=o.indexOf(H);t.fillStyle=q%2===0?"#252525":"#2a2a2a",t.fillRect(k,N,P,f),t.fillStyle="#353535",t.fillRect(k,N,u,f),t.strokeStyle="#1a1a1a",t.lineWidth=1,t.strokeRect(k,N,u,f),t.fillStyle="#fff",t.font=`${Math.round(g)}px Arial, sans-serif`,t.textAlign="left";const U=((j=H.profile)==null?void 0:j.name)||"Unknown",K=Math.floor(u/(g*.6)),y=U.length>K?U.substring(0,K-2)+"..":U;t.fillText(y,k+m*.5,N+f*.65);const R=H.hp/100,W=R>.66?"#4caf50":R>.33?"#ffc107":"#f44336",T=Math.max(3,f*.15);t.fillStyle=W,t.beginPath(),t.arc(k+u-T*2,N+f/2,T,0,Math.PI*2),t.fill();let E=k+u;for(const D of Se){const z=H.workPriorities,L=(z==null?void 0:z[D])??3;t.fillStyle=Xs(L),t.fillRect(E,N,h,f),t.strokeStyle="#1a1a1a",t.lineWidth=1,t.strokeRect(E,N,h,f),t.fillStyle=L===0?"#666":"#fff",t.font=`bold ${Math.round(g*1.1)}px Arial, sans-serif`,t.textAlign="center",t.fillText(Js(L),E+h/2,N+f*.65),E+=h}N+=f}t.restore();const O=Math.max(0,(o.length+1)*f-I);if(O>0){const H=Math.max(6,l*.008),q=s+l-m-H,U=S,K=I;t.fillStyle="rgba(255, 255, 255, 0.1)",t.fillRect(q,U,H,K);const y=Math.max(30,I/((o.length+1)*f)*K),R=U+ae/O*(K-y);t.fillStyle="rgba(100, 150, 200, 0.6)",t.fillRect(q,R,H,y)}const X=r+c-b;if(t.fillStyle="#1a1a1a",t.fillRect(s,X,l,b),t.fillStyle="#aaa",t.font=`${Math.round(g*.9)}px Arial, sans-serif`,t.textAlign="center",t.fillText("Click a cell to cycle priority: 1 (highest) → 2 → 3 → 4 (lowest) → disabled → 1",s+l/2,X+b*.35),t.fillText("Press P to close • Scroll with mouse wheel • Hover over column headers for full names",s+l/2,X+b*.75),Fe){const H=rt[Fe];if(H){t.font=`${Math.round(g*1.1)}px Arial, sans-serif`;const q=H.label,U=t.measureText(q).width,K=m*1.5,y=U+K*2,R=f*1.2;let W=lt+10,T=ct-R-5;W+y>s+l&&(W=lt-y-10),T<r&&(T=ct+20),t.fillStyle="rgba(40, 40, 40, 0.95)",t.strokeStyle="#4a6fa5",t.lineWidth=2,t.beginPath(),t.roundRect(W,T,y,R,5),t.fill(),t.stroke(),t.fillStyle="#ffffff",t.font=`bold ${Math.round(g*1.1)}px Arial, sans-serif`,t.textAlign="left",t.fillText(q,W+K,T+R*.65)}}t.restore()}function jt(t,e,i,n,o){var N,O;if(!ye)return!1;const a=i.filter(X=>X.alive),s=vt(n,o,a.length),{panelX:r,panelY:l,panelWidth:c,panelHeight:h,cellWidth:f,cellHeight:d,headerHeight:u,nameColumnWidth:m,padding:g}=s,p=u*.6,b=r+c-p-g,v=l+(u-p)/2;if(t>=b&&t<=b+p&&e>=v&&e<=v+p||t<r||t>r+c||e<l||e>l+h)return Yt(),!0;const M=r+g,w=l+u+g,C=t-M-m,k=e-w-d+ae;if(C<0||k<0)return!0;const S=Math.floor(C/f),P=Math.floor(k/d);if(S<0||S>=Se.length||P<0||P>=a.length)return!0;const I=a[P],B=Se[S];if(I&&B){qs(I,B);const X=((N=I.workPriorities)==null?void 0:N[B])??3;console.log(`${((O=I.profile)==null?void 0:O.name)||"Colonist"} ${B} priority → ${X}`)}return!0}function Zs(t){ye&&(ae+=t*.5,ae=Math.max(0,ae))}function Ks(t,e,i,n,o){if(!ye){Fe=null;return}const a=i.filter(g=>g.alive),s=vt(n,o,a.length),{panelX:r,panelY:l,cellWidth:c,headerHeight:h,nameColumnWidth:f,padding:d}=s,u=r+d,m=l+h+d;if(e>=m-ae&&e<=m-ae+s.cellHeight){const g=t-u-f;if(g>=0){const p=Math.floor(g/c);if(p>=0&&p<Se.length){Fe=Se[p],lt=t,ct=e;return}}}Fe=null}function _s(t){t.debugConsole={open:!1,input:"",history:[],historyIndex:-1,output:[],commands:new Map};const e=(i,n,o)=>{t.debugConsole.commands.set(i,n),o&&(n.help=o)};e("help",(i,n)=>{const o=i.debugConsole;if(n.length){const a=o.commands.get(n[0]);return a&&a.help?a.help:`No help for '${n[0]}'`}return"commands: help, toggle, spawn, speed, pause, give, select, clear, injure, health, resources, kill, heal, godmode"},"help [cmd] — show commands or help for cmd"),e("toggle",(i,n)=>{const o=(n[0]||"").toLowerCase();if(!o)return"usage: toggle <nav|colonists|combat|enemies>";if(o==="nav")i.debug.nav=!i.debug.nav;else if(o==="colonists")i.debug.colonists=!i.debug.colonists;else if(o==="combat")i.debug.combat=!i.debug.combat;else return o==="enemies"?(i.disableEnemySpawns=!i.disableEnemySpawns,`enemy spawns ${i.disableEnemySpawns?"disabled":"enabled"}`):`unknown toggle '${o}'`;return`${o} = ${o==="combat"?i.debug.combat:i.debug[o]}`},"toggle nav|colonists|combat|enemies — flip debug flags or disable enemy spawning"),e("spawn",(i,n)=>{const o=(n[0]||"enemy").toLowerCase(),a=Math.max(1,Math.min(20,parseInt(n[1]||"1",10)||1));if(o==="enemy"){for(let s=0;s<a;s++)i.spawnEnemy();return`spawned ${a} enemy`}if(o==="colonist"){for(let s=0;s<a;s++)i.spawnColonist({x:i.camera.x+100+s*8,y:i.camera.y+100});return`spawned ${a} colonist`}return`unknown spawn '${o}'`},"spawn enemy [n] | spawn colonist [n]"),e("speed",(i,n)=>{const o=parseFloat(n[0]||"");return!isFinite(o)||o<=0?"usage: speed <number> e.g. 1 or 6":(i.fastForward=o,`speed = ${i.fastForward}`)},"speed <n> — set game speed multiplier"),e("pause",i=>(i.paused=!i.paused,`paused = ${i.paused}`),"pause — toggle pause"),e("give",(i,n)=>{const o=(n[0]||"").toLowerCase(),a=(n[1]||"selected").toLowerCase();let s=[];if(a==="all")s=i.colonists.filter(r=>r.alive);else if(a==="selected")s=i.selColonist?[i.selColonist]:[];else{const r=i.colonists.find(l=>{var c,h;return l.alive&&((h=(c=l.profile)==null?void 0:c.name)==null?void 0:h.toLowerCase().includes(a))});r&&(s=[r])}if(!s.length)return a==="selected"?"no colonist selected (use 'select next')":`no colonist found matching '${a}'`;for(const r of s)r.inventory||(r.inventory={items:[],equipment:{},carryCapacity:50,currentWeight:0}),r.inventory.equipment||(r.inventory.equipment={});if(o==="pistol"||o==="weapon"){for(const r of s){const l=te.createItem("Pistol",1,"normal");r.inventory.equipment.weapon=l,i.recalcInventoryWeight(r)}return`gave pistol to ${s.length} colonist(s)`}else if(o==="medicine"||o==="medicinekit"){for(const r of s){const l=te.createItem("MedicineKit",5,"normal");r.inventory.items.push(l),i.recalcInventoryWeight(r)}return`gave 5 medicine kits to ${s.length} colonist(s)`}else if(o==="bandage"||o==="bandages"){for(const r of s){const l=te.createItem("Bandage",10,"normal");r.inventory.items.push(l),i.recalcInventoryWeight(r)}return`gave 10 bandages to ${s.length} colonist(s)`}else if(o==="food"||o==="bread"){for(const r of s){const l=te.createItem("Bread",10,"normal");r.inventory.items.push(l),i.recalcInventoryWeight(r)}return`gave 10 bread to ${s.length} colonist(s)`}else return"usage: give <pistol|medicine|bandage|food> [selected|all|name]"},"give <item> [target] — give items to colonist(s). Items: pistol,medicine,bandage,food. Target: selected,all,name"),e("select",(i,n)=>{var l;if((n[0]||"").toLowerCase()!=="next")return"usage: select next";const a=i.colonists.filter(c=>c.alive);if(!a.length)return"no colonists";const s=Math.max(0,a.indexOf(i.selColonist||a[0])),r=a[(s+1)%a.length];return i.selColonist=r,i.follow=!0,`selected ${((l=r.profile)==null?void 0:l.name)||"colonist"}`},"select next — select next colonist"),e("clear",(i,n)=>{const o=(n[0]||"messages").toLowerCase();return o==="messages"?(i.messages.length=0,"cleared messages"):o==="bullets"?(i.bullets.length=0,"cleared bullets"):"usage: clear messages|bullets"},"clear messages|bullets — clear logs or bullets"),e("injure",(i,n)=>{const o=(n[0]||"bruise").toLowerCase(),a={cut:8,bruise:6,burn:12,bite:10,gunshot:25,fracture:20},s=Math.max(1,Math.min(50,parseInt(n[1]||a[o].toString(),10)||a[o])),r=(n[2]||"selected").toLowerCase(),l=["cut","bruise","burn","bite","gunshot","fracture"];if(!l.includes(o))return`invalid damage type '${o}'. Use: ${l.join(", ")}`;let c=[];if(r==="all")c=i.colonists.filter(h=>h.alive);else if(r==="selected")c=i.selColonist?[i.selColonist]:[];else{const h=i.colonists.find(f=>{var d,u;return f.alive&&((u=(d=f.profile)==null?void 0:d.name)==null?void 0:u.toLowerCase().includes(r))});h&&(c=[h])}if(!c.length)return r==="selected"?"no colonist selected (use 'select next')":`no colonist found matching '${r}'`;for(const h of c)if(typeof i.applyDamageToColonist=="function")i.applyDamageToColonist(h,s,o);else return"damage system not available";return`applied ${s} ${o} damage to ${c.length} colonist(s)`},"injure [type] [damage] [target] — injure colonist(s). Types: cut,bruise,burn,bite,gunshot,fracture. Target: selected,all,name"),e("health",(i,n)=>{var r,l;const o=(n[0]||"check").toLowerCase(),a=(n[1]||"selected").toLowerCase();let s=[];if(a==="all")s=i.colonists.filter(c=>c.alive);else if(a==="selected")s=i.selColonist?[i.selColonist]:[];else{const c=i.colonists.find(h=>{var f,d;return h.alive&&((d=(f=h.profile)==null?void 0:f.name)==null?void 0:d.toLowerCase().includes(a))});c&&(s=[c])}if(!s.length)return a==="selected"?"no colonist selected (use 'select next')":`no colonist found matching '${a}'`;if(o==="check"){const c=s[0],h=((r=c.profile)==null?void 0:r.name)||"Unknown";if(!c.health)return`${h}: No health system initialized. Use 'health init' to initialize.`;const f=Math.round((c.health.totalPain||0)*100),d=((l=c.health.injuries)==null?void 0:l.length)||0,u=Math.round((c.health.consciousness||1)*100),m=Math.round((c.health.mobility||1)*100),g=Math.round((c.health.manipulation||1)*100);let p=`${h}: Pain=${f}%, Injuries=${d}, Consciousness=${u}%, Mobility=${m}%, Manipulation=${g}%`;if(d>0){const b=c.health.injuries.slice(0,3).map(v=>`${v.type}(${Math.round(v.severity*100)}%)`).join(", ");p+=` | Injuries: ${b}${d>3?"...":""}`}return p}else if(o==="init"){let c=0;for(const h of s)h.health||(Be(h),c++);return`initialized health system for ${c} colonist(s)`}else return"usage: health check|init [target]. Target: selected,all,name"},"health check|init [target] — check health status or initialize health system"),e("resources",(i,n)=>{const o=(n[0]||"").toLowerCase();if(o==="unlimited"||o==="god"||o==="infinite")return i.resourceSystem.setResource("wood",999999),i.resourceSystem.setResource("stone",999999),i.resourceSystem.setResource("food",999999),i.resourceSystem.setResource("medicine",999999),i.resourceSystem.setResource("herbal",999999),i.resourceSystem.setResource("wheat",999999),i.resourceSystem.setResource("bread",999999),"resources set to unlimited (999999 each)";if(o==="add"){const a=(n[1]||"").toLowerCase(),s=Math.max(1,parseInt(n[2]||"100",10)||100),r=["wood","stone","food","medicine","herbal","wheat","bread"];return r.includes(a)?(i.resourceSystem.setResource(a,i.resourceSystem.getResource(a)+s),`added ${s} ${a}`):`invalid resource type '${a}'. Use: ${r.join(", ")}`}else if(o==="set"){const a=(n[1]||"").toLowerCase(),s=Math.max(0,parseInt(n[2]||"0",10)||0),r=["wood","stone","food","medicine","herbal","wheat","bread"];return r.includes(a)?(i.resourceSystem.setResource(a,s),`set ${a} to ${s}`):`invalid resource type '${a}'. Use: ${r.join(", ")}`}else if(o==="show"||o==="list"||o===""){const a=i.resourceSystem.getResourcesRef();return`Wood:${a.wood} Stone:${a.stone} Food:${a.food} Medicine:${a.medicine} Herbal:${a.herbal} Wheat:${a.wheat} Bread:${a.bread}`}else return"usage: resources [unlimited|add|set|show] [type] [amount]"},"resources [action] — manage resources. Actions: unlimited, add <type> <amt>, set <type> <amt>, show"),e("kill",(i,n)=>{var a,s;const o=(n[0]||"enemies").toLowerCase();if(o==="enemies"||o==="enemy"){const r=i.enemies.length;return i.enemies.length=0,`killed ${r} enemies`}else{if(o==="selected")return i.selColonist?(i.selColonist.alive=!1,i.selColonist.hp=0,`killed ${((a=i.selColonist.profile)==null?void 0:a.name)||"selected colonist"}`):"no colonist selected";if(o==="all"){const r=i.colonists.filter(l=>l.alive).length;for(const l of i.colonists)l.alive=!1,l.hp=0;return`killed ${r} colonists`}else{const r=i.colonists.find(l=>{var c,h;return l.alive&&((h=(c=l.profile)==null?void 0:c.name)==null?void 0:h.toLowerCase().includes(o))});return r?(r.alive=!1,r.hp=0,`killed ${((s=r.profile)==null?void 0:s.name)||o}`):`no colonist found matching '${o}'`}}},"kill [target] — kill entities. Target: enemies,selected,all,name"),e("heal",(i,n)=>{const o=(n[0]||"selected").toLowerCase();let a=[];if(o==="all")a=i.colonists.filter(s=>s.alive);else if(o==="selected")a=i.selColonist?[i.selColonist]:[];else{const s=i.colonists.find(r=>{var l,c;return r.alive&&((c=(l=r.profile)==null?void 0:l.name)==null?void 0:c.toLowerCase().includes(o))});s&&(a=[s])}if(!a.length)return o==="selected"?"no colonist selected (use 'select next')":`no colonist found matching '${o}'`;for(const s of a)s.hp=100,s.health&&s.health.injuries&&(s.health.injuries=[],s.health.totalPain=0,s.health.bleeding=0,s.health.consciousness=1,s.health.mobility=1,s.health.manipulation=1),s.hunger=0,s.fatigue=0;return`fully healed ${a.length} colonist(s)`},"heal [target] — fully heal colonist(s). Target: selected,all,name"),e("godmode",(i,n)=>{const o=(n[0]||"selected").toLowerCase();let a=[];if(o==="all")a=i.colonists.filter(r=>r.alive);else if(o==="selected")a=i.selColonist?[i.selColonist]:[];else{const r=i.colonists.find(l=>{var c,h;return l.alive&&((h=(c=l.profile)==null?void 0:c.name)==null?void 0:h.toLowerCase().includes(o))});r&&(a=[r])}if(!a.length)return o==="selected"?"no colonist selected (use 'select next')":`no colonist found matching '${o}'`;for(const r of a)r.godmode=!r.godmode,r.godmode&&(r.hp=100,r.hunger=0,r.fatigue=0);return`godmode ${a[0].godmode?"enabled":"disabled"} for ${a.length} colonist(s)`},"godmode [target] — toggle godmode (no damage/hunger/fatigue). Target: selected,all,name")}function $s(t){const e=t.debugConsole;e&&(e.open=!e.open)}function er(t,e){const i=t.debugConsole;if(!i||!i.open)return!1;if(e.key==="Escape")return i.open=!1,!0;if(e.key==="Enter"){const n=i.input.trim();return n.length&&(i.history.unshift(n),i.historyIndex=-1,tr(t,n),i.input=""),!0}return e.key==="Backspace"?(i.input=i.input.slice(0,-1),!0):e.key==="ArrowUp"?(i.history.length&&(i.historyIndex=Math.min(i.historyIndex+1,i.history.length-1),i.input=i.history[i.historyIndex]),!0):e.key==="ArrowDown"?(i.historyIndex>0?(i.historyIndex-=1,i.input=i.history[i.historyIndex]):(i.historyIndex=-1,i.input=""),!0):e.key.length===1&&!e.ctrlKey&&!e.metaKey?(i.input+=e.key,!0):!1}function tr(t,e){const i=t.debugConsole,[n,...o]=e.split(/\s+/),a=i.commands.get(n.toLowerCase());if(!a){i.output.push(`unknown command: ${n}`),Ut(i);return}try{const s=a(t,o);s&&i.output.push(s)}catch(s){i.output.push(`error: ${(s==null?void 0:s.message)||s}`)}Ut(i)}function Ut(t){t.output.length>10&&t.output.splice(0,t.output.length-10)}function ir(t){const e=t.debugConsole;if(!e||!e.open)return;const i=t.ctx,n=10,o=t.canvas.width,a=t.canvas.height,r=t.scale(t.isTouch?86:64)+8,l=Math.min(220,Math.max(140,Math.round(a*.25)));i.save(),i.resetTransform(),i.globalAlpha=.92,i.fillStyle="#0b1220cc";const c=a-r-l;i.fillRect(0,c,o,l),i.globalAlpha=1,i.strokeStyle="#ffffffff",i.lineWidth=1,i.strokeRect(.5,c+.5,o-1,l-1),i.globalAlpha=1,i.fillStyle="#c7d2fe";const h=t.isTouch?17:15;i.font=`${h}px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace`,i.textAlign="left",i.textBaseline="alphabetic";let f=c+n+4;for(const g of e.output)i.fillText(g,n,f),f+=h+5;const d=`> ${e.input}`;i.fillStyle="#e5e7eb";const u=a-r-n;if(i.fillText(d,n,u),performance.now()%1e3<600){const g=i.measureText(d),p=g.width,b=g.actualBoundingBoxAscent||h*.9,v=g.actualBoundingBoxDescent||h*.2,M=n+p+2;i.strokeStyle="#e5e7eb",i.lineWidth=1,i.beginPath(),i.moveTo(M,u-b),i.lineTo(M,u+v),i.stroke()}i.restore()}class nr{constructor(){x(this,"colonists",[]);x(this,"enemies",[]);x(this,"buildings",[]);x(this,"trees",[]);x(this,"rocks",[]);x(this,"bullets",[]);x(this,"particles",[]);x(this,"resources",{wood:0,stone:0,food:0,medicine:5,herbal:3});x(this,"BASE_STORAGE",200);x(this,"storageFullWarned",!1);x(this,"day",1);x(this,"tDay",0);x(this,"dayLength",180);x(this,"fastForward",1);x(this,"paused",!1);x(this,"prevIsNight",!1);x(this,"messages",[]);x(this,"selectedBuild","house");x(this,"selColonist",null);x(this,"hotbar",["house","farm","turret","wall","stock","tent","warehouse","well","infirmary"]);x(this,"respawnTimer",0);x(this,"assignedTargets",new WeakSet);x(this,"buildReservations",new Map);x(this,"insideCounts",new Map);x(this,"sleepReservations",new Map)}isNight(){return this.tDay>.5}reset(){this.colonists=[],this.enemies=[],this.buildings=[],this.trees=[],this.rocks=[],this.bullets=[],this.particles=[],this.resources={wood:50,stone:30,food:20,medicine:5,herbal:3},this.storageFullWarned=!1,this.day=1,this.tDay=0,this.fastForward=1,this.paused=!1,this.prevIsNight=!1,this.messages=[],this.selectedBuild="house",this.selColonist=null,this.respawnTimer=0,this.assignedTargets=new WeakSet,this.buildReservations=new Map,this.insideCounts=new Map,this.sleepReservations=new Map}}class or{constructor(){x(this,"day",1);x(this,"tDay",0);x(this,"dayLength",180);x(this,"fastForward",1);x(this,"paused",!1);x(this,"prevIsNight",!1)}update(e){if(this.paused)return;const i=e*this.fastForward;this.tDay+=i/this.dayLength,this.tDay>=1&&(this.tDay-=1,this.day++)}isNight(){return this.tDay>.5}didNightJustStart(){const e=this.isNight(),i=e&&!this.prevIsNight;return this.prevIsNight=e,i}toggleFastForward(){this.fastForward=this.fastForward===1?6:1}togglePause(){this.paused=!this.paused}setPaused(e){this.paused=e}getEffectiveDt(e){return this.paused?0:e*this.fastForward}getDay(){return this.day}getTimeOfDay(){return this.tDay}getDayLength(){return this.dayLength}getFastForward(){return this.fastForward}isPaused(){return this.paused}setDay(e){this.day=e}setTimeOfDay(e){this.tDay=e}setFastForward(e){this.fastForward=e}reset(){this.day=1,this.tDay=0,this.fastForward=1,this.paused=!1,this.prevIsNight=!1}getCurrentHour(){return Math.floor(this.tDay*24)}}class sr{constructor(){x(this,"camera",{x:0,y:0,zoom:1});x(this,"canvasWidth",0);x(this,"canvasHeight",0);x(this,"DPR",1);x(this,"minZoom",.5);x(this,"maxZoom",2.5);x(this,"panSpeed",500)}setCanvasDimensions(e,i,n){this.canvasWidth=e,this.canvasHeight=i,this.DPR=n}pan(e,i){this.camera.x+=e*this.DPR/this.camera.zoom,this.camera.y+=i*this.DPR/this.camera.zoom}panWithSpeed(e,i,n){const o=this.panSpeed*n/this.camera.zoom;this.camera.x+=e*o,this.camera.y+=i*o}setPosition(e,i){this.camera.x=e,this.camera.y=i}centerOn(e,i){const n=this.canvasWidth/this.DPR/this.camera.zoom,o=this.canvasHeight/this.DPR/this.camera.zoom;this.camera.x=e-n/2,this.camera.y=i-o/2}zoom(e){const i=this.camera.zoom;if(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom+e)),i!==this.camera.zoom){const n=this.camera.x+this.canvasWidth/this.DPR/(2*i),o=this.camera.y+this.canvasHeight/this.DPR/(2*i);this.camera.x=n-this.canvasWidth/this.DPR/(2*this.camera.zoom),this.camera.y=o-this.canvasHeight/this.DPR/(2*this.camera.zoom)}}setZoom(e){this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,e))}screenToWorld(e,i){return{x:e*this.DPR/this.camera.zoom+this.camera.x,y:i*this.DPR/this.camera.zoom+this.camera.y}}worldToScreen(e,i){return{x:(e-this.camera.x)*this.camera.zoom/this.DPR,y:(i-this.camera.y)*this.camera.zoom/this.DPR}}isVisible(e,i,n,o){const a=this.canvasWidth/this.DPR/this.camera.zoom,s=this.canvasHeight/this.DPR/this.camera.zoom;return!(e+n<this.camera.x||e>this.camera.x+a||i+o<this.camera.y||i>this.camera.y+s)}getCamera(){return{...this.camera}}getX(){return this.camera.x}getY(){return this.camera.y}getZoom(){return this.camera.zoom}getCameraRef(){return this.camera}reset(){this.camera.x=0,this.camera.y=0,this.camera.zoom=1}}class rr{constructor(){x(this,"resources",{wood:0,stone:0,food:0,medicine:5,herbal:3,wheat:0,bread:0});x(this,"baseStorage",200);x(this,"storageFullWarned",!1)}getStorageCapacity(e=0,i=0){return this.baseStorage+e*500+i*100}getTotalStored(){return this.resources.wood+this.resources.stone+this.resources.food}isStorageFull(e){return this.getTotalStored()>=e}addResource(e,i,n){if(e==="medicine"||e==="herbal"||e==="wheat"||e==="bread")return this.resources[e]+=i,i;const o=this.getTotalStored(),a=Math.max(0,n-o),s=Math.min(i,a);return s>0&&(this.resources[e]+=s),s<i&&!this.storageFullWarned?(this.storageFullWarned=!0,s):(s===i&&(this.storageFullWarned=!1),s)}subtractResource(e,i){return this.resources[e]>=i?(this.resources[e]-=i,!0):!1}hasCost(e){return!(e.wood&&this.resources.wood<e.wood||e.stone&&this.resources.stone<e.stone||e.food&&this.resources.food<e.food||e.medicine&&this.resources.medicine<e.medicine||e.herbal&&this.resources.herbal<e.herbal||e.wheat&&this.resources.wheat<e.wheat||e.bread&&this.resources.bread<e.bread)}payCost(e){return this.hasCost(e)?(e.wood&&(this.resources.wood-=e.wood),e.stone&&(this.resources.stone-=e.stone),e.food&&(this.resources.food-=e.food),e.medicine&&(this.resources.medicine-=e.medicine),e.herbal&&(this.resources.herbal-=e.herbal),e.wheat&&(this.resources.wheat-=e.wheat),e.bread&&(this.resources.bread-=e.bread),!0):!1}getResource(e){return this.resources[e]}getAllResources(){return{...this.resources}}getResourcesRef(){return this.resources}setResource(e,i){this.resources[e]=Math.max(0,i)}reset(){this.resources={wood:50,stone:30,food:20,medicine:5,herbal:3,wheat:0,bread:0},this.storageFullWarned=!1}formatCost(e){const i=[];return e.wood&&i.push(`${e.wood}w`),e.stone&&i.push(`${e.stone}s`),e.food&&i.push(`${e.food}f`),e.medicine&&i.push(`${e.medicine}m`),e.herbal&&i.push(`${e.herbal}h`),e.wheat&&i.push(`${e.wheat}wh`),e.bread&&i.push(`${e.bread}br`),i.join(" ")}}class ar{constructor(){x(this,"mouse",{x:0,y:0,wx:0,wy:0,down:!1,rdown:!1});x(this,"keyState",{});x(this,"once",new Set);x(this,"touchLastPan",null);x(this,"touchLastDist",null);x(this,"lastInputWasTouch",!1);x(this,"inputFilter")}bindKeyboardEvents(e){this.inputFilter=e,window.addEventListener("keydown",i=>{if(this.inputFilter&&this.inputFilter())return;const n=i.key.toLowerCase();this.setKeyState(n,!0),(n===" "||n==="h"||n==="b"||n==="f"||n==="g"||n==="j"||n==="k"||n==="p"||n==="r"||n==="t"||n==="escape"||/^[1-9]$/.test(n)||n==="w"||n==="a"||n==="s"||n==="d"||n==="+"||n==="="||n==="-"||n==="_")&&i.preventDefault()}),window.addEventListener("keyup",i=>{if(this.inputFilter&&this.inputFilter())return;const n=i.key.toLowerCase();this.setKeyState(n,!1)})}updateMouseWorldCoords(e){const i=e(this.mouse.x,this.mouse.y);this.mouse.wx=i.x,this.mouse.wy=i.y}setMousePosition(e,i){this.mouse.x=e,this.mouse.y=i}setMouseDown(e){this.mouse.down=e}setMouseRightDown(e){this.mouse.rdown=e}getMouse(){return this.mouse}getMouseRef(){return this.mouse}setKeyState(e,i){this.keyState[e]=i,i||this.once.delete(e)}isKeyPressed(e){return!!this.keyState[e]}keyPressed(e){return this.keyState[e]&&!this.once.has(e)?(this.once.add(e),!0):!1}getKeyStateRef(){return this.keyState}setTouchPan(e){this.touchLastPan=e}getTouchPan(){return this.touchLastPan}setTouchDist(e){this.touchLastDist=e}getTouchDist(){return this.touchLastDist}setLastInputWasTouch(e){this.lastInputWasTouch=e}wasLastInputTouch(){return this.lastInputWasTouch}reset(){this.mouse={x:0,y:0,wx:0,wy:0,down:!1,rdown:!1},this.keyState={},this.once=new Set,this.touchLastPan=null,this.touchLastDist=null,this.lastInputWasTouch=!1}}class lr{constructor(){x(this,"selectedBuild","house");x(this,"hotbar",["house","farm","turret","wall","stock","tent","warehouse","well","infirmary"]);x(this,"showBuildMenu",!1);x(this,"selColonist",null);x(this,"follow",!1);x(this,"pendingPlacement",null);x(this,"pendingDragging",!1);x(this,"menuRects",[]);x(this,"hotbarRects",[]);x(this,"placeUIRects",[]);x(this,"colonistPanelRect",null);x(this,"colonistPanelCloseRect",null);x(this,"colonistProfileTab","bio");x(this,"colonistTabRects",[]);x(this,"contextMenu",null);x(this,"contextMenuRects",[]);x(this,"longPressTimer",null);x(this,"longPressStartPos",null);x(this,"longPressStartTime",null);x(this,"longPressTarget",null);x(this,"longPressTargetType",null);x(this,"lastPaintCell",null);x(this,"eraseDragStart",null)}selectBuilding(e){this.selectedBuild=e}toggleBuildMenu(){this.showBuildMenu=!this.showBuildMenu}openBuildMenu(){this.showBuildMenu=!0}closeBuildMenu(){this.showBuildMenu=!1}selectColonist(e){this.selColonist=e}deselectColonist(){this.selColonist=null,this.follow=!1}toggleFollow(){this.selColonist&&(this.follow=!this.follow)}setPendingPlacement(e){this.pendingPlacement=e,this.pendingDragging=!1}cancelPendingPlacement(){this.pendingPlacement=null,this.pendingDragging=!1}startLongPress(e,i,n,o){this.longPressStartPos={x:e,y:i},this.longPressStartTime=Date.now(),this.longPressTarget=n,this.longPressTargetType=o,this.longPressTimer=window.setTimeout(()=>{},500)}cancelLongPress(){this.longPressTimer!==null&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.longPressStartPos=null,this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null}isLongPressing(){return this.longPressTimer!==null}hideContextMenu(){this.contextMenu=null,this.contextMenuRects=[]}showContextMenu(e,i,n){this.contextMenu={...e,visible:!0,x:i,y:n}}reset(){this.selectedBuild="house",this.showBuildMenu=!1,this.selColonist=null,this.follow=!1,this.pendingPlacement=null,this.pendingDragging=!1,this.menuRects=[],this.hotbarRects=[],this.placeUIRects=[],this.colonistPanelRect=null,this.colonistPanelCloseRect=null,this.colonistProfileTab="bio",this.colonistTabRects=[],this.contextMenu=null,this.contextMenuRects=[],this.cancelLongPress(),this.lastPaintCell=null,this.eraseDragStart=null}}function cr(t,e){t.setTransform(1,0,0,1,0,0),t.fillStyle=_.sky,t.fillRect(0,0,e.width,e.height)}function dr(t,e){t.translate(-e.x*e.zoom,-e.y*e.zoom),t.scale(e.zoom,e.zoom)}function hr(t){t.save(),t.fillStyle=_.ground,t.fillRect(0,0,Q.w,Q.h);const e=t.getTransform?t.getTransform():null,i=e?Math.max(.001,e.a):1;t.lineWidth=Math.max(1/i,.75/i),t.strokeStyle="#1e293b",t.globalAlpha=.5,t.beginPath();for(let n=0;n<=Q.w;n+=A)t.moveTo(n,0),t.lineTo(n,Q.h);for(let n=0;n<=Q.h;n+=A)t.moveTo(0,n),t.lineTo(Q.w,n);t.stroke(),t.globalAlpha=1,t.restore()}function fr(t,e,i){if(!e)return;t.save();const n=Math.max(0,Math.floor(i.x/A)),o=Math.max(0,Math.floor(i.y/A)),a=Math.min(e.cols,Math.ceil((i.x+t.canvas.width/i.zoom)/A)+1),s=Math.min(e.rows,Math.ceil((i.y+t.canvas.height/i.zoom)/A)+1);for(let r=o;r<s;r++)for(let l=n;l<a;l++){const c=r*e.cols+l,h=Ne(e.floors[c]);if(h===$.NONE)continue;const f=li[h];if(!f)continue;const d=l*A,u=r*A;t.fillStyle=f.color,t.fillRect(d,u,A,A),f.pattern==="stripes"&&f.secondaryColor?(t.fillStyle=f.secondaryColor,t.fillRect(d,u,A,A/4),t.fillRect(d,u+A/2,A,A/4)):f.pattern==="noise"&&f.secondaryColor&&(t.fillStyle=f.secondaryColor,(l+r)%2===0&&t.fillRect(d+A/4,u+A/4,A/2,A/2)),t.strokeStyle="rgba(0, 0, 0, 0.1)",t.lineWidth=1,t.strokeRect(d,u,A,A)}t.restore()}function Qt(t,e,i,n,o){t.fillStyle=o,t.beginPath(),t.arc(e,i,n,0,Math.PI*2),t.fill()}function ur(t,e,i,n,o,a,s=0){t.fillStyle=a,t.beginPath();for(let r=0;r<o;r++){const l=s+r*2*Math.PI/o,c=e+Math.cos(l)*n,h=i+Math.sin(l)*n;r===0?t.moveTo(c,h):t.lineTo(c,h)}t.closePath(),t.fill()}function qt(t,e,i,n=10,o=_.colonist){t.save(),t.translate(e,i);const a="#0b0f14",s=n*.32,r=-n*.3;t.fillStyle=o,t.beginPath(),t.arc(0,r,s,0,Math.PI*2),t.fill(),t.strokeStyle=a,t.lineWidth=1,t.beginPath(),t.arc(0,r,s+.5,0,Math.PI*2),t.stroke();const l=n*.55,c=n*.55,h=-n*.05;t.fillStyle=o,t.beginPath(),t.moveTo(-l/2,h-c/2),t.lineTo(l/2,h-c/2),t.lineTo(l/2,h+c/2),t.lineTo(-l/2,h+c/2),t.closePath(),t.fill(),t.strokeStyle=a,t.stroke();const f=n*.18,d=n*.5,u=h+c/2+d*.1;t.fillStyle=o,t.fillRect(-f-.6,u-d,f,d),t.fillRect(.6,u-d,f,d),t.strokeStyle=a,t.strokeRect(-f-.6,u-d,f,d),t.strokeRect(.6,u-d,f,d),t.restore()}function xi(t,e,i,n,o=8,a=!1){const s=n.profile;if(!s){t.fillStyle=a?"#93c5fd":_.colonist,t.beginPath(),t.arc(e,i,o,0,Math.PI*2),t.fill();return}t.save(),t.translate(e,i);let r="south";if(n.direction!==void 0){const C=(n.direction*180/Math.PI+360)%360;C>=315||C<45?r="east":C>=45&&C<135?r="south":C>=135&&C<225?r="east":r="north"}const l=n.direction!==void 0&&(n.direction*180/Math.PI+360)%360>=135&&(n.direction*180/Math.PI+360)%360<225;l&&t.scale(-1,1);const c=32,h=48;a&&(t.fillStyle="#93c5fd",t.globalAlpha=.3,t.beginPath(),t.arc(0,0,o+2,0,Math.PI*2),t.fill(),t.globalAlpha=1);const f=fe.getInstance();if(!f||!f.isLoaded()){console.log("Assets not loaded, using fallback circles for colonist:",(s==null?void 0:s.name)||"unknown"),t.fillStyle=s.avatar.clothing,t.beginPath(),t.arc(0,0,o,0,Math.PI*2),t.fill(),t.restore();return}const d=s.avatar.sprites,u=(w,C)=>{const k=document.createElement("canvas");k.width=c,k.height=h;const S=k.getContext("2d");S.drawImage(w,0,0,c,h);const P=S.getImageData(0,0,c,h),I=P.data,B=C.replace("#",""),N=parseInt(B.substr(0,2),16),O=parseInt(B.substr(2,2),16),X=parseInt(B.substr(4,2),16);for(let j=0;j<I.length;j+=4)if(I[j+3]>0){const H=(I[j]+I[j+1]+I[j+2])/765;I[j]=N*H,I[j+1]=O*H,I[j+2]=X*H}return S.putImageData(P,0,0),k},m=f.getColonistSprite("body",d.bodyType,r);if(m){const w=u(m,s.avatar.skinTone);t.drawImage(w,-c/2,-28.799999999999997)}const g=f.getColonistSprite("apparel",d.apparelType,r);if(g){const w=u(g,s.avatar.clothing);t.drawImage(w,-c/2,-28.799999999999997)}const p=f.getColonistSprite("head",d.headType,r);if(p){const w=u(p,s.avatar.skinTone);t.drawImage(w,-c/2,-28.799999999999997)}const b=f.getColonistSprite("hair",d.hairStyle,r);if(b){const w=u(b,s.avatar.hairColor);t.drawImage(w,-c/2,-28.799999999999997)}t.save(),l&&t.scale(-1,1);const v=zt&&zt(n)||"Okay";let M="#22c55e";switch(v){case"Happy":M="#22c55e";break;case"Content":M="#84cc16";break;case"Okay":M="#eab308";break;case"Injured":M="#ef4444";break;case"Starving":M="#dc2626";break;case"Exhausted":M="#6b7280";break;case"Terrified":M="#7c2d12";break;case"Resting":M="#3b82f6";break;default:M="#eab308";break}t.fillStyle=M,t.beginPath(),t.arc(0,-28.799999999999997+h*.1,3,0,Math.PI*2),t.fill(),t.strokeStyle="#000000",t.lineWidth=.5,t.stroke(),n.carryingWheat&&n.carryingWheat>0?(t.font="bold 12px system-ui",t.fillText("🌾",0,-28.799999999999997-5)):n.carryingBread&&n.carryingBread>0&&(t.font="bold 12px system-ui",t.fillText("🍞",0,-28.799999999999997-5)),t.restore(),t.restore()}function Ar(t,e){if(e.kind==="path"){t.fillStyle="#1f2937",t.fillRect(e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1);return}if(e.kind==="door"){const i=Rn(e);if(t.save(),t.translate(e.x+e.w/2,e.y+e.h/2),t.fillStyle="#4a3520",t.fillRect(-e.w/2,-e.h/2,e.w,3),t.fillRect(-e.w/2,e.h/2-3,e.w,3),t.fillRect(-e.w/2,-e.h/2,3,e.h),t.fillRect(e.w/2-3,-e.h/2,3,e.h),i<1){const n=-i*(e.w/2-4),o=i*(e.w/2-4);t.fillStyle=e.color,t.fillRect(-e.w/2+3+n,-e.h/2+3,e.w/2-6,e.h-6),t.strokeStyle="#2a1a10",t.strokeRect(-e.w/2+3+n,-e.h/2+3,e.w/2-6,e.h-6),t.fillStyle=e.color,t.fillRect(3-o,-e.h/2+3,e.w/2-6,e.h-6),t.strokeStyle="#2a1a10",t.strokeRect(3-o,-e.h/2+3,e.w/2-6,e.h-6),t.strokeStyle="#3a2510",t.lineWidth=1;for(let a=1;a<3;a++){const s=-e.w/2+3+n+(e.w/2-6)*a/3,r=3-o+(e.w/2-6)*a/3;t.beginPath(),t.moveTo(s,-e.h/2+6),t.lineTo(s,e.h/2-6),t.stroke(),t.beginPath(),t.moveTo(r,-e.h/2+6),t.lineTo(r,e.h/2-6),t.stroke()}}if(t.restore(),!e.done){t.fillStyle="#0b1220",t.fillRect(e.x,e.y-6,e.w,4),t.fillStyle="#6ee7ff";const n=1-e.buildLeft/e.build;t.fillRect(e.x,e.y-6,n*e.w,4)}if(e.done&&e.hp<100){const o=e.hp/100;t.fillStyle="#0b1220",t.fillRect(e.x,e.y+e.h+2,e.w,3),t.fillStyle=o>.5?"#4ade80":o>.25?"#fbbf24":"#ef4444",t.fillRect(e.x,e.y+e.h+2,e.w*o,3)}return}if(e.kind==="house"){const i=fe.getInstance(),n=i.getImage("house");n&&i.isLoaded()?(t.drawImage(n,e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1)):(t.fillStyle=e.color,t.fillRect(e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1))}else if(e.kind==="farm"&&e.done){const i=fe.getInstance(),n=e.growth||0;let o="wheat_stage_1";n>=.67?o="wheat_stage_3":n>=.33&&(o="wheat_stage_2");const a=i.getImage(o);a&&i.isLoaded()?(t.drawImage(a,e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1)):(t.fillStyle=e.color,t.fillRect(e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1),n>0&&(t.fillStyle="#4ade80",t.fillRect(e.x+2,e.y+e.h-4,(e.w-4)*Math.min(n,1),2)))}else t.fillStyle=e.color,t.fillRect(e.x,e.y,e.w,e.h),t.strokeStyle="#0b0f14cc",t.strokeRect(e.x+.5,e.y+.5,e.w-1,e.h-1),e.kind==="turret"&&e.flashTimer>0&&(t.fillStyle="#ffffff88",t.fillRect(e.x,e.y,e.w,e.h));if(!e.done){t.fillStyle="#0b1220",t.fillRect(e.x,e.y-6,e.w,4),t.fillStyle="#6ee7ff";const i=1-e.buildLeft/e.build;t.fillRect(e.x,e.y-6,i*e.w,4)}if(e.kind!=="house"&&!(e.kind==="farm"&&e.done)){t.fillStyle="#0b0f14aa",t.font="bold 12px system-ui";const i=e.x+e.w/2,n=e.y+e.h/2;let o="B";e.kind==="hq"?o="HQ":e.kind==="farm"?o="F":e.kind==="turret"?o="T":e.kind==="wall"?o="W":e.kind==="stock"?o="S":e.kind==="tent"?o="R":e.kind==="warehouse"?o="WH":e.kind==="well"?o="WL":e.kind==="infirmary"?o="I":e.kind==="bed"?o=e.isMedicalBed?"⚕️":"🛏":e.kind==="stove"?o="🔥":e.kind==="pantry"&&(o="🍞"),t.textAlign="center",t.textBaseline="middle",t.fillText(o,i,n)}if(e.kind==="stove"&&e.done&&e.cookingProgress!==void 0&&e.cookingProgress>0&&(t.fillStyle="#0b1220",t.fillRect(e.x,e.y+e.h+2,e.w,4),t.fillStyle="#ff6347",t.fillRect(e.x,e.y+e.h+2,e.w*e.cookingProgress,4)),e.kind==="turret"&&e.range){const i=e.x+e.w/2,n=e.y+e.h/2;t.globalAlpha=.07,t.fillStyle="#e2f3ff",t.beginPath(),t.arc(i,n,e.range,0,Math.PI*2),t.fill(),t.globalAlpha=1}}function gr(t,e){for(const i of e)i.particles&&i.particles.length>0&&vi(t,i.particles),t.globalAlpha=.15,t.strokeStyle="#e0f2fe",t.lineWidth=1,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(i.tx,i.ty),t.stroke(),t.globalAlpha=1}function pr(t,e,i,n){n.uiScale;const o=n.scale(n.isTouch?14:10),a=n.scale(n.isTouch?56:44),s=e.width;t.fillStyle="#0b122088",t.fillRect(0,0,s,a),t.strokeStyle="#1e293b",t.lineWidth=1,t.strokeRect(0,.5,s,a),t.fillStyle="#dbeafe",t.font=n.getScaledFont(n.isTouch?18:16,"600");let r=o;const l=Math.max(n.scale(n.isTouch?170:130),Math.min(n.scale(n.isTouch?260:220),Math.round(e.width*.14)));if(ue(t,r,n.scale(12),`Wood: ${Math.floor(i.res.wood)}`,"#b08968",n),r+=l,ue(t,r,n.scale(12),`Stone: ${Math.floor(i.res.stone)}`,"#9aa5b1",n),r+=l,ue(t,r,n.scale(12),`Food: ${Math.floor(i.res.food)}`,"#9ae6b4",n),r+=l,(i.res.wheat||0)>0&&(ue(t,r,n.scale(12),`Wheat: ${Math.floor(i.res.wheat||0)}`,"#f4d03f",n),r+=l),(i.res.bread||0)>0&&(ue(t,r,n.scale(12),`Bread: ${Math.floor(i.res.bread||0)}`,"#d2691e",n),r+=l),i.storage){const p=Math.floor(i.storage.used/i.storage.max*100),b=p>90?"#ef4444":p>70?"#eab308":"#22c55e";ue(t,r,n.scale(12),`Storage: ${Math.floor(i.storage.used)}/${i.storage.max} (${p}%)`,b,n),r+=Math.max(l,n.scale(n.isTouch?260:200))}const c=`Colonists: ${i.colonists}/${i.cap}`;ue(t,r,n.scale(12),c,"#93c5fd",n),r+=Math.max(l,n.scale(n.isTouch?260:210));const h=`Hiding: ${i.hiding}`;ue(t,r,n.scale(12),h,"#60a5fa",n),r+=Math.max(n.scale(n.isTouch?180:140),l*.9|0);const f=`Day ${i.day} — ${i.tDay*24|0}:00 ${i.isNight?"🌙":"☀️"}`;ue(t,r,n.scale(12),f,i.isNight?"#ffd166":"#6ee7ff",n);const d=e.height-n.scale(n.isTouch?86:64),u=Math.max(n.scale(n.isTouch?170:140),Math.min(n.scale(n.isTouch?260:220),(e.width-o*2)/i.hotbar.length));r=o,t.fillStyle="#0b122088",t.fillRect(0,d,e.width,n.scale(n.isTouch?86:64)),t.strokeStyle="#1e293b",t.strokeRect(0,d+.5,e.width,n.scale(n.isTouch?86:64)),t.font=n.getScaledFont(n.isTouch?17:15);for(let p=0;p<i.hotbar.length;p++){const b=i.hotbar[p],v=r+n.scale(2),M=d+n.scale(n.isTouch?14:10),w=u-n.scale(6),C=n.scale(n.isTouch?60:44);yr(t,v,M,w,C,`${p+1}. ${b.name}`,b.cost,b.selected,n),Array.isArray(n.hotbarRects)&&(n.hotbarRects[p]={index:p,x:v,y:M,w,h:C}),r+=u}let m=a+n.scale(n.isTouch?12:8);const g=Math.min(n.scale(n.isTouch?520:420),e.width-o*2);for(let p=i.messages.length-1;p>=0;p--){const b=i.messages[p];mr(t,s-g-o,m,b.text,g,n),m+=n.scale(n.isTouch?34:26)}}function ue(t,e,i,n,o,a){const s=t.measureText(n).width+a.scale(a.isTouch?28:24),r=a.scale(a.isTouch?32:26);t.fillStyle="#0f172a",t.fillRect(e,i,s,r),t.strokeStyle="#1e293b",t.strokeRect(e+.5,i+.5,s-1,r-1),t.fillStyle=o,t.fillRect(e+a.scale(3),i+a.scale(3),a.scale(a.isTouch?10:8),r-a.scale(6)),t.fillStyle="#dbeafe",t.fillText(n,e+a.scale(a.isTouch?18:16),i+a.scale(a.isTouch?22:18))}function yr(t,e,i,n,o,a,s,r,l){t.fillStyle=r?"#102034":"#0f172a",t.fillRect(e,i,n,o),t.strokeStyle=r?"#4b9fff":"#1e293b",t.strokeRect(e+.5,i+.5,n-1,o-1),t.fillStyle="#dbeafe",t.fillText(a,e+l.scale(10),i+l.scale(l.isTouch?36:28)),t.fillStyle="#9fb3c8",t.fillText(s,e+n-l.scale(l.isTouch?66:56),i+l.scale(l.isTouch?36:28))}function mr(t,e,i,n,o,a){const s=a.scale(a.isTouch?30:24);t.fillStyle="#0f172aee",t.fillRect(e,i,o,s),t.strokeStyle="#1e293b",t.strokeRect(e+.5,i+.5,o-1,s-1),t.fillStyle="#dbeafe",t.fillText(n,e+a.scale(10),i+a.scale(a.isTouch?20:16))}function br(t){if(!t.regionManager.isEnabled()){t.ctx.fillStyle="rgba(255, 0, 0, 0.8)",t.ctx.font="20px monospace",t.ctx.fillText("Regions Disabled",20,100);return}const e=t.ctx,i=t.regionManager.getRegions();t.regionManager.getRooms();const n=t.regionManager.builder.getRegionGrid();e.globalAlpha=.2;for(const a of i.values()){const s=a.id*137%360;e.fillStyle=`hsl(${s}, 70%, 50%)`;for(const r of a.cells){const l=r%n.cols*A,c=Math.floor(r/n.cols)*A;e.fillRect(l,c,A,A)}}e.globalAlpha=1,e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=1;for(const a of i.values())for(const s of a.cells){const r=s%n.cols,l=Math.floor(s/n.cols),c=r*A,h=l*A,f=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:d,dy:u}of f){const m=r+d,g=l+u;if(m<0||g<0||m>=n.cols||g>=n.rows){e.strokeRect(c,h,A,A);continue}if(n.get(m,g)!==a.id){if(e.beginPath(),d===0){const b=h+(u>0?A:0);e.moveTo(c,b),e.lineTo(c+A,b)}else{const b=c+(d>0?A:0);e.moveTo(b,h),e.lineTo(b,h+A)}e.stroke()}}}e.strokeStyle="rgba(0, 255, 0, 0.8)",e.lineWidth=2;for(const a of i.values())for(const s of a.links){const r=s.x*A,l=s.y*A;e.beginPath(),s.edge===0?(e.moveTo(r,l),e.lineTo(r+s.span*A,l)):s.edge===1?(e.moveTo(r+A,l),e.lineTo(r+A,l+s.span*A)):s.edge===2?(e.moveTo(r,l+A),e.lineTo(r+s.span*A,l+A)):(e.moveTo(r,l),e.lineTo(r,l+s.span*A)),e.stroke()}e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";for(const a of i.values()){let s=0,r=0;for(const h of a.cells){const f=h%n.cols,d=Math.floor(h/n.cols);s+=f*A+A/2,r+=d*A+A/2}const l=s/a.cells.size,c=r/a.cells.size;e.fillText(`R${a.id}`,l,c-6),a.roomId!==null&&e.fillText(`Room${a.roomId}`,l,c+6)}e.textAlign="left",e.textBaseline="top",e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(10,10,300,100),e.fillStyle="white",e.font="14px monospace";const o=t.regionManager.getStats();e.fillText(`Regions: ${o.regionCount}`,20,20),e.fillText(`Rooms: ${o.roomCount}`,20,40),e.fillText(`Avg Region Size: ${o.avgRegionSize.toFixed(1)} cells`,20,60),e.fillText(`Avg Room Size: ${o.avgRoomSize.toFixed(1)} regions`,20,80)}function wr(t){const{ctx:e,camera:i,terrainGrid:n}=t;e.save();const o=Math.max(0,Math.floor(i.x/A)),a=Math.max(0,Math.floor(i.y/A)),s=Math.min(n.cols,Math.ceil((i.x+e.canvas.width/i.zoom)/A)),r=Math.min(n.rows,Math.ceil((i.y+e.canvas.height/i.zoom)/A));for(let l=a;l<r;l++)for(let c=o;c<s;c++){const h=l*n.cols+c,f=Ne(n.floors[h]);if(f===$.NONE)continue;const d=li[f];if(!d)continue;e.fillStyle=d.color,e.globalAlpha=.6,e.fillRect(c*A,l*A,A,A),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=1,e.globalAlpha=.4,e.strokeRect(c*A,l*A,A,A),e.fillStyle="white",e.globalAlpha=.8,e.font="8px monospace",e.textAlign="center",e.textBaseline="middle";const u=f===$.BASIC_PATH?"P":f===$.STONE_ROAD?"R":f===$.WOODEN_FLOOR?"W":f===$.CONCRETE?"C":f===$.METAL_FLOOR?"M":f===$.CARPET?"Cp":"?";e.fillText(u,c*A+A/2,l*A+A/2)}e.restore()}function vr(t,e){const i=t.ctx,n=t.canvas.width,o=t.canvas.height,a=550,s=450,r=320,l=280,c=Math.max(.5,Math.min(.85,n/800)),h=Math.max(.5,Math.min(.85,o/600)),f=Math.min(c,h),d=Math.max(r,Math.min(t.scale(a*f),n*.9)),u=Math.max(l,Math.min(t.scale(s*f),o*.85)),m=t.scale(8),g=Math.max(m,(n-d)/2),p=t.scale(54),b=Math.max(m,Math.min(p,o-u-m));i.save(),i.fillStyle="#0b1220cc",i.fillRect(g,b,d,u),i.strokeStyle="#1e293b",i.strokeRect(g+.5,b+.5,d-1,u-1);let v,M,w,C;const k=t.scale(32),S=b+t.scale(12),P=[{id:"bio",label:"Bio",icon:"👤"},{id:"health",label:"Health",icon:"❤️"},{id:"gear",label:"Gear",icon:"🎒"},{id:"social",label:"Social",icon:"👥"},{id:"skills",label:"Skills",icon:"🛠️"},{id:"log",label:"Log",icon:"📜"}];t.colonistTabRects=[];const I=(d-t.scale(32))/P.length;for(let O=0;O<P.length;O++){const X=P[O],j=g+t.scale(16)+O*I,H=t.colonistProfileTab===X.id;i.fillStyle=H?"#1e293b":"#0f172a",i.fillRect(j,S,I,k),i.strokeStyle=H?"#3b82f6":"#1e293b",i.strokeRect(j+.5,S+.5,I-1,k-1),i.fillStyle=H?"#60a5fa":"#9ca3af",i.font=t.getScaledFont(10,"600"),i.textAlign="center",i.textBaseline="middle";const q=S+k/2;i.fillText(`${X.icon} ${X.label}`,j+I/2,q),t.colonistTabRects.push({tab:X.id,x:j,y:S,w:I,h:k})}const B=S+k+t.scale(8),N=u-(B-b)-t.scale(16);switch(i.save(),i.beginPath(),i.rect(g+t.scale(8),B,d-t.scale(16),N),i.clip(),t.colonistProfileTab){case"bio":Mr(t,e,g+t.scale(16),B,d-t.scale(32),N);break;case"health":kr(t,e,g+t.scale(16),B,d-t.scale(32),N);break;case"gear":Sr(t,e,g+t.scale(16),B,d-t.scale(32),N);break;case"social":Cr(t,e,g+t.scale(16),B,d-t.scale(32));break;case"skills":xr(t,e,g+t.scale(16),B,d-t.scale(32),N);break;case"log":Rr(t,e,g+t.scale(16),B,d-t.scale(32),N);break}i.restore(),v=t.scale(26),M=t.scale(8),w=g+d-M-v,C=b+u-M-v,i.fillStyle="#0f172a",i.fillRect(w,C,v,v),i.strokeStyle="#1e293b",i.strokeRect(w+.5,C+.5,v-1,v-1),i.fillStyle="#dbeafe",i.font=t.getScaledFont(16,"700"),i.textAlign="center",i.textBaseline="middle",i.fillText("✕",w+v/2,C+v/2+t.scale(1)),i.fillStyle="#4b5563",i.font=t.getScaledFont(9),i.textAlign="left",i.fillText(t.follow?"Following (Esc to stop)":"Click to follow",g+t.scale(16),b+u-t.scale(8)),t.colonistPanelRect={x:g,y:b,w:d,h:u},t.colonistPanelCloseRect={x:w,y:C,w:v,h:v},i.restore()}function Mr(t,e,i,n,o,a){var g;const s=t.ctx;let r=n+t.scale(8);const l=t.scale(64),c=i+t.scale(8),h=r;s.fillStyle="#0f172a",s.fillRect(c,h,l,l),s.strokeStyle="#1e293b",s.strokeRect(c+.5,h+.5,l-1,l-1),s.save(),s.translate(c+l/2,h+l/2),s.scale(t.uiScale*2,t.uiScale*2),xi(s,0,0,e,16,!0),s.restore();const f=e.profile,d=c+l+t.scale(16);let u=h+t.scale(8);if(s.fillStyle="#dbeafe",s.font=t.getScaledFont(18,"700"),s.textAlign="left",f){s.fillText(f.name,d,u),u+=t.scale(22),s.font=t.getScaledFont(13,"400"),s.fillStyle="#94a3b8",s.fillText(f.background,d,u),u+=t.scale(16),s.fillStyle="#60a5fa";const p=f.age||Math.floor(Math.random()*30)+20;s.fillText(`Age: ${p}`,d,u),u+=t.scale(14),(g=f.detailedInfo)!=null&&g.birthplace&&(s.fillStyle="#a78bfa",s.fillText(`From: ${f.detailedInfo.birthplace}`,d,u),u+=t.scale(14)),s.fillStyle="#fbbf24",s.fillText(`Favorite Food: ${f.favoriteFood}`,d,u)}else s.fillText("Unnamed Colonist",d,u),u+=t.scale(22),s.font=t.getScaledFont(13,"400"),s.fillStyle="#94a3b8",s.fillText("No background available",d,u);r=h+l+t.scale(20);const m=f==null?void 0:f.detailedInfo;if(f&&f.personality.length>0){s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Personality Traits",i,r),r+=t.scale(18);for(const p of f.personality)s.fillStyle="#60a5fa",s.font=t.getScaledFont(12,"400"),s.fillText(`• ${p}`,i+t.scale(8),r),r+=t.scale(16);r+=t.scale(8)}if(m&&m.family&&(s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Family",i,r),r+=t.scale(18),s.fillStyle="#10b981",s.font=t.getScaledFont(11,"400"),m.family.parents.length>0&&(s.fillText(`Parents: ${m.family.parents.join(", ")}`,i+t.scale(8),r),r+=t.scale(14)),m.family.siblings.length>0&&(s.fillText(`Siblings: ${m.family.siblings.join(", ")}`,i+t.scale(8),r),r+=t.scale(14)),m.family.spouse&&(s.fillText(`Spouse: ${m.family.spouse}`,i+t.scale(8),r),r+=t.scale(14)),m.family.children.length>0&&(s.fillText(`Children: ${m.family.children.join(", ")}`,i+t.scale(8),r),r+=t.scale(14)),r+=t.scale(8)),m&&m.skills&&m.skills.length>0&&(s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Skills",i,r),r+=t.scale(18),s.fillStyle="#f59e0b",s.font=t.getScaledFont(11,"400"),s.fillText(`• ${m.skills.join(", ")}`,i+t.scale(8),r),r+=t.scale(16)),f&&f.backstory){s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Backstory",i,r),r+=t.scale(18),s.fillStyle="#94a3b8",s.font=t.getScaledFont(11,"400");const p=f.backstory.split(" "),b=o-t.scale(16);let v="";for(let M of p){const w=v+M+" ";if(s.measureText(w).width>b&&v!==""){if(s.fillText(v.trim(),i+t.scale(8),r),r+=t.scale(14),v=M+" ",r>n+a-t.scale(20))break}else v=w}v.trim()&&r<=n+a-t.scale(20)&&s.fillText(v.trim(),i+t.scale(8),r)}}function kr(t,e,i,n,o,a){const s=t.ctx;let r=n+t.scale(8);const l=Math.max(.7,Math.min(1,o/400)),c=Math.round(16*l),h=Math.round(12*l),f=Math.round(10*l),d=Math.max(0,Math.min(100,e.hp|0)),u=Math.max(0,Math.min(100,(e.fatigue||0)|0)),m=Math.max(0,Math.min(100,(e.hunger||0)|0)),g=t.getColonistMood?t.getColonistMood(e):"OK";s.fillStyle="#f1f5f9",s.font=t.getScaledFont(c,"600"),s.textAlign="left",s.fillText("Overall Condition",i,r),r+=t.scale(Math.round(24*l));const p=t.scale(Math.round(22*l));if(t.barRow(i,r,"Health",d,"#22c55e"),r+=p,t.barRow(i,r,"Energy",100-u,"#eab308"),r+=p,t.barRow(i,r,"Fullness",100-m,"#f87171"),r+=p,e.health){r+=t.scale(Math.round(16*l)),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(c,"600"),s.fillText("Detailed Health",i,r),r+=t.scale(Math.round(20*l));const b=Math.round((e.health.totalPain||0)*100),v=Math.round((e.health.consciousness||1)*100),M=Math.round((e.health.mobility||1)*100),w=Math.round((e.health.manipulation||1)*100);s.fillStyle="#94a3b8",s.font=t.getScaledFont(h,"500"),s.fillText(`Pain Level: ${b}%`,i,r),s.fillStyle=b>30?"#ef4444":b>15?"#f59e0b":"#22c55e";const C=b>50?" (Severe)":b>30?" (Moderate)":b>15?" (Mild)":" (None)",k=Math.min(i+t.scale(Math.round(80*l)),i+o-t.scale(60));if(s.fillText(C,k,r),r+=t.scale(Math.round(16*l)),t.barRow(i,r,"Consciousness",v,v>80?"#22c55e":v>60?"#f59e0b":"#ef4444"),r+=p,t.barRow(i,r,"Mobility",M,M>80?"#22c55e":M>60?"#f59e0b":"#ef4444"),r+=p,t.barRow(i,r,"Manipulation",w,w>80?"#22c55e":w>60?"#f59e0b":"#ef4444"),r+=p,e.health.bodyParts&&e.health.bodyParts.length>0){r+=t.scale(Math.round(16*l)),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(Math.round(14*l),"600"),s.fillText("Body Parts",i,r),r+=t.scale(Math.round(18*l));for(const S of e.health.bodyParts){const P=Math.round(S.currentHp/S.maxHp*100),I=Math.round(S.efficiency*100);s.fillStyle="#cbd5e1",s.font=t.getScaledFont(Math.round(11*l),"500"),s.fillText(S.label,i,r);const B=Math.min(t.scale(80),o*.3),N=t.scale(8),O=i+Math.min(t.scale(80),o*.25);s.fillStyle="#374151",s.fillRect(O,r-t.scale(6),B,N);const X=P>80?"#22c55e":P>50?"#f59e0b":"#ef4444";if(s.fillStyle=X,s.fillRect(O,r-t.scale(6),B*(P/100),N),s.fillStyle="#9ca3af",s.font=t.getScaledFont(f,"400"),s.fillText(`${P}%`,O+B+t.scale(8),r),I<100&&o>300){s.fillStyle="#f59e0b";const j=Math.min(O+B+t.scale(40),i+o-t.scale(60));s.fillText(`(${I}%)`,j,r)}r+=t.scale(Math.round(14*l))}}if(e.health.injuries&&e.health.injuries.length>0){r+=t.scale(Math.round(12*l)),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(Math.round(14*l),"600"),s.fillText("Active Injuries",i,r),r+=t.scale(Math.round(18*l));const S=o<350?4:6;for(const P of e.health.injuries.slice(0,S)){const I=Math.round(P.severity*100),B=Math.round(P.pain*100),O={cut:"🔪",bruise:"🟣",burn:"🔥",bite:"🦷",gunshot:"🔫",fracture:"🦴"}[P.type]||"⚕️";s.fillStyle="#f87171",s.font=t.getScaledFont(h,"500");const X=o<350?P.description.substring(0,25)+"...":P.description;s.fillText(`${O} ${X}`,i,r),s.fillStyle="#94a3b8",s.font=t.getScaledFont(f,"400");const j=`Severity: ${I}%, Pain: ${B}%`;if(s.fillText(j,i+t.scale(8),r+t.scale(12)),P.bleeding>0&&o>300){s.fillStyle="#dc2626";const H=Math.min(i+t.scale(150),i+o-t.scale(80));s.fillText(`Bleeding: ${Math.round(P.bleeding*100)}%`,H,r+t.scale(12))}if(P.infected&&o>250){s.fillStyle="#7c2d12";const H=Math.min(i+t.scale(220),i+o-t.scale(60));s.fillText("INFECTED",H,r+t.scale(12))}if(r+=t.scale(Math.round(26*l)),r>n+a-t.scale(40))break}e.health.injuries.length>6&&(s.fillStyle="#6b7280",s.font=t.getScaledFont(10,"400"),s.fillText(`...and ${e.health.injuries.length-6} more injuries`,i,r))}else e.health.bodyParts&&(r+=t.scale(12),s.fillStyle="#22c55e",s.font=t.getScaledFont(12,"500"),s.fillText("✓ No active injuries",i,r))}else r+=t.scale(16),s.fillStyle="#6b7280",s.font=t.getScaledFont(12,"400"),s.fillText("Enhanced health system not initialized",i,r);r+=t.scale(16),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Mental State",i,r),r+=t.scale(18),s.fillStyle="#9fb3c8",s.font=t.getScaledFont(12,"400"),s.fillText(`Current Mood: ${g}`,i+t.scale(8),r)}function xr(t,e,i,n,o,a){const s=t.ctx;s.save();let r=n+t.scale(4);if(s.fillStyle="#f1f5f9",s.font=t.getScaledFont(16,"600"),s.textAlign="left",s.fillText("Skills",i,r),r+=t.scale(22),!e.skills){s.fillStyle="#94a3b8",s.font=t.getScaledFont(12,"400"),s.fillText("No skills data",i,r),s.restore();return}const l=Object.values(e.skills.byName);l.sort((m,g)=>g.level-m.level);const c=t.scale(14),h=o-t.scale(180);s.font=t.getScaledFont(11,"400");const f=[];for(const m of l){if(r+c>n+a-t.scale(8))break;s.fillStyle="#e2e8f0",s.fillText(m.name,i,r+c*.8),s.fillStyle="#60a5fa",s.fillText(String(m.level).padStart(2," "),i+t.scale(110),r+c*.8);let g="#475569",p="";m.passion==="interested"?(g="#fbbf24",p="★"):m.passion==="burning"&&(g="#f97316",p="★★"),p&&(s.fillStyle=g,s.fillText(p,i+t.scale(140),r+c*.8));const b=i+t.scale(170),v=r+t.scale(2);s.fillStyle="#1e293b",s.fillRect(b,v,h,c-t.scale(4)),s.fillStyle="#0f172a",s.fillRect(b+1,v+1,h-2,c-t.scale(6));const M=100+Math.pow(m.level+1,1.6)*40,w=Math.max(0,Math.min(1,m.xp/M)),C=Math.round((h-4)*w);s.fillStyle="#3b82f6",s.fillRect(b+2,v+2,C,c-t.scale(8)),s.fillStyle="#cbd5e1",s.font=t.getScaledFont(9,"400"),s.textAlign="center",s.fillText(`${Math.round(w*100)}%`,b+h/2,v+(c-t.scale(8))/2+t.scale(2)),s.textAlign="left",f.push({x:b,y:v,w:h,h:c-t.scale(4),skill:m,needed:M}),r+=c+t.scale(6)}const d=t.mouse.x*t.DPR,u=t.mouse.y*t.DPR;for(const m of f)if(d>=m.x&&d<=m.x+m.w&&u>=m.y&&u<=m.y+m.h){const g=m.skill,p=m.needed,b=Math.max(0,Math.round(p-g.xp)),v=t.t||0,M=3;let w=0;if(g.xpDeltas&&g.xpDeltas.length)for(let j=g.xpDeltas.length-1;j>=0;j--){const H=g.xpDeltas[j];if(H.t>=v-M)w+=H.amount;else break}const C=g.passion==="burning"?"x200%":g.passion==="interested"?"x150%":"x100%",k=[`${g.name} (Level ${g.level})`,`XP: ${Math.round(g.xp)}/${Math.round(p)}`,`To next: ${b}`,...w>0?[`Recent gain: +${w.toFixed(1)} XP (last ${M}s)`]:[],`Passion: ${g.passion||"none"} (${C})`,`Work Speed: ${((.6+Math.pow(g.level,.9)*.06)*100).toFixed(0)}%`],S=t.scale(6);s.font=t.getScaledFont(11,"400");let P=0;for(const j of k){const H=s.measureText(j).width;H>P&&(P=H)}const I=P+S*2,B=k.length*t.scale(14)+S*2;let N=m.x+t.scale(10),O=m.y-B-t.scale(4);O<n&&(O=m.y+t.scale(18)),N+I>i+o&&(N=i+o-I),s.fillStyle="rgba(15,23,42,0.92)",s.fillRect(N,O,I,B),s.strokeStyle="#334155",s.strokeRect(N+.5,O+.5,I-1,B-1);let X=O+S;for(const j of k)s.fillStyle="#e2e8f0",s.fillText(j,N+S,X+t.scale(11)),X+=t.scale(14);break}s.restore()}function Sr(t,e,i,n,o,a){const s=t.ctx;let r=n+t.scale(8);if(s.fillStyle="#f1f5f9",s.font=t.getScaledFont(16,"600"),s.textAlign="left",s.fillText("Equipment & Inventory",i,r),r+=t.scale(24),!e.inventory){s.fillStyle="#6b7280",s.font=t.getScaledFont(12,"400"),s.fillText("No inventory data available",i,r);return}s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Equipment",i,r),r+=t.scale(18);const l=["helmet","armor","weapon","tool","shield","accessory"];for(const c of l){const h=e.inventory.equipment[c];s.fillStyle="#94a3b8",s.font=t.getScaledFont(12,"500");const f=c.charAt(0).toUpperCase()+c.slice(1);s.fillText(`${f}:`,i,r),h?(s.fillStyle=Xt(t,h.quality||"normal"),s.font=t.getScaledFont(12,"400"),s.fillText(h.name,i+t.scale(80),r),s.fillStyle="#6b7280",s.font=t.getScaledFont(10,"400"),s.fillText(`(${h.quality||"normal"})`,i+t.scale(180),r)):(s.fillStyle="#6b7280",s.font=t.getScaledFont(12,"400"),s.fillText("None",i+t.scale(80),r)),r+=t.scale(16)}if(r+=t.scale(12),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Inventory Items",i,r),r+=t.scale(18),e.inventory.items.length===0)s.fillStyle="#6b7280",s.font=t.getScaledFont(12,"400"),s.fillText("No items in inventory",i+t.scale(8),r);else for(const c of e.inventory.items){s.fillStyle=Xt(t,c.quality||"normal"),s.font=t.getScaledFont(12,"400");const h=`${c.name} (${c.quantity})`;if(s.fillText(h,i+t.scale(8),r),s.fillStyle="#6b7280",s.font=t.getScaledFont(10,"400"),s.fillText(`${c.quality||"normal"}`,i+t.scale(150),r),c.durability!==void 0&&s.fillText(`${Math.round(c.durability)}%`,i+t.scale(200),r),r+=t.scale(16),r>n+a-t.scale(20)){s.fillStyle="#6b7280",s.font=t.getScaledFont(10,"400"),s.fillText("...more items",i+t.scale(8),r);break}}e.carrying&&(r+=t.scale(12),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Currently Carrying",i,r),r+=t.scale(18),s.fillStyle="#22c55e",s.font=t.getScaledFont(12,"400"),s.fillText(`${e.carrying.type||"Item"}`,i+t.scale(8),r))}function Cr(t,e,i,n,o,a){var c;const s=t.ctx;let r=n+t.scale(8);s.fillStyle="#f1f5f9",s.font=t.getScaledFont(16,"600"),s.textAlign="left",s.fillText("Social Relationships",i,r),r+=t.scale(24),s.fillStyle="#94a3b8",s.font=t.getScaledFont(12,"400"),s.fillText("Social skill: Novice",i,r),r+=t.scale(16),r+=t.scale(16),s.fillStyle="#f1f5f9",s.font=t.getScaledFont(14,"600"),s.fillText("Colony Relationships",i,r),r+=t.scale(18);const l=t.colonists.filter(h=>h!==e&&h.alive);if(l.length>0)for(let h=0;h<Math.min(l.length,3);h++){const f=l[h],d=["Neutral","Friend","Good friend","Rival"][Math.floor(Math.random()*4)],u=d==="Friend"||d==="Good friend"?"#22c55e":d==="Rival"?"#ef4444":"#94a3b8";s.fillStyle="#dbeafe",s.font=t.getScaledFont(11,"500"),s.fillText(((c=f.profile)==null?void 0:c.name)||"Colonist",i+t.scale(8),r),s.fillStyle=u,s.font=t.getScaledFont(11,"400"),s.fillText(d,i+t.scale(120),r),r+=t.scale(16)}else s.fillStyle="#6b7280",s.font=t.getScaledFont(11,"400"),s.fillText("No other colonists in colony",i+t.scale(8),r)}function Rr(t,e,i,n,o,a){const s=t.ctx;let r=n+t.scale(8);s.fillStyle="#f1f5f9",s.font=t.getScaledFont(16,"600"),s.textAlign="left",s.fillText("Activity Log",i,r),r+=t.scale(24);const l=[{time:`Day ${t.day} 08:30`,action:"Started construction work",type:"work"},{time:`Day ${t.day} 07:45`,action:"Finished eating breakfast",type:"need"},{time:`Day ${t.day} 07:00`,action:"Woke up",type:"rest"},{time:`Day ${t.day-1} 22:30`,action:"Went to sleep",type:"rest"},{time:`Day ${t.day-1} 19:15`,action:"Had dinner",type:"need"}];for(const c of l){const h=c.type==="work"?"#60a5fa":c.type==="need"?"#22c55e":c.type==="rest"?"#a78bfa":"#94a3b8";if(s.fillStyle="#6b7280",s.font=t.getScaledFont(10,"400"),s.fillText(c.time,i,r),s.fillStyle=h,s.font=t.getScaledFont(11,"400"),s.fillText(c.action,i+t.scale(100),r),r+=t.scale(16),r>n+a-t.scale(20))break}}function Xt(t,e){switch(e.toLowerCase()){case"legendary":return"#a855f7";case"masterwork":return"#f59e0b";case"excellent":return"#10b981";case"good":return"#3b82f6";case"normal":return"#6b7280";case"poor":return"#ef4444";case"awful":return"#991b1b";default:return"#6b7280"}}function Tr(t){const e=t.pendingPlacement;if(!e)return;const i=V[e.key],n=t.ctx,o=i.size.w*A,a=i.size.h*A,r=((k,S)=>({x:(k-t.camera.x)*t.camera.zoom,y:(S-t.camera.y)*t.camera.zoom}))(e.x,e.y);let l=o*t.camera.zoom,c=a*t.camera.zoom;const h=e.rot||0;if(h===90||h===270){const k=l;l=c,c=k}n.save();const d=Ie(e.key,e.x+1,e.y+1),u=Ge(t,d,d.x,d.y)&&xe(t.RES,i.cost);n.globalAlpha=.6,n.fillStyle=u?_.ghost:"#ff6b6b88",n.fillRect(r.x,r.y,l,c),n.globalAlpha=1,n.strokeStyle="#4b9fff",n.setLineDash([4,3]),n.strokeRect(r.x+.5,r.y+.5,l-1,c-1),n.setLineDash([]),n.restore();const m=t.scale(10),g=t.scale(42);let p=r.x+l+m,b=r.y;const v=t.canvas.width;p+g*3>v-t.scale(6)&&(p=Math.max(t.scale(6),r.x-m-g*3));const M=(k,S,P)=>({id:k,x:S,y:P,w:g,h:g}),w=[M("up",p+g,b),M("left",p,b+g),M("right",p+g*2,b+g),M("down",p+g,b+g*2),M("rotL",p,b+g*3+t.scale(6)),M("rotR",p+g*2,b+g*3+t.scale(6)),M("cancel",p,b+g*4+t.scale(6)),M("ok",p+g*2,b+g*4+t.scale(6))];t.placeUIRects=w,n.save(),n.fillStyle="#0f172aee",n.strokeStyle="#1e293b";const C=(k,S,P=!1)=>{n.save(),n.globalAlpha=P?.5:1,n.fillRect(k.x,k.y,k.w,k.h),n.strokeRect(k.x+.5,k.y+.5,k.w-1,k.h-1),n.fillStyle="#dbeafe",n.font=t.getScaledFont(18,"600"),n.textAlign="center",n.textBaseline="middle",n.fillText(S,k.x+k.w/2,k.y+k.h/2+t.scale(2)),n.restore(),n.fillStyle="#0f172aee"};for(const k of w)k.id==="up"?C(k,"↑"):k.id==="down"?C(k,"↓"):k.id==="left"?C(k,"←"):k.id==="right"?C(k,"→"):k.id==="rotL"?C(k,"⟲"):k.id==="rotR"?C(k,"⟳"):k.id==="ok"?C(k,"OK",!u):k.id==="cancel"&&C(k,"X");n.fillStyle="#dbeafe",n.font=t.getScaledFont(14,"500"),n.textAlign="left",n.textBaseline="top",n.fillText("Drag to move • Tap OK to place",Math.max(t.scale(6),r.x),Math.max(t.scale(6),r.y-t.scale(26))),n.restore()}class Pr{constructor(e){this.game=e}render(){const{game:e}=this,{ctx:i,canvas:n}=e;cr(i,n),e.clampCameraToWorld(),i.save(),dr(i,e.camera),this.renderWorld(),this.renderEntities(),this.renderDebug(),i.restore(),this.renderUI()}renderWorld(){const{game:e}=this,{ctx:i}=e;hr(i),fr(i,e.terrainGrid,e.camera)}renderEntities(){const{game:e}=this,{ctx:i}=e;for(const n of e.trees)Qt(i,n.x,n.y,n.r,_.tree);for(const n of e.rocks)Qt(i,n.x,n.y,n.r,_.rock);for(const n of e.buildings)Ar(i,n);for(const n of e.buildings){if(!n.done)continue;const o=e.insideCounts.get(n)||0;if(o>0&&(n.kind==="hq"||n.kind==="house")){const r=n.x+n.w-6,l=n.y+6;if(o<=4)for(let c=0;c<o;c++){const h=r-c%2*12,f=l+Math.floor(c/2)*12;qt(i,h,f,10,"#93c5fd")}else{qt(i,r,l,10,"#93c5fd"),i.save(),i.fillStyle="#1e293b",i.strokeStyle="#93c5fd",i.lineWidth=1.5;const c=r-12,h=l,f=8;i.beginPath(),i.arc(c,h,f,0,Math.PI*2),i.fill(),i.stroke(),i.fillStyle="#ffffff",i.font="bold 10px system-ui",i.textAlign="center",i.textBaseline="middle",i.fillText(String(o),c,h),i.restore()}}}for(const n of e.colonists){if(!n.alive||n.inside&&n.inside.kind!=="bed")continue;const a=e.selColonist===n;xi(i,n.x,n.y,n,n.r,a)}if(e.debug.combat)for(const n of e.buildings){if(!n.alive||!n.done)continue;const o=V[n.kind];if(!o.isTurret)continue;const a=o.range||0;if(a>0){const s=n.x+n.w/2,r=n.y+n.h/2;i.strokeStyle="rgba(255,0,0,0.3)",i.lineWidth=2,i.beginPath(),i.arc(s,r,a,0,Math.PI*2),i.stroke()}}e.drawLongPressProgress();for(const n of e.enemies)ur(i,n.x,n.y,n.r+2,3,_.enemy,-Math.PI/2);if(gr(i,e.bullets),vi(i,e.particles),e.isNight()&&(i.fillStyle="rgba(6,10,18, 0.58)",i.fillRect(0,0,Q.w,Q.h)),e.selectedBuild&&!e.pendingPlacement){const n=V[e.selectedBuild],o=Math.floor(e.mouse.wx/A)*A,a=Math.floor(e.mouse.wy/A)*A,s=Ge(e,{...n,size:n.size},o,a)&&xe(e.RES,n.cost);i.globalAlpha=.6,i.fillStyle=s?_.ghost:"#ff6b6b88",i.fillRect(o,a,n.size.w*A,n.size.h*A),i.globalAlpha=1}if(e.mouse.rdown&&e.eraseDragStart){const n=Math.min(e.eraseDragStart.x,e.mouse.wx),o=Math.min(e.eraseDragStart.y,e.mouse.wy),a=Math.abs(e.mouse.wx-e.eraseDragStart.x),s=Math.abs(e.mouse.wy-e.eraseDragStart.y);i.save(),i.globalAlpha=.18,i.fillStyle="#ef4444",i.fillRect(n,o,a,s),i.globalAlpha=1,i.strokeStyle="#ef4444",i.setLineDash([6,4]),i.strokeRect(n+.5,o+.5,a-1,s-1),i.setLineDash([]),i.restore()}}renderDebug(){const{game:e}=this,{ctx:i}=e;e.debug.regions&&br(e),e.debug.terrain&&wr(e),e.debug.nav&&this.renderNavDebug(),e.debug.colonists&&(this.renderColonistDebug(),this.renderEnemyDebug()),ir(e)}renderNavDebug(){const{game:e}=this,{ctx:i,grid:n,camera:o}=e,a=o;i.save(),i.globalAlpha=.4;for(let s=0;s<n.rows;s++)for(let r=0;r<n.cols;r++){const l=s*n.cols+r;if(!n.solid[l])continue;const c=r*A,h=s*A;c+A<a.x-100||c>a.x+a.w+100||h+A<a.y-100||h>a.y+a.h+100||(i.fillStyle="#ff000088",i.fillRect(c,h,A,A))}i.font="8px monospace";for(let s=0;s<n.rows;s++)for(let r=0;r<n.cols;r++){const l=s*n.cols+r;if(n.solid[l])continue;const c=n.cost[l];if(c===1)continue;const h=r*A,f=s*A;if(h+A<a.x-100||h>a.x+a.w+100||f+A<a.y-100||f>a.y+a.h+100)continue;const d=Math.min(1,(c-1)*.3);i.fillStyle=`rgba(255, 200, 0, ${d})`,i.fillRect(h,f,A,A),i.fillStyle="#000000",i.fillText(c.toFixed(1),h+2,f+10)}i.restore();for(const s of e.colonists)if(!(!s.alive||!s.path||s.path.length===0)){i.strokeStyle="#00ffff",i.lineWidth=2,i.setLineDash([4,4]),i.beginPath(),i.moveTo(s.x,s.y);for(const r of s.path)i.lineTo(r.x,r.y);if(i.stroke(),i.setLineDash([]),s.pathIndex!==void 0&&s.path[s.pathIndex]){const r=s.path[s.pathIndex];i.fillStyle="#00ffff",i.beginPath(),i.arc(r.x,r.y,4,0,Math.PI*2),i.fill()}if(s.target&&s.target.x!=null){const r=s.target;i.strokeStyle="#ffff00",i.lineWidth=1,i.setLineDash([2,2]),i.beginPath(),i.moveTo(s.x,s.y),i.lineTo(r.x,r.y),i.stroke(),i.setLineDash([])}}for(const s of e.enemies){const r=s,l=r.path;if(!(!l||l.length===0)){i.strokeStyle="#ff4444",i.lineWidth=2,i.setLineDash([4,4]),i.beginPath(),i.moveTo(s.x,s.y);for(const c of l)i.lineTo(c.x,c.y);i.stroke(),i.setLineDash([]);for(let c=0;c<l.length;c++){const h=l[c];i.fillStyle=c===r.pathIndex?"#ff0000":"#ff8888",i.fillRect(h.x-2,h.y-2,4,4)}}}}renderColonistDebug(){var n;const{game:e}=this,{ctx:i}=e;i.save(),i.font="10px monospace",i.lineWidth=1;for(const o of e.colonists){if(!o.alive||o.inside&&o.inside.kind!=="bed")continue;const s=o.x-35;let r=o.y-o.r-45;const l=12,c=[`State: ${o.state||"unknown"}`,`Task: ${o.task||"none"}`,`HP: ${Math.floor(o.hp||0)}`,`Pos: ${Math.floor(o.x)},${Math.floor(o.y)}`,`Speed: ${this.calculateColonistSpeed(o).toFixed(1)}`,`Stuck: ${o.stuckTimer?o.stuckTimer.toFixed(1)+"s":"no"}`,`Since: ${o.stateSince?o.stateSince.toFixed(1)+"s":"0s"}`,`PathIdx: ${o.pathIndex??"none"}/${((n=o.path)==null?void 0:n.length)??0}`,`Jitter: ${o.jitterScore??0}`,`Repath: ${o.repath?o.repath.toFixed(1)+"s":"none"}`];if(o.target){const d=o.target;d.x!=null&&(c.push(`Target: ${Math.floor(d.x)},${Math.floor(d.y)}`),d.type&&c.push(`Type: ${d.type}`),d.hp!=null&&c.push(`T.HP: ${Math.floor(d.hp)}`))}const h=140,f=c.length*l+4;i.fillStyle="rgba(0, 0, 0, 0.8)",i.fillRect(s-2,r-l+2,h,f),i.strokeStyle="#444",i.strokeRect(s-2,r-l+2,h,f);for(let d=0;d<c.length;d++){const u=c[d];i.fillStyle="#ffffff",i.strokeStyle="#000000",i.lineWidth=2,i.strokeText(u,s,r+d*l),i.fillText(u,s,r+d*l)}if(i.strokeStyle="#ff6b6b",i.lineWidth=1,i.globalAlpha=.3,i.beginPath(),i.arc(o.x,o.y,o.r,0,Math.PI*2),i.stroke(),i.globalAlpha=1,o.target&&o.task&&(o.task==="chop"||o.task==="mine")){const d=o.target;if(d.x!=null&&d.r!=null){const u=d.r+o.r+4+2.5;i.strokeStyle="#22c55e",i.lineWidth=2,i.globalAlpha=.4,i.beginPath(),i.arc(d.x,d.y,u,0,Math.PI*2),i.stroke(),i.globalAlpha=1;const m=Math.hypot(o.x-d.x,o.y-d.y);i.fillStyle=m<=u?"#22c55e":"#ff6b6b",i.font="12px monospace";const g=(o.x+d.x)/2,p=(o.y+d.y)/2;i.strokeText(`${m.toFixed(1)}`,g-15,p),i.fillText(`${m.toFixed(1)}`,g-15,p)}}}i.restore()}renderEnemyDebug(){const{game:e}=this,{ctx:i}=e;i.save(),i.font="9px monospace";for(const n of e.enemies){const o=n,a=o.path,s=n.x-40;let r=n.y-n.r-35;const l=11,c=[`HP: ${Math.floor(n.hp)}`,`Pos: ${Math.floor(n.x)},${Math.floor(n.y)}`,`Target: ${n.target?n.target.kind||"colonist":"none"}`,`PathIdx: ${o.pathIndex??"none"}/${(a==null?void 0:a.length)??0}`,`Repath: ${o.repath?o.repath.toFixed(1)+"s":"none"}`,`Stuck: ${o.stuckTimer?o.stuckTimer.toFixed(1)+"s":"no"}`],h=120,f=c.length*l+4;i.fillStyle="rgba(0, 0, 0, 0.75)",i.fillRect(s-2,r-2,h,f),i.fillStyle="#ff4444";for(let d=0;d<c.length;d++)i.fillText(c[d],s,r+d*l+10)}i.restore()}renderUI(){const{game:e}=this,{ctx:i,canvas:n}=e,o=e.getPopulationCap(),a=e.colonists.filter(c=>c.inside&&c.inside.kind!=="bed").length,s=e.RES.wood+e.RES.stone+e.RES.food,r=e.getStorageCapacity(),l=e.hotbar.map(c=>({key:String(c),name:V[c].name,cost:e.costText(V[c].cost||{}),selected:e.selectedBuild===c}));pr(i,n,{res:e.RES,colonists:e.colonists.filter(c=>c.alive).length,cap:o,hiding:a,day:e.day,tDay:e.tDay,isNight:e.isNight(),hotbar:l,messages:e.messages,storage:{used:s,max:r}},e),e.selColonist?vr(e,e.selColonist):e.colonistPanelRect=e.colonistPanelCloseRect=null,e.showBuildMenu&&On(e),e.pendingPlacement&&Tr(e),e.contextMenu&&Hn(e),Vs(i,e.colonists,n.width,n.height),qn(i,n.width,n.height)}calculateColonistSpeed(e){const{game:i}=this;let n=e.speed||0;e.fatigueSlow&&(n*=e.fatigueSlow),n*=i.getMoveSpeedMultiplier(e);let o=n;const a=Math.floor(e.x/A),s=Math.floor(e.y/A);if(a>=0&&s>=0&&a<i.grid.cols&&s<i.grid.rows){const r=s*i.grid.cols+a,l=i.grid.cost[r];l>0&&(o=n/l)}return o}}function Br(t,e,i,n){const o=Math.floor(e/A),a=Math.floor(i/A),s=Math.ceil(n/A)+2,r=Math.max(0,o-s),l=Math.min(t.grid.cols-1,o+s),c=Math.max(0,a-s),h=Math.min(t.grid.rows-1,a+s);Yi(t.grid,r,c,l-r+1,h-c+1),t.grid.terrainGrid&&ht(t.grid);for(const f of t.buildings){const d=Math.floor(f.x/A),u=Math.floor((f.x+f.w-1)/A),m=Math.floor(f.y/A),g=Math.floor((f.y+f.h-1)/A);if(!(u<r||d>l||g<c||m>h)&&(f.kind!=="hq"&&f.kind!=="path"&&f.kind!=="house"&&f.kind!=="farm"&&f.kind!=="bed"&&f.kind!=="door"&&di(t.grid,f.x,f.y,f.w,f.h),f.kind==="path"&&Pe(t.grid,f.x,f.y,f.w,f.h,"BASIC_PATH"),f.kind==="door"&&f.done&&Pe(t.grid,f.x,f.y,f.w,f.h,"BASIC_PATH"),f.kind==="house"&&f.done)){const p=f.x+f.w/2-A/2,b=f.y+f.h;Pe(t.grid,p,b,A,A,"FAST_ROAD")}}for(const f of t.trees){const d=Math.floor(f.x/A),u=Math.floor(f.y/A);d>=r&&d<=l&&u>=c&&u<=h&&Qe(t.grid,f.x,f.y,f.r)}for(const f of t.rocks){const d=Math.floor(f.x/A),u=Math.floor(f.y/A);d>=r&&d<=l&&u>=c&&u<=h&&Qe(t.grid,f.x,f.y,f.r)}t.regionManager.isEnabled()&&(t.regionManager.rebuildArea(r,c,l,h,t.buildings),t.regionManager.updateObjectCaches(t.buildings,t.trees,t.rocks))}function Ir(t){Hi(t.grid),t.grid.terrainGrid&&ht(t.grid);for(const e of t.buildings)if(e.kind!=="hq"&&e.kind!=="path"&&e.kind!=="house"&&e.kind!=="farm"&&e.kind!=="bed"&&e.kind!=="door"&&di(t.grid,e.x,e.y,e.w,e.h),e.kind==="path"&&Pe(t.grid,e.x,e.y,e.w,e.h,"BASIC_PATH"),e.kind==="door"&&e.done&&Pe(t.grid,e.x,e.y,e.w,e.h,"BASIC_PATH"),e.kind==="house"&&e.done){const i=e.x+e.w/2-A/2,n=e.y+e.h;Pe(t.grid,i,n,A,A,"FAST_ROAD")}for(const e of t.trees)Qe(t.grid,e.x,e.y,e.r);for(const e of t.rocks)Qe(t.grid,e.x,e.y,e.r);t.regionManager.isEnabled()&&(t.regionManager.onBuildingsChanged(t.buildings),t.regionManager.updateObjectCaches(t.buildings,t.trees,t.rocks))}function Er(t,e,i,n,o){return fi(t.grid,e,i,n,o)}function Dr(t,e,i,n,o,a){return fi(t.grid,i,n,o,a)}function Si(t,e,i){const n=Math.floor(e/A),o=Math.floor(i/A);return n<0||o<0||n>=t.grid.cols||o>=t.grid.rows?-1:o*t.grid.cols+n}function Fr(t,e,i){const n=Si(t,e,i);return n<0?!0:!!t.grid.solid[n]}class Lr{constructor(e){this.game=e}rebuildNavGrid(){Ir(this.game)}rebuildNavGridPartial(e,i,n){Br(this.game,e,i,n)}syncTerrainToGrid(){ht(this.game.grid)}computePath(e,i,n,o){return Er(this.game,e,i,n,o)}computePathWithDangerAvoidance(e,i,n,o,a){return Dr(this.game,e,i,n,o,a)}cellIndexAt(e,i){return Si(this.game,e,i)}isBlocked(e,i){return Fr(this.game,e,i)}findNearestBuildingByRegion(e,i,n){const{game:o}=this;if(!o.regionManager.isEnabled()){let a=null,s=1/0;for(const r of o.buildings){if(!n(r))continue;const l=r.x+r.w/2,c=r.y+r.h/2,h=Math.hypot(e-l,i-c);h<s&&(s=h,a=r)}return a}return o.regionManager.findNearestBuilding(e,i,n)}findNearestTreeByRegion(e,i){const{game:n}=this;if(!n.regionManager.isEnabled()){let a=null,s=1/0;for(const r of n.trees){if(r.hp<=0)continue;const l=Math.hypot(e-r.x,i-r.y);l<s&&(s=l,a=r)}return a}return n.regionManager.findNearestTree(e,i,n.trees)}findNearestRockByRegion(e,i){const{game:n}=this;if(!n.regionManager.isEnabled()){let a=null,s=1/0;for(const r of n.rocks){if(r.hp<=0)continue;const l=Math.hypot(e-r.x,i-r.y);l<s&&(s=l,a=r)}return a}return n.regionManager.findNearestRock(e,i,n.rocks)}isReachable(e,i,n,o){return this.game.regionManager.isEnabled()?this.game.regionManager.isReachable(e,i,n,o):!0}isWithinInteractionRange(e,i,n,o){const a=e-n.x,s=i-n.y;return Math.hypot(a,s)<=n.r+o}bestApproachToCircle(e,i,n){const{game:o}=this,a=16,s=new Set,r=[],l=Math.max(6,i.r+n-2),c=Math.atan2(i.y-e.y,i.x-e.x),h=[];for(let p=0;p<a;p++){const b=(p%2?1:-1)*Math.ceil(p/2);h.push(b/a*Math.PI*2+c)}for(const p of h){const b=i.x+Math.cos(p)*l,v=i.y+Math.sin(p)*l,M=Math.floor(b/A),w=Math.floor(v/A);if(M<0||w<0||M>=o.grid.cols||w>=o.grid.rows)continue;const C=M*A+A/2,k=w*A+A/2,S=`${M},${w}`;s.has(S)||(s.add(S),!this.isBlocked(C,k)&&r.push({x:C,y:k,gx:M,gy:w}))}if(r.length===0){const p=Math.atan2(e.y-i.y,e.x-i.x),b=i.r+n,v=Math.max(4,A*.33);for(let M=b;M>=Math.max(i.r+2,b-6*A);M-=v){const w=i.x+Math.cos(p)*M,C=i.y+Math.sin(p)*M,k=Math.floor(w/A),S=Math.floor(C/A);if(k<0||S<0||k>=o.grid.cols||S>=o.grid.rows)continue;const P=k*A+A/2,I=S*A+A/2;if(this.isBlocked(P,I))continue;if(this.computePathWithDangerAvoidance(e,e.x,e.y,P,I))return{x:P,y:I}}return{x:i.x+Math.cos(p)*b,y:i.y+Math.sin(p)*b}}let f=null,d=1/0,u=1/0,m=0;const g=8;for(const p of r){if(m>=g)break;const b=this.computePathWithDangerAvoidance(e,e.x,e.y,p.x,p.y);if(!b||b.length===0)continue;m++;let v=0;for(const w of b){const C=this.cellIndexAt(w.x,w.y);if(C<0){v=1/0;break}v+=o.grid.cost[C]||1}if(v===1/0)continue;const M=this.cellIndexAt(p.x,p.y);if(M>=0&&o.grid.cost[M]<=.7&&(v-=.05),b.length<=3&&v<=2)return Math.random()<.02&&console.log(`Early-out: great path found with length ${b.length} and cost ${v.toFixed(3)}`),p;(v<u||v===u&&b.length<d)&&(u=v,d=b.length,f=p)}return f?(Math.random()<.02&&console.log(`Best approach: (${f.x.toFixed(1)}, ${f.y.toFixed(1)}) with path cost ${u.toFixed(3)} and length ${d} (evaluated ${m} candidates)`),f):r[0]}}class Nr{constructor(e){x(this,"canvas");x(this,"ctx");x(this,"DPR",1);x(this,"state",new nr);x(this,"timeSystem",new or);x(this,"cameraSystem",new sr);x(this,"resourceSystem",new rr);x(this,"inputManager",new ar);x(this,"uiManager",new lr);x(this,"renderManager",new Pr(this));x(this,"navigationManager",new Lr(this));x(this,"uiScale",1);x(this,"baseFontSize",14);x(this,"isTouch",!1);x(this,"isActuallyTouchDevice",!1);x(this,"debug",{nav:!1,paths:!0,colonists:!1,forceDesktopMode:!1,regions:!1,terrain:!1});x(this,"handleResize",()=>{const e=document.querySelector("header"),i=e?Math.ceil(e.getBoundingClientRect().height):48,n=window.innerWidth,o=window.innerHeight-i;this.canvas.style.width=n+"px",this.canvas.style.height=o+"px",this.canvas.width=Math.floor(n*this.DPR),this.canvas.height=Math.floor(o*this.DPR),this.cameraSystem.setCanvasDimensions(this.canvas.width,this.canvas.height,this.DPR),this.calculateUIScale(),this.clampCameraToWorld()});x(this,"screenToWorld",(e,i)=>this.cameraSystem.screenToWorld(e,i));x(this,"respawnTimer",0);x(this,"assignedTargets",new WeakSet);x(this,"buildReservations",new Map);x(this,"insideCounts",new Map);x(this,"sleepReservations",new Map);x(this,"last",performance.now());x(this,"frame",e=>{const i=Math.min(.033,(e-this.last)/1e3);this.last=e,this.update(i),this.draw(),requestAnimationFrame(this.frame)});x(this,"grid",zi());x(this,"terrainGrid",Li(this.grid.cols,this.grid.rows));x(this,"regionManager",new _i(this.grid));const i=e.getContext("2d");if(!i)throw new Error("no ctx");this.canvas=e,this.ctx=i,this.DPR=Math.max(1,Math.min(2,window.devicePixelRatio||1)),this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.bindInput(),this.newGame(),this.grid.terrainGrid=this.terrainGrid,this.syncTerrainToGrid(),this.rebuildNavGrid(),this.regionManager.initialize(this.buildings),this.regionManager.updateObjectCaches(this.buildings,this.trees,this.rocks),this.resourceSystem.reset(),this.timeSystem.reset(),this.cameraSystem.setCanvasDimensions(this.canvas.width,this.canvas.height,this.DPR),this.cameraSystem.setZoom(1),this.cameraSystem.centerOn(oe.x,oe.y),this.clampCameraToWorld(),te.loadItems(),_s(this),this.applyDamageToColonist=(n,o,a="cut")=>{Ct(this,n,o,a)},requestAnimationFrame(this.frame)}get camera(){return this.cameraSystem.getCameraRef()}getStorageCapacity(){const e=this.state.buildings.filter(n=>n.done&&n.kind==="warehouse").length,i=this.state.buildings.filter(n=>n.done&&n.kind==="tent").length;return this.resourceSystem.getStorageCapacity(e,i)}getPopulationCap(){const e=this.buildings.find(n=>n.kind==="hq")?3:0,i=this.buildings.filter(n=>n.done&&typeof n.popCap=="number").reduce((n,o)=>n+(o.popCap||0),0);return e+i}addResource(e,i){const n=this.getStorageCapacity(),o=this.resourceSystem.addResource(e,i,n);return o===0&&i>0&&this.msg(`Storage full! Cannot store more ${String(e)}`,"warn"),o}get colonists(){return this.state.colonists}set colonists(e){this.state.colonists=e}get enemies(){return this.state.enemies}set enemies(e){this.state.enemies=e}get buildings(){return this.state.buildings}set buildings(e){this.state.buildings=e}get trees(){return this.state.trees}set trees(e){this.state.trees=e}get rocks(){return this.state.rocks}set rocks(e){this.state.rocks=e}get bullets(){return this.state.bullets}set bullets(e){this.state.bullets=e}get particles(){return this.state.particles}set particles(e){this.state.particles=e}get messages(){return this.state.messages}set messages(e){this.state.messages=e}get RES(){return this.resourceSystem.getResourcesRef()}get day(){return this.timeSystem.getDay()}set day(e){this.timeSystem.setDay(e)}get tDay(){return this.timeSystem.getTimeOfDay()}set tDay(e){this.timeSystem.setTimeOfDay(e)}get dayLength(){return this.timeSystem.getDayLength()}get fastForward(){return this.timeSystem.getFastForward()}set fastForward(e){this.timeSystem.setFastForward(e)}get paused(){return this.timeSystem.isPaused()}set paused(e){this.timeSystem.setPaused(e)}get selectedBuild(){return this.uiManager.selectedBuild}set selectedBuild(e){this.uiManager.selectedBuild=e}get hotbar(){return this.uiManager.hotbar}set hotbar(e){this.uiManager.hotbar=e}get showBuildMenu(){return this.uiManager.showBuildMenu}set showBuildMenu(e){this.uiManager.showBuildMenu=e}get selColonist(){return this.uiManager.selColonist}set selColonist(e){this.uiManager.selColonist=e}get follow(){return this.uiManager.follow}set follow(e){this.uiManager.follow=e}get pendingPlacement(){return this.uiManager.pendingPlacement}set pendingPlacement(e){this.uiManager.pendingPlacement=e}get menuRects(){return this.uiManager.menuRects}set menuRects(e){this.uiManager.menuRects=e}get hotbarRects(){return this.uiManager.hotbarRects}set hotbarRects(e){this.uiManager.hotbarRects=e}get placeUIRects(){return this.uiManager.placeUIRects}set placeUIRects(e){this.uiManager.placeUIRects=e}get colonistPanelRect(){return this.uiManager.colonistPanelRect}set colonistPanelRect(e){this.uiManager.colonistPanelRect=e}get colonistPanelCloseRect(){return this.uiManager.colonistPanelCloseRect}set colonistPanelCloseRect(e){this.uiManager.colonistPanelCloseRect=e}get colonistProfileTab(){return this.uiManager.colonistProfileTab}set colonistProfileTab(e){this.uiManager.colonistProfileTab=e}get colonistTabRects(){return this.uiManager.colonistTabRects}set colonistTabRects(e){this.uiManager.colonistTabRects=e}get contextMenu(){return this.uiManager.contextMenu}set contextMenu(e){this.uiManager.contextMenu=e}get contextMenuRects(){return this.uiManager.contextMenuRects}set contextMenuRects(e){this.uiManager.contextMenuRects=e}get longPressTimer(){return this.uiManager.longPressTimer}set longPressTimer(e){this.uiManager.longPressTimer=e}get longPressStartPos(){return this.uiManager.longPressStartPos}set longPressStartPos(e){this.uiManager.longPressStartPos=e}get longPressStartTime(){return this.uiManager.longPressStartTime}set longPressStartTime(e){this.uiManager.longPressStartTime=e}get longPressTarget(){return this.uiManager.longPressTarget}set longPressTarget(e){this.uiManager.longPressTarget=e}get longPressTargetType(){return this.uiManager.longPressTargetType}set longPressTargetType(e){this.uiManager.longPressTargetType=e}get lastPaintCell(){return this.uiManager.lastPaintCell}set lastPaintCell(e){this.uiManager.lastPaintCell=e}get eraseDragStart(){return this.uiManager.eraseDragStart}set eraseDragStart(e){this.uiManager.eraseDragStart=e}get pendingDragging(){return this.uiManager.pendingDragging}set pendingDragging(e){this.uiManager.pendingDragging=e}get mouse(){return this.inputManager.getMouseRef()}get keyState(){return this.inputManager.getKeyStateRef()}get once(){return new Set}get touchLastPan(){return this.inputManager.getTouchPan()}set touchLastPan(e){this.inputManager.setTouchPan(e)}get touchLastDist(){return this.inputManager.getTouchDist()}set touchLastDist(e){this.inputManager.setTouchDist(e)}get lastInputWasTouch(){return this.inputManager.wasLastInputTouch()}set lastInputWasTouch(e){this.inputManager.setLastInputWasTouch(e)}getEquippedItems(e){var n;const i=((n=e.inventory)==null?void 0:n.equipment)||{};return[i.helmet,i.armor,i.weapon,i.tool,i.accessory].filter(Boolean)}getMoveSpeedMultiplier(e){let i=0;for(const o of this.getEquippedItems(e)){if(!(o!=null&&o.defName))continue;const a=te.getItemDef(o.defName);a!=null&&a.movementPenalty&&(i+=a.movementPenalty)}i=Math.min(.4,Math.max(0,i));const n=1-i;return Math.max(.6,n)}getWorkSpeedMultiplier(e,i){let n=0;for(const s of this.getEquippedItems(e)){if(!(s!=null&&s.defName))continue;const r=te.getItemDef(s.defName);r!=null&&r.workSpeedBonus&&(!r.workTypes||r.workTypes.includes(i))&&(n+=r.workSpeedBonus)}n=Math.min(.8,Math.max(0,n));const o=e.manipulationMultiplier||1,a=e.consciousnessMultiplier||1;return(1+n)*o*a}getArmorReduction(e){var a;let i=0;const n=((a=e.inventory)==null?void 0:a.equipment)||{},o=[n.helmet,n.armor];for(const s of o){if(!(s!=null&&s.defName))continue;const r=te.getItemDef(s.defName);r!=null&&r.armorRating&&(i+=r.armorRating)}return Math.min(.8,Math.max(0,i))}applyDamageToColonist(e,i,n="bruise"){var r,l;e.health||Be(e);const o=this.getArmorReduction(e),a=i*(1-o),s=Ct(this,e,a,n,{damageMultiplier:1});if(s.died)this.msg(`${((r=e.profile)==null?void 0:r.name)||"Colonist"} died from ${s.cause||"injuries"}!`,"bad");else if(s.bodyPart){const c=s.fatal?"critically":"severely";this.msg(`${((l=e.profile)==null?void 0:l.name)||"Colonist"} ${c} injured in ${s.bodyPart} (${n})`,"warn")}}calculatePainFromDamage(e,i){return Math.min(1,({cut:.3,bruise:.1,burn:.4,bite:.35,gunshot:.5,fracture:.6}[e]||.2)*i)}calculateBleedingFromDamage(e,i){return Math.min(1,({cut:.4,bruise:0,burn:.1,bite:.3,gunshot:.5,fracture:.2}[e]||.1)*i)}calculateHealRate(e,i){return({cut:.8,bruise:1.2,burn:.6,bite:.7,gunshot:.4,fracture:.3}[e]||.8)*(1-i*.5)}calculateInfectionChance(e,i){return Math.min(.8,({cut:.15,bruise:0,burn:.25,bite:.4,gunshot:.3,fracture:.1}[e]||.1)*i)}generateInjuryDescription(e,i,n){const o=n<.2?"minor":n<.5?"moderate":n<.8?"severe":"critical";return{cut:`${o} laceration on ${i}`,bruise:`${o} bruising on ${i}`,burn:`${o} burn on ${i}`,bite:`${o} bite wound on ${i}`,gunshot:`${o} gunshot wound in ${i}`,fracture:`${o} fracture in ${i}`}[e]||`${o} injury to ${i}`}recalculateColonistHealth(e){if(!e.health)return;let i=0,n=0;for(const l of e.health.injuries)i+=l.pain,n+=l.bleeding;e.health.totalPain=Math.min(1,i),e.health.bloodLevel=Math.max(0,1-n),e.health.consciousness=Math.max(.1,1-i*.3-(1-e.health.bloodLevel)*.5);const o=e.health.injuries.filter(l=>l.bodyPart==="left_leg"||l.bodyPart==="right_leg");let a=0;for(const l of o)a+=l.severity*.3;e.health.mobility=Math.max(.2,1-a-i*.2);const s=e.health.injuries.filter(l=>l.bodyPart==="left_arm"||l.bodyPart==="right_arm");let r=0;for(const l of s)r+=l.severity*.4;e.health.manipulation=Math.max(.1,1-r-i*.3)}tryConsumeInventoryFood(e){var n,o,a;if(!e.inventory)return!1;const i=e.inventory.items;for(let s=0;s<i.length;s++){const r=i[s];if(!(r.category==="Food"||!!r.defName&&((n=te.getItemDef(r.defName))==null?void 0:n.category)==="Food")||r.quantity<=0)continue;const c=r.defName&&((o=te.getItemDef(r.defName))==null?void 0:o.nutrition)||10,h=Math.max(20,Math.min(70,Math.round(c*3)));return e.hunger=Math.max(0,(e.hunger||0)-h),e.hp=Math.min(100,e.hp+1.5),this.msg(`${((a=e.profile)==null?void 0:a.name)||"Colonist"} ate ${r.name}`,"good"),r.quantity-=1,r.quantity<=0&&i.splice(s,1),this.recalcInventoryWeight(e),!0}return!1}recalcInventoryWeight(e){if(!e.inventory)return;let i=0;for(const o of e.inventory.items)i+=(o.weight||0)*(o.quantity||1);const n=e.inventory.equipment||{};for(const o of["helmet","armor","weapon","tool","accessory"]){const a=n[o];a&&(i+=a.weight||0)}e.inventory.currentWeight=Math.round(i*100)/100}clampCameraToWorld(){const e=this.canvas.width/this.DPR/this.camera.zoom,i=this.canvas.height/this.DPR/this.camera.zoom,n=Math.max(0,Q.w-e),o=Math.max(0,Q.h-i);Number.isFinite(this.camera.x)||(this.camera.x=0),Number.isFinite(this.camera.y)||(this.camera.y=0),this.camera.x=ie(this.camera.x,0,n),this.camera.y=ie(this.camera.y,0,o)}calculateUIScale(){const n=this.canvas.width/this.DPR,o=this.canvas.height/this.DPR,a=n/1920,s=o/1080;let r=Math.min(a,s);const l="ontouchstart"in window||navigator.maxTouchPoints>0;this.isTouch=l,this.isActuallyTouchDevice=l&&n<900,l?n<600?r=Math.max(r*1.9,1.6):n<=900?r=Math.max(r*1.7,1.5):n<=1200?r=Math.max(r*1.5,1.35):r=Math.max(r*1.25,r):n<1200&&(r*=1.1),r=Math.max(1.1,Math.min(r,3)),this.uiScale=r,console.log(`UI Scale calculated: ${r.toFixed(2)} for ${n}x${o}`)}getScaledFont(e,i="500",n="system-ui,Segoe UI,Roboto"){return`${i} ${Math.round(e*this.uiScale)}px ${n}`}scale(e){return Math.round(e*this.uiScale)}bindInput(){const e=this.canvas;e.addEventListener("mousemove",i=>{const n=e.getBoundingClientRect();this.mouse.x=i.clientX-n.left,this.mouse.y=i.clientY-n.top;const o=this.screenToWorld(this.mouse.x,this.mouse.y);if(this.mouse.wx=o.x,this.mouse.wy=o.y,Ce()){Ks(this.mouse.x*this.DPR,this.mouse.y*this.DPR,this.colonists,this.canvas.width,this.canvas.height);return}if(this.pendingPlacement&&this.mouse.down){const a=V[this.pendingPlacement.key],s=this.pendingPlacement.rot||0,r=s===90||s===270,l=Math.floor(this.mouse.wx/A)*A,c=Math.floor(this.mouse.wy/A)*A,h=(r?a.size.h:a.size.w)*A,f=(r?a.size.w:a.size.h)*A;this.pendingPlacement.x=ie(l,0,Q.w-h),this.pendingPlacement.y=ie(c,0,Q.h-f);return}if(this.mouse.down){const a=this.selectedBuild?V[this.selectedBuild]:null;a!=null&&a.isFloor?this.paintPathAtMouse():this.selectedBuild==="wall"&&this.paintWallAtMouse()}}),e.addEventListener("mousedown",i=>{if(i.preventDefault(),this.lastInputWasTouch=!1,Ce())return jt(i.offsetX*this.DPR,i.offsetY*this.DPR,this.colonists,this.canvas.width,this.canvas.height),void 0;if(Dt())return Ft(i.offsetX*this.DPR,i.offsetY*this.DPR,this.canvas.width,this.canvas.height),void 0;if(i.button===0){if(this.mouse.down=!0,this.selColonist){const s=this.mouse.x*this.DPR,r=this.mouse.y*this.DPR;if(this.colonistPanelCloseRect){const l=this.colonistPanelCloseRect;if(s>=l.x&&s<=l.x+l.w&&r>=l.y&&r<=l.y+l.h){this.selColonist=null,this.follow=!1;return}}if(this.colonistTabRects){for(const l of this.colonistTabRects)if(s>=l.x&&s<=l.x+l.w&&r>=l.y&&r<=l.y+l.h){this.colonistProfileTab=l.tab;return}}if(this.colonistPanelRect){const l=this.colonistPanelRect;if(!(s>=l.x&&s<=l.x+l.w&&r>=l.y&&r<=l.y+l.h)){this.selColonist=null,this.follow=!1;return}}}if(this.pendingPlacement){const s=this.mouse.x*this.DPR,r=this.mouse.y*this.DPR;if(this.placeUIRects.length){for(const w of this.placeUIRects)if(s>=w.x&&s<=w.x+w.w&&r>=w.y&&r<=w.y+w.h){w.id==="up"?this.nudgePending(0,-1):w.id==="down"?this.nudgePending(0,1):w.id==="left"?this.nudgePending(-1,0):w.id==="right"?this.nudgePending(1,0):w.id==="ok"?this.confirmPending():w.id==="cancel"?this.cancelPending():w.id==="rotL"?this.rotatePending(-90):w.id==="rotR"&&this.rotatePending(90);return}}const l=this.pendingPlacement,c=V[l.key],f=((w,C)=>({x:(w-this.camera.x)*this.camera.zoom,y:(C-this.camera.y)*this.camera.zoom}))(l.x,l.y),d=c.size.w*A*this.camera.zoom,u=c.size.h*A*this.camera.zoom;if(s>=f.x&&s<=f.x+d&&r>=f.y&&r<=f.y+u){this.pendingDragging=!0;return}const m=l.rot||0,g=m===90||m===270,p=Math.floor(this.mouse.wx/A)*A,b=Math.floor(this.mouse.wy/A)*A,v=(g?c.size.h:c.size.w)*A,M=(g?c.size.w:c.size.h)*A;l.x=ie(p,0,Q.w-v),l.y=ie(b,0,Q.h-M);return}const n=this.mouse.x*this.DPR,o=this.mouse.y*this.DPR;for(const s of this.hotbarRects)if(n>=s.x&&n<=s.x+s.w&&o>=s.y&&o<=s.y+s.h){const r=this.hotbar[s.index];r&&(this.selectedBuild=r,this.toast("Selected: "+V[r].name));return}if(this.contextMenu){const s=this.mouse.x*this.DPR,r=this.mouse.y*this.DPR;let l=!1;const c=this.contextMenu;for(const h of this.contextMenuRects)if(s>=h.x&&s<=h.x+h.w&&r>=h.y&&r<=h.y+h.h){const f=h.item;if(!f)continue;const d=f.enabled!==!1;if(!h.isSubmenu&&f.submenu&&f.submenu.length){d&&(c.openSubmenu=c.openSubmenu===f.id?void 0:f.id),l=!0;return}d&&(f.action?f.action({game:this,target:c.target,item:f}):c.onSelect&&c.onSelect({game:this,target:c.target,item:f})),Re(this),l=!0;return}l||Re(this)}if(this.showBuildMenu){Bt(this);return}if(window._eraseOnce){window._eraseOnce=!1,this.cancelOrErase();return}const a=this.selectedBuild?V[this.selectedBuild]:null;if(a!=null&&a.isFloor)this.paintPathAtMouse(!0);else if(this.selectedBuild==="wall")this.paintWallAtMouse(!0);else{const s=this.findColonistAt(this.mouse.wx,this.mouse.wy);s?(this.selColonist=s,this.follow=!0):this.placeAtMouse()}}if(i.button===2){if(this.mouse.rdown=!0,this.showBuildMenu){this.showBuildMenu=!1;return}const n=this.findColonistAt(this.mouse.wx,this.mouse.wy);if(n){It(this,n,this.mouse.x,this.mouse.y);return}const o=this.findBuildingAt(this.mouse.wx,this.mouse.wy);if(o&&et(this,o,this.mouse.x,this.mouse.y))return;this.eraseDragStart={x:this.mouse.wx,y:this.mouse.wy}}}),e.addEventListener("mouseup",i=>{if(i.preventDefault(),i.button===0&&(this.mouse.down=!1,this.lastPaintCell=null,this.pendingDragging=!1),i.button===2){if(this.eraseDragStart){const n=Math.min(this.eraseDragStart.x,this.mouse.wx),o=Math.min(this.eraseDragStart.y,this.mouse.wy),a=Math.max(this.eraseDragStart.x,this.mouse.wx),s=Math.max(this.eraseDragStart.y,this.mouse.wy);(a-n)*(s-o)<12*12?this.cancelOrErase():this.eraseInRect({x:n,y:o,w:a-n,h:s-o})}this.mouse.rdown=!1,this.eraseDragStart=null}}),e.addEventListener("contextmenu",i=>i.preventDefault()),e.addEventListener("wheel",i=>{if(i.preventDefault(),Ce()){Zs(i.deltaY);return}const n=i.deltaY<0?1.1:.9,o=e.getBoundingClientRect(),a=i.clientX-o.left,s=i.clientY-o.top,r=this.screenToWorld(a,s),l=Math.max(.6,Math.min(2.2,this.camera.zoom*n));this.camera.zoom=l;const c=this.screenToWorld(a,s);this.camera.x+=r.x-c.x,this.camera.y+=r.y-c.y,this.clampCameraToWorld()}),this.inputManager.bindKeyboardEvents(()=>{const i=this.debugConsole;return i&&i.open}),window.addEventListener("keydown",i=>{const n=i;if(n.key==="`"||n.code==="Backquote"){i.preventDefault(),$s(this);return}er(this,i)&&(i.preventDefault(),i.stopPropagation())}),e.addEventListener("touchstart",i=>{if(i.preventDefault(),this.lastInputWasTouch=!0,this.isActuallyTouchDevice=!0,i.touches.length===1){this.touchLastPan={x:i.touches[0].clientX,y:i.touches[0].clientY};const n=e.getBoundingClientRect(),o=i.touches[0].clientX-n.left,a=i.touches[0].clientY-n.top,s=this.screenToWorld(o,a),r=this.findColonistAt(s.x,s.y);if(r)this.longPressStartPos={x:o,y:a},this.longPressStartTime=performance.now(),this.longPressTarget=r,this.longPressTargetType="colonist",this.longPressTimer=window.setTimeout(()=>{It(this,r,o,a),navigator.vibrate&&navigator.vibrate(50),this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null},500);else{const l=this.findBuildingAt(s.x,s.y);l&&(this.longPressStartPos={x:o,y:a},this.longPressStartTime=performance.now(),this.longPressTarget=l,this.longPressTargetType="building",this.longPressTimer=window.setTimeout(()=>{et(this,l,o,a),navigator.vibrate&&navigator.vibrate(50),this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null},500))}}else if(i.touches.length===2){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null;const n=i.touches[0].clientX-i.touches[1].clientX,o=i.touches[0].clientY-i.touches[1].clientY;this.touchLastDist=Math.hypot(n,o)}},{passive:!1}),e.addEventListener("touchmove",i=>{if(i.preventDefault(),this.lastInputWasTouch=!0,this.longPressTimer&&this.longPressStartPos&&i.touches.length===1){const n=e.getBoundingClientRect(),o=i.touches[0].clientX-n.left,a=i.touches[0].clientY-n.top;Math.hypot(o-this.longPressStartPos.x,a-this.longPressStartPos.y)>20&&(clearTimeout(this.longPressTimer),this.longPressTimer=null,this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null)}if(i.touches.length===1&&this.touchLastPan){if(this.pendingPlacement){const r=e.getBoundingClientRect(),l=i.touches[0].clientX-r.left,c=i.touches[0].clientY-r.top,h=this.screenToWorld(l,c);this.mouse.x=l,this.mouse.y=c,this.mouse.wx=h.x,this.mouse.wy=h.y;const f=V[this.pendingPlacement.key],d=this.pendingPlacement.rot||0,u=d===90||d===270,m=Math.floor(this.mouse.wx/A)*A,g=Math.floor(this.mouse.wy/A)*A,p=(u?f.size.h:f.size.w)*A,b=(u?f.size.w:f.size.h)*A;this.pendingPlacement.x=ie(m,0,Q.w-p),this.pendingPlacement.y=ie(g,0,Q.h-b);return}const n=i.touches[0].clientX,o=i.touches[0].clientY,a=n-this.touchLastPan.x,s=o-this.touchLastPan.y;this.touchLastPan={x:n,y:o},this.camera.x-=a/this.camera.zoom,this.camera.y-=s/this.camera.zoom,this.clampCameraToWorld()}else if(i.touches.length===2){const n=i.touches[0].clientX-i.touches[1].clientX,o=i.touches[0].clientY-i.touches[1].clientY,a=Math.hypot(n,o);if(this.touchLastDist!=null&&this.touchLastDist>0){const s=a/this.touchLastDist,r=e.getBoundingClientRect(),l=(i.touches[0].clientX+i.touches[1].clientX)/2-r.left,c=(i.touches[0].clientY+i.touches[1].clientY)/2-r.top,h=this.screenToWorld(l,c),f=Math.max(.6,Math.min(2.2,this.camera.zoom*s));this.camera.zoom=f;const d=this.screenToWorld(l,c);this.camera.x+=h.x-d.x,this.camera.y+=h.y-d.y,this.clampCameraToWorld()}this.touchLastDist=a}},{passive:!1}),e.addEventListener("touchend",i=>{if(i.preventDefault(),this.lastInputWasTouch=!0,this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.longPressStartPos=null,this.longPressStartTime=null,this.longPressTarget=null,this.longPressTargetType=null,i.changedTouches.length===1&&i.touches.length===0){const n=e.getBoundingClientRect(),o=i.changedTouches[0].clientX-n.left,a=i.changedTouches[0].clientY-n.top;this.handleTapOrClickAtScreen(o,a)}i.touches.length===0&&(this.touchLastPan=null,this.touchLastDist=null)},{passive:!1})}handleTapOrClickAtScreen(e,i){this.canvas.getBoundingClientRect(),this.mouse.x=e,this.mouse.y=i;const o=this.screenToWorld(this.mouse.x,this.mouse.y);if(this.mouse.wx=o.x,this.mouse.wy=o.y,Ce())return jt(e*this.DPR,i*this.DPR,this.colonists,this.canvas.width,this.canvas.height),void 0;if(Dt())return Ft(e*this.DPR,i*this.DPR,this.canvas.width,this.canvas.height),void 0;if(this.pendingPlacement){const h=this.mouse.x*this.DPR,f=this.mouse.y*this.DPR;if(this.placeUIRects.length){for(const k of this.placeUIRects)if(h>=k.x&&h<=k.x+k.w&&f>=k.y&&f<=k.y+k.h){k.id==="up"?this.nudgePending(0,-1):k.id==="down"?this.nudgePending(0,1):k.id==="left"?this.nudgePending(-1,0):k.id==="right"?this.nudgePending(1,0):k.id==="ok"?this.confirmPending():k.id==="cancel"?this.cancelPending():k.id==="rotL"?this.rotatePending(-90):k.id==="rotR"&&this.rotatePending(90);return}}const d=this.pendingPlacement,u=V[d.key],g=((k,S)=>({x:(k-this.camera.x)*this.camera.zoom,y:(S-this.camera.y)*this.camera.zoom}))(d.x,d.y),p=u.size.w*A*this.camera.zoom,b=u.size.h*A*this.camera.zoom;if(h>=g.x&&h<=g.x+p&&f>=g.y&&f<=g.y+b){this.confirmPending();return}const v=Math.floor(this.mouse.wx/A)*A,M=Math.floor(this.mouse.wy/A)*A,w=u.size.w*A,C=u.size.h*A;d.x=ie(v,0,Q.w-w),d.y=ie(M,0,Q.h-C);return}if(this.selColonist){const h=this.mouse.x*this.DPR,f=this.mouse.y*this.DPR;if(this.colonistPanelCloseRect){const d=this.colonistPanelCloseRect;if(h>=d.x&&h<=d.x+d.w&&f>=d.y&&f<=d.y+d.h){this.selColonist=null,this.follow=!1;return}}if(this.colonistTabRects){for(const d of this.colonistTabRects)if(h>=d.x&&h<=d.x+d.w&&f>=d.y&&f<=d.y+d.h){this.colonistProfileTab=d.tab;return}}if(this.isTouch&&this.colonistPanelRect){const d=this.colonistPanelRect;if(!(h>=d.x&&h<=d.x+d.w&&f>=d.y&&f<=d.y+d.h)){this.selColonist=null,this.follow=!1;return}}}const a=this.mouse.x*this.DPR,s=this.mouse.y*this.DPR;for(const h of this.hotbarRects)if(a>=h.x&&a<=h.x+h.w&&s>=h.y&&s<=h.y+h.h){const f=this.hotbar[h.index];f&&(this.selectedBuild=f,this.toast("Selected: "+V[f].name));return}if(this.contextMenu){const h=this.mouse.x*this.DPR,f=this.mouse.y*this.DPR;let d=!1;const u=this.contextMenu;for(const m of this.contextMenuRects)if(h>=m.x&&h<=m.x+m.w&&f>=m.y&&f<=m.y+m.h){const g=m.item;if(!g)continue;const p=g.enabled!==!1;if(!m.isSubmenu&&g.submenu&&g.submenu.length){p&&(u.openSubmenu=u.openSubmenu===g.id?void 0:g.id),d=!0;return}p&&(g.action?g.action({game:this,target:u.target,item:g}):u.onSelect&&u.onSelect({game:this,target:u.target,item:g})),Re(this),d=!0;return}d||Re(this)}if(this.showBuildMenu){Bt(this);return}if(window._eraseOnce){window._eraseOnce=!1,this.cancelOrErase();return}const r=this.selectedBuild?V[this.selectedBuild]:null;if(r!=null&&r.isFloor){this.paintPathAtMouse(!0);return}if(this.selectedBuild==="wall"){this.paintWallAtMouse(!0);return}if(!this.debug.forceDesktopMode&&this.isActuallyTouchDevice&&this.lastInputWasTouch&&this.selectedBuild){this.placeAtMouse();return}const l=this.findColonistAt(this.mouse.wx,this.mouse.wy);if(l){this.selColonist=l,this.follow=!0;return}const c=this.findBuildingAt(this.mouse.wx,this.mouse.wy);c&&et(this,c,this.mouse.x,this.mouse.y)||this.placeAtMouse()}findColonistAt(e,i){for(let n=this.colonists.length-1;n>=0;n--){const o=this.colonists[n],a=o.inside&&o.inside.kind!=="bed";if(!o.alive||a)continue;if((o.x-e)*(o.x-e)+(o.y-i)*(o.y-i)<=(o.r+2)*(o.r+2))return o}return null}findBuildingAt(e,i,n){const o=(n==null?void 0:n.includeUnderConstruction)??!1;for(let a=this.buildings.length-1;a>=0;a--){const s=this.buildings[a];if(!(!o&&!s.done)&&e>=s.x&&e<=s.x+s.w&&i>=s.y&&i<=s.y+s.h)return s}return null}msg(e,i="info"){this.messages.push({text:e,t:4,kind:i}),this.toast(e,1600)}toast(e,i=1400){const n=document.getElementById("toast");n&&(n.textContent=e,n.style.opacity="1",clearTimeout(n._t),n._t=setTimeout(()=>n.style.opacity="0",i))}scatter(){for(let e=0;e<220;e++){const i={x:ee(80,Q.w-80),y:ee(80,Q.h-80)};Math.hypot(i.x-oe.x,i.y-oe.y)<220||this.trees.push({x:i.x,y:i.y,r:12,hp:40,type:"tree"})}for(let e=0;e<140;e++){const i={x:ee(80,Q.w-80),y:ee(80,Q.h-80)};Math.hypot(i.x-oe.x,i.y-oe.y)<200||this.rocks.push({x:i.x,y:i.y,r:12,hp:50,type:"rock"})}this.rebuildNavGrid()}tryRespawn(e){if(this.respawnTimer+=e*this.fastForward,this.respawnTimer>=4){this.respawnTimer=0;const i=n=>{for(let o=0;o<6;o++){const a={x:ee(60,Q.w-60),y:ee(60,Q.h-60)};if(Math.hypot(a.x-oe.x,a.y-oe.y)<200)continue;let s=!0;for(const r of this.buildings)if(a.x>r.x-24&&a.x<r.x+r.w+24&&a.y>r.y-24&&a.y<r.y+r.h+24){s=!1;break}if(s){n==="tree"?this.trees.push({x:a.x,y:a.y,r:12,hp:40,type:"tree"}):this.rocks.push({x:a.x,y:a.y,r:12,hp:50,type:"rock"}),this.navigationManager.rebuildNavGridPartial(a.x,a.y,44);break}}};Math.random()<.5&&this.trees.length<260&&i("tree"),Math.random()<.35&&this.rocks.length<180&&i("rock")}}buildHQ(){const e={w:3*A,h:3*A},i={kind:"hq",name:"HQ",x:oe.x-e.w/2,y:oe.y-e.h/2,w:e.w,h:e.h,hp:600,done:!0,color:_.bld,size:{w:3,h:3},build:0,buildLeft:0};this.buildings.push(i),this.rebuildNavGrid()}newGame(){var i;this.colonists.length=this.enemies.length=this.trees.length=this.rocks.length=this.buildings.length=this.bullets.length=this.messages.length=0,this.buildReservations.clear(),this.insideCounts.clear(),this.sleepReservations.clear(),this.RES.wood=50,this.RES.stone=30,this.RES.food=20,this.day=1,this.tDay=0,this.fastForward=1,this.camera.zoom=1,this.camera.x=oe.x-this.canvas.width/this.DPR/(2*this.camera.zoom),this.camera.y=oe.y-this.canvas.height/this.DPR/(2*this.camera.zoom),this.buildHQ(),this.scatter();for(let n=0;n<3;n++){const o=ee(0,Math.PI*2),a=80+ee(-10,10);this.spawnColonist({x:oe.x+Math.cos(o)*a,y:oe.y+Math.sin(o)*a})}if(!this.colonists.some(n=>{var o,a;return((a=(o=n.inventory)==null?void 0:o.equipment)==null?void 0:a.weapon)&&(n.inventory.equipment.weapon.defName==="Pistol"||n.inventory.equipment.weapon.defName==="Rifle")})&&this.colonists.length){const n=this.colonists[0],o=te.createItem("Pistol",1,"normal");o&&(n.inventory||(n.inventory={items:[],equipment:{},carryCapacity:50,currentWeight:0}),n.inventory.equipment.weapon=o,this.recalcInventoryWeight(n),this.msg(`${((i=n.profile)==null?void 0:i.name)||"Colonist"} starts with a pistol for defense.`,"info"))}this.msg("Welcome! Build farms before night, then turrets.")}spawnColonist(e){const i=Ot(),n={x:e.x,y:e.y,r:8,hp:100,speed:50*i.stats.workSpeed,task:null,target:null,carrying:null,hunger:0,alive:!0,color:i.avatar.clothing,t:ee(0,1),direction:0,profile:i,inventory:JSON.parse(JSON.stringify(i.startingInventory))};return i.initialSkills&&(n.skills=i.initialSkills),Be(n),at(n),this.colonists.push(n),this.msg(`${Ds(i)} has joined the colony!`,"good"),n}spawnEnemy(){const e=Bi(0,4);let i,n;e===0?(i=ee(0,Q.w),n=-80):e===1?(i=ee(0,Q.w),n=Q.h+80):e===2?(i=-80,n=ee(0,Q.h)):(i=Q.w+80,n=ee(0,Q.h));const o={x:i,y:n,r:9,hp:60+this.day*6,speed:48+this.day*2,dmg:8+this.day,target:null,color:_.enemy};return this.enemies.push(o),o}placeAtMouse(){Xn(this)}tryPlaceNow(e,i,n,o){pt(this,e,i,n,o)}nudgePending(e,i){Jn(this,e,i)}rotatePending(e){Vn(this,e)}confirmPending(){Zn(this)}cancelPending(){Kn(this)}paintPathAtMouse(e=!1){_n(this,e)}paintWallAtMouse(e=!1){$n(this,e)}eraseInRect(e){eo(this,e)}cancelOrErase(){to(this)}evictColonistsFrom(e){yt(this,e)}buildingCapacity(e){return e.kind==="hq"?8:e.kind==="house"?3:typeof e.popCap=="number"?e.popCap:1}getReservedSleepCount(e,i){const n=this.sleepReservations.get(e);return!n||n.size===0?0:i&&n.has(i)?Math.max(0,n.size-1):n.size}buildingHasSpace(e,i){const n=this.buildingCapacity(e),o=this.insideCounts.get(e)||0,a=this.getReservedSleepCount(e,i);return o+a<n}reserveSleepSpot(e,i){if(!i.done)return!1;if(e.reservedSleepFor===i)return!0;e.reservedSleepFor&&e.reservedSleepFor!==i&&this.releaseSleepReservation(e);const n=this.buildingCapacity(i),o=this.insideCounts.get(i)||0,a=this.sleepReservations.get(i)||new Set;return o+a.size>=n?!1:(a.add(e),this.sleepReservations.set(i,a),e.reservedSleepFor=i,!0)}releaseSleepReservation(e){const i=e.reservedSleepFor;if(!i)return;const n=this.sleepReservations.get(i);n&&(n.delete(e),n.size===0&&this.sleepReservations.delete(i)),e.reservedSleepFor=null}tryEnterBuilding(e,i){if(!i.done||!this.buildingHasSpace(i,e))return!1;if(this.insideCounts.set(i,(this.insideCounts.get(i)||0)+1),this.releaseSleepReservation(e),e.inside=i,e.hideTimer=0,i.kind==="bed"){const n=this.centerOf(i);e.x=n.x,e.y=n.y,e.restingOn=i,e.sleepFacing=Math.PI/2}else e.restingOn=null;return!0}leaveBuilding(e){const i=e.inside;if(i){const n=(this.insideCounts.get(i)||1)-1;n<=0?this.insideCounts.delete(i):this.insideCounts.set(i,n)}i&&i.kind==="bed"&&(e.restingOn=null,e.sleepFacing=void 0),e.inside=null,e.hideTimer=0}getMaxCrew(e){const i=e.w/A*(e.h/A);return i<=1?1:i<=4?2:3}releaseBuildReservation(e){if(!e.reservedBuildFor)return;const i=e.reservedBuildFor,n=(this.buildReservations.get(i)||1)-1;n<=0?this.buildReservations.delete(i):this.buildReservations.set(i,n),e.reservedBuildFor=null}clearPath(e){e.path=void 0,e.pathIndex=void 0}setTask(e,i,n){if(e.target&&e.target.type&&this.assignedTargets.has(e.target)&&this.assignedTargets.delete(e.target),e.reservedBuildFor&&e.reservedBuildFor!==n&&this.releaseBuildReservation(e),e.task=i,e.target=n,this.clearPath(e),n&&n.type&&(n.type==="tree"||n.type==="rock")&&this.assignedTargets.add(n),i==="build"&&n&&n.w!=null&&!e.reservedBuildFor){const o=n,a=this.buildReservations.get(o)||0,s=this.getMaxCrew(o);a<s&&(this.buildReservations.set(o,a+1),e.reservedBuildFor=o)}}pickTask(e){var a,s;if(e.workPriorities||at(e),this.isNight()){this.setTask(e,"idle",{x:e.x,y:e.y});return}const i=[],n=r=>{const l=e.workPriorities;if(!l||!l[r])return 3;const c=l[r];return c===0?999:c},o=r=>{const l=e.workPriorities;return l?l[r]!==0:!0};if(o("Construction"))for(const r of this.buildings){if(r.done||(this.buildReservations.get(r)||0)>=this.getMaxCrew(r))continue;const c=Math.hypot(e.x-(r.x+r.w/2),e.y-(r.y+r.h/2));i.push({workType:"Construction",task:"build",target:r,distance:c,priority:n("Construction")})}if(o("Growing")){const r=this.buildings.find(l=>l.kind==="farm"&&l.done&&l.ready);if(r){const l=Math.hypot(e.x-(r.x+r.w/2),e.y-(r.y+r.h/2));i.push({workType:"Growing",task:"harvestFarm",target:r,distance:l,priority:n("Growing")})}if(Math.random()<.1){const l=this.buildings.find(c=>c.kind==="well"&&c.done);if(l){const c=Math.hypot(e.x-(l.x+l.w/2),e.y-(l.y+l.h/2));i.push({workType:"Growing",task:"harvestWell",target:l,distance:c,priority:n("Growing")})}}}if(o("PlantCutting")&&(this.RES.food<Math.max(4,this.colonists.length*2)||this.RES.wood<this.RES.stone)){const l=this.trees.filter(h=>!this.assignedTargets.has(h)),c=this.nearestSafeCircle(e,{x:e.x,y:e.y},l);if(c){const h=Math.hypot(e.x-c.x,e.y-c.y);i.push({workType:"PlantCutting",task:"chop",target:c,distance:h,priority:n("PlantCutting")})}}if(o("Mining")&&(this.RES.stone<this.RES.wood||this.RES.stone<20)){const r=this.rocks.filter(c=>!this.assignedTargets.has(c)),l=this.nearestSafeCircle(e,{x:e.x,y:e.y},r);if(l){const c=Math.hypot(e.x-l.x,e.y-l.y);i.push({workType:"Mining",task:"mine",target:l,distance:c,priority:n("Mining")})}}if(o("Cooking")){const r=this.buildings.filter(h=>h.kind==="stove"&&h.done),l=this.buildings.filter(h=>h.kind==="farm"&&h.done);let c=this.RES.wheat||0;for(const h of l)h.inventory&&(c+=gi(h,"wheat"));if(r.length>0&&c>=5){const h=r.find(f=>!f.cookingColonist||f.cookingColonist===e.id);if(h){const f=Math.hypot(e.x-(h.x+h.w/2),e.y-(h.y+h.h/2));i.push({workType:"Cooking",task:"cookWheat",target:h,distance:f,priority:n("Cooking")})}}if(e.carryingBread&&e.carryingBread>0){const h=this.buildings.filter(f=>f.kind==="pantry"&&f.done);if(h.length>0){const f=h.reduce((u,m)=>{const g=Math.hypot(e.x-(m.x+m.w/2),e.y-(m.y+m.h/2)),p=Math.hypot(e.x-(u.x+u.w/2),e.y-(u.y+u.h/2));return g<p?m:u}),d=Math.hypot(e.x-(f.x+f.w/2),e.y-(f.y+f.h/2));i.push({workType:"Cooking",task:"storeBread",target:f,distance:d,priority:n("Cooking")-1})}}}if(i.sort((r,l)=>r.priority!==l.priority?r.priority-l.priority:r.distance-l.distance),i.length>0){const r=i[0];this.setTask(e,r.task,r.target),Math.random()<.1&&console.log(`Colonist ${((a=e.profile)==null?void 0:a.name)||"Unknown"} assigned ${r.workType} (priority ${r.priority}): ${r.task}`)}else this.setTask(e,"idle",{x:e.x+ee(-80,80),y:e.y+ee(-80,80)}),Math.random()<.05&&console.log(`Colonist ${((s=e.profile)==null?void 0:s.name)||"Unknown"} has no available work (idling)`)}nearestCircle(e,i){let n=null,o=1e9;for(const a of i){const s=re(e,a);s<o&&(o=s,n=a)}return n}nearestSafeCircle(e,i,n){return this.nearestCircle(i,n)}moveAlongPath(e,i,n,o=10){const a=n&&(!e.pathGoal||Math.hypot(e.pathGoal.x-n.x,e.pathGoal.y-n.y)>24);if(n&&(a||!e.path||e.pathIndex==null)){const p=this.computePathWithDangerAvoidance(e,e.x,e.y,n.x,n.y);if(p&&p.length){if(e.path=p,e.pathIndex=0,e.pathGoal={x:n.x,y:n.y},Math.random()<.1){let b=0;for(const v of p){const M=Math.floor(v.x/A),w=Math.floor(v.y/A);if(M>=0&&w>=0&&M<this.grid.cols&&w<this.grid.rows){const C=w*this.grid.cols+M;this.grid.cost[C]<=.7&&b++}}b>0&&console.log(`Computed path with ${b}/${p.length} low-cost tiles`)}}else Math.random()<.05&&console.log(`Failed to compute path from (${e.x.toFixed(1)}, ${e.y.toFixed(1)}) to (${n.x.toFixed(1)}, ${n.y.toFixed(1)})`)}if(!e.path||e.pathIndex==null||e.pathIndex>=e.path.length)return n?Math.hypot(e.x-n.x,e.y-n.y)<=o:!1;const s=e.path[e.pathIndex];if(!s||s.x==null||s.y==null)return console.log(`Invalid path node at index ${e.pathIndex}, clearing path`),this.clearPath(e),n?Math.hypot(e.x-n.x,e.y-n.y)<=o:!1;const r=s.x-e.x,l=s.y-e.y;let c=Math.hypot(r,l);const h=15,f=6;let d=e.speed*(e.fatigueSlow||1)*this.getMoveSpeedMultiplier(e),u=d,m=!1;{const p=Math.floor(e.x/A),b=Math.floor(e.y/A);if(p>=0&&b>=0&&p<this.grid.cols&&b<this.grid.rows){const M=b*this.grid.cols+p,w=this.grid.cost[M];w>0&&w<1?(u=d/w,m=!0):w>1&&(u=d/w),m&&Math.random()<.01&&console.log(`Colonist at (${e.x.toFixed(1)}, ${e.y.toFixed(1)}) on floor - cost: ${w.toFixed(2)}, speed: ${u.toFixed(1)} (base: ${d.toFixed(1)})`)}}const g=u*i;if(c<=Math.max(h,g))return e.x=s.x,e.y=s.y,e.pathIndex++,e.jitterScore=0,e.jitterWindow=0,e.lastDistToNode=void 0,e.lastDistSign=void 0,e.pathIndex>=e.path.length?(e.path=void 0,e.pathIndex=void 0,n?Math.hypot(e.x-n.x,e.y-n.y)<=o:!0):!1;if(e.jitterWindow=(e.jitterWindow||0)+i,e.lastDistToNode!=null){const p=c-e.lastDistToNode,b=p===0?0:p>0?1:-1,v=e.lastDistSign??b;b!==0&&v!==0&&b!==v&&c<h+15?e.jitterScore=(e.jitterScore||0)+1:e.jitterScore=Math.max(0,(e.jitterScore||0)-1),e.lastDistSign=b}if(e.lastDistToNode=c,(e.jitterScore||0)>=8||(e.jitterWindow||0)>3){if(c<h+f){if(e.pathIndex++,e.pathIndex>=e.path.length)return this.clearPath(e),n?Math.hypot(e.x-n.x,e.y-n.y)<=o:!1}else if(n){const p=this.computePath(e.x,e.y,n.x,n.y);p&&p.length&&(e.path=p,e.pathIndex=0)}if(e.jitterScore=0,e.jitterWindow=0,e.lastDistToNode=void 0,e.lastDistSign=void 0,!e.path||e.pathIndex==null||e.pathIndex>=e.path.length)return!1}return c>1&&(e.direction=Math.atan2(l,r)),e.x=Math.max(0,Math.min(e.x+r/(c||1)*g,Q.w)),e.y=Math.max(0,Math.min(e.y+l/(c||1)*g,Q.h)),!1}findSafeTurret(e,i){let n=null,o=1/0;for(const a of this.buildings){if(a.kind!=="turret"||!a.done)continue;const s=this.centerOf(a),r=Math.hypot(e.x-s.x,e.y-s.y),l=Math.hypot(i.x-s.x,i.y-s.y),c=a.range||160,h=l<c?100:0,f=r+h;f<o&&(o=f,n=a)}return n}isProtectedByTurret(e){const i=this.centerOf(e);for(const n of this.buildings){if(n.kind!=="turret"||!n.done)continue;const o=n.range||120,a=this.centerOf(n);if(re(i,a)<o*o)return!0}return!1}centerOf(e){return{x:e.x+e.w/2,y:e.y+e.h/2}}pointInRect(e,i){return e.x>=i.x&&e.x<=i.x+i.w&&e.y>=i.y&&e.y<=i.y+i.h}updateTurret(e,i){Ls(this,e,i)}isNight(){return this.timeSystem.isNight()}spawnWave(){const e=4+Math.floor(this.day*1.3);for(let i=0;i<e;i++)this.spawnEnemy();this.msg(`Night ${this.day}: Enemies incoming!`,"warn")}nextDay(){this.waveSpawnedForDay=!1;let e=0;for(let o=0;o<this.colonists.length;o++)this.RES.food>0?this.RES.food-=1:(e++,this.colonists[o]&&(this.colonists[o].alive=!1));e>0&&(this.colonists=this.colonists.filter(o=>o.alive),this.msg(`${e} colonist(s) starved`,"bad"));for(const o of this.buildings)o.kind==="farm"&&o.done&&(o.growth=(o.growth||0)+.5,(o.growth||0)>=(o.growTime||1)&&(o.ready=!0));const i=this.buildings.find(o=>o.kind==="tent"&&o.done),n=this.getPopulationCap();i&&this.colonists.length<n&&this.RES.food>=15&&(this.RES.food-=15,this.spawnColonist({x:oe.x+ee(-20,20),y:oe.y+ee(-20,20)}),this.msg("A new colonist joined! (-15 food)","info")),this.day>20&&this.win()}dayTick(e){const i=this.timeSystem.getDay();this.timeSystem.update(e),this.timeSystem.getDay()>i&&this.nextDay(),this.timeSystem.didNightJustStart()&&(this.disableEnemySpawns||this.spawnWave());for(let o=this.colonists.length-1;o>=0;o--){const a=this.colonists[o];if(!a.alive){this.releaseSleepReservation(a),a.inside&&this.leaveBuilding(a),this.colonists.splice(o,1);continue}a.profile||(a.profile=Ot(),a.color=a.profile.avatar.clothing,a.speed=50*a.profile.stats.workSpeed),a.hp<=0&&(a.alive=!1)}}keyPressed(e){return this.inputManager.keyPressed(e)}update(e){const i=this.debugConsole,n=!!(i&&i.open);if(Ce()){!n&&this.keyPressed("p")&&(it(),this.toast("Work Priorities Panel closed")),!n&&this.keyPressed("escape")&&(it(),this.toast("Work Priorities Panel closed"));return}if(!n&&this.keyPressed(" ")){this.paused=!this.paused;const s=document.getElementById("btnPause");s&&(s.textContent=this.paused?"Resume":"Pause")}if(!n&&this.keyPressed("h")){const s=document.getElementById("help");s&&(s.hidden=!s.hidden)}!n&&this.keyPressed("b")&&(this.showBuildMenu=!this.showBuildMenu),!n&&this.keyPressed("p")&&(it(),this.toast(Ce()?"Work Priorities Panel opened":"Work Priorities Panel closed")),!n&&this.keyPressed("g")&&(this.debug.nav=!this.debug.nav,this.toast(this.debug.nav?"Debug: nav ON":"Debug: nav OFF")),!n&&this.keyPressed("j")&&(this.debug.colonists=!this.debug.colonists,this.toast(this.debug.colonists?"Debug: colonists ON":"Debug: colonists OFF")),!n&&this.keyPressed("r")&&(this.debug.regions=!this.debug.regions,this.toast(this.debug.regions?"Debug: regions ON":"Debug: regions OFF")),!n&&this.keyPressed("t")&&(this.debug.terrain=!this.debug.terrain,this.toast(this.debug.terrain?"Debug: terrain ON":"Debug: terrain OFF")),!n&&this.keyPressed("k")&&(this.debug.forceDesktopMode=!this.debug.forceDesktopMode,this.toast(this.debug.forceDesktopMode?"Debug: Force Desktop Mode ON":"Debug: Force Desktop Mode OFF")),!n&&this.keyPressed("escape")&&(this.showBuildMenu?this.showBuildMenu=!1:(this.selectedBuild=null,this.toast("Build canceled"),this.selColonist=null,this.follow=!1)),!n&&this.keyPressed("f")&&(this.fastForward=this.fastForward===1?6:1,this.toast(this.fastForward>1?"Fast-forward ON":"Fast-forward OFF"));const a=360*e/this.camera.zoom;if(this.keyState.w&&(this.camera.y-=a),this.keyState.s&&(this.camera.y+=a),this.keyState.a&&(this.camera.x-=a),this.keyState.d&&(this.camera.x+=a),(this.keyState["+"]||this.keyState["="])&&(this.camera.zoom=Math.max(.6,Math.min(2.2,this.camera.zoom*1.02))),(this.keyState["-"]||this.keyState._)&&(this.camera.zoom=Math.max(.6,Math.min(2.2,this.camera.zoom/1.02))),!this.paused){for(const[s,r]of this.hotbar.entries())this.keyPressed(String(s+1))&&(this.selectedBuild=r,this.toast("Selected: "+V[r].name));if(this.follow&&this.selColonist){const s=this.selColonist,r=this.canvas.width/this.camera.zoom,l=this.canvas.height/this.camera.zoom;this.camera.x=ie(s.x-r/2,0,Math.max(0,Q.w-r)),this.camera.y=ie(s.y-l/2,0,Math.max(0,Q.h-l))}this.dayTick(e);for(const s of this.colonists)s.alive&&(s.health||Be(s),Us(this,s,e*this.fastForward),Bn(this,s,e*this.fastForward));for(let s=this.enemies.length-1;s>=0;s--){const r=this.enemies[s];Gn(this,r,e*this.fastForward),r.hp<=0&&(this.enemies.splice(s,1),Math.random()<.5&&(this.RES.food+=1))}for(const s of this.buildings){if(s.kind==="turret"&&s.done&&this.updateTurret(s,e*this.fastForward),s.kind==="door"&&s.done&&Cn(s,e*this.fastForward,this.tDay),s.healRate&&s.done){const r=s.healRate,l=s.healRange||120,c=this.centerOf(s);for(const h of this.colonists){if(!h.alive)continue;(h.x-c.x)*(h.x-c.x)+(h.y-c.y)*(h.y-c.y)<l*l&&(h.hp=Math.min(100,h.hp+r*e*this.fastForward))}}if(s.kind==="tent"&&s.done&&(s.cooldown=(s.cooldown||0)-e*this.fastForward,s.cooldown<=0&&this.RES.food>=15)){const r=this.getPopulationCap(),l=this.colonists.filter(d=>d.alive).length,f=Math.max(25,l*8)+15;if(this.colonists.length<r&&this.RES.food>=f){this.RES.food-=15;const d=this.centerOf(s);this.spawnColonist({x:d.x+(Math.random()-.5)*40,y:d.y+(Math.random()-.5)*40}),this.msg("Recruit tent attracted a new colonist! (-15 food)","good"),s.cooldown=60}else this.RES.food<f&&this.RES.food>=15}}this.tryRespawn(e),Ns(this,e);for(let s=this.messages.length-1;s>=0;s--){const r=this.messages[s];r.t-=e,r.t<=0&&this.messages.splice(s,1)}}}draw(){this.renderManager.render()}costText(e){const i=[];return e.wood&&i.push(`${e.wood}w`),e.stone&&i.push(`${e.stone}s`),e.food&&i.push(`${e.food}f`),i.join(" ")}win(){this.paused=!0,this.msg("You survived! Day 20 reached.","good"),alert("You survived to Day 20 — victory!")}lose(){this.paused=!0,this.msg("HQ destroyed. Colony fell.","bad"),alert("Your HQ was destroyed. Game over.")}rebuildNavGrid(){this.navigationManager.rebuildNavGrid()}syncTerrainToGrid(){this.navigationManager.syncTerrainToGrid()}computePath(e,i,n,o){return this.navigationManager.computePath(e,i,n,o)}computePathWithDangerAvoidance(e,i,n,o,a){return this.navigationManager.computePathWithDangerAvoidance(e,i,n,o,a)}cellIndexAt(e,i){return this.navigationManager.cellIndexAt(e,i)}isBlocked(e,i){return this.navigationManager.isBlocked(e,i)}findNearestBuildingByRegion(e,i,n){return this.navigationManager.findNearestBuildingByRegion(e,i,n)}findNearestTreeByRegion(e,i){return this.navigationManager.findNearestTreeByRegion(e,i)}isReachable(e,i,n,o){return this.navigationManager.isReachable(e,i,n,o)}isWithinInteractionRange(e,i,n,o){return this.navigationManager.isWithinInteractionRange(e,i,n,o)}bestApproachToCircle(e,i,n){return this.navigationManager.bestApproachToCircle(e,i,n)}handleContextMenuAction(e,i){var n,o,a,s,r,l,c,h,f,d,u,m,g,p,b,v;switch(console.log(`Context menu action: ${e} for colonist:`,(n=i.profile)==null?void 0:n.name),e){case"prioritize_medical":this.setColonistMedicalPriority(i,!0),this.msg(`${((o=i.profile)==null?void 0:o.name)||"Colonist"} prioritizing medical work`,"info");break;case"prioritize_work":this.setTask(i,"work",this.findNearestWorkTarget(i)),this.msg(`${((a=i.profile)==null?void 0:a.name)||"Colonist"} prioritizing work tasks`,"info");break;case"prioritize_build":this.setTask(i,"build",this.findNearestBuildTarget(i)),this.msg(`${((s=i.profile)==null?void 0:s.name)||"Colonist"} prioritizing construction`,"info");break;case"prioritize_haul":this.msg(`${((r=i.profile)==null?void 0:r.name)||"Colonist"} prioritizing hauling`,"info");break;case"prioritize_research":this.msg(`${((l=i.profile)==null?void 0:l.name)||"Colonist"} prioritizing research`,"info");break;case"force_rest":this.forceColonistToRest(i);break;case"force_eat":this.forceColonistToEat(i);break;case"force_work":this.setTask(i,"work",this.findNearestWorkTarget(i)),this.msg(`${((c=i.profile)==null?void 0:c.name)||"Colonist"} forced to work`,"info");break;case"force_guard":this.setTask(i,"guard",{x:i.x,y:i.y}),this.msg(`${((h=i.profile)==null?void 0:h.name)||"Colonist"} guarding area`,"info");break;case"goto_hq":this.sendColonistToHQ(i);break;case"goto_safety":this.sendColonistToSafety(i);break;case"goto_bed":this.sendColonistToBed(i);break;case"goto_food":this.sendColonistToFood(i);break;case"medical_bandage":this.assignMedicalTreatment(i,"bandage_wound");break;case"medical_treat_infection":this.assignMedicalTreatment(i,"treat_infection");break;case"medical_surgery":this.assignMedicalTreatment(i,"remove_bullet");break;case"medical_pain_relief":this.assignMedicalTreatment(i,"pain_management");break;case"medical_treat_all":this.assignComprehensiveMedicalCare(i);break;case"medical_treat":this.treatColonist(i);break;case"medical_rest":this.forceColonistToRest(i),this.msg(`${((f=i.profile)==null?void 0:f.name)||"Colonist"} ordered to bed rest`,"info");break;case"medical_injury_summary":if(i.health){const w=mn(i.health);this.msg(`${((d=i.profile)==null?void 0:d.name)||"Colonist"}: ${w}`,"info")}else this.msg("No health data","warn");break;case"medical_bandage_all_bleeding":if(i.health){let w=0;for(const C of i.health.injuries)C.bleeding>0&&!C.bandaged&&(C.bandaged=!0,C.bleeding*=.2,C.infectionChance*=.5,w++);this.msg(w?`Applied bandages to ${w} wound${w>1?"s":""}`:"No bleeding wounds",w?"good":"info")}break;case"prioritize_treat_patient":{const w=this.selColonist;w&&w!==i&&(w.assignedMedicalPatientId=i.id||(i.id=`colonist_${Date.now()}_${Math.random().toString(36).slice(2,9)}`),w.medicalPriorityUntil=w.t+60,this.msg(`${((u=w.profile)==null?void 0:u.name)||"Doctor"} will prioritize treating ${((m=i.profile)==null?void 0:m.name)||"Patient"}`,"info"));break}case"clear_prioritize_treat":{const w=this.selColonist;w&&w.assignedMedicalPatientId&&(w.assignedMedicalPatientId=void 0,w.medicalPriorityUntil=void 0,this.msg(`${((g=w.profile)==null?void 0:g.name)||"Doctor"} cleared treatment priority`,"info"));break}case"medical_bandage":this.assignMedicalTreatment(i,"bandage_wound");break;case"medical_rescue":if(this.findBestDoctor(i)||this.colonists.find(w=>w!==i&&w.alive&&w.state!=="downed")){const w=this.findBestRestBuilding(i,{preferMedical:!0,allowShelterFallback:!0});if(w){i.x=w.x+w.w/2,i.y=w.y+w.h/2;const C=w.kind==="bed"?w.isMedicalBed?"medical bed":"bed":w.name||"shelter";this.msg(`${((p=i.profile)==null?void 0:p.name)||"Colonist"} rescued to ${C}`,w.isMedicalBed?"good":"info")}else this.msg("No bed available for rescue","warn")}else this.msg("No rescuer available","warn");break;case"cancel":this.setTask(i,"idle",{x:i.x,y:i.y}),this.msg(`${((b=i.profile)==null?void 0:b.name)||"Colonist"} task cancelled`,"info");break;case"follow":this.follow&&this.selColonist===i?(this.follow=!1,this.selColonist=null,this.msg("Stopped following","info")):(this.selColonist=i,this.follow=!0,this.msg(`Following ${((v=i.profile)==null?void 0:v.name)||"colonist"}`,"info"));break}Re(this)}findNearestWorkTarget(e){let i=null,n=1/0;for(const o of this.buildings)if(!o.done){const a=Math.hypot(e.x-(o.x+o.w/2),e.y-(o.y+o.h/2));a<n&&(n=a,i=o)}return i||{x:e.x+ee(-50,50),y:e.y+ee(-50,50)}}findNearestBuildTarget(e){return this.findNearestWorkTarget(e)}colonistNeedsMedicalBed(e){var n;return e.state==="downed"||e.hp<60?!0:(((n=e.health)==null?void 0:n.injuries)??[]).some(o=>o.bleeding>0||o.severity>.25||o.infected)}findBestRestBuilding(e,i){const{requireMedical:n=!1,preferMedical:o=!1,allowShelterFallback:a=!0}=i||{},s=this.buildings.filter(u=>u.kind==="bed"&&u.done&&this.buildingHasSpace(u,e)),r=s.filter(u=>u.isMedicalBed),l=s.filter(u=>!u.isMedicalBed),c=[];n?c.push(...r):o&&r.length>0?c.push(...r,...l):c.push(...l,...r);const h=u=>{let m=null,g=1/0;for(const p of u){const b=this.centerOf(p),v=Math.hypot(b.x-e.x,b.y-e.y);v<g&&(g=v,m=p)}return m},f=h(c);if(f)return f;if(!a)return null;const d=this.buildings.filter(u=>(u.kind==="house"||u.kind==="tent"||u.kind==="hq"||u.kind==="infirmary")&&u.done&&this.buildingHasSpace(u,e));return h(d)}forceColonistToRest(e){var o;const i=this.colonistNeedsMedicalBed(e),n=this.findBestRestBuilding(e,{preferMedical:i,allowShelterFallback:!0});if(n){this.setTask(e,"rest",n);const a=n.kind==="bed"?n.isMedicalBed?"medical bed":"bed":n.name||n.kind;this.msg(`${((o=e.profile)==null?void 0:o.name)||"Colonist"} going to ${a}`,"info")}else this.msg("No available sleeping quarters","warn")}forceColonistToEat(e){var i;this.RES.food>0?(e.hunger=Math.max(0,(e.hunger||0)-30),this.RES.food=Math.max(0,this.RES.food-1),this.msg(`${((i=e.profile)==null?void 0:i.name)||"Colonist"} eating food`,"good")):this.msg("No food available","warn")}sendColonistToHQ(e){var n;const i=this.buildings.find(o=>o.kind==="hq");if(i){const o={x:i.x+i.w/2,y:i.y+i.h/2};this.setTask(e,"goto",o),this.msg(`${((n=e.profile)==null?void 0:n.name)||"Colonist"} going to HQ`,"info")}}sendColonistToSafety(e){var i;for(const n of this.buildings)if(n.done&&this.isProtectedByTurret(n)&&this.buildingHasSpace(n)){this.setTask(e,"goto",n),this.msg(`${((i=e.profile)==null?void 0:i.name)||"Colonist"} going to safety`,"info");return}this.sendColonistToHQ(e)}sendColonistToBed(e){var o;const i=this.colonistNeedsMedicalBed(e),n=this.findBestRestBuilding(e,{preferMedical:i,allowShelterFallback:!0});if(n){this.setTask(e,"rest",n);const a=n.kind==="bed"?n.isMedicalBed?"medical bed":"bed":"shelter";this.msg(`${((o=e.profile)==null?void 0:o.name)||"Colonist"} going to ${a}`,"info")}else this.msg("No available beds","warn")}sendColonistToFood(e){var n;const i=this.buildings.find(o=>(o.kind==="warehouse"||o.kind==="hq")&&o.done);if(i){const o={x:i.x+i.w/2,y:i.y+i.h/2};this.setTask(e,"goto",o),this.msg(`${((n=e.profile)==null?void 0:n.name)||"Colonist"} going to food storage`,"info")}else this.sendColonistToHQ(e)}treatColonist(e){var n,o,a;const i=this.buildings.find(s=>s.kind==="infirmary"&&s.done);if(i)this.setTask(e,"medical",i),this.msg(`${((n=e.profile)==null?void 0:n.name)||"Colonist"} going for medical treatment`,"info");else if(e.health){const s=bn(e.health);e.hp=Math.min(100,ut(e.health)),this.msg(`${((o=e.profile)==null?void 0:o.name)||"Colonist"} field-treated (${s.bandaged} bandaged, pain -${s.painReduced.toFixed(2)})`,"good")}else e.hp=Math.min(100,e.hp+10),this.msg(`${((a=e.profile)==null?void 0:a.name)||"Colonist"} received crude aid`,"info")}setColonistMedicalPriority(e,i){e.medicalPriority=i,i&&this.setTask(e,"seekMedical",null)}assignMedicalTreatment(e,i){var a,s,r;const n=this.findBestDoctor(e);if(!n){this.msg("No available doctor for treatment","warn");return}const o=pe.createForcedJob(n,e,i);o?(pe.reserveJob(o,n),n.medicalJob=o,n.task=null,n.target=null,this.clearPath(n),this.msg(`${((a=n.profile)==null?void 0:a.name)||"Doctor"} treating ${((s=e.profile)==null?void 0:s.name)||"patient"} with ${((r=o.treatment)==null?void 0:r.name)||"treatment"}`,"info")):this.msg(`Cannot apply ${i} treatment`,"warn")}assignComprehensiveMedicalCare(e){var r,l,c,h,f;if(!((l=(r=e.health)==null?void 0:r.injuries)!=null&&l.length)){this.msg(`${((c=e.profile)==null?void 0:c.name)||"Colonist"} has no injuries to treat`,"info");return}const i=this.findBestDoctor(e);if(!i){this.msg("No available doctor for comprehensive care","warn");return}const o=[...e.health.injuries].sort((d,u)=>{const m=(d.bleeding||0)*2+(d.severity||0);return(u.bleeding||0)*2+(u.severity||0)-m})[0];let a="bandage_wound";o.infected?a="treat_infection":o.type==="gunshot"?a="surgical_repair":o.bleeding>0?a="bandage_wound":o.severity>.6&&(a="advanced_treatment");const s=pe.createForcedJob(i,e,a);s?(pe.reserveJob(s,i),i.medicalJob=s,i.task=null,i.target=null,this.clearPath(i),this.msg(`${((h=i.profile)==null?void 0:h.name)||"Doctor"} providing comprehensive care to ${((f=e.profile)==null?void 0:f.name)||"patient"}`,"info")):this.msg("Failed to create medical job","warn")}findBestDoctor(e){const i=this.colonists.filter(n=>!(n===e||!n.alive||n.task&&n.task!=="idle"&&n.task!=="seekTask"));return i.length===0?null:(i.sort((n,o)=>{const a=this.getColonistMedicalSkill(n);return this.getColonistMedicalSkill(o)-a}),i[0])}getColonistMedicalSkill(e){var a,s;const i=(a=e.profile)==null?void 0:a.detailedInfo.skills.includes("First Aid"),n=((s=e.profile)==null?void 0:s.background)==="Medic";let o=0;return i&&(o+=3),n&&(o+=5),o}drawLongPressProgress(){if(!this.longPressStartTime||!this.longPressTarget||!this.longPressStartPos)return;const e=this.ctx,n=performance.now()-this.longPressStartTime,o=Math.min(n/500,1);if(o>=1)return;const a=this.longPressTarget,r=this.longPressTargetType==="building"&&a?this.centerOf(a):{x:a.x,y:a.y},l=(r.x-this.camera.x)*this.camera.zoom,c=(r.y-this.camera.y)*this.camera.zoom;e.save();const h=this.scale(20),f=l,d=c;e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=this.scale(3),e.beginPath(),e.arc(f,d,h,0,Math.PI*2),e.stroke(),e.strokeStyle="#60a5fa",e.lineWidth=this.scale(3),e.lineCap="round",e.beginPath();const u=-Math.PI/2,m=u+o*Math.PI*2;if(e.arc(f,d,h,u,m),e.stroke(),o>.3){const g=Math.sin(n/100*Math.PI)*.3+.1;e.fillStyle=`rgba(96, 165, 250, ${g})`,e.beginPath(),e.arc(f,d,h*.6,0,Math.PI*2),e.fill()}o>.5&&(e.fillStyle="#ffffff",e.font=this.getScaledFont(12,"600"),e.textAlign="center",e.textBaseline="middle",e.fillText("⚙️",f,d)),e.restore()}barRow(e,i,n,o,a){const s=this.ctx;s.fillStyle="#dbeafe",s.fillText(n,e,i);const r=this.scale(140),l=this.scale(10),c=s.measureText(n).width,h=Math.max(this.scale(86),c+this.scale(14));s.fillStyle="#0f172a",s.fillRect(e+h,i-this.scale(8),r,l),s.strokeStyle="#1e293b",s.strokeRect(e+h+.5,i-this.scale(8)+.5,r-1,l-1),s.fillStyle=a,s.fillRect(e+h+this.scale(2),i-this.scale(6),Math.max(0,Math.min(r-this.scale(4),o/100*(r-this.scale(4)))),l-this.scale(4))}}function Wr(){if(document.getElementById("error-overlay"))return;const e=document.createElement("div");e.id="error-overlay",e.style.cssText=["position:fixed","inset:0 auto auto 0","max-width:100%","z-index:99999","background:rgba(8,8,10,0.82)","color:#fee2e2",'font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',"padding:10px","overflow:auto","display:none","white-space:pre-wrap","pointer-events:auto"].join(";");const i=document.createElement("div");i.style.cssText="display:flex;align-items:center;gap:8px;margin-bottom:8px;";const n=document.createElement("strong");n.textContent="Errors";const o=document.createElement("button");o.textContent="Dismiss",o.style.cssText="margin-left:auto;background:#ef4444;color:white;border:none;border-radius:4px;padding:4px 8px;",o.onclick=()=>{e.style.display="none",e.innerHTML="",e.appendChild(i),i.appendChild(n),i.appendChild(o)},i.appendChild(n),i.appendChild(o),e.appendChild(i),document.body.appendChild(e);const a=s=>{e.style.display="block";const r=document.createElement("div");r.textContent=s,e.appendChild(r)};window.__showErrorOverlay=a,window.addEventListener("error",s=>{var l;const r=((l=s==null?void 0:s.error)==null?void 0:l.stack)||(s==null?void 0:s.message)||String(s);a(`[error] ${r}`)}),window.addEventListener("unhandledrejection",s=>{const r=s.reason,l=r&&(r.stack||r.message)||String(r);a(`[unhandledrejection] ${l}`)})}Wr();(()=>{const t=window.__showErrorOverlay;if(!t)return;const e=console.error.bind(console),i=console.warn.bind(console);console.error=(...n)=>{try{t(`[console.error] ${n.map(o=>o&&(o.stack||o.message)?o.stack||o.message:String(o)).join(" ")}`)}catch{}e(...n)},console.warn=(...n)=>{try{t(`[console.warn] ${n.map(o=>o&&(o.stack||o.message)?o.stack||o.message:String(o)).join(" ")}`)}catch{}i(...n)}})();let me=document.getElementById("game");const De=document.getElementById("btnPause"),Jt=document.getElementById("btnHelp");document.getElementById("btnToggleUI");const nt=document.getElementById("btnMenu"),Ae=document.getElementById("headerDropdown"),Vt=document.getElementById("hd-new"),Zt=document.getElementById("hd-help"),Kt=document.getElementById("hd-build");document.getElementById("hd-toggle-mobile");const _t=document.getElementById("btnNew"),be=document.getElementById("help"),$t=document.getElementById("mobileControls"),ei=document.getElementById("mc-build"),ti=document.getElementById("mc-cancel"),ii=document.getElementById("mc-erase"),ni=document.getElementById("mc-pause"),oi=document.getElementById("mc-ff"),si=document.getElementById("mc-zoom-in"),ri=document.getElementById("mc-zoom-out");be&&(be.innerHTML=`
    <h2>How to play</h2>
    <div><b>Goal:</b> Gather wood & stone, build farms for food, add houses for pop cap; survive nightly raids with turrets/walls.</div>
  <div><b>Controls:</b> 1..9 quick-build, <b>B</b> build menu, <b>P</b> work priorities, LMB place, RMB cancel/erase; WASD pan; Space pause; H toggle help; +/- zoom; F fast-forward.</div>
  <div><b>UI Modes:</b> 📱 Mobile UI shows touch controls for tap/touch gameplay. 🖥️ Desktop UI is clean with keyboard shortcuts only.</div>
  `);async function Gr(){if(me=document.getElementById("game"),!me){const o=window.__showErrorOverlay,a='Fatal: Canvas element with id "game" not found in DOM.';throw o==null||o(a),new Error(a)}const t=me.getContext("2d");t&&(t.fillStyle="#0a0e14",t.fillRect(0,0,me.width,me.height),t.fillStyle="#dbeafe",t.font="24px system-ui",t.textAlign="center",t.fillText("Loading assets...",me.width/2,me.height/2));try{await fe.getInstance().loadAssets(),console.log("Assets loaded successfully"),console.log("House image loaded:",!!fe.getInstance().getImage("house"))}catch(o){console.warn("Some assets failed to load:",o);const a=window.__showErrorOverlay;a==null||a("Warning: some assets failed to load. See console for details.")}const e=new Nr(me);De&&(De.onclick=()=>{e.paused=!e.paused,De.textContent=e.paused?"Resume":"Pause"}),_t&&(_t.onclick=()=>{e.newGame()}),Jt&&(Jt.onclick=()=>{be&&(be.hidden=!be.hidden)});const i=document.getElementById("btnFSM"),n=document.getElementById("btnBlueprint");i&&(i.onclick=()=>{window.open("./fsm-editor.html","_blank")}),n&&(n.onclick=()=>{window.open("./blueprint-fsm-editor.html","_blank")}),Object.assign(window,{game:e,BUILD_TYPES:V,imageAssets:fe.getInstance()}),$t&&($t.hidden=!1),document.addEventListener("keydown",o=>{const a=[" ","h","b","f","g","j","escape","w","a","s","d","+","=","-","_"],s=/^[1-9]$/.test(o.key);(a.includes(o.key.toLowerCase())||s)&&document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()}),nt&&Ae&&(nt.onclick=()=>{Ae.hidden=!Ae.hidden},Vt&&(Vt.onclick=()=>{Ae.hidden=!0,e.newGame()}),Zt&&(Zt.onclick=()=>{Ae.hidden=!0,be&&(be.hidden=!be.hidden)}),Kt&&(Kt.onclick=()=>{Ae.hidden=!0,e.showBuildMenu=!e.showBuildMenu}),document.addEventListener("click",o=>{if(!Ae)return;const a=o.target;a&&!Ae.contains(a)&&a!==nt&&(Ae.hidden=!0)})),ei&&(ei.onclick=()=>{e.showBuildMenu=!e.showBuildMenu}),ti&&(ti.onclick=()=>{e.selectedBuild=null,e.pendingPlacement=null,e.toast("Build canceled")}),ii&&(ii.onclick=()=>{window._eraseOnce=!0,e.toast("Erase mode: tap on a building to remove")}),ni&&(ni.onclick=()=>{e.paused=!e.paused,De&&(De.textContent=e.paused?"Resume":"Pause")}),oi&&(oi.onclick=()=>{e.fastForward=e.fastForward===1?6:1,e.toast(e.fastForward>1?"Fast-forward ON":"Fast-forward OFF")}),si&&(si.onclick=()=>{e.camera.zoom=Math.max(.6,Math.min(2.2,e.camera.zoom*1.1))}),ri&&(ri.onclick=()=>{e.camera.zoom=Math.max(.6,Math.min(2.2,e.camera.zoom/1.1))})}try{const t=Gr();t&&typeof t.catch=="function"&&t.catch(e=>{const i=window.__showErrorOverlay,n=e&&(e.stack||e.message)?e.stack||e.message:String(e);i==null||i(`[init] ${n}`),console.error(e)})}catch(t){const e=window.__showErrorOverlay,i=t&&(t.stack||t.message)?t.stack||t.message:String(t);e==null||e(`[init-sync] ${i}`),console.error(t)}
